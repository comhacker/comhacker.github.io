<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>CISCN2024wp</title>
    <url>/posts/55463/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h2 id="ezCsky"><a href="#ezCsky" class="headerlink" title="ezCsky"></a>ezCsky</h2><p>é¢˜ç›®æè¿°ï¼š æŸä¸ªæ–°èƒ½æºæ±½è½¦ä½¿ç”¨äº†å›½äº§çš„äº¤å‰ç¼–è¯‘é“¾å¯¹tboxçš„å›ºä»¶ç¨‹åºè¿›è¡Œäº†ç¼–è¯‘ï¼Œä½ èƒ½é€šè¿‡é€†å‘å‘ç°å…¶ä¸­çš„ç§˜å¯†å—ï¼Ÿ</p>
<p>ç”¨DIEæŸ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªelfæ–‡ä»¶</p>
<p>å°è¯•ç”¨idaæ‰“å¼€ï¼Œå‘ç°ä»–è¯´â€œä¸åŒ…æ‹¬å¤„ç†å™¨ç±»å‹mcoreâ€ï¼Œç‚¹å‡»okå°±ç›´æ¥é€€å‡ºäº†</p>
<img src="/posts/55463/image-20241218215831091.png" class="" title="image-20241218215831091">

<p>æŸ¥äº†ä¸€ä¸‹é¢˜ç›®æè¿°ä¸­æåˆ°çš„äº¤å‰ç¼–è¯‘ï¼š<strong>äº¤å‰ç¼–è¯‘å™¨</strong>ï¼ˆè‹±è¯­ï¼šCross compilerï¼‰æ˜¯æŒ‡ä¸€ä¸ªåœ¨æŸä¸ªç³»ç»Ÿå¹³å°ä¸‹å¯ä»¥äº§ç”Ÿå¦ä¸€ä¸ªç³»ç»Ÿå¹³å°ç³»çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ç¼–è¯‘å™¨ã€‚æ²¡ä»€ä¹ˆä¿¡æ¯ã€‚</p>
<p>ä½¿ç”¨è™šæ‹Ÿæœºé‡Œé¢çš„readelfå·¥å…·æŸ¥çœ‹è¯¥elfæ–‡ä»¶çš„ä¿¡æ¯ï¼š</p>
<h6 id="readelfå·¥å…·"><a href="#readelfå·¥å…·" class="headerlink" title="readelfå·¥å…·"></a>readelfå·¥å…·</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ ¼å¼ï¼šreadelf -x æ–‡ä»¶å</span><br><span class="line">-h æˆ– --file-headerï¼šæ˜¾ç¤º ELF æ–‡ä»¶å¤´éƒ¨çš„ä¿¡æ¯ã€‚*****</span><br><span class="line">-l æˆ– --program-headersï¼Œæœ‰æ—¶ä¹Ÿç”¨ -pï¼šæ˜¾ç¤ºç¨‹åºå¤´éƒ¨è¡¨çš„å†…å®¹ï¼Œè¿™æè¿°äº†æ–‡ä»¶å¦‚ä½•æ˜ å°„åˆ°å†…å­˜ä¸­ã€‚</span><br><span class="line">-S æˆ– --section-headersï¼šæ˜¾ç¤ºèŠ‚å¤´éƒ¨è¡¨çš„ä¿¡æ¯ï¼Œå³æ–‡ä»¶ä¸­å„èŠ‚çš„åŸºæœ¬ä¿¡æ¯ã€‚</span><br><span class="line">-s æˆ– --symsï¼šæ˜¾ç¤ºæ–‡ä»¶çš„ç¬¦å·è¡¨å†…å®¹ã€‚*****</span><br><span class="line">-r æˆ– --relocsï¼šæ˜¾ç¤ºé‡å®šä½æ¡ç›®ã€‚</span><br><span class="line">-d æˆ– --dynamicï¼šæ˜¾ç¤ºåŠ¨æ€æ®µçš„ä¿¡æ¯ï¼Œè¿™å¯¹äºå…±äº«åº“æˆ–åŠ¨æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶å°¤ä¸ºé‡è¦ã€‚</span><br><span class="line">-n æˆ– --notesï¼šæ˜¾ç¤ºä»»ä½•å­˜åœ¨çš„æ³¨é‡Šæ®µè½ã€‚</span><br><span class="line">-u æˆ– --unwindï¼šæ˜¾ç¤º unwind è¡¨æ ¼ä¿¡æ¯ã€‚</span><br><span class="line">-x SEC æˆ– --hex-dump=SECï¼šä»¥åå…­è¿›åˆ¶è½¬å‚¨æŒ‡å®šèŠ‚çš„å†…å®¹ã€‚</span><br></pre></td></tr></table></figure>



<img src="/posts/55463/image-20241218220926597.png" class="" title="image-20241218220926597">

<p>å‘ç°MCOREæ¶æ„çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨fileå‘½ä»¤ï¼šfile + æ–‡ä»¶å</p>
<img src="/posts/55463/image-20241218221522667.png" class="" title="image-20241218221522667">

<p>å‘ç°ä»–æ˜¯Motorola RCEæ¶æ„çš„ã€‚</p>
<h6 id="è®¡ç®—æœºæ¶æ„ï¼š"><a href="#è®¡ç®—æœºæ¶æ„ï¼š" class="headerlink" title="è®¡ç®—æœºæ¶æ„ï¼š"></a>è®¡ç®—æœºæ¶æ„ï¼š</h6><p>Motorola RCE (RISC Core Engine)ï¼Œå…¨ç§°ä¸ºMotorola RISC Core Engineï¼Œæ˜¯ç”± Motorolaå¼€å‘ï¼ŒåŸºäº RISC æ¶æ„çš„å¤„ç†å™¨æ¶æ„ã€‚</p>
<p>RISCæ˜¯ä¸€ç§å¼€æºæŒ‡ä»¤é›†æ¶æ„ã€‚</p>
<p>æŒ‡ä»¤é›†æ¶æ„(ISA)æ˜¯æŒ‡å®šè®¡ç®—æœºç¡¬ä»¶å¦‚ä½•æ‰§è¡ŒåŸºæœ¬æ“ä½œçš„ä¸€ç»„è§„åˆ™å’Œæ ¼å¼ï¼Œè€Œå¤„ç†å™¨æ¶æ„ï¼ˆå¦‚ARM æ¶æ„å’Œx86æ¶æ„ï¼‰æ˜¯æŒ‡å¤„ç†å™¨å†…éƒ¨çš„å…·ä½“è®¾è®¡å®ç°ï¼Œå¤„ç†å™¨æ¶æ„å¿…é¡»éµå¾ªæŸä¸ªç‰¹å®šçš„ ISAã€‚ISA æ˜¯ä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„æ¦‚å¿µï¼Œå®šä¹‰äº†å¤„ç†å™¨åº”è¯¥å¦‚ä½•å·¥ä½œï¼›è€Œå¤„ç†å™¨æ¶æ„åˆ™æ˜¯æ›´å…·ä½“çš„è®¾è®¡å®ç°ï¼Œæè¿°äº†å®é™…çš„ç¡¬ä»¶æ˜¯å¦‚ä½•æ„å»ºæ¥æ»¡è¶³ ISA çš„è¦æ±‚ã€‚</p>
<p>ç”±æ­¤å¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸ªelfä½¿ç”¨äº†RISCæ¶æ„ï¼Œä¹‹å‰IDAæ— æ³•åç¼–è¯‘æ˜¯é€‰é”™äº†æ¶æ„ã€‚</p>
<p>æ¥ç€ï¼Œç»§ç»­ä½¿ç”¨readelfæŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼š</p>
<p>readelf -s æ–‡ä»¶å  ï¼šæŸ¥çœ‹ç¬¦å·è¡¨</p>
<img src="/posts/55463/image-2024-12-18223425.png" class="" title="image-2024-12-18223425">

<p>æ³¨æ„åˆ°æœ‰xorå‡½æ•°ã€checkå‡½æ•°å’ŒRC4åŠ å¯†ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨IDAåç¼–è¯‘ï¼Œéœ€è¦å…ˆæ‰‹åŠ¨é€‰æ‹©RISCæ¶æ„ï¼š</p>
<img src="/posts/55463/image-2024-12-18223808.png" class="" title="image-2024-12-18223808">

<img src="/posts/55463/image2024-12-18223941.png" class="" title="image2024-12-18223941">

<p>ç”±è¿™é‡Œçš„RC4åŠ å¯†å¯ä»¥æ¨çŸ¥ï¼Œâ€™testkeyâ€™å°±æ˜¯å¯†é’¥ï¼Œunk_8AA0å°±æ˜¯å¯†æ–‡</p>
<img src="/posts/55463/image-20241218224642852.png" class="" title="image-20241218224642852">

<p>ç›´æ¥RC4è§£å¯†å¾—ä¸åˆ°flagï¼Œæ ¹æ®å‰é¢åœ¨ç¬¦å·è¡¨é‡Œé¢çœ‹åˆ°çš„ä¸œè¥¿ï¼Œè¿˜æœ‰ä¸€ä¸ªxorå‡½æ•°ã€‚</p>
<p>å…ˆå°è¯•ç”¨â€flag{â€œå¤´æ¥åæ¨å¼‚æˆ–çš„å¯†é’¥ï¼š</p>
<img src="/posts/55463/image-20241218224927370.png" class="" title="image-20241218224927370">

<p>å‘ç°æ¨åˆ°çš„å¯†é’¥å¾ˆåƒflagï¼Œæ„å‘³ç€å®ƒæ˜¯flagè‡ªèº«è¿›è¡Œå‰åå¼‚æˆ–ã€‚å†™è„šæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">/*åˆå§‹åŒ–å‡½æ•°*/</span><br><span class="line">void rc4_init(unsigned char*s, unsigned char*key, unsigned long Len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0, j = 0;</span><br><span class="line">    char k[256] = &#123; 0 &#125;;</span><br><span class="line">    unsigned char tmp = 0;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        j = (j + s[i] + k[i]) % 256;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[i]å’Œs[j]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">/*åŠ è§£å¯†*/</span><br><span class="line">void rc4_crypt(unsigned char*s, unsigned char*Data, unsigned long Len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0, j = 0, t = 0;</span><br><span class="line">    unsigned long k = 0;</span><br><span class="line">    unsigned char tmp;</span><br><span class="line">    for (k = 0; k&lt;Len; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = (i + 1) % 256;</span><br><span class="line">        j = (j + s[i]) % 256;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[x]å’Œs[y]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t = (s[i] + s[j]) % 256;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char flag[]=</span><br><span class="line">    &#123;</span><br><span class="line">     	0x96, 0x8F, 0xB8, 0x08, 0x5D, 0xA7, 0x68, 0x44, 0xF2, 0x64,</span><br><span class="line">        0x92, 0x64, 0x42, 0x7A, 0x78, 0xE6, 0xEA, 0xC2, 0x78, 0xB8,</span><br><span class="line">        0x63, 0x9E, 0x5B, 0x3D, 0xD9, 0x28, 0x3F, 0xC8, 0x73, 0x06,</span><br><span class="line">        0xEE, 0x6B, 0x8D, 0x0C, 0x4B, 0xA3, 0x23, 0xAE, 0xCA, 0x40,</span><br><span class="line">        0xED, 0xD1</span><br><span class="line">    &#125;; </span><br><span class="line">    unsigned char key[]=&quot;testkey&quot;;</span><br><span class="line">    unsigned  char s[256]=&#123;0&#125;;</span><br><span class="line">    rc4_init(s,key,7);    //ç¬¬ä¸‰ä½æ˜¯keyé•¿åº¦ </span><br><span class="line">    rc4_crypt(s,flag,42);  //ç¬¬ä¸‰ä½æ˜¯sé•¿åº¦ </span><br><span class="line">    int i;</span><br><span class="line">    for(i=40;i&gt;=0;i--)&#123;</span><br><span class="line">        flag[i]^=flag[i+1];</span><br><span class="line">    &#125;</span><br><span class="line">    for(i=0;i&lt;42;i++)&#123;</span><br><span class="line">        printf(&quot;%c&quot;,flag[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; //flag&#123;d0f5b330-9a74-11ef-9afd-acde48001122&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>DASCTF2024</title>
    <url>/posts/42198/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<p>å»èŠ±ä¹‹åé‡æ–°è¯†åˆ«å¾—åˆ°ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œè§£å¯†å‡ºæ¥æ˜¯fakeflag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt; </span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">void xor(unsigned char *data)&#123;</span><br><span class="line">  int i;</span><br><span class="line">  char c[]=&quot;Laughter_is_poison_to_fear&quot;;</span><br><span class="line">  for(i=0;i&lt;48;i++)&#123;</span><br><span class="line">    printf(&quot;%c&quot;,data[i]^c[i%26]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">void encrypt(uint32_t* v,uint32_t* key)</span><br><span class="line">&#123;</span><br><span class="line">	uint32_t k0,k1,k2,k3;</span><br><span class="line">	uint32_t v0,v1;</span><br><span class="line">	v0=v[0],v1=v[1];</span><br><span class="line">	k0=key[0],k1=key[1],k2=key[2],k3=key[3];</span><br><span class="line">	uint32_t delta=0x9E3779B9,sum=0;</span><br><span class="line">	for(int i=0;i&lt;32;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v0+=((v1&lt;&lt;4) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;5) + k1);</span><br><span class="line">		v1+=((v0&lt;&lt;4) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;5) + k3); </span><br><span class="line">	&#125;</span><br><span class="line">	v[0]=v0,v[1]=v1;</span><br><span class="line">&#125;</span><br><span class="line">void decrypt(uint32_t* v,uint32_t* key)</span><br><span class="line">&#123;</span><br><span class="line">	uint32_t k0,k2,k3,k1;</span><br><span class="line">	uint32_t v0,v1;</span><br><span class="line">	v0=v[0],v1=v[1];</span><br><span class="line">	k0=key[0],k1=key[1],k2=key[2],k3=key[3];</span><br><span class="line">	uint32_t delta=0x61C88647,sum=0-0x61C88647*32;</span><br><span class="line">	for(int i=0;i&lt;32;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		v1 -= (sum + key[(sum &gt;&gt; 11) &amp; 3]) ^ (v0 + ((16 * v0) ^ (v0 &gt;&gt; 5)));</span><br><span class="line">		sum += 0x61C88647;</span><br><span class="line">		v0 -= (sum + key[sum &amp; 3]) ^ (v1 + ((16 * v1) ^ (v1 &gt;&gt; 5)));</span><br><span class="line">	&#125;</span><br><span class="line">	v[0]=v0,v[1]=v1;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	unsigned char s[50]=&#123;</span><br><span class="line">    0xc2,0x39,0x3f,0xf7,0xeb,0x24,0x94,0x4d,0x99,0x41,</span><br><span class="line">    0x7e,0xfc,0x41,0x79,0xab,0xc8,0x5e,0xd0,0x3b,0xd7,</span><br><span class="line">    0x85,0x63,0xd3,0x1d,0xcb,0x98,0x5a,0x6,0x21,0x8b,</span><br><span class="line">    0xa3,0xd8,0xe3,0x86,0x1a,0x37,0x4a,0x8a,0x5c,0xd2,</span><br><span class="line">    0x53,0xcb,0x14,0x3c,0x89,0xeb,0x71,0xeb</span><br><span class="line">    &#125;;</span><br><span class="line">	char key[]=&quot;&#123;you_find_it_!?&#125;&quot;;</span><br><span class="line">	for(int i=0;i&lt;48;i+=8)</span><br><span class="line">	&#123;</span><br><span class="line">		decrypt((uint32_t*)&amp;s[i],(uint32_t*)key);	</span><br><span class="line">	&#125;</span><br><span class="line">	// printf(&quot;%s&quot;,s);	</span><br><span class="line">  xor(s);	  </span><br><span class="line"> &#125; fakeflag_plz_Try_more_hard_to_find_the_true_flag</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å…¶ä»–ä¿¡æ¯ï¼ŒåŠ¨è°ƒçœ‹çœ‹</p>
<p>å‘ç°åœ¨æ‰§è¡Œå®Œäº†è¯¥åŠ å¯†å‡½æ•°åè°ƒè½¬åˆ°äº†å¦ä¸€ä¸ªå‡½æ•°</p>
<img src="/posts/42198/image-20241228163913938.png" class="" title="image-20241228163913938">

<p>ç»è¿‡è¿™ä¸ªSMCï¼ŒåŠ¨è°ƒåˆ°ç¬¬14è¡Œï¼Œå•æ­¥æ­¥å…¥ï¼ˆF7ï¼‰ã€‚</p>
<p>è·³è½¬åˆ°äº†ä¸€å †æ±‡ç¼–ä»£ç </p>
<img src="/posts/42198/image-20241228164136913.png" class="" title="image-20241228164136913">

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">debug042:005D1020 db    0</span><br><span class="line">debug042:005D1021 ; ---------------------------------------------------------------------------</span><br><span class="line">debug042:005D1021 mov     ecx, 77h ; &#x27;w&#x27;</span><br><span class="line">debug042:005D1026 call    $+5   //å°†ä¸‹ä¸€æ¡æŒ‡ä»¤å…¥æ ˆ</span><br><span class="line">debug042:005D102B pop     ebx  // æ‰§è¡Œå®Œåebx=005D102B</span><br><span class="line">debug042:005D102C mov     [ebx-0Bh], cl   // å°†0x77å­˜åœ¨[ebx-b](å³005D1020)å¤„</span><br><span class="line">debug042:005D102F push    ebp </span><br><span class="line">debug042:005D1030 pusha        		//å°†æ‰€æœ‰é€šç”¨å¯„å­˜å™¨å…¥æ ˆ</span><br><span class="line">debug042:005D1031 pushf				//å°†æ‰€æœ‰æ ‡å¿—å¯„å­˜å™¨å…¥æ ˆ</span><br><span class="line">debug042:005D1032 call    $+5</span><br><span class="line">debug042:005D1037 pop     eax   //å°†æœ¬æŒ‡ä»¤åœ°å€ä¼ ç»™eax</span><br><span class="line">debug042:005D1038 xor     edx, edx</span><br><span class="line">debug042:005D103A mov     dl, [eax-17h]  //å°†[eax-17](å³005D1020)é‡Œé¢çš„å€¼(0x77)èµ‹å€¼åˆ°edxä½ä½</span><br><span class="line">debug042:005D1040 xor     edx, 1D82h   		</span><br><span class="line">debug042:005D1046 lea     ebx, [eax+edx]	//è®¡ç®—eax+edxçš„å€¼ï¼Œèµ‹å€¼ç»™ebx</span><br><span class="line">debug042:005D1049 mov     ecx, 35h ; &#x27;5&#x27;    //å°†0x55èµ‹å€¼ç»™ecxï¼Œä¸ºä¸‹ä¸€æ®µæ±‡ç¼–ä»£ç åšå‡†å¤‡</span><br><span class="line">debug042:005D104E mov     byte ptr [eax-17h], 0   //å°†005D1020å¤„é‡æ–°å¡«å›0</span><br><span class="line">debug042:005D1055 jmp     ebx 		//è·³åˆ°005D2E2Cå¤„</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ®µæ±‡ç¼–å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸ºäº†è·³è½¬åšå‡†å¤‡ï¼Œé™¤äº†005D102Få¤„çš„push    ebp ã€‚æ¥ä¸‹æ¥çœ‹005D2E2Cå¤„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">debug042:005D2E2B db  35h ; 5</span><br><span class="line">debug042:005D2E2C ; ---------------------------------------------------------------------------</span><br><span class="line">debug042:005D2E2C call    $+5</span><br><span class="line">debug042:005D2E31 pop     ebx   //è·å–å½“å‰æŒ‡ä»¤åœ°å€</span><br><span class="line">debug042:005D2E32 mov     [ebx-6], cl   //å°†0x35èµ‹å€¼ç»™[ebx-6](å³005D2E2B)å¤„</span><br><span class="line">debug042:005D2E35 popf   		//é€šç”¨å¯„å­˜å™¨å‡ºæ ˆï¼Œå¯¹åº”å‰é¢ä¸€æ®µæ±‡ç¼–çš„å‹æ ˆ</span><br><span class="line">debug042:005D2E36 popa</span><br><span class="line">debug042:005D2E37 mov     ebp, esp</span><br><span class="line">debug042:005D2E39 pusha</span><br><span class="line">debug042:005D2E3A pushf</span><br><span class="line">debug042:005D2E3B call    $+5</span><br><span class="line">debug042:005D2E40 pop     eax</span><br><span class="line">debug042:005D2E41 xor     edx, edx</span><br><span class="line">debug042:005D2E43 mov     dl, [eax-15h]</span><br><span class="line">debug042:005D2E49 xor     edx, 1A12h</span><br><span class="line">debug042:005D2E4F lea     ebx, [eax+edx]</span><br><span class="line">debug042:005D2E52 mov     ecx, 69h ; &#x27;i&#x27;     //å°†0x69èµ‹å€¼ç»™ecxï¼Œä¸ºä¸‹ä¸€æ®µæ±‡ç¼–ä»£ç åšå‡†å¤‡</span><br><span class="line">debug042:005D2E57 mov     byte ptr [eax-15h], 0</span><br><span class="line">debug042:005D2E5E jmp     ebx</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ®µä¹Ÿå°±æ˜¯005D2E37å¤„çš„mov     ebp, espæœ‰ç”¨ï¼Œå…¶ä»–å°±æ˜¯ä¸ºä¸‹ä¸€æ¬¡è·³è½¬åšå‡†å¤‡</p>
]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>ESPå®šå¾‹è„±å£³</title>
    <url>/posts/43303/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>åŠ å£³æ˜¯åˆ©ç”¨ç‰¹æ®Šçš„ç®—æ³•äº‹å…ˆå¯¹ç¨‹åºæºä»£ç è¿›è¡Œå‹ç¼©ï¼Œå¹¶å‘ç¨‹åºé‡Œé¢æ³¨å…¥è§£å‹çš„ä»£ç ï¼Œè¿™æ®µè§£å‹ä»£ç ä¼šå…ˆäºæºä»£ç æ‰§è¡Œã€‚åœ¨ç¨‹åºæ‰§è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨å°†åŸå§‹ä»£ç è¿›è¡Œè§£å‹ï¼Œç„¶åè·³è½¬åˆ°åŸç¨‹åºçš„å…¥å£ç‚¹ï¼Œç»§ç»­æ‰§è¡ŒåŸç¨‹åºã€‚è€Œåœ¨æ‰§è¡Œå®Œè§£å‹è¿‡ç¨‹åéœ€è¦å°†æ ˆæ¢å¤åˆ°è§£å‹å‰çš„çŠ¶æ€ï¼Œå³ESPä¼šå›åˆ°è§£å‹å‰çš„ä½ç½®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­ESPæ˜¯å¦å›åˆ°åˆå§‹ä½ç½®æ¥åˆ¤æ–­ç¨‹åºæ˜¯å¦å·²ç»è¾¾åˆ°å…¥å£ç‚¹ï¼ˆOEPï¼‰ã€‚</p>
<p>æ¥ä¸‹æ¥ä»¥è„±upxå£³ä¸ºä¾‹ï¼š</p>
<p>ç¨‹åºæºä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">int main() &#123;</span><br><span class="line">	char s[] = &quot;ek`fz`abcdefg|&quot;;</span><br><span class="line">	char input[15];</span><br><span class="line">	int i;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½ çš„flag:\n&quot;);</span><br><span class="line">	scanf(&quot;%14s&quot;, input,sizeof(input));</span><br><span class="line">	for (i = 0; i &lt; 14; i++)</span><br><span class="line">		input[i] -= 1;</span><br><span class="line">	if (!strcmp(input, s))</span><br><span class="line">		printf(&quot;right!&quot;);</span><br><span class="line">	else</span><br><span class="line">		printf(&quot;wrong!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ“ä½œæ–¹æ³•"><a href="#æ“ä½œæ–¹æ³•" class="headerlink" title="æ“ä½œæ–¹æ³•"></a>æ“ä½œæ–¹æ³•</h1><p>ä¸€å…±åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ol>
<li>å¯»æ‰¾OEP</li>
<li>dumpå‡ºåˆæ­¥çš„è„±å£³ç¨‹åº</li>
<li>ä¿®å¤ç¨‹åº</li>
</ol>
<h2 id="1ã€å¯»æ‰¾OEP"><a href="#1ã€å¯»æ‰¾OEP" class="headerlink" title="1ã€å¯»æ‰¾OEP"></a>1ã€å¯»æ‰¾OEP</h2><p>ä½¿ç”¨xdbgæ‰“å¼€</p>
<img src="/posts/43303/image-20241206232732823.png" class="" title="image-20241206232732823">

<p>å¯ä»¥çœ‹åˆ°å¼€å§‹å°±æ˜¯pushadæŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤æ˜¯å°†æ‰€æœ‰å¯„å­˜å™¨éƒ½å‹å…¥æ ˆã€‚</p>
<p>ä¸€èˆ¬çš„å£³éƒ½ä¼šåœ¨å¼€å§‹æ—¶è¿›è¡Œå‹æ ˆï¼Œç„¶ååœ¨è§£å‹ç»“æŸæ—¶è¿›è¡Œå‡ºæ ˆã€‚</p>
<p>æ­¤æ—¶æŒ‰F8å•æ­¥æ­¥è¿‡ï¼Œå¯ä»¥çœ‹åˆ°å³è¾¹çš„ESPå‘ç”Ÿäº†å˜åŒ–</p>
<img src="/posts/43303/image-20241206232654462.png" class="" title="image-20241206232654462">

<p>ç‚¹å‡»å³è¾¹ESPï¼ŒæŒ‰å³é”®ï¼Œé€‰å†…å­˜çª—å£ä¸­è½¬åˆ°ï¼Œå†…å­˜1</p>
<img src="/posts/43303/image-20241206232906388.png" class="" title="image-20241206232906388">

<p>æ­¤æ—¶å·¦ä¸‹è§’çš„å†…å­˜çª—å£å·²ç»è½¬ç§»åˆ°ESPçš„ä½ç½®</p>
<img src="/posts/43303/image-20241206233019638.png" class="" title="image-20241206233019638">

<p>é€‰å®šç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ŒæŒ‰å³é”®ï¼Œæ–­ç‚¹ï¼Œç¡¬ä»¶è®¿é—®ï¼Œæ¥ä¸‹æ¥ä¸‰ä¸ªé‡Œé¢éšä¾¿é€‰ä¸€ä¸ª</p>
<img src="/posts/43303/image-20241206233108832.png" class="" title="image-20241206233108832">

<p>æ­¤æ—¶ä¸‹å¥½äº†æ–­ç‚¹ï¼ŒæŒ‰F9è®©ç¨‹åºä¸€ç›´è¿è¡Œç›´åˆ°æ–­ç‚¹å¤„</p>
<img src="/posts/43303/image-20241211210508761.png" class="" title="image-20241211210508761">

<p>æ³¨æ„æ­¤æ—¶çš„ESPå›åˆ°äº†åˆšç”¨xdbgæ‰“å¼€æ—¶çš„å€¼0x0061FF78ï¼Œæ­¤æ—¶å£³å·²ç»è§£å‹å®Œäº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªå¤§çš„è·³è½¬å°±æ˜¯è·³è½¬åˆ°OEPå¤„ã€‚</p>


<p>åœ¨è·³è½¬åˆ°OEPå‰æœ‰ä¸€æ®µå¾€å›é€€çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦è·³è¿‡è¿™æ®µä»£ç æ‰§è¡Œåˆ°jmpé‚£é‡Œã€‚</p>
<p>å•å‡»0041E963 å¤„çš„jmp u.4014E0æŒ‡ä»¤å¯¹å…¶é€‰å®šï¼ŒæŒ‰F4å°±åœåœ¨äº†è¿™ä¸ªåœ°å€å¤„ï¼Œæ¥ä¸‹æ¥æŒ‰F8å¾€åè¿è¡Œä¸€æ­¥ï¼Œç›´æ¥è·³è½¬åˆ°äº†0x4014E0åœ°å€å¤„ï¼Œè¿™é‡Œå°±æ˜¯OEPï¼ˆç¨‹åºå…¥å£ç‚¹ï¼‰<img src="/posts/43303/image-20241211211507576.png" class="" title="image-20241211211507576"></p>
<h2 id="2ã€dumpå‡ºåˆæ­¥çš„è„±å£³ç¨‹åº"><a href="#2ã€dumpå‡ºåˆæ­¥çš„è„±å£³ç¨‹åº" class="headerlink" title="2ã€dumpå‡ºåˆæ­¥çš„è„±å£³ç¨‹åº"></a>2ã€dumpå‡ºåˆæ­¥çš„è„±å£³ç¨‹åº</h2><p>å…ˆç‚¹å‡»ä¸Šæ–¹çš„æ–­ç‚¹çª—å£ï¼Œè¿™é‡Œä¼šæŠŠæ‰€æœ‰æ–­ç‚¹åˆ—å‡ºæ¥</p>


<img src="/posts/43303/image-20241211211858516.png" class="" title="image-20241211211858516">

<p>å•å‡»ä¸€ä¸‹åˆšæ‰è®¾ç½®çš„æ–­ç‚¹ï¼ŒæŒ‰å³é”®ï¼Œé€‰æ‹©åˆ é™¤æ–­ç‚¹</p>
<img src="/posts/43303/image-20241211211951774.png" class="" title="image-20241211211951774">

<p>å›åˆ°cpuçª—å£ï¼Œæ­¤æ—¶çš„ç¨‹åºæ˜¯è„±å£³å®Œæˆçš„ç¨‹åºï¼Œç‚¹å‡»ä¸Šé¢ç¬¬äºŒæ’çš„scyllaå·¥å…·</p>
<img src="/posts/43303/image-20241211212248223.png" class="" title="image-20241211212248223">

<img src="/posts/43303/image-20241211212600034.png" class="" title="image-20241211212600034">

<p>ç‚¹å‡»dumpï¼Œä¼šç”Ÿæˆä¸€ä¸ªdump.exeæ–‡ä»¶.</p>
<h2 id="3ã€ä¿®å¤ç¨‹åº"><a href="#3ã€ä¿®å¤ç¨‹åº" class="headerlink" title="3ã€ä¿®å¤ç¨‹åº"></a>3ã€ä¿®å¤ç¨‹åº</h2><p>æ­¤æ—¶çš„ç”Ÿæˆçš„exeæ–‡ä»¶è¿˜æ˜¯æœ‰é—®é¢˜çš„æ–‡ä»¶ï¼Œå¯èƒ½ä¼šè¿è¡Œå¤±è´¥ï¼Œå› ä¸ºè„±å£³è¿‡ç¨‹å¯èƒ½ä¼šæ”¹å˜ç¨‹åºçš„æ•°æ®æ®µã€å¯¼å…¥è¡¨ã€å¯¼å‡ºè¡¨ç­‰å†…å®¹ã€‚æ‰€ä»¥éœ€è¦å°†è¿™äº›è¡¨æ ¼å’Œæ•°æ®æ¢å¤åˆ°è„±å£³å‰çš„çŠ¶æ€ï¼Œç¡®ä¿ç¨‹åºèƒ½å¤Ÿæ­£ç¡®åŠ è½½æ‰€éœ€çš„åº“å’Œå‡½æ•°ã€‚</p>
<p>è¿˜æ˜¯åˆšæ‰é‚£ä¸ªScyllaæ’ä»¶ï¼Œç‚¹å‡»IAT Autosearchã€Get Imports</p>
<img src="/posts/43303/image-20241211213131379.png" class="" title="image-20241211213131379">

<img src="/posts/43303/image-20241211213238362.png" class="" title="image-20241211213238362">

<p>æ­¤æ—¶æŒ‰Fix Dumpï¼Œé€‰æ‹©åˆšæ‰dumpå‡ºçš„dump.exeæ–‡ä»¶ï¼Œç‚¹æ‰“å¼€</p>
<img src="/posts/43303/image-20241211213350764.png" class="" title="image-20241211213350764">

<p>æ­¤æ—¶ä¼šåœ¨ç›¸åŒç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªdump_SCY.exeæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯è„±å£³å®Œæˆçš„ç¨‹åºã€‚</p>
]]></content>
      <tags>
        <tag>Reverse</tag>
      </tags>
  </entry>
  <entry>
    <title>GHCTF</title>
    <url>/posts/18925/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h1 id="ASM-Signin"><a href="#ASM-Signin" class="headerlink" title="ASM?Signin!"></a>ASM?Signin!</h1><p>è„šæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">void swap(unsigned char a[],int l,int h)&#123;</span><br><span class="line">    int i=0;</span><br><span class="line">    unsigned char temp;</span><br><span class="line">    for(i=0;i&lt;4;i++)&#123;</span><br><span class="line">      temp=a[l];</span><br><span class="line">      a[l]=a[h];</span><br><span class="line">      a[h]=temp;</span><br><span class="line">      l++;</span><br><span class="line">      h++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    unsigned char data1[33]=&#123;0x26,0x27,0x24,0x25,0x2A,0x2B,0x28,0x00,</span><br><span class="line">        0x2E,0x2F,0x2C,0x2D,0x32,0x33,0x30,0x00,</span><br><span class="line">        0x36,0x37,0x34,0x35,0x3A,0x3B,0x38,0x39,</span><br><span class="line">        0x3E,0x3F,0x3C,0x3D,0x3F,0x27,0x34,0x11&#125;;</span><br><span class="line">    int i=0,j=0,k=0;</span><br><span class="line">    for(k=0;k&lt;8;k++)&#123;    //é”™ä½äº¤æ¢éƒ¨åˆ†</span><br><span class="line">        j=i;</span><br><span class="line">        j+=4;</span><br><span class="line">        if(j&gt;=28) j-=28;</span><br><span class="line">        swap(data1,i,j);</span><br><span class="line">        i+=4;</span><br><span class="line">    &#125;</span><br><span class="line">    unsigned char data2[]=&#123;0x69,0x77,0x77,0x66,0x73,0x72,0x4F,0x46,</span><br><span class="line">                           0x03,0x47,0x6F,0x79,0x07,0x41,0x13,0x47,</span><br><span class="line">                           0x5E,0x67,0x5F,0x09,0x0F,0x58,0x63,0x7D,</span><br><span class="line">                           0x5F,0x77,0x68,0x35,0x62,0x0D,0x0D,0x50&#125;;</span><br><span class="line">    for(i=31;i&gt;0;i-=4)&#123;     //é”™ä½å¼‚æˆ–è§£å¯†éƒ¨åˆ†</span><br><span class="line">        data2[i]^=data1[i];</span><br><span class="line">        data2[i-1]^=data1[i-1];</span><br><span class="line">        data2[i-2]^=data1[i-1];</span><br><span class="line">        data2[i-3]^=data1[i-2];</span><br><span class="line">    &#125;</span><br><span class="line">    for(i=0;i&lt;32;i++) printf(&quot;%c&quot;,data2[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="FishingKit"><a href="#FishingKit" class="headerlink" title="FishingKit"></a>FishingKit</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt; </span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">void encrypt(uint32_t* v,uint32_t* key)</span><br><span class="line">&#123;</span><br><span class="line">	uint32_t k0,k1,k2,k3;</span><br><span class="line">	uint32_t v0,v1;</span><br><span class="line">	v0=v[0],v1=v[1];</span><br><span class="line">	k0=key[0],k1=key[1],k2=key[2],k3=key[3];</span><br><span class="line">	uint32_t delta=0x9E3779B9,sum=0;</span><br><span class="line">	for(int i=0;i&lt;32;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v0+=((v1&lt;&lt;4) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;5) + k1);</span><br><span class="line">		v1+=((v0&lt;&lt;4) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;5) + k3); </span><br><span class="line">	&#125;</span><br><span class="line">	v[0]=v0,v[1]=v1;</span><br><span class="line">&#125;</span><br><span class="line">void decrypt(uint32_t* v,uint32_t* key)</span><br><span class="line">&#123;</span><br><span class="line">	uint32_t k0,k2,k3,k1;</span><br><span class="line">	uint32_t v0,v1;</span><br><span class="line">	v0=v[0],v1=v[1];</span><br><span class="line">	k0=key[0],k1=key[1],k2=key[2],k3=key[3];</span><br><span class="line">	uint32_t delta=0x66778899,v5=0x66778899*24;</span><br><span class="line">	for(int i=0;i&lt;24;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		v1 -= (key[(v5 &gt;&gt; 11) &amp; 3] + v5) ^ (v0 + ((v0 &gt;&gt; 5) ^ (16 * v0)));</span><br><span class="line">        v5 -= 0x66778899;</span><br><span class="line">        v0 -= (key[v5 &amp; 3] + v5) ^ (v1 + ((v1 &gt;&gt; 5) ^ (16 * v1)));</span><br><span class="line">	&#125;</span><br><span class="line">	v[0]=v0,v[1]=v1;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	unsigned char s[24]=&#123;0x21, 0x56, 0x97, 0xA6, 0x1A, 0xD5, 0xC4, 0xDE, 0xA4, 0x9C, </span><br><span class="line">                        0x82, 0x4D, 0xD1, 0x45, 0xC8, 0x56, 0xA7, 0xB4, 0x96, 0x5C, </span><br><span class="line">                        0x4D, 0x49, 0x87, 0x20&#125;;</span><br><span class="line">	uint32_t key[4]=&#123;0x756C6544,0x61426578,0x7469,0x0&#125;;</span><br><span class="line">	for(int i=0;i&lt;24;i+=8)</span><br><span class="line">	&#123;</span><br><span class="line">		decrypt((uint32_t*)&amp;s[i],key);	</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;%s&quot;,s);		  </span><br><span class="line"> &#125; //NSSCTF&#123;Wh@t_@_b1g_F1sh&#125;</span><br></pre></td></tr></table></figure>

<h1 id="LockedSecret"><a href="#LockedSecret" class="headerlink" title="LockedSecret"></a>LockedSecret</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">void decrypt(uint32_t* v,uint32_t* key)</span><br><span class="line">&#123;</span><br><span class="line">	uint32_t k0,k2,k3,k1;</span><br><span class="line">	uint32_t v0,v1;</span><br><span class="line">	v0=v[0]^0xf,v1=v[1]^0xf;</span><br><span class="line">	k0=key[0],k1=key[1],k2=key[2],k3=key[3];</span><br><span class="line">	uint32_t delta=0x5E2377FF,sum=0x5E2377FF*8;</span><br><span class="line">	for(int i=0;i&lt;8;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		v1-=(key[3]+(v0&gt;&gt;5))^(v0+sum)^(key[2]+16*v0);</span><br><span class="line">		v0-=(key[1]+(v1&gt;&gt;5))^(v1+sum)^(key[0]+16*v1);</span><br><span class="line">		sum-=delta;</span><br><span class="line">	&#125;</span><br><span class="line">	v[0]=v0,v[1]=v1;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	uint8_t s[32]=&#123;0xDC, 0x45, 0x1E, 0x03, 0x89, 0xE9, 0x76, 0x27, 0x47, 0x48, </span><br><span class="line">        0x23, 0x01, 0x70, 0xD2, 0xCE, 0x64, 0xDA, 0x7F, 0x46, 0x33, </span><br><span class="line">        0xB1, 0x03, 0x49, 0xA3, 0x27, 0x00, 0xD1, 0x2C, 0x37, 0xB3, </span><br><span class="line">        0xBD, 0x75 &#125;;</span><br><span class="line">	uint32_t key[4]=&#123;0x423DF72D, 0x5F59A01, 0x633FCF1D, 0x77D19122&#125;;</span><br><span class="line">	for(int i=0;i&lt;4;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		decrypt((uint32_t*)&amp;s[i*8],key);	</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;%s&quot;,s);		  </span><br><span class="line"> &#125; // NSSCTF&#123;!!!Y0u_g3t_th3_s3cr3t!!!&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Mio-Ryo-Syo"><a href="#Mio-Ryo-Syo" class="headerlink" title="Mio?Ryo?Syo?"></a>Mio?Ryo?Syo?</h1><p>å¿…é¡»è¦åœ¨python3.8çš„ç¯å¢ƒä¸‹æ‰èƒ½å¾—åˆ°ä¸¤ä¸ªåº“çš„pycæ–‡ä»¶ï¼ˆSecret.pycå’ŒSecretEncrypt.pycï¼‰ï¼Œæˆ‘ç”µè„‘æ˜¯3.12ï¼Œæ‰€ä»¥æ‰¾åŠå¤©ä¹Ÿæ²¡æ‰¾åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶ğŸ™Œ</p>
<p>ä½¿ç”¨pycdcåç¼–è¯‘ä¸‰ä¸ªpycæ–‡ä»¶ï¼Œè¿›è¡Œé€‚å½“çš„ä¿®å¤ï¼Œå¾—åˆ°æºä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import math</span><br><span class="line">class class0:</span><br><span class="line">    table85 = &#x27;&#x27;.join((lambda _0: [ chr(j) for j in _0 ])(range(33, 118)))</span><br><span class="line"></span><br><span class="line">    def base85(x3 = None):</span><br><span class="line">        x1 = &#x27;&#x27;</span><br><span class="line">        x2 = (4 - len(x3) % 4) % 4</span><br><span class="line">        x3 += b&#x27;\x00&#x27; * x2</span><br><span class="line">        for i in range(0, len(x3), 4):</span><br><span class="line">            x4 = x3[i:i + 4]</span><br><span class="line">            x5 = int.from_bytes(x4, &#x27;big&#x27;)</span><br><span class="line">            x6 = &#x27;&#x27;</span><br><span class="line">            for _ in range(5):</span><br><span class="line">                x6 = class0.table85[x5 % 85] + x6</span><br><span class="line">                x5 //= 85</span><br><span class="line">            x1 += x6</span><br><span class="line">        if x2:</span><br><span class="line">            x1 = x1[:-x2]</span><br><span class="line">        return x1</span><br><span class="line"></span><br><span class="line">    base85 = None(base85)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class class1:</span><br><span class="line">    table45 = &#x27;&#x27;.join((lambda _0: [ chr(i) for i in _0 ])(range(48, 93)))</span><br><span class="line"></span><br><span class="line">    def base45(str = None):</span><br><span class="line">        enc = []</span><br><span class="line">        j = 0</span><br><span class="line">        while j &lt; len(str):</span><br><span class="line">            if j + 1 &lt; len(str):</span><br><span class="line">                x0 = str[j] &lt;&lt; 8 | str[j + 1]</span><br><span class="line">                enc.append(class1.table45[x0 % 45])</span><br><span class="line">                x0 //= 45</span><br><span class="line">                enc.append(class1.table45[x0 % 45])</span><br><span class="line">                x0 //= 45</span><br><span class="line">                enc.append(class1.table45[x0])</span><br><span class="line">                j += 2</span><br><span class="line">                continue</span><br><span class="line">            x0 = str[j]</span><br><span class="line">            enc.append(class1.table45[x0 % 45])</span><br><span class="line">            x0 //= 45</span><br><span class="line">            enc.append(class1.table45[x0])</span><br><span class="line">            j += 1</span><br><span class="line">        return &#x27;&#x27;.join(enc)</span><br><span class="line"></span><br><span class="line">    base45 = None(base45)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def encrypt(input_str, num):</span><br><span class="line">    arr = []</span><br><span class="line">    for char in input_str:  # éå†æ¯ä¸ªå­—ç¬¦</span><br><span class="line">        # å¤„ç†å°å†™å­—æ¯</span><br><span class="line">        if &#x27;a&#x27; &lt;= char &lt;= &#x27;z&#x27;:</span><br><span class="line">            shifted = (ord(char) - ord(&#x27;a&#x27;) + num) % 26</span><br><span class="line">            arr.append(chr(ord(&#x27;a&#x27;) + shifted))</span><br><span class="line">        # å¤„ç†æ•°å­—</span><br><span class="line">        elif &#x27;0&#x27; &lt;= char &lt;= &#x27;9&#x27;:</span><br><span class="line">            shifted = (ord(char) - ord(&#x27;0&#x27;) - num) % 10  # æ•°å­—å·¦ç§»</span><br><span class="line">            arr.append(chr(ord(&#x27;0&#x27;) + shifted))</span><br><span class="line">        # å…¶ä»–å­—ç¬¦åŸæ ·ä¿ç•™</span><br><span class="line">        else:</span><br><span class="line">            arr.append(char)</span><br><span class="line">    return &#x27;&#x27;.join(arr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc = bytes([57,118,33,114,68,56,117,115,34,52,52,95,78,40,49,59,95,85,63,122,54,33,77,110,49,54,34,</span><br><span class="line">                      109,106,122,60,92,108,91,61,51,42,62,35,38,52,67,62,122,116,48,76,50,67,51,59,41,122,45,45,51,90])</span><br><span class="line"></span><br><span class="line">def l(_ = None):</span><br><span class="line">    return encrypt(class0.base85(encrypt(class1.base45(_.encode()), 7).encode()), 9)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(&#x27;è¯·è¾“å…¥:&#x27;, &#x27;&#x27;, **(&#x27;end&#x27;,))</span><br><span class="line">    aaaaaaaaaaaaa = input()</span><br><span class="line">    wwwwwwwwwww = l(aaaaaaaaaaaaa)</span><br><span class="line">    if enc == wwwwwwwwwww.encode():</span><br><span class="line">        print(&quot;å¯¹çš„&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;éä¹Ÿ&quot;)</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦é€»è¾‘ï¼šinput -&gt; base45åŠ å¯† -&gt; ç§»7ä½ -&gt; base85åŠ å¯† -&gt; ç§»9ä½</p>
<p>åè¿‡æ¥è§£å¯†ï¼šå¯†æ–‡ -&gt; ç§»9ä½ -&gt; base85è§£å¯† -&gt; ç§»7ä½ -&gt; base45è§£å¯† </p>
<p>ç§»ä½çš„é€†è„šæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def shift(str,num):</span><br><span class="line">    arr = &#x27;&#x27;</span><br><span class="line">    for i in str:</span><br><span class="line">        if &#x27;a&#x27; &lt;= i &lt;= &#x27;z&#x27;:</span><br><span class="line">            arr += chr(97+(ord(i)-97-num+26)%26)</span><br><span class="line">        elif &#x27;0&#x27; &lt;= i &lt;= &#x27;9&#x27;:</span><br><span class="line">            arr += chr(48+(ord(i)+num-48+10)%10)</span><br><span class="line">        else:</span><br><span class="line">            arr += i</span><br><span class="line">    return arr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc=[57,118,33,114,68,56,117,115,34,52,52,95,78,40,49,59,95,85,63,122,54,33,77,110,49,54,34,109,106,122,60,92,108,91,61,51,42,62,35,38,52,67,62,122,116,48,76,50,67,51,59,41,122,45,45,51,90]</span><br><span class="line">for i in enc:</span><br><span class="line">    dec+=chr(i)</span><br><span class="line">num=9</span><br><span class="line">print(shift(dec,num))</span><br></pre></td></tr></table></figure>

<img src="/posts/18925/image-20250308183254474.png" class="" title="image-20250308183254474">

<p>NSSCTF{Th3yâ€™r3_a11_p1aY_Ba5e!}</p>
]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>HookæŠ€æœ¯å®ç°ï¼</title>
    <url>/posts/30238/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="HOOKæŠ€æœ¯ç®€ä»‹"><a href="#HOOKæŠ€æœ¯ç®€ä»‹" class="headerlink" title="HOOKæŠ€æœ¯ç®€ä»‹"></a>HOOKæŠ€æœ¯ç®€ä»‹</h1><p>å¶ç„¶å‘ç°ä¸€ç¯‡æ–‡ç« ï¼Œé‡Œé¢ä»‹ç»äº†å…³äºå®ç°HookæŠ€æœ¯çš„è¯¦ç»†æ­¥éª¤ï¼š<a href="https://www.cnblogs.com/iBinary/p/7599789.html">é€†å‘å®ç”¨å¹²è´§åˆ†äº«,HookæŠ€æœ¯ç¬¬ä¸€è®²,ä¹‹Hook Windows API - iBinary - åšå®¢å›­</a></p>
<p>åœ¨ä»”ç»†çœ‹å®Œè¿™ç¯‡æ–‡ç« åï¼Œæˆ‘å°±æƒ³è¯•è¯•é€šè¿‡hookæŠ€æœ¯ä¿®æ”¹windows apiå‡½æ•°ã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>Hookçš„ä¸»è¦æ€è·¯å¦‚ä¸‹ï¼š</p>
<p>1ã€è·å–strcmpå‡½æ•°çš„åœ°å€</p>
<p>2ã€è·å–è‡ªå®šä¹‰å‡½æ•°çš„åœ°å€</p>
<p>3ã€å–æ¶ˆstrcmpå‡½æ•°åœ°å€ä¿æŠ¤</p>
<p>4ã€è®¡ç®—strcmpå‡½æ•°ä¸è‡ªå®šä¹‰å‡½æ•°ä¹‹é—´çš„åç§»offset</p>
<p>5ã€ä¿®æ”¹strcmpå‡½æ•°å¤´5ä¸ªå­—èŠ‚ï¼Œæ”¹ä¸ºjmp offset</p>
<p>äºæ˜¯ï¼Œå†™ä¸‹å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">int __cdecl my_strcmp(char s1[],char s2[])&#123;</span><br><span class="line">    printf(&quot;hookæˆåŠŸ!&quot;);</span><br><span class="line">    return 0;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">void hook()&#123;</span><br><span class="line">        // æ­¥éª¤1ï¼šç¡®å®š strcmp æ‰€åœ¨çš„DLLåœ°å€</span><br><span class="line">        const char* dllName = &quot;ucrtbase.dll&quot;; </span><br><span class="line">        HMODULE hModule = GetModuleHandleA(dllName);</span><br><span class="line">        </span><br><span class="line">        // å¦‚æœDLLæœªåŠ è½½ï¼Œéœ€è°ƒç”¨LoadLibraryæ˜¾å¼åŠ è½½</span><br><span class="line">        if (hModule == NULL) &#123;</span><br><span class="line">            hModule = LoadLibraryA(dllName);</span><br><span class="line">            if (hModule == NULL) &#123;</span><br><span class="line">                printf(&quot;Failed to load DLL. Error: %lu\n&quot;, GetLastError());</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        // æ­¥éª¤2ï¼šè·å–å‡½æ•°åœ°å€</span><br><span class="line">        FARPROC pStrCmp = GetProcAddress(hModule, &quot;strcmp&quot;);</span><br><span class="line">        if (pStrCmp == NULL) &#123;</span><br><span class="line">            printf(&quot;Function not found. Error: %lu\n&quot;, GetLastError());</span><br><span class="line">            FreeLibrary(hModule);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        // æ­¥éª¤3ï¼šå®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹å¹¶è°ƒç”¨</span><br><span class="line">        typedef int (__cdecl* STRCMP_FUNC)(const char*, const char*);  // __cdeclæ˜¯Cè¿è¡Œæ—¶åº“çš„é»˜è®¤è°ƒç”¨çº¦å®š</span><br><span class="line">        STRCMP_FUNC strcmp_func = (STRCMP_FUNC)pStrCmp;</span><br><span class="line">    </span><br><span class="line">        // æ­¥éª¤4ï¼šå–æ¶ˆå‡½æ•°åœ°å€ä¿æŠ¤</span><br><span class="line">        DWORD oldProtect;  // æ—§ä¿æŠ¤å±æ€§</span><br><span class="line">        VirtualProtect((LPVOID)strcmp_func,0x1000,PAGE_EXECUTE_READWRITE,&amp;oldProtect);</span><br><span class="line"></span><br><span class="line">        // æ­¥éª¤5ï¼šè·å–è‡ªå®šä¹‰å‡½æ•°åœ°å€</span><br><span class="line">        byte* funcAddr = (byte*)my_strcmp;</span><br><span class="line"></span><br><span class="line">        // æ­¥éª¤6ï¼šä¿®æ”¹å¤´5ä¸ªå­—èŠ‚ï¼Œè·³è½¬åˆ°è‡ªå®šä¹‰å‡½æ•°</span><br><span class="line">        //æ³¨ï¼šä»¥ä¸‹æ˜¯GCCçš„å†…è”æ±‡ç¼–ï¼Œä»…åœ¨GCCæ¡ä»¶ä¸‹æ‰å¯è¿è¡Œ</span><br><span class="line">        __asm__ __volatile__ (</span><br><span class="line">    		&quot;movl %0, %%eax \n\t&quot;</span><br><span class="line">    		&quot;movl %1, %%ebx \n\t&quot;</span><br><span class="line">    		&quot;subl %%eax, %%ebx \n\t&quot;</span><br><span class="line">   		 	&quot;subl $5, %%ebx \n\t&quot;</span><br><span class="line">    		&quot;movb $0xe9, (%%eax) \n\t&quot;</span><br><span class="line">    		&quot;movl %%ebx, 1(%%eax)&quot;</span><br><span class="line">    		: /* æ— è¾“å‡ºæ“ä½œæ•° */</span><br><span class="line">    		: &quot;r&quot; (strcmp_func), &quot;r&quot; (funcAddr)  // è¾“å…¥æ“ä½œæ•°</span><br><span class="line">    		: &quot;eax&quot;, &quot;ebx&quot;, &quot;memory&quot;            // å£°æ˜è¢«ç ´åçš„åˆ—è¡¨</span><br><span class="line">		);</span><br><span class="line">         DWORD floadprotect;</span><br><span class="line">         VirtualProtect((LPVOID)strcmp_func,0x1000,oldProtect,&amp;floadprotect);  //æ¢å¤å†…å­˜ä¿æŠ¤</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    hook();</span><br><span class="line">    char a[]=&quot;hello world&quot;;</span><br><span class="line">    char s[20];</span><br><span class="line">    scanf(&quot;%s&quot;,s);</span><br><span class="line">    if(!strcmp(a,s))</span><br><span class="line">        printf(&quot;right!\n&quot;);</span><br><span class="line">    else printf(&quot;wrong!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…è¿è¡Œä¸‹æ¥å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯hookä¼¼ä¹å¹¶æ²¡æœ‰å¥æ•ˆğŸ˜…ï¼Œè¿™å°±ç›¸å½“çš„æŠ½è±¡äº†ã€‚</p>
<p>é‡äº‹ä¸è§‰ï¼ŒåŠ¨è°ƒå¤§æ³•ï¼</p>
<p>æ”¾å…¥x32dbgçœ‹çœ‹å“ªé‡Œå‡ºç°äº†é—®é¢˜ã€‚</p>
<img src="/posts/30238/image-20250422223807531.png" class="" title="image-20250422223807531">

<p>è¿™é‡Œå°±æ˜¯ä¸Šé¢çš„å†…è”æ±‡ç¼–éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹strcmpå‡½æ•°çš„éƒ¨åˆ†ã€‚è¿™é‡Œ[ebp-1c]å°±æ˜¯strcmpå‡½æ•°ï¼Œæˆ‘ä»¬è·Ÿè¿‡å»æŸ¥çœ‹åœ°å€ï¼š</p>
<img src="/posts/30238/image-20250422224047795.png" class="" title="image-20250422224047795">

<p>å®ƒçš„èµ·å§‹åœ°å€ä¸º77011C10ï¼Œç»§ç»­è¿è¡Œä¸‹å»ï¼Œç­‰strcmpå‡½æ•°ä¿®æ”¹å®Œä¹‹åï¼Œå›æ¥çœ‹ï¼š</p>
<img src="/posts/30238/image-20250422224415381.png" class="" title="image-20250422224415381">

<p>è¿™é‡Œç¡®å®è¢«ä¿®æ”¹äº†ï¼Œç­‰åé¢è°ƒç”¨strcmpå‡½æ•°çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥è·³è½¬åˆ°test1.401500ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼‰é‡Œé¢å»ï¼Œåˆ°æ­¤HookæˆåŠŸäº†ï¼</p>
<p>æˆåŠŸäº†ï¼Ÿé‚£ä¸ºä»€ä¹ˆç›´æ¥è¿è¡Œçš„æ—¶å€™HooKæ²¡èµ·ä½œç”¨ï¼Ÿç»§ç»­è¿è¡Œï¼Œå‘ç°mainå‡½æ•°é‡Œé¢è°ƒç”¨çš„strcmpå‡½æ•°å’Œä¸Šé¢ä¿®æ”¹çš„å‡½æ•°ä¸åœ¨åŒä¸€ä¸ªåœ°å€ï¼Œå³ï¼š</p>
<img src="/posts/30238/image-20250422224827706.png" class="" title="image-20250422224827706">

<p>è¿™åªæœ‰ä¸€ä¸ªå¯èƒ½ï¼Œå°±æ˜¯æˆ‘ä¿®æ”¹çš„æ˜¯ucrtbase.dllé‡Œé¢çš„strcmpå‡½æ•°ï¼Œä½†æ˜¯mainå‡½æ•°é‡Œé¢è°ƒç”¨çš„æ˜¯windows.hé‡Œé¢çš„strcmpå‡½æ•°ã€‚</p>
<h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>æ—¢ç„¶mainå‡½æ•°é‡Œé¢è°ƒç”¨çš„æ˜¯windows.hé‡Œé¢çš„strcmpï¼Œé‚£æˆ‘å°±ä¿®æ”¹windows.hé‡Œé¢çš„strcmpå‡½æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">int __cdecl my_strcmp(char s1[],char s2[])&#123;</span><br><span class="line">    printf(&quot;hookæˆåŠŸ!&quot;);</span><br><span class="line">    return 0;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">void hook()&#123; </span><br><span class="line">        // å–æ¶ˆå‡½æ•°åœ°å€ä¿æŠ¤</span><br><span class="line">        DWORD oldProtect;  // æ—§ä¿æŠ¤å±æ€§</span><br><span class="line">        VirtualProtect((LPVOID)strcmp,0x1000,PAGE_EXECUTE_READWRITE,&amp;oldProtect);</span><br><span class="line"></span><br><span class="line">        // è·å–å‡½æ•°åœ°å€</span><br><span class="line">        byte* funcAddr = (byte*)my_strcmp;</span><br><span class="line">        byte* strcmp_add = (byte*)strcmp;</span><br><span class="line"></span><br><span class="line">        // è·³è½¬åˆ°è‡ªå®šä¹‰å‡½æ•°</span><br><span class="line">        __asm__ __volatile__ (</span><br><span class="line">    		&quot;movl %0, %%eax \n\t&quot;</span><br><span class="line">		    &quot;movl %1, %%ebx \n\t&quot;</span><br><span class="line">		    &quot;subl %%eax, %%ebx \n\t&quot;</span><br><span class="line">		    &quot;subl $5, %%ebx \n\t&quot;</span><br><span class="line">		    &quot;movb $0xe9, (%%eax) \n\t&quot;</span><br><span class="line">		    &quot;movl %%ebx, 1(%%eax)&quot;</span><br><span class="line">		    : /* æ— è¾“å‡ºæ“ä½œæ•° */</span><br><span class="line">		    : &quot;r&quot; (strcmp_add), &quot;r&quot; (funcAddr)  // è¾“å…¥æ“ä½œæ•°</span><br><span class="line">		    : &quot;eax&quot;, &quot;ebx&quot;, &quot;memory&quot;            // ç ´ååˆ—è¡¨</span><br><span class="line">		);</span><br><span class="line">         DWORD floadprotect;</span><br><span class="line">         VirtualProtect((LPVOID)strcmp,0x1000,oldProtect,&amp;floadprotect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    hook();</span><br><span class="line">    char a[]=&quot;hello world&quot;;</span><br><span class="line">    char s[20];</span><br><span class="line">    scanf(&quot;%s&quot;,s);</span><br><span class="line">    if(!strcmp(a,s))</span><br><span class="line">        printf(&quot;right!\n&quot;);</span><br><span class="line">    else printf(&quot;wrong!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">//77011C10</span><br></pre></td></tr></table></figure>

<p>HookæˆåŠŸï¼š</p>
<img src="/posts/30238/image-20250422225432814.png" class="" title="image-20250422225432814">
]]></content>
      <tags>
        <tag>Reverse</tag>
      </tags>
  </entry>
  <entry>
    <title>ISCCåŒºåŸŸèµ›wp</title>
    <url>/posts/54083/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="faze"><a href="#faze" class="headerlink" title="faze"></a>faze</h2><p>ä¸»é€»è¾‘å°±æ˜¯å…ˆç”Ÿæˆè¿·å®«å›¾ï¼Œç„¶åè°ƒç”¨dM7å‡½æ•°å¯»æ‰¾è·¯å¾„ï¼ŒæŠŠè·¯å¾„ä¿å­˜åœ¨v9ï¼Œæœ€åä¸è¾“å…¥è¿›è¡Œæ¯”è¾ƒï¼ŒæŠŠæ–­ç‚¹è®¾ç½®åœ¨è¿™:</p>
<img src="/posts/54083/image-20250510120643938.png" class="" title="image-20250510120643938">

<p>åŠ¨è°ƒæŸ¥çœ‹v9çš„å€¼ï¼š</p>
<img src="/posts/54083/image-20250510120734428.png" class="" title="image-20250510120734428">

<p>shift+eæå–ï¼Œè¿™å°±æ˜¯flag</p>
<h2 id="greeting"><a href="#greeting" class="headerlink" title="greeting"></a>greeting</h2><p>ä¸»è¦åŠ å¯†æµç¨‹ï¼šæ¯ä¸ªå­—èŠ‚ç»è¿‡å¼‚æˆ–å’Œå¾ªç¯å·¦ç§»æ“ä½œï¼Œç§»ä½æ¬¡æ•°ç”±ç´¢å¼•å€¼å’ŒæŸç§é™¤æ³•ç»“æœå†³å®š</p>
<img src="/posts/54083/image-20250513183726985.png" class="" title="image-20250513183726985">

<p>ç»è¿‡ä¸Šè¿°åŠ å¯†åä¸å¯†æ–‡æ¯”è¾ƒã€‚å¯†æ–‡ï¼š</p>
<img src="/posts/54083/image-20250513183800011.png" class="" title="image-20250513183800011">

<img src="/posts/54083/image-20250513183838639.png" class="" title="image-20250513183838639">

<img src="/posts/54083/image-20250513183906393.png" class="" title="image-20250513183906393">

<p>å†™å‡ºè§£å¯†è„šæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def ror(n, shift):</span><br><span class="line">    return ((n &gt;&gt; (shift % 8)) | (n &lt;&lt; (8 - (shift % 8)))) &amp; 0xFF</span><br><span class="line"></span><br><span class="line">encrypted_data = [0x13,0x10,0x7C,0xF0,0x52,0x6C,0x56,0x10,0xA1,0x32,0x39,0x2A,0x94,0x19,0xB0,0x14]</span><br><span class="line">flag = []</span><br><span class="line">for i in range(16):</span><br><span class="line">    rol_amount = i % 5</span><br><span class="line">    byte = encrypted_data[i]</span><br><span class="line">    rotated = ror(byte, rol_amount)</span><br><span class="line">    original = rotated ^ (i + 0x5A)</span><br><span class="line">    flag.append(chr(original))</span><br><span class="line">print(&#x27;&#x27;.join(flag))</span><br></pre></td></tr></table></figure>

<h2 id="SecretGrid"><a href="#SecretGrid" class="headerlink" title="SecretGrid"></a>SecretGrid</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line"></span><br><span class="line">void decrypt(char* input, char* output) &#123;</span><br><span class="line">    char key[] = &#123;&quot;ISCC&#123;s_ale_ru_upatu_prrlaullre_&#125;&quot;&#125;;</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; 30; i++) &#123;</span><br><span class="line">        if ((i &amp; 1) == 0) &#123;</span><br><span class="line">            output[i] = input[i] ^ (key[i] + 2);</span><br><span class="line">        &#125; else if (i % 3 == 0) &#123;</span><br><span class="line">            output[i] = input[i] ^ (key[i] + 5);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            output[i] = input[i] ^ key[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    output[30] = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    char v[] = &#123;</span><br><span class="line">        6,39,125,4,13,49,14,52,41,94,27,11,49,110,0,4,10,64,84,116,43,57,53,74,7,31,3,25,43,6</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    char t[30];</span><br><span class="line">    decrypt(v, t);</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; 30; i++) &#123;</span><br><span class="line">        printf(&quot;%c&quot;, t[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æœ‰è¶£çš„å°æ¸¸æˆ"><a href="#æœ‰è¶£çš„å°æ¸¸æˆ" class="headerlink" title="æœ‰è¶£çš„å°æ¸¸æˆ"></a>æœ‰è¶£çš„å°æ¸¸æˆ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import base64</span><br><span class="line">import struct</span><br><span class="line">from ctypes import c_uint32</span><br><span class="line">def xxtea_encrypt(n, v, key):</span><br><span class="line">    # å…¨éƒ¨è½¬ä¸ºc_unit32æ ¼å¼</span><br><span class="line">    v = [c_uint32(i) for i in v]</span><br><span class="line">    r = 6 + 52 // n</span><br><span class="line">    v1 = v[n-1].value</span><br><span class="line">    delta = 0x9e3779b9</span><br><span class="line">    total = c_uint32(0)</span><br><span class="line">    for i in range(r):</span><br><span class="line">        total.value += delta</span><br><span class="line">        e = (total.value &gt;&gt; 2) &amp; 3</span><br><span class="line">        for j in range(n-1):</span><br><span class="line">            v0 = v[j+1].value</span><br><span class="line">            v[j].value += ((((v1 &gt;&gt; 5) ^ (v0 &lt;&lt; 2)) + ((v0 &gt;&gt; 3) ^ (v1 &lt;&lt; 4))) ^ ((total.value ^ v0) + (key[(j &amp; 3) ^ e] ^ v1)))</span><br><span class="line">            v1 = v[j].value</span><br><span class="line">        v0 = v[0].value</span><br><span class="line">        v[n-1].value += ((((v1 &gt;&gt; 5) ^ (v0 &lt;&lt; 2)) + ((v0 &gt;&gt; 3) ^ (v1 &lt;&lt; 4))) ^ ((total.value ^ v0) + (key[((n-1) &amp; 3) ^ e] ^ v1)))</span><br><span class="line">        v1 = v[n-1].value</span><br><span class="line">    return [i.value for i in v]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def xxtea_decrypt(n, v, key):</span><br><span class="line">    # å…¨éƒ¨è½¬ä¸ºc_unit32æ ¼å¼</span><br><span class="line">    v = [c_uint32(i) for i in v]</span><br><span class="line">    r = 6 + 52 // n</span><br><span class="line">    v0 = v[0].value</span><br><span class="line">    delta = 0x9e3779b9</span><br><span class="line">    total = c_uint32(delta * r)</span><br><span class="line">    for i in range(r):</span><br><span class="line">        e = (total.value &gt;&gt; 2) &amp; 3</span><br><span class="line">        for j in range(n-1, 0, -1):</span><br><span class="line">            v1 = v[j-1].value</span><br><span class="line">            v[j].value -= ((((v1 &gt;&gt; 5) ^ (v0 &lt;&lt; 2)) + ((v0 &gt;&gt; 3) ^ (v1 &lt;&lt; 4))) ^ ((total.value ^ v0) + (key[(j &amp; 3) ^ e] ^ v1)))</span><br><span class="line">            v0 = v[j].value</span><br><span class="line">        v1 = v[n-1].value</span><br><span class="line">        v[0].value -= ((((v1 &gt;&gt; 5) ^ (v0 &lt;&lt; 2)) + ((v0 &gt;&gt; 3) ^ (v1 &lt;&lt; 4))) ^ ((total.value ^ v0) + (key[(0 &amp; 3) ^ e] ^ v1)))</span><br><span class="line">        v0 = v[0].value</span><br><span class="line">        total.value -= delta</span><br><span class="line">    return [i.value for i in v]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k = [0x12345678, 0x9ABCDEF0, 0xFEDCBA98, 0x76543210]</span><br><span class="line">l = 30</span><br><span class="line">v = [0x8f644b67,0x8dc43994,0x7baf4ebb,0xe5b92cd4,0xe540e3f2,0xb81e24dc,0x3f7addc5,0xfb7aecb0,0x65520266,0xb42f1f86,0xda99ca47,0x75869f5d,0x8ca022e6,0x1f2270ea,0x48f3183c,0xc293f7dd,0xfee027a6,0xe5e5f139,0x189cf5bd,0xdfefdb8f,0xca3e03d0,0x9423c07c,0x30653ba2,0x44334245,0xf8e760fe,0x7225fa4d,0x7c119f87,0x34718b8c,0x5751fc75,0x63080380]</span><br><span class="line">for i in range(10000):</span><br><span class="line">    v = xxtea_decrypt(l, v, k)</span><br><span class="line">    # print(list(map(hex, v)))</span><br><span class="line">    out = b&quot;&quot;.join([struct.pack(&quot;&lt;I&quot;, i) for i in v])</span><br><span class="line">    try:</span><br><span class="line">        print(out.decode())</span><br><span class="line">        print(&quot;&quot;.join([chr(out[i:i+4][0]) for i in range(0, len(out), 4)]), end=&quot;&quot;)</span><br><span class="line">    except:</span><br><span class="line">        continue</span><br></pre></td></tr></table></figure>





<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><p>ä¸¤ä¸ªå‹ç¼©æ–‡ä»¶part1ã€part2</p>
<p>part1:</p>
<p>æ•°æ®åŒºåŠ å¯†æ ‡å¿—ä½ï¼ˆå¶æ•°ä»£è¡¨æœªåŠ å¯†ï¼‰ï¼š</p>
<img src="/posts/54083/image-20250512011547834.png" class="" title="image-20250512011547834">

<p>ç›®å½•æ®µåŠ å¯†æ ‡å¿—ä½ï¼ˆå¥‡æ•°ä»£è¡¨æ˜¯ä¼ªåŠ å¯†ï¼‰ï¼š</p>
<img src="/posts/54083/image-20250512011738345.png" class="" title="image-20250512011738345">

<p>å°†70 00 æ”¹ä¸º00 00 å³å¯æ­£å¸¸è§£å‹ã€‚</p>
<p>è§£å‹åæ‰“å¼€æ–‡ä»¶ï¼š</p>
<img src="/posts/54083/image-20250512012430449.png" class="" title="image-20250512012430449">

<p>è¯´æ˜ä¸‹ä¸€ä¸ªå‹ç¼©åŒ…æ˜¯æ©ç çˆ†ç ´ã€‚å¼€å§‹çˆ†ç ´ï¼š</p>
<img src="/posts/54083/image-20250512012545795.png" class="" title="image-20250512012545795">

<p>å¾—åˆ°å¯†ç ï¼š</p>
<img src="/posts/54083/image-20250512012531176.png" class="" title="image-20250512012531176">

<h1 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h1><h2 id="é‚¦å¸ƒå‡ºå‡»"><a href="#é‚¦å¸ƒå‡ºå‡»" class="headerlink" title="é‚¦å¸ƒå‡ºå‡»"></a>é‚¦å¸ƒå‡ºå‡»</h2><img src="/posts/54083/image-20250512022757837.png" class="" title="image-20250512022757837">

<p>è¿™é‡Œå‘ç°ç–‘ä¼¼base64å¯†æ–‡ï¼Œè§£å¯†ä¸€ä¸‹çœ‹çœ‹</p>
<img src="/posts/54083/image-20250517011536825.png" class="" title="image-20250517011536825">

<p>ä»è¿™é‡Œçš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¦å¯¹å‰é¢ä¸‰ä¸ªå­—ç¬¦ä¸²è¿›è¡Œä¸‰æ¬¡base64è§£å¯†ã€‚å°†ä¸Šé¢å‰ä¸‰æ®µå­—ç¬¦ä¸²æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œè¿›è¡Œä¸‰æ¬¡base64è§£å¯†ï¼Œå¾—åˆ°æ•°æ®åº“è§£å¯†å¯†é’¥ï¼š</p>
<img src="/posts/54083/image-20250512022912882.png" class="" title="image-20250512022912882">

<p>ä½¿ç”¨sqlcipherå·¥å…·è¿›è¡Œæ•°æ®åº“è§£å¯†ï¼Œå¾—åˆ°è§£å¯†åçš„æ•°æ®åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PRAGMA key = &#x27;JINGLIU&#x27;;</span><br><span class="line">ATTACH DATABASE &#x27;plaintext.db&#x27; AS plaintext KEY &#x27;&#x27;;</span><br><span class="line">SELECT sqlcipher_export(&#x27;plaintext&#x27;);</span><br><span class="line">DETACH DATABASE plaintext;</span><br></pre></td></tr></table></figure>

<img src="/posts/54083/image-20250512023105094.png" class="" title="image-20250512023105094">

<p>æŠŠå¾—åˆ°çš„æ•°æ®åº“ç”¨DB Browser for SQLCipheræ‰“å¼€ï¼š</p>
<img src="/posts/54083/image-20250512023209496.png" class="" title="image-20250512023209496">

<p>è¿™é‡Œé¢è¿™ä¸ªkeyåé¢è¦ç”¨åˆ°ã€‚</p>
<img src="/posts/54083/image-20250515135051283.png" class="" title="image-20250515135051283">

<p>æ ¹æ®ä¸»å‡½æ•°é€»è¾‘ï¼Œå…ˆä½¿ç”¨a.aç”Ÿæˆå¯†æ–‡ï¼Œç„¶åä½¿ç”¨getivç”Ÿæˆå¯†é’¥ï¼ŒDESHelper().encryptè¿›è¡ŒåŠ å¯†ï¼Œæ‹¿åŠ å¯†ç»“æœä¸è¾“å…¥è¿›è¡Œå¯¹æ¯”ã€‚å› æ­¤å¯ä»¥é€šè¿‡fridaçš„hookæ¥ç›´æ¥å¾—åˆ°åŠ å¯†åçš„ç»“æœã€‚å…ˆå°è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Java.perform(function() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        // Hook DESHelper.encrypt</span><br><span class="line">        var cls1 = Java.use(&quot;com.example.mobile01.DESHelper&quot;);</span><br><span class="line">        cls1.encrypt.implementation = function(data, key, iv) &#123;</span><br><span class="line">            var enc_data = this.encrypt(data, key, iv);</span><br><span class="line">            console.log(&quot;Flag: ISCC&#123;&quot; + enc_data + &quot;&#125;&quot;);</span><br><span class="line">            return enc_data;</span><br><span class="line">        &#125;;</span><br><span class="line">        console.log(&quot;[+] Hooked com.example.mobile01.DESHelper.encrypt()&quot;);</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        console.error(&quot;[-] Failed to hook DESHelper.encrypt: &quot; + err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å‘ç°ç¨‹åºä¼šç›´æ¥æŠ¥é”™ç„¶åç›´æ¥é€€å‡º</p>
<img src="/posts/54083/image-20250515135529398.png" class="" title="image-20250515135529398">

<p>è¿™æ ·å®Œå…¨æ— æ³•å¾—åˆ°å¯†æ–‡æˆ–è€…IVã€‚é‡‡ç”¨æ§åˆ¶å˜é‡æ³•æ¥æ¢ç©¶ä¸ºä»€ä¹ˆä¼šå‡ºç°æŠ¥é”™ã€‚å…ˆhookè®©a.aä¸è¿è¡Œ</p>
<img src="/posts/54083/image-20250515135708911.png" class="" title="image-20250515135708911">

<img src="/posts/54083/image-20250515135824540.png" class="" title="image-20250515135824540">

<p>ç»“æœå‘ç°ç¨‹åºä¸ä¼šæ–­å¼€ï¼Œè€Œä¸”IVèƒ½æ­£å¸¸å¾—åˆ°ï¼Œè¿™å°±è¯´æ˜é—®é¢˜åœ¨a.aé‡Œé¢ã€‚ç»§ç»­çœ‹a.aé‡Œé¢è°ƒç”¨çš„b.bï¼Œè¯•ä¸€è¯•ç›´æ¥æ‰“å°b.bè¿”å›å€¼ï¼š</p>
<img src="/posts/54083/image-20250515140117960.png" class="" title="image-20250515140117960">

<p>å‘ç°èƒ½æ­£å¸¸è¿”å›ï¼Œè¯´æ˜ä¸æ˜¯b.bçš„é—®é¢˜ã€‚ç»§ç»­æ€è€ƒï¼Œåœ¨a.aé‡Œé¢çš„è¯­å¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SecretKeySpec secretKeySpec = new SecretKeySpec(process(b.c()), &quot;Blowfish&quot;);</span><br></pre></td></tr></table></figure>

<p>ä¸­ï¼Œb.cç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œç„¶åå°†è¯¥ç©ºå­—ç¬¦ä¸²è®¾ç½®ä¸ºå¯†é’¥ã€‚é—®é¢˜å°±åœ¨è¿™ï¼Œç©ºçš„å¯†é’¥ä¼šå¯¼è‡´å¯†é’¥å¡«å……å¤±è´¥ï¼Œæ‰€ä»¥ç¨‹åºä¼šç›´æ¥æŠ¥é”™é—ªé€€ã€‚é‚£ä¹ˆæ‹¿ä»€ä¹ˆå¡«å……å¯†é’¥ï¼Ÿå‰é¢æ•°æ®åº“æ–‡ä»¶é‡Œé¢</p>
<img src="/posts/54083/image-20250515140458909.png" class="" title="image-20250515140458909">

<p>blowfishæ°å¥½å¯¹åº”a.açš„åŠ å¯†æ–¹æ³•ï¼Œæ‰€ä»¥çŒœæµ‹è¿™é‡Œé¢çš„keyå°±æ˜¯çœŸæ­£çš„keyã€‚ä½¿ç”¨fridaå°†è¿™ä¸ªkey hookåˆ°b.cçš„è¿”å›å€¼ï¼Œä½¿å®ƒå½“keyä¼ å…¥ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Java.perform(function() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        // Hook com.example.mobile01.b.c() </span><br><span class="line">        var cls2 = Java.use(&quot;com.example.mobile01.b&quot;);</span><br><span class="line">        cls2.c.implementation = function() &#123;</span><br><span class="line">            var res = &quot;AtBgCfDhEjFlGqHp&quot;;//æŠŠæ•°æ®åº“é‡Œçš„keyæ”¾å…¥</span><br><span class="line">            console.log(&quot;[*] com.example.mobile01.b.b() called, returned: &quot; + res);</span><br><span class="line">            return res;</span><br><span class="line">        &#125;;</span><br><span class="line">        console.log(&quot;[+] Hooked com.example.mobile01.a.a()&quot;);</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        console.error(&quot;[-] Failed to hook com.example.mobile01.a.a(): &quot; + err);</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">        // Hook DESHelper.encrypt</span><br><span class="line">        var cls1 = Java.use(&quot;com.example.mobile01.DESHelper&quot;);</span><br><span class="line">        cls1.encrypt.implementation = function(data, key, iv) &#123;</span><br><span class="line">            var enc_data = this.encrypt(data, key, iv);</span><br><span class="line">            console.log(&quot;Flag: ISCC&#123;&quot; + enc_data + &quot;&#125;&quot;);</span><br><span class="line">            return enc_data;</span><br><span class="line">        &#125;;</span><br><span class="line">        console.log(&quot;[+] Hooked com.example.mobile01.DESHelper.encrypt()&quot;);</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        console.error(&quot;[-] Failed to hook DESHelper.encrypt: &quot; + err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥æŒ‡ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">frida -U -l hook_des.js -f com.example.mobile01</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°flagï¼š</p>
<img src="/posts/54083/image-20250515141140152.png" class="" title="image-20250515141140152">

<h2 id="Detective"><a href="#Detective" class="headerlink" title="Detective"></a>Detective</h2><img src="/posts/54083/image-20250513083750267.png" class="" title="image-20250513083750267">

<p>è°ƒç”¨äº†nativeå±‚çš„validatePasswordå‡½æ•°</p>
<img src="/posts/54083/image-20250513084030558.png" class="" title="image-20250513084030558">

<p>æ˜¯ä¸€ä¸ªsha256ï¼Œå¯†ç æ˜¯4ä½ã€‚å¯ä»¥ç›´æ¥çˆ†ç ´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import itertools</span><br><span class="line"></span><br><span class="line">data = &quot;23213b6f905655aaf0510c9054e4b14719d07c2c17c08d826a5f9139d8c234f9&quot;</span><br><span class="line">table = &#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="line"></span><br><span class="line">for chars in itertools.product(table, repeat=4):</span><br><span class="line">    pwd = &#x27;&#x27;.join(chars)</span><br><span class="line">    sha256_hash = hashlib.sha256(pwd.encode()).hexdigest()</span><br><span class="line">    if sha256_hash == data:</span><br><span class="line">        result = pwd</span><br><span class="line">        break</span><br><span class="line">else:</span><br><span class="line">    result = None</span><br><span class="line"></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å¯†ç SHERã€‚å†æŸ¥çœ‹mainzctivityï¼š</p>
<img src="/posts/54083/image-20250513084718675.png" class="" title="image-20250513084718675">

<p>ä¸»è¦åœ¨äºæœ€åä¸€å¥è¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">str.length() &gt;= 8 &amp;&amp; (str.length() + 1) % 2 != 0 &amp;&amp; str.substring(0, 5).equals(&quot;ISCC&#123;&quot;) &amp;&amp; str.charAt(str.length() - 1) == &#x27;&#125;&#x27; &amp;&amp; stringFromJNI(a.a(str.substring(5, str.length() - 1))).equals(&quot;105C5A31214E50520020444E2F3A&quot;);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„stringFromJNIå‡½æ•°å’Œaå‡½æ•°å¯¹è¾“å…¥è¿›è¡Œäº†åŠ å¯†ã€‚aå‡½æ•°ï¼š</p>
<img src="/posts/54083/image-20250513085045386.png" class="" title="image-20250513085045386">

<img src="/posts/54083/image-20250513085157635.png" class="" title="image-20250513085157635">

<p>stringFromJNIå‡½æ•°ï¼ˆéƒ¨åˆ†ï¼‰:</p>
<img src="/posts/54083/image-20250513090334219.png" class="" title="image-20250513090334219">

<p>è¿™é‡Œè‚¯å®šç”¨äº†å¼‚æˆ–ï¼ŒçŒœæµ‹Sherlockæ˜¯ä½œä¸ºå¯†é’¥ä¼ å…¥ã€‚<br>hook 4ä¸ªå‡½æ•°ï¼Œè§‚å¯Ÿå…¶è¡Œä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line">    const MainActivity = Java.use(&quot;com.example.detective.MainActivity&quot;);</span><br><span class="line">    const detective_a = Java.use(&quot;com.example.detective.a&quot;);</span><br><span class="line">    const detective_b = Java.use(&quot;com.example.detective.b&quot;);</span><br><span class="line">    // Hook Java å±‚çš„ a.a</span><br><span class="line">    detective_a.a.implementation = function (input) &#123;</span><br><span class="line">        const result = this.a(input);</span><br><span class="line">        console.log(&quot;[*] a.a called&quot;);</span><br><span class="line">        console.log(&quot;    Input : &quot; + input);</span><br><span class="line">        console.log(&quot;    Output: &quot; + result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Hook native å±‚çš„ stringFromJNI</span><br><span class="line">    MainActivity.stringFromJNI.implementation = function (input) &#123;</span><br><span class="line">        console.log(&quot;[*] stringFromJNI called&quot;);</span><br><span class="line">        console.log(&quot;    Input : &quot; + input);</span><br><span class="line">        const result = this.stringFromJNI(input);</span><br><span class="line">        console.log(&quot;    Output: &quot; + result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // Hook Java å±‚çš„ a.c</span><br><span class="line">    detective_a.c.implementation = function (input) &#123;</span><br><span class="line">        const result = this.c(input);</span><br><span class="line">        console.log(&quot;[*] a.c called&quot;);</span><br><span class="line">        console.log(&quot;    Input : &quot; + input);</span><br><span class="line">        console.log(&quot;    Output: &quot; + result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // Hook Java å±‚çš„ a.b</span><br><span class="line">    detective_a.b.implementation = function (input) &#123;</span><br><span class="line">        const result = this.b(input);</span><br><span class="line">        console.log(&quot;[*] a.b called&quot;);</span><br><span class="line">        console.log(&quot;    Input : &quot; + input);</span><br><span class="line">        console.log(&quot;    Output: &quot; + result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // Hook Java å±‚çš„ b.a</span><br><span class="line">    detective_b.a.implementation = function (input) &#123;</span><br><span class="line">        const result = this.a(input);</span><br><span class="line">        console.log(&quot;[*] b.a called&quot;);</span><br><span class="line">        console.log(&quot;    Input : &quot; + input);</span><br><span class="line">        console.log(&quot;    Output: &quot; + result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    console.log(&quot;[+] Hooks installed on C0500a.m51a and stringFromJNI&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">// frida -U -l hook_des.js -f com.example.detective</span><br></pre></td></tr></table></figure>

<img src="/posts/54083/image-20250513142404847.png" class="" title="image-20250513142404847">

<p>æ‹¿stringFromJNIå‡½æ•°è¾“å…¥è¿›è¡Œå¼‚æˆ–å¾—åˆ°ï¼š</p>
<img src="/posts/54083/image-20250513142757999.png" class="" title="image-20250513142757999">

<p>ä¸hookå¾—åˆ°çš„ç»“æœå®Œå…¨ç›¸åŒï¼Œæ„å‘³ç€è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†å­—ç¬¦ä¸²å¼‚æˆ–åå†è½¬åŒ–ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ã€‚å†ä»”ç»†åˆ†æä¸€ä¸‹å…¶ä»–å‡½æ•°ï¼Œa.bå‡½æ•°è²Œä¼¼æ˜¯å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸º16è¿›åˆ¶ä¸²ï¼Œç„¶åè¡¥0ï¼›a.cæ˜¯a.bçš„é€†è¿‡ç¨‹ã€‚b.aæ˜¯ä¸€ä¸ªåŠ å¯†è¿‡ç¨‹ï¼Œç›®å‰çœ‹ä¸å‡ºæ¥ï¼Œå¾—åˆ†ææºç ã€‚</p>
<p>ä»£ç ä¸­æœ‰ä¸¤ä¸ªStringï¼Œsbå’Œsb2ï¼Œç”¨äºåˆ†åˆ«å¤„ç†ä¸åŒæ¡ä»¶ä¸‹çš„å­—ç¬¦ã€‚å¤–å±‚å¾ªç¯éå†è¾“å…¥å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦ï¼Œæ ¹æ®içš„å¥‡å¶æ€§æ¥å†³å®šå°†å­—ç¬¦æ·»åŠ åˆ°sbè¿˜æ˜¯sb2ã€‚è¿™é‡Œiä»0å¼€å§‹ï¼Œæ‰€ä»¥i%2&#x3D;&#x3D;0å¯¹åº”çš„å…¶å®æ˜¯å¥‡æ•°ä½ç½®ï¼ˆå› ä¸ºç´¢å¼•ä»0å¼€å§‹ï¼‰ã€‚ä¸è¿‡içš„åˆå§‹å€¼æ˜¯0ï¼Œæ¯æ¬¡å¾ªç¯ié€’å¢ï¼Œå› æ­¤åœ¨åˆ¤æ–­i%2&#x3D;&#x3D;0æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨å¤„ç†å¶æ•°ç´¢å¼•çš„ä½ç½®ï¼ˆæ¯”å¦‚ç¬¬0ã€2ã€4ä½ï¼‰ï¼Œè€Œå¥‡æ•°ç´¢å¼•çš„å­—ç¬¦è¢«å¤„ç†åˆ°sbä¸­ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå½“i%2&#x3D;&#x3D;0æ—¶ï¼Œä¼šæ£€æŸ¥i3çš„å€¼æ˜¯å¦ä¸º1æˆ–è€…(i3-1)æ˜¯å¦èƒ½è¢«3æ•´é™¤ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå¹¶ä¸”å½“å‰å­—ç¬¦æ˜¯â€™0â€™ï¼Œåˆ™æ›¿æ¢ä¸ºâ€™3â€™ï¼Œå¦åˆ™ä¿ç•™åŸå­—ç¬¦ã€‚åŒæ ·ï¼Œåœ¨å¤„ç†å¥‡æ•°ç´¢å¼•æ—¶ï¼Œi2çš„æ¡ä»¶æ˜¯æ˜¯å¦ä¸º0æˆ–è€…èƒ½è¢«3æ•´é™¤ï¼ŒåŒæ ·æ›¿æ¢â€™0â€™ä¸ºâ€™3â€™ã€‚</p>
<p>ç„¶åï¼Œsb2è¢«è¿½åŠ äº†sbçš„å†…å®¹ï¼Œåˆå¹¶åçš„ç»“æœè¢«å¤„ç†åˆ°sb3ä¸­ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¾ªç¯ï¼Œæ¯æ¬¡å–ä¸¤ä¸ªå­—ç¬¦charAt2å’ŒcharAt3ã€‚å¦‚æœcharAt2ä¸æ˜¯â€™3â€™åˆ°â€™7â€™ä¹‹é—´çš„å­—ç¬¦ï¼Œåˆ™äº¤æ¢è¿™ä¸¤ä¸ªå­—ç¬¦çš„ä½ç½®ï¼Œå¹¶è¿½åŠ â€21â€ã€‚å¦åˆ™ï¼Œä¿æŒé¡ºåºä¸å˜ã€‚æœ€åï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢æ¯ä¸¤ä¸ªå­—ç¬¦ä¸ºâ€$100â€ï¼Œç„¶åæˆªå–å»æ‰æœ€åä¸¤ä¸ªå­—ç¬¦ã€‚</p>
<p>è§£å¯†è„šæœ¬:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def xor_decrypt(ciphertext_hex, key_str):</span><br><span class="line">    cipher_bytes = bytes.fromhex(ciphertext_hex)</span><br><span class="line">    key_bytes = bytes(key_str, &#x27;utf-8&#x27;)</span><br><span class="line">    </span><br><span class="line">    plain_bytes = bytearray()</span><br><span class="line">    for i in range(len(cipher_bytes)):</span><br><span class="line">        plain_bytes.append(cipher_bytes[i] ^ key_bytes[i % len(key_bytes)])</span><br><span class="line">    </span><br><span class="line">    return plain_bytes.hex()</span><br><span class="line"></span><br><span class="line">def process_hex_string(hex_str):</span><br><span class="line">    print(&quot;Processing hex:&quot;, hex_str)</span><br><span class="line">    buffer = []</span><br><span class="line">    ptr = 0</span><br><span class="line">    </span><br><span class="line">    while ptr &lt; len(hex_str):</span><br><span class="line">        curr_char = hex_str[ptr]</span><br><span class="line">        next_char = hex_str[ptr+1]</span><br><span class="line">        </span><br><span class="line">        # æ£€æŸ¥ç‰¹æ®Šæ ‡è®°&quot;21&quot;å’Œå¤„ç†æ¡ä»¶</span><br><span class="line">        if ptr + 4 &lt;= len(hex_str) and hex_str[ptr+2:ptr+4] == &#x27;21&#x27; and next_char not in &#x27;34567&#x27;:</span><br><span class="line">            buffer.append(next_char)</span><br><span class="line">            buffer.append(curr_char)</span><br><span class="line">            ptr += 4</span><br><span class="line">        else:</span><br><span class="line">            buffer.append(curr_char)</span><br><span class="line">            buffer.append(next_char)</span><br><span class="line">            ptr += 2</span><br><span class="line"></span><br><span class="line">    combined_str = &#x27;&#x27;.join(buffer)</span><br><span class="line">    split_pos = len(combined_str) // 2</span><br><span class="line">    first_part = combined_str[:split_pos]</span><br><span class="line">    second_part = combined_str[split_pos:]</span><br><span class="line">    </span><br><span class="line">    print(&#x27;First part:&#x27;, first_part)</span><br><span class="line">    print(&#x27;Second part:&#x27;, second_part)</span><br><span class="line">    </span><br><span class="line">    # é‡æ„åŸå§‹å­—ç¬¦ä¸²</span><br><span class="line">    reconstructed = []</span><br><span class="line">    first_idx = second_idx = 0</span><br><span class="line">    counter_1 = counter_2 = 0</span><br><span class="line">    </span><br><span class="line">    for pos in range(len(combined_str)):</span><br><span class="line">        if pos % 2 == 0:  # å¤„ç†ç¬¬äºŒéƒ¨åˆ†</span><br><span class="line">            if second_idx &gt;= len(second_part):</span><br><span class="line">                break</span><br><span class="line">            char = second_part[second_idx]</span><br><span class="line">            second_idx += 1</span><br><span class="line">            if (counter_2 == 0 or counter_2 % 3 == 0) and char == &#x27;3&#x27;:</span><br><span class="line">                reconstructed.append(&#x27;0&#x27;)</span><br><span class="line">            else:</span><br><span class="line">                reconstructed.append(char)</span><br><span class="line">            counter_2 += 1</span><br><span class="line">        else:             # å¤„ç†ç¬¬ä¸€éƒ¨åˆ†</span><br><span class="line">            char = first_part[first_idx]</span><br><span class="line">            first_idx += 1</span><br><span class="line">            if (counter_1 == 1 or (counter_1 - 1) % 3 == 0) and char == &#x27;3&#x27;:</span><br><span class="line">                reconstructed.append(&#x27;0&#x27;)</span><br><span class="line">            else:</span><br><span class="line">                reconstructed.append(char)</span><br><span class="line">            counter_1 += 1</span><br><span class="line">    </span><br><span class="line">    return &#x27;&#x27;.join(reconstructed)</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ç¤ºä¾‹</span><br><span class="line">encrypted_data = &quot;105C5A31214E50520020444E2F3A&quot;</span><br><span class="line">decryption_key = &quot;Sherlock&quot;</span><br><span class="line"></span><br><span class="line"># è§£å¯†é˜¶æ®µ</span><br><span class="line">decrypted_hex = xor_decrypt(encrypted_data, decryption_key)</span><br><span class="line">processed_hex = process_hex_string(decrypted_hex)</span><br><span class="line"></span><br><span class="line"># æœ€ç»ˆè½¬æ¢</span><br><span class="line">print(&quot;\nFinal result:&quot;)</span><br><span class="line">for i in range(0, len(processed_hex), 3):</span><br><span class="line">    hex_triplet = processed_hex[i:i+3]</span><br><span class="line">    print(chr(int(hex_triplet, 16)), end=&#x27;&#x27;)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>PEè§£æå™¨</title>
    <url>/posts/38541/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="PEè§£æå™¨"><a href="#PEè§£æå™¨" class="headerlink" title="PEè§£æå™¨"></a>PEè§£æå™¨</h1><p>ä¸»è¦åŠŸèƒ½ï¼š</p>
<ol>
<li>æ‰“å°PEå¤´</li>
<li>æ‰“å°èŠ‚è¡¨</li>
<li>æ‰“å°æ•°æ®ç›®å½•è¡¨</li>
</ol>
<p>åœ¨ç»ˆç«¯ä¸­å°†PEæ–‡ä»¶è·¯å¾„ä¼ å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">void DOS_head(unsigned char *pfile)&#123;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)pfile;</span><br><span class="line">    printf(&quot;DOSå¤´:\n&quot;);</span><br><span class="line">    printf(&quot;e_magic:%#06x\te_lfanew:%#010x\n\n&quot;,dos-&gt;e_magic,dos-&gt;e_lfanew);</span><br><span class="line">&#125;</span><br><span class="line">void file_header(unsigned char *pfile)&#123;</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)pfile;</span><br><span class="line">    printf(&quot;FILEå¤´:\n&quot;);</span><br><span class="line">    printf(&quot;Machine: %#06x\n&quot;, fheader-&gt;Machine);</span><br><span class="line">    printf(&quot;NumberOfSections: %#06x\n&quot;, fheader-&gt;NumberOfSections);</span><br><span class="line">    printf(&quot;TimeDateStamp: %#010x\n&quot;, fheader-&gt;TimeDateStamp);</span><br><span class="line">    printf(&quot;PointerToSymbolTable: %#010x\n&quot;, fheader-&gt;PointerToSymbolTable);</span><br><span class="line">    printf(&quot;NumberOfSymbols: %#010x\n&quot;, fheader-&gt;NumberOfSymbols);</span><br><span class="line">    printf(&quot;SizeOfOptionalHeader: %#06x\n&quot;, fheader-&gt;SizeOfOptionalHeader);</span><br><span class="line">    printf(&quot;Characteristics: %#06x\n\n\n&quot;, fheader-&gt;Characteristics);</span><br><span class="line">&#125;</span><br><span class="line">void optional_header(unsigned char* pfile)&#123;</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)pfile;</span><br><span class="line">    printf(&quot;optionalå¤´:\n&quot;);</span><br><span class="line">    printf(&quot;SizeOfCode:%#010x\n&quot;,oheader-&gt;SizeOfCode);</span><br><span class="line">    printf(&quot;SizeOfInitializedData:%#010x\n&quot;,oheader-&gt;SizeOfInitializedData);</span><br><span class="line">    printf(&quot;SizeOfUninitializedData:%#010x\n&quot;,oheader-&gt;SizeOfUninitializedData);</span><br><span class="line">    printf(&quot;AddressOfEntryPoint:%#010x\n&quot;,oheader-&gt;AddressOfEntryPoint);</span><br><span class="line">    printf(&quot;BaseOfCode:%#010x\n&quot;,oheader-&gt;BaseOfCode);</span><br><span class="line">    printf(&quot;BaseOfData:%#010x\n&quot;,oheader-&gt;BaseOfData);</span><br><span class="line">    printf(&quot;ImageBase:%#010x\n&quot;,oheader-&gt;ImageBase);</span><br><span class="line">    printf(&quot;SectionAlignment:%#010x\n&quot;,oheader-&gt;SectionAlignment);</span><br><span class="line">    printf(&quot;FileAlignment:%#010x\n&quot;,oheader-&gt;FileAlignment);</span><br><span class="line">    printf(&quot;SizeOfImage:%#010x\n&quot;,oheader-&gt;SizeOfImage);</span><br><span class="line">    printf(&quot;SizeOfHeaders:%#010x\n\n\n&quot;,oheader-&gt;SizeOfHeaders);</span><br><span class="line">&#125;</span><br><span class="line">void directory_print()&#123;</span><br><span class="line">    printf(&quot;Directory:\n&quot;);</span><br><span class="line">    printf(&quot;Name                           RVA              size\n&quot;);</span><br><span class="line">    printf(&quot;Export Directory               %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[0].VirtualAddress,oheader-&gt;DataDirectory[0].Size);</span><br><span class="line">    printf(&quot;Import Directory               %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[1].VirtualAddress,oheader-&gt;DataDirectory[1].Size);</span><br><span class="line">    printf(&quot;Resource Directory             %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[2].VirtualAddress,oheader-&gt;DataDirectory[2].Size);</span><br><span class="line">    printf(&quot;Exception Directory            %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[3].VirtualAddress,oheader-&gt;DataDirectory[3].Size);</span><br><span class="line">    printf(&quot;Security Directory             %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[4].VirtualAddress,oheader-&gt;DataDirectory[4].Size);</span><br><span class="line">    printf(&quot;Base Relocation Table          %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[5].VirtualAddress,oheader-&gt;DataDirectory[5].Size);</span><br><span class="line">    printf(&quot;Debug Directory                %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[6].VirtualAddress,oheader-&gt;DataDirectory[6].Size);</span><br><span class="line">    printf(&quot;Architecture Specific Data     %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[7].VirtualAddress,oheader-&gt;DataDirectory[7].Size);</span><br><span class="line">    printf(&quot;RVA of GP                      %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[8].VirtualAddress,oheader-&gt;DataDirectory[8].Size);</span><br><span class="line">    printf(&quot;TLS Directory                  %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[9].VirtualAddress,oheader-&gt;DataDirectory[9].Size);</span><br><span class="line">    printf(&quot;Load Config Directory          %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[10].VirtualAddress,oheader-&gt;DataDirectory[10].Size);</span><br><span class="line">    printf(&quot;Bound Import Directory         %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[11].VirtualAddress,oheader-&gt;DataDirectory[11].Size);</span><br><span class="line">    printf(&quot;Import Address Table           %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[12].VirtualAddress,oheader-&gt;DataDirectory[12].Size);</span><br><span class="line">    printf(&quot;Delay Import Descriptors       %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[13].VirtualAddress,oheader-&gt;DataDirectory[13].Size);</span><br><span class="line">    printf(&quot;COM Runtime descriptor         %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[14].VirtualAddress,oheader-&gt;DataDirectory[14].Size);</span><br><span class="line">    printf(&quot;Reserved                       %#010x       %#010x\n&quot;,oheader-&gt;DataDirectory[15].VirtualAddress,oheader-&gt;DataDirectory[15].Size);</span><br><span class="line">&#125;</span><br><span class="line">void section_header(unsigned char *pfile)&#123;</span><br><span class="line">    int num = fheader-&gt;NumberOfSections;</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)pfile;</span><br><span class="line">    int i=0;</span><br><span class="line">    IMAGE_SECTION_HEADER* p=NULL;</span><br><span class="line">    printf(&quot;èŠ‚è¡¨:\n&quot;);</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        p = &amp;sheader[i];</span><br><span class="line">        printf(&quot;name:%s\n&quot;,p-&gt;Name);</span><br><span class="line">        printf(&quot;VirtualSize:%#010x\n&quot;,p-&gt;Misc);</span><br><span class="line">        printf(&quot;VirtualAddress:%#010x\n&quot;,p-&gt;VirtualAddress);</span><br><span class="line">        printf(&quot;SizeOfRawData:%#010x\n&quot;,p-&gt;SizeOfRawData);</span><br><span class="line">        printf(&quot;PointerToRawData:%#010x\n&quot;,p-&gt;PointerToRawData);</span><br><span class="line">        printf(&quot;Characteristics:%#010x\n\n&quot;,p-&gt;Characteristics);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char* argv[])&#123;</span><br><span class="line">    if(argc != 2) &#123;</span><br><span class="line">        printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    const char* pe_path = argv[1];</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    int psize=ftell(pf);</span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(psize);</span><br><span class="line">    fread(file_buf,1,psize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    DOS_head(file_buf);</span><br><span class="line">    unsigned char* offset = file_buf + dos-&gt;e_lfanew;</span><br><span class="line">    if (memcmp(offset, &quot;PE\0\0&quot;, 4) != 0) &#123;</span><br><span class="line">        printf(&quot;ä¸æ˜¯æœ‰æ•ˆçš„PEæ–‡ä»¶\n&quot;);</span><br><span class="line">        free(file_buf);</span><br><span class="line">        free(dos);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    offset += 4; // å®šä½åˆ°fileå¤´</span><br><span class="line">    file_header(offset);</span><br><span class="line">    offset += sizeof(IMAGE_FILE_HEADER); // å®šä½åˆ°å¯é€‰å¤´</span><br><span class="line">    optional_header(offset);</span><br><span class="line">    offset += sizeof(IMAGE_OPTIONAL_HEADER32);  // å®šä½åˆ°èŠ‚è¡¨</span><br><span class="line">    section_header(offset);</span><br><span class="line">    directory_print();</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="RVAä¸FOAè½¬åŒ–å™¨"><a href="#RVAä¸FOAè½¬åŒ–å™¨" class="headerlink" title="RVAä¸FOAè½¬åŒ–å™¨"></a>RVAä¸FOAè½¬åŒ–å™¨</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">DWORD FOA_to_RVA(DWORD foa)&#123;</span><br><span class="line">    DWORD rva=0;</span><br><span class="line">    if(foa&lt;oheader-&gt;SizeOfHeaders) &#123;</span><br><span class="line">        rva = foa;</span><br><span class="line">        return rva;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;fheader-&gt;NumberOfSections;i++)&#123;</span><br><span class="line">        if(foa&gt;=sheader[i].PointerToRawData&amp;&amp;foa&lt;(sheader[i].PointerToRawData+sheader[i].SizeOfRawData))</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=foa-sheader[i].PointerToRawData;</span><br><span class="line">    rva = sheader[i].VirtualAddress + offset;</span><br><span class="line">    return rva;</span><br><span class="line">&#125;</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">    DWORD foa=0;</span><br><span class="line">    if(rva&lt;oheader-&gt;SizeOfHeaders) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;fheader-&gt;NumberOfSections;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i == fheader-&gt;NumberOfSections) &#123;printf(&quot;æ²¡æœ‰å¯¹åº”çš„FOA\n&quot;);return 0;&#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">    return foa;</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char* argv[])&#123;</span><br><span class="line">    if(argc != 2) &#123;</span><br><span class="line">        printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    const char* pe_path = argv[1];</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    int fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize);</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *buffer=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)buffer;</span><br><span class="line">    buffer+=dos-&gt;e_lfanew+4;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)buffer;</span><br><span class="line">    buffer+=20;      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)buffer;</span><br><span class="line">    buffer += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    int size = fheader-&gt;NumberOfSections * sizeof(IMAGE_SECTION_HEADER);</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)buffer;</span><br><span class="line">    int flag=0;</span><br><span class="line">    DWORD foa=0,rva=0;</span><br><span class="line">    while(1)&#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥ä½ éœ€è¦è¿›è¡Œçš„æ“ä½œï¼ˆFOA-&gt;RVAé€‰æ‹©1,RVA-&gt;FOAé€‰æ‹©2,é€€å‡ºé€‰æ‹©-1ï¼‰:\n&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;flag);</span><br><span class="line">        switch(flag)</span><br><span class="line">        &#123;</span><br><span class="line">            case 1:&#123;</span><br><span class="line">                printf(&quot;è¯·è¾“å…¥FOAï¼š&quot;);</span><br><span class="line">                scanf(&quot;%x&quot;,&amp;foa);</span><br><span class="line">                if(foa&gt;fsize||foa&lt;0) &#123;printf(&quot;è¶…å‡ºèŒƒå›´!!!&quot;);return 0;&#125;</span><br><span class="line">                rva=FOA_to_RVA(foa);</span><br><span class="line">                printf(&quot;RVAä¸ºï¼š%#x,VAä¸ºï¼š%#x\n&quot;,rva,rva+oheader-&gt;ImageBase);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            case 2:&#123;</span><br><span class="line">                printf(&quot;è¯·è¾“å…¥RVAï¼š&quot;);</span><br><span class="line">                scanf(&quot;%x&quot;,&amp;rva);</span><br><span class="line">                if(rva&lt;0||rva&gt;oheader-&gt;SizeOfImage) &#123;printf(&quot;è¶…å‡ºèŒƒå›´!!!&quot;);return 0;&#125;</span><br><span class="line">                foa=RVA_to_FOA(rva);</span><br><span class="line">                printf(&quot;FOAä¸ºï¼š%#x\n&quot;,foa);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            default:</span><br><span class="line">                return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Reverse</tag>
      </tags>
  </entry>
  <entry>
    <title>TGCTF</title>
    <url>/posts/40555/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h2 id="randomsystem"><a href="#randomsystem" class="headerlink" title="randomsystem"></a>randomsystem</h2><p>ä¸»å‡½æ•°:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">__int64 sub_412370()</span><br><span class="line">&#123;</span><br><span class="line">  v23 = 0;</span><br><span class="line">  v24 = 0;</span><br><span class="line">  v25 = 0;</span><br><span class="line">  v26 = 0;</span><br><span class="line">  v27 = 0;</span><br><span class="line">  j_memset(v19, 0, 0x100u);</span><br><span class="line">  j_memset(v18, 0, sizeof(v18));</span><br><span class="line">  strcpy(key, &quot;KeYkEy!!&quot;);</span><br><span class="line">  v17[0] = 376;</span><br><span class="line">  v17[1] = 356;</span><br><span class="line">  v17[2] = 169;</span><br><span class="line">  v17[3] = 501;</span><br><span class="line">  v17[4] = 277;</span><br><span class="line">  v17[5] = 329;</span><br><span class="line">  v17[6] = 139;</span><br><span class="line">  v17[7] = 342;</span><br><span class="line">  v17[8] = 380;</span><br><span class="line">  v17[9] = 365;</span><br><span class="line">  v17[10] = 162;</span><br><span class="line">  v17[11] = 258;</span><br><span class="line">  v17[12] = 381;</span><br><span class="line">  v17[13] = 339;</span><br><span class="line">  v17[14] = 347;</span><br><span class="line">  v17[15] = 307;</span><br><span class="line">  v17[16] = 263;</span><br><span class="line">  v17[17] = 359;</span><br><span class="line">  v17[18] = 162;</span><br><span class="line">  v17[19] = 484;</span><br><span class="line">  v17[20] = 310;</span><br><span class="line">  v17[21] = 333;</span><br><span class="line">  v17[22] = 346;</span><br><span class="line">  v17[23] = 339;</span><br><span class="line">  v17[24] = 150;</span><br><span class="line">  v17[25] = 194;</span><br><span class="line">  v17[26] = 175;</span><br><span class="line">  v17[27] = 344;</span><br><span class="line">  v17[28] = 158;</span><br><span class="line">  v17[29] = 250;</span><br><span class="line">  v17[30] = 128;</span><br><span class="line">  v17[31] = 175;</span><br><span class="line">  v17[32] = 158;</span><br><span class="line">  v17[33] = 173;</span><br><span class="line">  v17[34] = 152;</span><br><span class="line">  v17[35] = 379;</span><br><span class="line">  v17[36] = 158;</span><br><span class="line">  v17[37] = 292;</span><br><span class="line">  v17[38] = 130;</span><br><span class="line">  v17[39] = 365;</span><br><span class="line">  v17[40] = 197;</span><br><span class="line">  v17[41] = 20;</span><br><span class="line">  v17[42] = 197;</span><br><span class="line">  v17[43] = 161;</span><br><span class="line">  v17[44] = 198;</span><br><span class="line">  v17[45] = 10;</span><br><span class="line">  v17[46] = 207;</span><br><span class="line">  v17[47] = 244;</span><br><span class="line">  v17[48] = 202;</span><br><span class="line">  v17[49] = 14;</span><br><span class="line">  v17[50] = 204;</span><br><span class="line">  v17[51] = 176;</span><br><span class="line">  v17[52] = 193;</span><br><span class="line">  v17[53] = 255;</span><br><span class="line">  v17[54] = 35;</span><br><span class="line">  v17[55] = 7;</span><br><span class="line">  v17[56] = 158;</span><br><span class="line">  v17[57] = 181;</span><br><span class="line">  v17[58] = 145;</span><br><span class="line">  v17[59] = 353;</span><br><span class="line">  v17[60] = 153;</span><br><span class="line">  v17[61] = 357;</span><br><span class="line">  v17[62] = 246;</span><br><span class="line">  v17[63] = 151;</span><br><span class="line">  sub_4110EB(&quot;Welcome to HZNUCTF!!!\n&quot;, v4);</span><br><span class="line">  sub_4110EB(&quot;Enter something: \n&quot;, v5);</span><br><span class="line">  sub_411037(&quot;%64s&quot;, (char)v29);</span><br><span class="line">  sub_411339(v29, v28);</span><br><span class="line">  sub_41128F(v28[0], v28[1], &amp;v23);</span><br><span class="line">  if ( (char)v23 == 53</span><br><span class="line">    &amp;&amp; SBYTE1(v23) == 50</span><br><span class="line">    &amp;&amp; SBYTE2(v23) == 54</span><br><span class="line">    &amp;&amp; SHIBYTE(v23) == 53</span><br><span class="line">    &amp;&amp; (char)v24 == 53</span><br><span class="line">    &amp;&amp; SBYTE1(v24) == 54</span><br><span class="line">    &amp;&amp; SBYTE2(v24) == 54</span><br><span class="line">    &amp;&amp; SHIBYTE(v24) == 53</span><br><span class="line">    &amp;&amp; (char)v25 == 53</span><br><span class="line">    &amp;&amp; SBYTE1(v25) == 50</span><br><span class="line">    &amp;&amp; SBYTE2(v25) == 54</span><br><span class="line">    &amp;&amp; SHIBYTE(v25) == 53</span><br><span class="line">    &amp;&amp; (char)v26 == 53</span><br><span class="line">    &amp;&amp; SBYTE1(v26) == 51</span><br><span class="line">    &amp;&amp; SBYTE2(v26) == 54</span><br><span class="line">    &amp;&amp; SHIBYTE(v26) == 53 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4110EB(&quot;good_job!!!\n&quot;, v6);</span><br><span class="line">    sub_4110EB(&quot;So, Plz input the flag:\n&quot;, v7);</span><br><span class="line">    sub_411037(&quot;%73s&quot;, (char)&amp;v21);</span><br><span class="line">    strncpy_s(Destination, 0x41u, Source, 0x40u);</span><br><span class="line">    sub_41127B();</span><br><span class="line">    srand(Seed);</span><br><span class="line">    sub_41127B();</span><br><span class="line">    j_memset(v15, 0, 0x80u);</span><br><span class="line">    for ( i = 0; i &lt; 32; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        rand();</span><br><span class="line">        v1 = sub_41127B() % 32;</span><br><span class="line">        v13 = 1;</span><br><span class="line">        for ( j = 0; j &lt; i; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">          if ( v15[j] == v1 )</span><br><span class="line">          &#123;</span><br><span class="line">            v13 = 0;</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( !v13 );</span><br><span class="line">      v15[i] = v1;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(Destination, v15);  //æ¢ä½</span><br><span class="line">    strcpy(v19, Destination);  //å¤åˆ¶</span><br><span class="line">    int_key(&amp;v23, key);   //å¯†é’¥ç”Ÿæˆ</span><br><span class="line">    matrix_dot(&amp;matrix, v19, v18);   //çŸ©é˜µä¹˜æ³•</span><br><span class="line">    v11 = 0;</span><br><span class="line">    for ( k = 0; k &lt; 8; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      for ( m = 0; m &lt; 8; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        *((_DWORD *)&amp;v18[2 * k] + m) ^= key[v11 % j_strlen(key)];  //å¼‚æˆ–</span><br><span class="line">        ++v11;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if ( sub_411078((int)v18, (int)v17) == 1 )  //æ¯”è¾ƒ</span><br><span class="line">      sub_4110EB(&quot;Congratulation!!!\n&quot;, v8);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4110EB(&quot;wrong_wrong!!!\n&quot;, v6);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_41120D(&amp;savedregs, &amp;dword_412D48, 0, v0);</span><br><span class="line">  return v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦é€»è¾‘å°±æ˜¯è¾“å…¥ç»è¿‡æ¢ä½ã€çŸ©é˜µä¹˜æ³•ã€å¼‚æˆ–åäºæ•°æ®è¿›è¡Œæ¯”è¾ƒã€‚ä»åå¾€å‰é€†å‘ï¼š</p>
<h3 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h3><p>å¼‚æˆ–æ˜¯ä¸keyè¿›è¡Œçš„ï¼Œéœ€è¦å…ˆæ±‚å‡ºkeyçš„å€¼ã€‚ä¸€å¼€å§‹å®šä¹‰äº†strcpy(key, â€œKeYkEy!!â€);ç„¶ååœ¨int_keyå‡½æ•°å¯¹keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œè¯¥å‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°v23åœ¨å‰é¢ä¸€ä¸ªifè¯­å¥ä¸­è¿›è¡Œäº†åˆ¤æ–­ï¼Œç­‰äºæ˜¯ç›´æ¥å°†v23çš„å€¼ç»™å‡ºäº†ã€‚è¿›å»init_keyå‡½æ•°çœ‹çœ‹ä¿®æ”¹è¿‡ç¨‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __cdecl sub_412110(char *s, int a2)</span><br><span class="line">&#123;</span><br><span class="line">  int result; // eax</span><br><span class="line">  int i; // [esp+D0h] [ebp-14h]</span><br><span class="line">  size_t v4; // [esp+DCh] [ebp-8h]</span><br><span class="line"></span><br><span class="line">  v4 = j_strlen(s);</span><br><span class="line">  for ( i = 0; i &lt; (int)(v4 - 1); i += 2 )</span><br><span class="line">    *(_BYTE *)(a2 + i / 2) = (s[i + 1] - 48) | (16 * (s[i] - 48));</span><br><span class="line">  result = 8;</span><br><span class="line">  *(_BYTE *)(a2 + 8) = 0;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ®µå¯ä»¥ç›´æ¥å¤åˆ¶è¿è¡Œå¾—åˆ°keyï¼Œç„¶åæ‹¿éªŒè¯æ•°æ®ä¸å¯†é’¥å¼‚æˆ–æ¥è§£å¯†:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">int main()&#123;</span><br><span class="line">	char v23[]=&#123;53,50,54,53,53,54,54,53,53,50,54,53,53,51,54,53&#125;;</span><br><span class="line">	char key[10]=&quot;KeYkEy!!&quot;;</span><br><span class="line">	for(int i=0;i&lt;15;i+=2)&#123;</span><br><span class="line">		key[i/2]= (v23[i + 1] - 48) | (16 * (v23[i] - 48));</span><br><span class="line">	&#125;</span><br><span class="line">	key[8]=0;</span><br><span class="line">	int enc[64];</span><br><span class="line">	enc[0] = 376;</span><br><span class="line">  enc[1] = 356;</span><br><span class="line">  enc[2] = 169;</span><br><span class="line">  enc[3] = 501;</span><br><span class="line">  enc[4] = 277;</span><br><span class="line">  enc[5] = 329;</span><br><span class="line">  enc[6] = 139;</span><br><span class="line">  enc[7] = 342;</span><br><span class="line">  enc[8] = 380;</span><br><span class="line">  enc[9] = 365;</span><br><span class="line">  enc[10] = 162;</span><br><span class="line">  enc[11] = 258;</span><br><span class="line">  enc[12] = 381;</span><br><span class="line">  enc[13] = 339;</span><br><span class="line">  enc[14] = 347;</span><br><span class="line">  enc[15] = 307;</span><br><span class="line">  enc[16] = 263;</span><br><span class="line">  enc[17] = 359;</span><br><span class="line">  enc[18] = 162;</span><br><span class="line">  enc[19] = 484;</span><br><span class="line">  enc[20] = 310;</span><br><span class="line">  enc[21] = 333;</span><br><span class="line">  enc[22] = 346;</span><br><span class="line">  enc[23] = 339;</span><br><span class="line">  enc[24] = 150;</span><br><span class="line">  enc[25] = 194;</span><br><span class="line">  enc[26] = 175;</span><br><span class="line">  enc[27] = 344;</span><br><span class="line">  enc[28] = 158;</span><br><span class="line">  enc[29] = 250;</span><br><span class="line">  enc[30] = 128;</span><br><span class="line">  enc[31] = 175;</span><br><span class="line">  enc[32] = 158;</span><br><span class="line">  enc[33] = 173;</span><br><span class="line">  enc[34] = 152;</span><br><span class="line">  enc[35] = 379;</span><br><span class="line">  enc[36] = 158;</span><br><span class="line">  enc[37] = 292;</span><br><span class="line">  enc[38] = 130;</span><br><span class="line">  enc[39] = 365;</span><br><span class="line">  enc[40] = 197;</span><br><span class="line">  enc[41] = 20;</span><br><span class="line">  enc[42] = 197;</span><br><span class="line">  enc[43] = 161;</span><br><span class="line">  enc[44] = 198;</span><br><span class="line">  enc[45] = 10;</span><br><span class="line">  enc[46] = 207;</span><br><span class="line">  enc[47] = 244;</span><br><span class="line">  enc[48] = 202;</span><br><span class="line">  enc[49] = 14;</span><br><span class="line">  enc[50] = 204;</span><br><span class="line">  enc[51] = 176;</span><br><span class="line">  enc[52] = 193;</span><br><span class="line">  enc[53] = 255;</span><br><span class="line">  enc[54] = 35;</span><br><span class="line">  enc[55] = 7;</span><br><span class="line">  enc[56] = 158;</span><br><span class="line">  enc[57] = 181;</span><br><span class="line">  enc[58] = 145;</span><br><span class="line">  enc[59] = 353;</span><br><span class="line">  enc[60] = 153;</span><br><span class="line">  enc[61] = 357;</span><br><span class="line">  enc[62] = 246;</span><br><span class="line">  enc[63] = 151;</span><br><span class="line">  for(int i=0;i&lt;64;i++)&#123;</span><br><span class="line">	  enc[i]^=key[i%8];</span><br><span class="line">  &#125;</span><br><span class="line">  for(int i=0;i&lt;8;i++)&#123;</span><br><span class="line">		printf(&quot;[&quot;);</span><br><span class="line">		for(int j=0;j&lt;8;j++)&#123;</span><br><span class="line">			printf(&quot;%d&quot;,enc[i*8+j]);</span><br><span class="line">			if(j!=7) printf(&quot;,&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		printf(&quot;],\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;//è¿™é‡Œæ‰“å°çŸ©é˜µæ ¼å¼æ˜¯ä¸ºäº†åç»­çŸ©é˜µè§£å¯†æ›´æ–¹ä¾¿</span><br><span class="line">///[298,257,255,400,327,300,216,307],</span><br><span class="line">[302,264,244,359,303,310,264,342],</span><br><span class="line">[341,258,244,385,356,296,265,310],</span><br><span class="line">[196,167,249,317,204,159,211,202],</span><br><span class="line">[204,200,206,286,204,321,209,264],</span><br><span class="line">[151,113,147,196,148,111,156,145],</span><br><span class="line">[152,107,154,213,147,154,112,98],</span><br><span class="line">[204,208,199,260,203,256,165,242]///</span><br></pre></td></tr></table></figure>

<h3 id="çŸ©é˜µé€†å‘"><a href="#çŸ©é˜µé€†å‘" class="headerlink" title="çŸ©é˜µé€†å‘"></a>çŸ©é˜µé€†å‘</h3><p>æºä»£ç ä¸­æ˜¯æ•°æ®ä¸çŸ©é˜µmatrixè¿›è¡Œä¹˜æ³•å¾—åˆ°ä¸Šé¢çš„ç»“æœï¼ˆè®¾ç½®ä¸ºçŸ©é˜µBï¼‰ï¼Œé‚£ä¹ˆè¦å¾—åˆ°æ•°æ®ï¼Œå°±éœ€è¦å°†çŸ©é˜µBä¸matrixçš„é€†çŸ©é˜µç›¸ä¹˜ã€‚å¯¹matrixçŸ©é˜µäº¤å‰å¼•ç”¨å¯ä»¥è¿½è¸ªåˆ°TLSå‡½æ•°é‡Œé¢</p>
<img src="/posts/40555/image-20250418184949999.png" class="" title="image-20250418184949999">

<p>æ ¹æ®TLSå‡½æ•°ï¼Œå¯ä»¥çŸ¥é“çŸ©é˜µmatrixçš„å€¼ã€‚è§£å¯†è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªæ–¹é˜µ</span></span><br><span class="line">A = np.array([[<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]])</span><br><span class="line">A_inv = np.linalg.inv(A)  <span class="comment"># è®¡ç®—é€†çŸ©é˜µ</span></span><br><span class="line">A_int = A_inv.astype(<span class="built_in">int</span>)  <span class="comment"># é€†çŸ©é˜µè½¬åŒ–ä¸ºæ•´æ•°çŸ©é˜µ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;é€†çŸ©é˜µ:\n&quot;</span>, A_int)</span><br><span class="line">B = np.array([[<span class="number">298</span>,<span class="number">257</span>,<span class="number">255</span>,<span class="number">400</span>,<span class="number">327</span>,<span class="number">300</span>,<span class="number">216</span>,<span class="number">307</span>],</span><br><span class="line">            [<span class="number">302</span>,<span class="number">264</span>,<span class="number">244</span>,<span class="number">359</span>,<span class="number">303</span>,<span class="number">310</span>,<span class="number">264</span>,<span class="number">342</span>],</span><br><span class="line">            [<span class="number">341</span>,<span class="number">258</span>,<span class="number">244</span>,<span class="number">385</span>,<span class="number">356</span>,<span class="number">296</span>,<span class="number">265</span>,<span class="number">310</span>],</span><br><span class="line">            [<span class="number">196</span>,<span class="number">167</span>,<span class="number">249</span>,<span class="number">317</span>,<span class="number">204</span>,<span class="number">159</span>,<span class="number">211</span>,<span class="number">202</span>],</span><br><span class="line">            [<span class="number">204</span>,<span class="number">200</span>,<span class="number">206</span>,<span class="number">286</span>,<span class="number">204</span>,<span class="number">321</span>,<span class="number">209</span>,<span class="number">264</span>],</span><br><span class="line">            [<span class="number">151</span>,<span class="number">113</span>,<span class="number">147</span>,<span class="number">196</span>,<span class="number">148</span>,<span class="number">111</span>,<span class="number">156</span>,<span class="number">145</span>],</span><br><span class="line">            [<span class="number">152</span>,<span class="number">107</span>,<span class="number">154</span>,<span class="number">213</span>,<span class="number">147</span>,<span class="number">154</span>,<span class="number">112</span>,<span class="number">98</span>],</span><br><span class="line">            [<span class="number">204</span>,<span class="number">208</span>,<span class="number">199</span>,<span class="number">260</span>,<span class="number">203</span>,<span class="number">256</span>,<span class="number">165</span>,<span class="number">242</span>]])</span><br><span class="line">C = np.dot(A_int,B);  <span class="comment"># æ±‚çŸ©é˜µä¹˜ç§¯</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;çŸ©é˜µä¹˜æ³•:\n&quot;</span>, C)</span><br></pre></td></tr></table></figure>



<p>è½¬æ¢ä¸ºå­—ç¬¦å°±æ˜¯fd11v56d454r6f4acb-1ea8d-6fy80795af83zfrb8-cd6cdc24tca7559fa099-</p>
<h3 id="æ¢ä½"><a href="#æ¢ä½" class="headerlink" title="æ¢ä½"></a>æ¢ä½</h3><p>æ¢ä½å‡½æ•°ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¾“å…¥ï¼Œç¬¬äºŒä¸ªä¸€ä¸ªæ•°ç»„v15ã€‚è¿™ä¸ªv15ç”±å‰é¢çš„å¾ªç¯ç”Ÿæˆ</p>
<img src="/posts/40555/image-20250418190757983.png" class="" title="image-20250418190757983">

<p>è¿™ä¸ªå¾ªç¯idaåæ±‡ç¼–ä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œå»çœ‹çœ‹æ±‡ç¼–ä»£ç å°±ä¼šå‘ç°ï¼Œå®é™…ä¸Šsub_41127Bå‡½æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ£€æŸ¥æ ˆå¹³è¡¡çš„å‡½æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼(è¿”å›å€¼ä¸å­˜åœ¨eaxå¯„å­˜å™¨)ï¼Œåªæœ‰randå‡½æ•°æ‰ä¼šæŠŠè¿”å›å€¼å­˜åˆ°eaxé‡Œé¢ï¼Œæ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯v1&#x3D;rand()%32ã€‚</p>
<p>è¿™ä¸€æ•´ä¸ªå¾ªç¯å…¶å®å°±æ˜¯ç”Ÿæˆ32ä¸ªä¸é‡å¤çš„ä¼ªéšæœºæ•°ï¼Œsrandåœ¨TLSå‡½æ•°å°±å·²ç»ç§ä¸‹ï¼Œä¸º2025ã€‚äº¤æ¢å‡½æ•°ä¼˜åŒ–åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">size_t __cdecl sub_413360(char *Str, int a2)</span><br><span class="line">&#123;</span><br><span class="line">  size_t result; // eax</span><br><span class="line">  char v3; // [esp+D3h] [ebp-1Dh]</span><br><span class="line">  size_t i; // [esp+DCh] [ebp-14h]</span><br><span class="line">  size_t v5; // [esp+E8h] [ebp-8h]</span><br><span class="line"></span><br><span class="line">  v5 = 64;</span><br><span class="line">  for ( i = 0;i&lt;32 ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( a2[i] &gt;= 0 &amp;&amp; a2[i] &lt; 64 )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = Str[i];</span><br><span class="line">      Str[i] = Str[64 - a2[i] - 1];</span><br><span class="line">      Str[64 - a2[i] - 1] = v3;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£å¯†:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">char</span> Str[],<span class="type">int</span> a2[])</span>&#123;</span><br><span class="line">	<span class="type">int</span> i=<span class="number">31</span>;</span><br><span class="line">	<span class="type">char</span> v3;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">31</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">		v3 = Str[i];</span><br><span class="line">      	Str[i] = Str[<span class="number">64</span> - a2[i] - <span class="number">1</span>];</span><br><span class="line">      	Str[<span class="number">64</span> - a2[i] - <span class="number">1</span>] = v3;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,Str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">int</span> seed=<span class="number">2025</span>;</span><br><span class="line">	<span class="type">int</span> a[<span class="number">32</span>];</span><br><span class="line">	<span class="type">int</span> temp;</span><br><span class="line">	<span class="type">int</span> zero=<span class="number">1</span>;</span><br><span class="line">	srand(seed);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			temp=rand()%<span class="number">32</span>;</span><br><span class="line">			zero=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++)</span><br><span class="line">				<span class="keyword">if</span>(temp==a[j])&#123;</span><br><span class="line">					zero=<span class="number">0</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;<span class="keyword">while</span>(zero==<span class="number">0</span>);</span><br><span class="line">		a[i]=temp;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">char</span> str[]=<span class="string">&quot;fd11v56d454r6f4acb-1ea8d-6fy80795af83zfrb8-cd6cdc24tca7559fa099-&quot;</span>;</span><br><span class="line">	swap(str,a);</span><br><span class="line">&#125;#<span class="number">3</span>zfb899ac5c256d<span class="number">-7</span>a8r59f0tccd<span class="number">-4f</span>a6b8vfd111-a44ffy4r0<span class="number">-6</span>dce5679da58</span><br></pre></td></tr></table></figure>

<p>HZNUCTF{3zfb899ac5c256d-7a8r59f0tccd-4fa6b8vfd111-a44ffy4r0-6dce5679da58}</p>
]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>iscc</title>
    <url>/posts/40580/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="ç»ƒæ­¦é¢˜"><a href="#ç»ƒæ­¦é¢˜" class="headerlink" title="ç»ƒæ­¦é¢˜"></a>ç»ƒæ­¦é¢˜</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="SR"><a href="#SR" class="headerlink" title="SR"></a>SR</h3><p>è„±å£³ä¹‹åæ‰“å¼€</p>
<img src="/posts/40580/image-20250501195702098.png" class="" title="image-20250501195702098">

<p>åœ¨æ¯”è¾ƒå‡½æ•°å¤„è®¾ç½®æ–­ç‚¹ï¼ŒåŠ¨è°ƒå¾—åˆ°flag</p>
<img src="/posts/40580/image-20250501195758440.png" class="" title="image-20250501195758440">

<h3 id="æˆ‘çˆ±çœ‹å°å“"><a href="#æˆ‘çˆ±çœ‹å°å“" class="headerlink" title="æˆ‘çˆ±çœ‹å°å“"></a>æˆ‘çˆ±çœ‹å°å“</h3><img src="/posts/40580/image-20250501202304564.png" class="" title="image-20250501202304564">

<p>pythonå†™çš„elfæ–‡ä»¶ï¼Œä½¿ç”¨pyinstxtractor.pyè„šæœ¬å¤„ç†ï¼ˆæ³¨æ„ï¼Œå¿…é¡»è¦åœ¨3.8çš„ç¯å¢ƒï¼‰</p>
<img src="/posts/40580/image-20250501202614840.png" class="" title="image-20250501202614840">

<p>ä½¿ç”¨pycdcåç¼–è¯‘pycæ–‡ä»¶ï¼š</p>
<img src="/posts/40580/image-20250501202730601.png" class="" title="image-20250501202730601">

<p>å¼•ç”¨äº†mypyå’Œyourpyä¸¤ä¸ªåº“ã€‚å»PYZ-00.pyz_extractedæ–‡ä»¶å¤¹ä¸‹æ‰¾ï¼Œæ²¡æ‰¾åˆ°åŒåpycæ–‡ä»¶ï¼Œä½†æ˜¯æœ‰.pyc.encryptedæ–‡ä»¶</p>
<p>ã€‚è¿™ç§æ–‡ä»¶æ˜¯åŠ äº†å¯†çš„pycæ–‡ä»¶ï¼ŒåŠ å¯†å¯†é’¥åœ¨pyimod00_crypto_key.pycæ–‡ä»¶é‡Œé¢ï¼š</p>


<p>ä½¿ç”¨è§£å¯†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import zlib, tinyaes</span><br><span class="line">from pathlib import Path</span><br><span class="line"></span><br><span class="line"># é…ç½®å‚æ•°</span><br><span class="line">CRYPT_BLOCK_SIZE = 16</span><br><span class="line">key = bytes(&#x27;yibaibayibei1801&#x27;, &#x27;utf-8&#x27;)  # ç›´æ¥ä½¿ç”¨ä½ çš„å¯†é’¥</span><br><span class="line">input_file = Path(&quot;D:\\Re\\pythoné€†å‘\\mypy.pyc.encrypted&quot;)   # è¦è¿è¡Œä¸¤æ¬¡è„šæœ¬å¾—åˆ°ä¸¤ä¸ªpycæ–‡ä»¶</span><br><span class="line">output_file = input_file.with_suffix(&#x27;&#x27;)  # è¾“å‡ºè·¯å¾„ä¸º mypy.pyc</span><br><span class="line"></span><br><span class="line"># è§£å¯†æ ¸å¿ƒé€»è¾‘</span><br><span class="line">with open(input_file, &#x27;rb&#x27;) as inf, open(output_file, &#x27;wb&#x27;) as outf:</span><br><span class="line">    iv = inf.read(CRYPT_BLOCK_SIZE)  # è¯»å–åˆå§‹å‘é‡</span><br><span class="line">    cipher = tinyaes.AES(key, iv)</span><br><span class="line">    encrypted_data = inf.read()  # è¯»å–åŠ å¯†æ•°æ®</span><br><span class="line">    decrypted_data = cipher.CTR_xcrypt_buffer(encrypted_data)  # AES-CTRè§£å¯†</span><br><span class="line">    plaintext = zlib.decompress(decrypted_data)  # è§£å‹æ•°æ®</span><br><span class="line">    </span><br><span class="line">    # ä¿®å¤pycæ–‡ä»¶å¤´ï¼ˆéœ€æ ¹æ®Pythonç‰ˆæœ¬è°ƒæ•´ï¼ï¼‰</span><br><span class="line">    # Python 3.8 ç¤ºä¾‹ï¼šb&#x27;\x55\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0&#x27;</span><br><span class="line">    pyc_header = b&#x27;\x55\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0&#x27;  </span><br><span class="line">    outf.write(pyc_header + plaintext)</span><br><span class="line"></span><br><span class="line">print(f&quot;[+] è§£å¯†å®Œæˆ: &#123;output_file&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ä¸¤ä¸ª.pycæ–‡ä»¶</p>
<img src="/posts/40580/image-20250501203831664.png" class="" title="image-20250501203831664">

<p>åˆ†åˆ«åç¼–è¯‘</p>
<p>mypy.pyc:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">def myfun():</span><br><span class="line">    part1 = &#x27;ISCC&#123;&#x27;</span><br><span class="line">    part2 = &#x27;xxxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;</span><br><span class="line">    part3 = &#x27;&#125;&#x27;</span><br><span class="line">    tmp = &#x27;&#x27;</span><br><span class="line">    part2_1 = part2[:11]</span><br><span class="line">    part2_2 = part2[11:15]</span><br><span class="line">    part2_3 = part2[15:20]</span><br><span class="line">    part2_4 = part2[20:]</span><br><span class="line">    for i in range(len(part2_1)):</span><br><span class="line">        tmp += chr(ord(part2_1[i]) + 1)</span><br><span class="line">    for i in range(len(part2_2)):</span><br><span class="line">        if part2_2[i].isalpha():</span><br><span class="line">            tmp += chr(ord(part2_2[i]) ^ 32)</span><br><span class="line">            continue</span><br><span class="line">        tmp += chr(ord(part2_2[i]) + 0)</span><br><span class="line">    for i in range(len(part2_3)):</span><br><span class="line">        tmp += chr(ord(part2_3[i]) - 1)</span><br><span class="line">    for i in range(len(part2_4)):</span><br><span class="line">        tmp += chr(ord(part2_4[i]) + i % 2)</span><br><span class="line">    cipher = &#x27;qzjotubmmfs_IS_udqx^iotfrfsuiog&#x27;</span><br><span class="line">    true_flag = part1 + part2 + part3</span><br><span class="line">    print(time.strftime(&#x27;%Y-%m-%d %H:%M&#x27;, time.localtime(time.time())))</span><br><span class="line">    return true_flag</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    ss = myfun()</span><br><span class="line">    print(ss)</span><br></pre></td></tr></table></figure>

<p>yourpy.pyc:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def next():</span><br><span class="line">Unsupported opcode: BEGIN_FINALLY</span><br><span class="line">    useful = &#x27;\n\n                                                                                       ,---,\n                                                                                    ,`--.\&#x27; |\n  ,--,                            ,-.           ,---,                               |   :  :\n,--.\&#x27;|                        ,--/ /|         ,--.\&#x27; |                               \&#x27;   \&#x27;  ;\n|  | :     ,---.     ,---.  ,--. :/ |         |  |  :                __  ,-.        |   |  |\n:  : \&#x27;    \&#x27;   ,\&#x27;\\   \&#x27;   ,\&#x27;\\ :  : \&#x27; /          :  :  :              ,\&#x27; ,\&#x27;/ /|        \&#x27;   :  ;\n|  \&#x27; |   /   /   | /   /   ||  \&#x27;  /           :  |  |,--.   ,---.  \&#x27;  | |\&#x27; | ,---.  |   |  \&#x27;\n\&#x27;  | |  .   ; ,. :.   ; ,. :\&#x27;  |  :           |  :  \&#x27;   |  /     \\ |  |   ,\&#x27;/     \\ \&#x27;   :  |\n|  | :  \&#x27;   | |: :\&#x27;   | |: :|  |   \\          |  |   /\&#x27; : /    /  |\&#x27;  :  / /    /  |;   |  ;\n\&#x27;  : |__\&#x27;   | .; :\&#x27;   | .; :\&#x27;  : |. \\         \&#x27;  :  | | |.    \&#x27; / ||  | \&#x27; .    \&#x27; / |`---\&#x27;. |\n|  | \&#x27;.\&#x27;|   :    ||   :    ||  | \&#x27; \\ \\        |  |  \&#x27; | :\&#x27;   ;   /|;  : | \&#x27;   ;   /| `--..`;\n;  :    ;\\   \\  /  \\   \\  / \&#x27;  : |--\&#x27;         |  :  :_:,\&#x27;\&#x27;   |  / ||  , ; \&#x27;   |  / |.--,_\n|  ,   /  `----\&#x27;    `----\&#x27;  ;  |,\&#x27;            |  | ,\&#x27;    |   :    | ---\&#x27;  |   :    ||    |`.\n ---`-\&#x27;                     \&#x27;--\&#x27;              `--\&#x27;\&#x27;       \\   \\  /         \\   \\  / `-- -`, ;\n                                                           `----\&#x27;           `----\&#x27;    \&#x27;---`&quot;\n\n\n    \n&#x27;</span><br><span class="line">    tips = &#x27;Congratulations, you found the hidden tip!&#x27;</span><br><span class="line">    your_id = &#x27;TIPO&#x27; + str(len(tips)) + &#x27;PCDL&#x27;</span><br><span class="line"># WARNING: Decompyle incomplete</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    next()</span><br></pre></td></tr></table></figure>

<img src="/posts/40580/image-20250501204050505.png" class="" title="image-20250501204050505">

<p>flagå’Œyourpy.pycæ— å…³ï¼Œåªéœ€è¦è§£mypy.pycé‡Œé¢çš„åŠ å¯†å°±è¡Œï¼Œç¨å¾®æ”¹ä¸€ä¸‹åŠ å¯†è„šæœ¬å°±èƒ½å®ç°è§£å¯†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">def myfun():</span><br><span class="line">    part1 = &#x27;ISCC&#123;&#x27;</span><br><span class="line">    part2 = &#x27;qzjotubmmfs_IS_udqx^iotfrfsuiog&#x27;</span><br><span class="line">    part3 = &#x27;&#125;&#x27;</span><br><span class="line">    tmp = &#x27;&#x27;</span><br><span class="line">    part2_1 = part2[:11]</span><br><span class="line">    part2_2 = part2[11:15]</span><br><span class="line">    part2_3 = part2[15:20]</span><br><span class="line">    part2_4 = part2[20:]</span><br><span class="line">    for i in range(len(part2_1)):</span><br><span class="line">        tmp += chr(ord(part2_1[i]) - 1)</span><br><span class="line">    for i in range(len(part2_2)):</span><br><span class="line">        if part2_2[i].isalpha():</span><br><span class="line">            tmp += chr(ord(part2_2[i]) ^ 32)</span><br><span class="line">            continue</span><br><span class="line">        tmp += chr(ord(part2_2[i]) + 0)</span><br><span class="line">    for i in range(len(part2_3)):</span><br><span class="line">        tmp += chr(ord(part2_3[i]) + 1)</span><br><span class="line">    for i in range(len(part2_4)):</span><br><span class="line">        tmp += chr(ord(part2_4[i]) - i % 2)</span><br><span class="line">    cipher = &#x27;qzjotubmmfs_IS_udqx^iotfrfsuiog&#x27;</span><br><span class="line">    true_flag = part1 + part2 + part3</span><br><span class="line">    print(time.strftime(&#x27;%Y-%m-%d %H:%M&#x27;, time.localtime(time.time())))</span><br><span class="line">    return tmp</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    ss = myfun()</span><br><span class="line">    print(ss)</span><br><span class="line"> //ISCC&#123;pyinstaller_is_very_interesting&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ä¹¦æ³•å¤§å¸ˆ"><a href="#ä¹¦æ³•å¤§å¸ˆ" class="headerlink" title="ä¹¦æ³•å¤§å¸ˆ"></a>ä¹¦æ³•å¤§å¸ˆ</h3><p>ä½¿ç”¨binwalkæå–å›¾ç‰‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">binwalk -e attachment-5.jpg</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°_attachment-5.jpg.extractedæ–‡ä»¶å¤¹ã€‚é‡Œé¢æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œéœ€è¦å¯†ç ã€‚ä½¿ç”¨åœ¨çº¿ç½‘ç«™æŸ¥çœ‹å›¾ç‰‡æ³¨é‡Šï¼Œå¾—åˆ°è§£å‹å¯†ç ï¼š</p>
<img src="/posts/40580/image-20250502174522457.png" class="" title="image-20250502174522457">

<p>è§£å‹å¾—åˆ°message45.txtæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯ä¹±ç </p>
<img src="/posts/40580/image-20250502174725308.png" class="" title="image-20250502174725308">

<p>æ¯ä¸¤ä¸ªæ±‰å­—çš„ç¬”åˆ’ç»„æˆä¸€ä¸ªå­—èŠ‚ï¼Œæ¯”å¦‚â€œå³å¥³â€ç¬”åˆ’æ•°åˆ†åˆ«ä¸º5å’Œ3ï¼Œç»„æˆ0x53ï¼ˆè¿™é‡Œçš„Oä»£è¡¨ç¬”åˆ’ä¸º0ï¼‰ï¼Œé€šè¿‡æ­¤æ–¹æ³•å¾—åˆ°ï¼š</p>
<p>SVNDQ3swVzdVTnpBZ0NofQ&#x3D;&#x3D;</p>
<p>è§£ç </p>
<img src="/posts/40580/image-20250502182009921.png" class="" title="image-20250502182009921">

<h2 id="mobile-å®‰å“"><a href="#mobile-å®‰å“" class="headerlink" title="mobile(å®‰å“)"></a>mobile(å®‰å“)</h2><h3 id="ä¸‰è¿›åˆ¶æˆ˜äº‰"><a href="#ä¸‰è¿›åˆ¶æˆ˜äº‰" class="headerlink" title="ä¸‰è¿›åˆ¶æˆ˜äº‰"></a>ä¸‰è¿›åˆ¶æˆ˜äº‰</h3><p>ä½¿ç”¨frida hookå¾—flagï¼Œæ³¨å…¥ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import frida</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">hook_code = &quot;&quot;&quot;</span><br><span class="line">Java.perform(function () &#123;</span><br><span class="line">    let MainActivity = Java.use(&quot;com.example.mobile02.MainActivity&quot;);</span><br><span class="line">    let flag1 = &#x27;&#x27;;</span><br><span class="line">    let key2 = &#x27;&#x27;;</span><br><span class="line">    let flag2_enc = &#x27;&#x27;;</span><br><span class="line">    let flag2 = &#x27;&#x27;;</span><br><span class="line">    var dictionary = [&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;];</span><br><span class="line">    let context;</span><br><span class="line">    </span><br><span class="line">    // ====================================================</span><br><span class="line">    // 1. ä¿®å¤ï¼šæ­£ç¡®ä¿å­˜åŸå§‹æ–¹æ³•å¼•ç”¨</span><br><span class="line">    // ====================================================</span><br><span class="line">    // è·å–åŸå§‹æ–¹æ³•å¼•ç”¨ï¼ˆæœª Hook å‰ï¼‰</span><br><span class="line">    const stringFromJNlMethod = MainActivity[&quot;stringFromJNl&quot;].overload(</span><br><span class="line">        &#x27;java.lang.String&#x27;,</span><br><span class="line">        &#x27;java.lang.String&#x27;</span><br><span class="line">    );</span><br><span class="line">    const stringFromJNlMethod_1 = MainActivity[&quot;stringFromJNI&quot;].overload(</span><br><span class="line">        &#x27;java.lang.String&#x27;</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    // ====================================================</span><br><span class="line">    // 2. Hook CHECK1 ä¿®æ”¹è¾“å…¥</span><br><span class="line">    // ====================================================</span><br><span class="line">    MainActivity[&quot;CHECK1&quot;].overload(&#x27;java.lang.String&#x27;).implementation = function (str) &#123;</span><br><span class="line">        console.log(`[CHECK1] Original input: $&#123;str&#125;`);</span><br><span class="line">        let fakeStr = &quot;ISCC&#123;BBBBBBBBBB&#125;&quot;; // é•¿åº¦=5+10+1=16 &gt;13</span><br><span class="line">        </span><br><span class="line">        if (str.startsWith(&quot;ISCC&#123;&quot;) &amp;&amp; str.endsWith(&quot;&#125;&quot;)) &#123;</span><br><span class="line">            fakeStr = str;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        context = this;</span><br><span class="line">        console.log(`[CHECK1] Modified input: $&#123;fakeStr&#125;`);</span><br><span class="line">        this[&quot;CHECK2&quot;].call(this, fakeStr);</span><br><span class="line">        return this[&quot;CHECK1&quot;](fakeStr);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    // ====================================================</span><br><span class="line">    // 3. Hook stringFromJNl å¹¶è°ƒç”¨åŸå§‹æ–¹æ³•</span><br><span class="line">    // ====================================================</span><br><span class="line">    stringFromJNlMethod.implementation = function (key, input) &#123;</span><br><span class="line">        console.log(`\\n===== Hooked stringFromJNl: key=$&#123;key&#125;, input=$&#123;input&#125; =====`);</span><br><span class="line">        if (key.length == 32) &#123;</span><br><span class="line">            key2 = key;</span><br><span class="line">        &#125;</span><br><span class="line">        return stringFromJNlMethod.call(this, key, input);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    stringFromJNlMethod_1.implementation = function (key) &#123;</span><br><span class="line">        flag1 = stringFromJNlMethod_1.call(this, key);</span><br><span class="line">        console.log(`flag1: $&#123;flag1&#125;`);</span><br><span class="line">        return flag1;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    let Intrinsics = Java.use(&quot;kotlin.jvm.internal.Intrinsics&quot;);</span><br><span class="line">    Intrinsics[&quot;areEqual&quot;].overload(&#x27;java.lang.Object&#x27;, &#x27;java.lang.Object&#x27;).implementation = </span><br><span class="line">        function (obj, obj2) &#123;</span><br><span class="line">            console.log(`[areEqual] Comparing: $&#123;obj&#125; vs $&#123;obj2&#125;`);</span><br><span class="line">            </span><br><span class="line">            if (String(obj2).length == 36) &#123;</span><br><span class="line">                flag2_enc = String(obj2);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            const visibleChars = [];</span><br><span class="line">            </span><br><span class="line">            if (key2.length == 32 &amp;&amp; flag2_enc.length == 36) &#123;</span><br><span class="line">                for (let i = 0x20; i &lt;= 0x7e; i++) &#123;</span><br><span class="line">                    visibleChars.push(String.fromCharCode(i));</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                visibleChars.forEach(char =&gt; &#123;</span><br><span class="line">                    const inputStr = char.repeat(6);</span><br><span class="line">                    try &#123;</span><br><span class="line">                        const result = stringFromJNlMethod.call(context, key2, inputStr);</span><br><span class="line">                        console.log(result);</span><br><span class="line">                        </span><br><span class="line">                        for (let i = 0; i &lt; 6; i += 1) &#123;</span><br><span class="line">                            dictionary[i][result.substring(i * 6, (i + 1) * 6)] = inputStr.at(i);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; catch (e) &#123;</span><br><span class="line">                        console.log(`è¾“å…¥ &#x27;$&#123;inputStr&#125;&#x27; åŠ å¯†å¤±è´¥: $&#123;e&#125;`);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                for (let i = 0; i &lt; 6; i += 1) &#123;</span><br><span class="line">                    flag2 += dictionary[i][flag2_enc.substring(i * 6, (i + 1) * 6)];</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                console.log(`flag2: $&#123;flag2&#125;`);</span><br><span class="line">                console.log(`flag: ISCC&#123;$&#123;flag1 + flag2&#125;&#125;`);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            return this[&quot;areEqual&quot;](obj, obj2);</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;);</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def handle_message(msg, data):</span><br><span class="line">    if msg[&quot;type&quot;] == &#x27;send&#x27;:</span><br><span class="line">        print(&quot;[*] &#123;0&#125;&quot;.format(msg[&#x27;payload&#x27;]))</span><br><span class="line">    else:</span><br><span class="line">        print(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    device = frida.get_usb_device()</span><br><span class="line">    pid = device.spawn([&quot;com.example.mobile02&quot;])</span><br><span class="line">    session = device.attach(pid)</span><br><span class="line">    script = session.create_script(hook_code)</span><br><span class="line">    script.on(&quot;message&quot;, handle_message)</span><br><span class="line">    script.load()</span><br><span class="line">    device.resume(pid)</span><br><span class="line">    sys.stdin.read()</span><br><span class="line">except Exception as e:</span><br><span class="line">    print(f&quot;Error: &#123;e&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p>æ³¨å…¥æµç¨‹ï¼š</p>
<p>å…ˆæ‰“å¼€æ¨¡æ‹Ÿå™¨</p>
<p>ç„¶åç”µè„‘å¼€å¯ç»ˆç«¯ï¼Œä¾æ¬¡è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤æ¥è¿è¡Œæ¨¡æ‹Ÿå™¨é‡Œé¢çš„frida_serverï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adb devices</span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">cd data/local/tmp</span><br><span class="line">./f16</span><br></pre></td></tr></table></figure>

<img src="/posts/40580/image-20250507123646619.png" class="" title="image-20250507123646619">

<p>æ¨¡æ‹Ÿå™¨å®‰è£…é¢˜ç›®çš„apkæ–‡ä»¶ï¼Œè¿è¡Œ</p>
<p>ç”µè„‘è¿è¡Œè„šæœ¬</p>
<p>æ¨¡æ‹Ÿå™¨ç‚¹å‡»ç‰¹å®šäº‹ä»¶ï¼ˆæ¯”å¦‚submit)</p>
<p>åœ¨ç»ˆç«¯ä¸Šè§‚å¯Ÿ</p>
<img src="/posts/40580/image-20250507124104236.png" class="" title="image-20250507124104236">
]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>VScodeä¸­æ–‡ä¹±ç é—®é¢˜è§£å†³</title>
    <url>/posts/27687/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h1><p>â€‹	å°è¯•äº†ç½‘ä¸Šçš„å¾ˆå¤šæ–¹æ³•ï¼Œéƒ½æœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œæœ‰å°†ç¼–ç å…¨æ”¹ä¸ºutf-8çš„ï¼ˆç¼ºç‚¹ï¼šå¤–éƒ¨è¿è¡Œæ—¶ä¹±ç ï¼Œè¾“å…¥ä¸­æ–‡åè¾“å‡ºä¸ºä¹±ç ï¼‰ï¼Œæœ‰å°†ç¼–ç å…¨æ”¹ä¸ºgbkçš„ï¼ˆç¼ºç‚¹ï¼šè¾“å…¥ä¸­æ–‡ä¸ºä¹±ç ï¼‰ï¼Œæœ‰ç›´æ¥è°ƒç”¨å¤–éƒ¨ç»ˆç«¯çš„ï¼ˆç¼ºç‚¹ï¼šç¨‹åºè¿è¡Œç»“æŸä¼šç›´æ¥å…³é—­ç»ˆç«¯ï¼Œå¯¼è‡´çœ‹ä¸åˆ°è¿è¡Œç»“æœï¼‰ã€‚å”¯ä¸€ä¸€ä¸ªè²Œä¼¼è¡Œå¾—é€šçš„æ–¹æ³•å°±æ˜¯ç¬¬ä¸‰ä¸ªï¼Œä½†æ˜¯æ‰¾äº†å¥½ä¹…éƒ½æ²¡æœ‰è®©ç»ˆç«¯åœä¸‹æ¥çš„æ–¹æ³•ï¼Œæœ€ååœ¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://blog.csdn.net/m0_73657663/article/details/134698209?ops_request_misc=%257B%2522request%255Fid%2522%253A%25229fea31e854124f56bd09f3e9533c4251%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=9fea31e854124f56bd09f3e9533c4251&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-5-134698209-null-null.nonecase&amp;utm_term=vscode&amp;spm=1018.2226.3001.4450</span><br></pre></td></tr></table></figure>

<p>è¿™ç¯‡åšå®¢é‡Œé¢æ‰çŸ¥é“å¯ä»¥å°†â€typeâ€æ”¹ä¸ºâ€cppvsdbgâ€æ¥ä½¿ç¨‹åºæš‚åœã€‚</p>
<h1 id="æ–¹æ³•ï¼š"><a href="#æ–¹æ³•ï¼š" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h1><p>1ã€å³ä¸‹è§’æ–‡ä»¶ç¼–ç æ”¹ä¸ºgbk</p>
<p>2ã€tasks.jsonæ–‡ä»¶é‡Œé¢argsåŠ ä¸€ä¸ªå‚æ•°â€-fexec-charset&#x3D;GBKâ€</p>
<p>3ã€launch.jsonæ–‡ä»¶é‡Œé¢æ”¹ä¸ºï¼šâ€typeâ€: â€œcppvsdbgâ€ï¼Œâ€externalConsoleâ€: trueæ”¹ä¸ºâ€consoleâ€: â€œexternalTerminalâ€</p>
<p>æœ€åtasks.jsonï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;2.0.0&quot;,</span><br><span class="line">    &quot;tasks&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;type&quot;: &quot;cppbuild&quot;,</span><br><span class="line">            &quot;label&quot;: &quot;C/C++: gcc.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶&quot;,</span><br><span class="line">            &quot;command&quot;: &quot;D:\\down\\mingw64\\bin\\g++.exe&quot;,</span><br><span class="line">            &quot;args&quot;: [</span><br><span class="line">                &quot;-fdiagnostics-color=always&quot;,</span><br><span class="line">                &quot;-g&quot;,</span><br><span class="line">                &quot;$&#123;file&#125;&quot;,</span><br><span class="line">                &quot;-o&quot;,</span><br><span class="line">                &quot;$&#123;fileDirname&#125;\\$&#123;fileBasenameNoExtension&#125;.exe&quot;,</span><br><span class="line">                &quot;-fexec-charset=GBK&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;options&quot;: &#123;</span><br><span class="line">                &quot;cwd&quot;: &quot;$&#123;fileDirname&#125;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;problemMatcher&quot;: [</span><br><span class="line">                &quot;$gcc&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;group&quot;: &quot;build&quot;,</span><br><span class="line">            &quot;detail&quot;: &quot;ç¼–è¯‘å™¨: D:\\down\\mingw64\\bin\\g++.exe&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>launch.jsonæ–‡ä»¶:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;C/C++: g++.exe ç»ˆç«¯è¿è¡Œ&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;cppvsdbg&quot;,</span><br><span class="line">            &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">            &quot;program&quot;: &quot;$&#123;fileDirname&#125;\\$&#123;fileBasenameNoExtension&#125;.exe&quot;,</span><br><span class="line">            &quot;args&quot;: [],</span><br><span class="line">            &quot;stopAtEntry&quot;: false,</span><br><span class="line">            &quot;cwd&quot;: &quot;$&#123;fileDirname&#125;&quot;,</span><br><span class="line">            &quot;environment&quot;: [],</span><br><span class="line">            &quot;console&quot;: &quot;externalTerminal&quot;,</span><br><span class="line">            &quot;preLaunchTask&quot;: &quot;C/C++: gcc.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;version&quot;: &quot;2.0.0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>æ‚è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>äºŒå‰æ ‘</title>
    <url>/posts/10764/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<p>ä¸ä½¿ç”¨ç»“æ„ä½“æ¥åˆ›å»ºå®Œå…¨äºŒå‰æ ‘:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">uint64_t *creat_re(char *s,int index)&#123;  // é€’å½’æ–¹å¼åˆ›å»ºå®Œå…¨äºŒå‰æ ‘</span><br><span class="line">	if(index&gt;=strlen(s)) return NULL;</span><br><span class="line">	uint64_t *temp=(uint64_t *)malloc(24);</span><br><span class="line">	if (temp == NULL) &#123;</span><br><span class="line">        fprintf(stderr, &quot;Memory allocation failed!\n&quot;);</span><br><span class="line">        exit(1);  // å¦‚æœåˆ†é…å¤±è´¥ï¼Œé€€å‡ºç¨‹åº</span><br><span class="line">    &#125;</span><br><span class="line">	*(char *)temp=s[index];</span><br><span class="line">	temp[1]=(uint64_t)creat_re(s,index*2+1);</span><br><span class="line">	temp[2]=(uint64_t)creat_re(s,index*2+2);</span><br><span class="line">	return temp;</span><br><span class="line">&#125;</span><br><span class="line">uint64_t *newnode(char c)&#123;  // éé€’å½’æ–¹å¼åˆ›å»ºå®Œå…¨äºŒå‰æ ‘çš„å•ä¸ªç»“ç‚¹</span><br><span class="line">	uint64_t *temp=(uint64_t *)malloc(24);</span><br><span class="line">	*(char *)temp=c;</span><br><span class="line">	temp[1]=temp[2]=0;</span><br><span class="line">	return temp;</span><br><span class="line">&#125;</span><br><span class="line">uint64_t *create(char *s)&#123;  // éé€’å½’æ–¹å¼åˆ›å»ºå®Œå…¨äºŒå‰æ ‘</span><br><span class="line">	uint64_t *list[100];</span><br><span class="line">	uint64_t *temp;</span><br><span class="line">	int len=strlen(s);</span><br><span class="line">	int i=1,j=1,k=0;</span><br><span class="line">	list[0]=newnode(s[0]);</span><br><span class="line">	while(i&lt;len)&#123;</span><br><span class="line">		temp=list[k++];</span><br><span class="line">		temp[1]=(uint64_t)newnode(s[i++]);</span><br><span class="line">		list[j++]=(uint64_t *)temp[1];</span><br><span class="line">		if(i&gt;=len) break;</span><br><span class="line">		temp[2]=(uint64_t)newnode(s[i++]);</span><br><span class="line">		list[j++]=(uint64_t *)temp[2];</span><br><span class="line">	&#125;</span><br><span class="line">	return list[0];</span><br><span class="line">&#125;</span><br><span class="line">void pre_travel(uint64_t *n)&#123;  // å‰åºéå†</span><br><span class="line">	if(n==NULL) return;</span><br><span class="line">	printf(&quot;%c&quot;,*(char *)n);</span><br><span class="line">	pre_travel((uint64_t *)n[1]);</span><br><span class="line">	pre_travel((uint64_t *)n[2]);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	char s[]=&quot;1234567&quot;;</span><br><span class="line">	int i;</span><br><span class="line">	uint64_t *temp;</span><br><span class="line">	// temp=creat_re(s,0);</span><br><span class="line">	temp=create(s);</span><br><span class="line">	pre_travel(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºäºä¸­åºéå†å’Œååºéå†åºåˆ—è¿˜åŸå®Œå…¨äºŒå‰æ ‘ç»“æ„ï¼Œè¾“å‡ºå±‚æ¬¡éå†åºåˆ—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#define num 26</span><br><span class="line">char mid[] = &quot;ja7Cws_A3daTd4qDo8&#125;F_Sd&#123;a&quot;;</span><br><span class="line">char post[] = &quot;j7aw_sC3addq4TAo&#125;8_Fda&#123;SD&quot;;</span><br><span class="line">// ç›®æ ‡ï¼šç»™å‡ºä¸­åºéå†å’Œååºéå†åºåˆ—ï¼Œæ±‚å‡ºå®Œå…¨äºŒå‰æ ‘ç»“æ„ï¼ˆæ‰“å°å‡ºå±‚æ¬¡éå†åºåˆ—ï¼‰</span><br><span class="line">typedef struct tree</span><br><span class="line">&#123;</span><br><span class="line">	char c;</span><br><span class="line">	struct tree *left,*right;</span><br><span class="line">&#125;tree;</span><br><span class="line">tree *creat(int ms,int me,int ps,int pe)&#123;   // åæ¨æ ‘çš„ç»“æ„</span><br><span class="line">	if(ms&gt;me||ps&gt;pe) return NULL;</span><br><span class="line">	tree *t=(tree  *)malloc(sizeof(tree));</span><br><span class="line">	char charAt=post[pe];</span><br><span class="line">	int i;</span><br><span class="line">	for(i=ms;i&lt;=me&amp;&amp;mid[i]!=charAt;i++) &#123;&#125;</span><br><span class="line">	t-&gt;c=charAt;</span><br><span class="line">	t-&gt;left=creat(ms,i-1,ps, ps + i - ms - 1);</span><br><span class="line">	t-&gt;right=creat(i+1,me, ps + i - ms,pe-1);</span><br><span class="line">	return t;</span><br><span class="line">&#125;</span><br><span class="line">void pre_travel(tree *t)&#123;    // å‰åºéå†</span><br><span class="line">	if(t==NULL) return;</span><br><span class="line">	printf(&quot;%c&quot;,t-&gt;c);</span><br><span class="line">	pre_travel(t-&gt;left);</span><br><span class="line">	pre_travel(t-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line">// å±‚æ¬¡éå†</span><br><span class="line">typedef struct q&#123;  // åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">	tree *c[num];</span><br><span class="line">	int r,f;</span><br><span class="line">&#125;queue;</span><br><span class="line">void init(queue *q)&#123;   //åˆå§‹åŒ–é˜Ÿåˆ—</span><br><span class="line">	q-&gt;r=q-&gt;f=0;</span><br><span class="line">&#125;</span><br><span class="line">void enqueue(queue *q,tree *t) &#123; // å…¥é˜Ÿ</span><br><span class="line">	if((q-&gt;f+1)%num==q-&gt;r) &#123;printf(&quot;é˜Ÿæ»¡ï¼\n&quot;);return;&#125;</span><br><span class="line">	q-&gt;c[q-&gt;f]=t;</span><br><span class="line">	q-&gt;f=(q-&gt;f+1)%num;</span><br><span class="line">&#125;</span><br><span class="line">tree *dequeue(queue *q) &#123;  // å‡ºé˜Ÿ</span><br><span class="line">	if(q-&gt;f==q-&gt;r) &#123;printf(&quot;é˜Ÿç©ºï¼\n&quot;);return NULL;&#125;</span><br><span class="line">	tree *temp=q-&gt;c[q-&gt;r];</span><br><span class="line">	q-&gt;r=(q-&gt;r+1)%num;</span><br><span class="line">	return temp;</span><br><span class="line">&#125;</span><br><span class="line">void level_travel(tree *t)&#123;  //  å±‚æ¬¡éå†</span><br><span class="line">	if(t==NULL) return;</span><br><span class="line">	queue *q=(queue *)malloc(sizeof(queue));</span><br><span class="line">	tree *temp;</span><br><span class="line">	init(q);</span><br><span class="line">	enqueue(q,t);</span><br><span class="line">	while(q-&gt;f!=q-&gt;r)&#123;</span><br><span class="line">		temp=dequeue(q);</span><br><span class="line">		printf(&quot;%c&quot;,temp-&gt;c);</span><br><span class="line">		if(temp-&gt;left!=NULL) enqueue(q,temp-&gt;left);</span><br><span class="line">		if(temp-&gt;right!=NULL) enqueue(q,temp-&gt;right);</span><br><span class="line">	&#125;</span><br><span class="line">	free(q);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	tree *t=creat(0,strlen(mid)-1,0,strlen(post)-1);</span><br><span class="line">	// pre_travel(t);</span><br><span class="line">	level_travel(t);</span><br><span class="line">&#125;</span><br><span class="line">//å±‚æ¬¡éå†ç»“æœ: DASCTF&#123;asd48_daj7w_3adqo&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡½æ•°è°ƒç”¨è¿‡ç¨‹</title>
    <url>/posts/24481/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<p>æºä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">int add(int a,int b)&#123;</span><br><span class="line">    int x,y;</span><br><span class="line">    x=a,y=b;</span><br><span class="line">    return x+y;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    int a=1,b=2;</span><br><span class="line">    printf(&quot;%d&quot;,add(a,b));</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æ”¾å…¥x32dbgé‡Œé¢è°ƒè¯•ï¼Œçœ‹åˆ°ï¼š</p>
<img src="/posts/24481/image-20241204220215454.png" class="" title="image-20241204220215454">

<p>å…ˆä»mainå‡½æ•°å¼€å§‹çœ‹ã€‚</p>
<p>åˆ›å»ºæ–°çš„å †æ ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">push ebp</span><br><span class="line">mov ebp,esp</span><br></pre></td></tr></table></figure>

<p>å…ˆæŠŠä¸»å‡½æ•°å †æ ˆä¸­çš„ebpæŒ‡é’ˆå‹å…¥æ ˆï¼Œåœ¨å°†ä¸»å‡½æ•°ä¸­çš„espèµ‹å€¼ç»™ebpç»è¿‡è¿™æ ·çš„æ“ä½œï¼Œä¼šåœ¨åŸå…ˆçš„å †æ ˆä¸Šæ–°å»ºä¸€ä¸ªå †æ ˆä¾›è¢«è°ƒå‡½æ•°ç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sub esp,20</span><br></pre></td></tr></table></figure>

<p>ä¸ºå˜é‡å¼€è¾Ÿ0x20å­—èŠ‚çš„æ–°ç©ºé—´</p>
<img src="/posts/24481/image-20241204222756002.png" class="" title="image-20241204222756002">

<p>å˜é‡èµ‹å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mov dword ptr ss:[esp+1C],1             //a=1</span><br><span class="line">mov dword ptr ss:[esp+18],2             //b=2</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æ—¶å‡½æ•°è°ƒç”¨ã€‚è°ƒç”¨è¿‡ç¨‹ä¸»è¦åˆ†ä¸¤éƒ¨åˆ†ï¼š1ã€ä¸»å‡½æ•°éƒ¨åˆ†ã€‚2ã€è¢«è°ƒå‡½æ•°éƒ¨åˆ†ã€‚</p>
<h1 id="ä¸»å‡½æ•°éƒ¨åˆ†ï¼š"><a href="#ä¸»å‡½æ•°éƒ¨åˆ†ï¼š" class="headerlink" title="ä¸»å‡½æ•°éƒ¨åˆ†ï¼š"></a>ä¸»å‡½æ•°éƒ¨åˆ†ï¼š</h1><h2 id="1ã€å‚æ•°å‹å…¥æ ˆ"><a href="#1ã€å‚æ•°å‹å…¥æ ˆ" class="headerlink" title="1ã€å‚æ•°å‹å…¥æ ˆ"></a>1ã€å‚æ•°å‹å…¥æ ˆ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0040153A | 8B4424 18                  | mov eax,dword ptr ss:[esp+18]           |b-&gt;eax</span><br><span class="line">0040153E | 894424 04                  | mov dword ptr ss:[esp+4],eax            |eax-&gt;[esp+4]</span><br><span class="line">00401542 | 8B4424 1C                  | mov eax,dword ptr ss:[esp+1C]           |a-&gt;eax</span><br><span class="line">00401546 | 890424                     | mov dword ptr ss:[esp],eax              |eax-&gt;[esp]</span><br></pre></td></tr></table></figure>



<p>æ³¨æ„åˆ°å‹å…¥æ ˆçš„é¡ºåºä¸å‚æ•°é¡ºåºæ˜¯ç›¸åçš„ï¼Œè°ƒç”¨æ—¶add(a,b)ï¼Œä½†æ˜¯bå…ˆå…¥æ ˆï¼Œaåå…¥ã€‚</p>
<h2 id="2ã€è°ƒç”¨å‡½æ•°"><a href="#2ã€è°ƒç”¨å‡½æ•°" class="headerlink" title="2ã€è°ƒç”¨å‡½æ•°"></a>2ã€è°ƒç”¨å‡½æ•°</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">00401549 | E8 B2FFFFFF                | call &lt;test.add&gt;                         |</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œcallè¯­å¥æ—¶ï¼ŒESPå‘ç”Ÿäº†æ”¹å˜</p>
<img src="/posts/24481/image-20241204225304838.png" class="" title="image-20241204225304838">

<p>æ˜¯å°†0x40154Eå‹å…¥äº†æ ˆï¼Œè€Œè¿™æ­£æ˜¯00401549+5ï¼Œå³callæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p>
<p>æ‰€ä»¥å®é™…ä¸Šåœ¨æ‰§è¡Œâ€œcall &lt;test.add&gt; â€æ—¶ï¼Œå¯ä»¥æ‹†è§£ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">push 0x40154E</span><br><span class="line">jmp  0x401500</span><br></pre></td></tr></table></figure>

<h1 id="è¢«è°ƒå‡½æ•°éƒ¨åˆ†ï¼š"><a href="#è¢«è°ƒå‡½æ•°éƒ¨åˆ†ï¼š" class="headerlink" title="è¢«è°ƒå‡½æ•°éƒ¨åˆ†ï¼š"></a>è¢«è°ƒå‡½æ•°éƒ¨åˆ†ï¼š</h1><h2 id="1ã€åˆ›å»ºæ–°å †æ ˆ"><a href="#1ã€åˆ›å»ºæ–°å †æ ˆ" class="headerlink" title="1ã€åˆ›å»ºæ–°å †æ ˆ"></a>1ã€åˆ›å»ºæ–°å †æ ˆ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">00401500 | 55                         | push ebp                                |</span><br><span class="line">00401501 | 89E5                       | mov ebp,esp                             |</span><br></pre></td></tr></table></figure>

<p>å…ˆå°†åŸæ ˆåº•å…¥æ ˆï¼Œåœ¨å°†æ–°æ ˆåº•è®¾ç½®ä¸ºåŸæ ˆé¡¶ï¼Œå³ï¼š</p>


<p>è¿™ä¸ªæ—¶å€™ESPå’ŒEBPéƒ½åœ¨0x61FE78å¤„ï¼Œå†æ‰§è¡Œå‹æ ˆå‡ºæ ˆä¹Ÿä¸ä¼šå½±å“åˆ°ä¸»å‡½æ•°å †æ ˆ</p>
<h2 id="2ã€ä¸ºå‚æ•°é¢„ç•™ç©ºé—´"><a href="#2ã€ä¸ºå‚æ•°é¢„ç•™ç©ºé—´" class="headerlink" title="2ã€ä¸ºå‚æ•°é¢„ç•™ç©ºé—´"></a>2ã€ä¸ºå‚æ•°é¢„ç•™ç©ºé—´</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">00401503 | 83EC 10                    | sub esp,10                       //ç©ºå‡º0x10å­—èŠ‚çš„ç©ºé—´</span><br></pre></td></tr></table></figure>

<h2 id="3ã€å–å‡ºå½¢å‚"><a href="#3ã€å–å‡ºå½¢å‚" class="headerlink" title="3ã€å–å‡ºå½¢å‚"></a>3ã€å–å‡ºå½¢å‚</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">00401506 | 8B45 08                    | mov eax,dword ptr ss:[ebp+8]            |</span><br><span class="line">00401509 | 8945 FC                    | mov dword ptr ss:[ebp-4],eax            | </span><br><span class="line">0040150C | 8B45 0C                    | mov eax,dword ptr ss:[ebp+C]            |</span><br><span class="line">0040150F | 8945 F8                    | mov dword ptr ss:[ebp-8],eax            |</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„[EBP+8]å¤„æ˜¯mainå‡½æ•°å‹å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå³1ï¼‰ï¼Œ[EBP+C]æ˜¯mainå‡½æ•°å‹å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³2ï¼‰</p>
<img src="/posts/24481/image-20241204231114451.png" class="" title="image-20241204231114451">

<h2 id="4ã€è¿”å›å€¼"><a href="#4ã€è¿”å›å€¼" class="headerlink" title="4ã€è¿”å›å€¼"></a>4ã€è¿”å›å€¼</h2><p>åœ¨å¤§å¤šæ•°æƒ…å†µï¼Œå‡½æ•°çš„è¿”å›å€¼å¹¶ä¸æ˜¯å‹å…¥æ ˆï¼Œè€Œæ˜¯å­˜å‚¨åœ¨å¯„å­˜å™¨eaxä¹‹ä¸­</p>
<h2 id="5ã€å‡½æ•°ç»“æŸ"><a href="#5ã€å‡½æ•°ç»“æŸ" class="headerlink" title="5ã€å‡½æ•°ç»“æŸ"></a>5ã€å‡½æ•°ç»“æŸ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0040151A | C9                         | leave                                   |</span><br></pre></td></tr></table></figure>

<p>ç­‰åŒäº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mov esp,ebp</span><br><span class="line">pop ebp</span><br></pre></td></tr></table></figure>

<p>ESPå’ŒEBPéƒ½è°ƒå›äº†è·³è½¬å‰çš„ä½ç½®ã€‚ç„¶åæ¥ä¸‹æ¥è¿˜è¦è¿”å›mainå‡½æ•°é‡Œé¢ï¼Œå³ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0040151B | C3                         | ret                                     |</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œretæˆ–retnæ—¶ï¼Œç­‰åŒäºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pop rip</span><br></pre></td></tr></table></figure>

<p>å…ˆå°†ä¹‹å‰å­˜å‚¨çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å¼¹å‡ºåˆ°ripä¹‹ä¸­ï¼ŒæŒ‡ç¤º CPU ä¸‹ä¸€æ¡æŒ‡ä»¤åº”è¯¥ä»å“ªé‡Œå¼€å§‹æ‰§è¡Œï¼Œç„¶åå°±ä¼šå›åˆ°mainå‡½æ•°é‡Œé¢ï¼ˆripé‡Œçš„ä½ç½®ï¼‰</p>
<p><strong><u>ç»å†äº†ä¸Šé¢ä¸¤æ­¥ï¼ŒESPå’ŒEBPä¼šå›åˆ°è°ƒç”¨å‡½æ•°å‰çš„ä½ç½®ï¼Œè¿™å°±æ˜¯å †æ ˆå¹³è¡¡ã€‚</u></strong></p>
<h1 id="å †æ ˆå¹³è¡¡ä¸æ‰‹åŠ¨è„±å£³ï¼š"><a href="#å †æ ˆå¹³è¡¡ä¸æ‰‹åŠ¨è„±å£³ï¼š" class="headerlink" title="å †æ ˆå¹³è¡¡ä¸æ‰‹åŠ¨è„±å£³ï¼š"></a>å †æ ˆå¹³è¡¡ä¸æ‰‹åŠ¨è„±å£³ï¼š</h1><p>åŠ å£³åŸç†å…¶å®ä¸SMCè‡ªä¿®æ”¹ä»£ç æœ‰ç›¸åŒä¹‹å¤„ï¼ŒåŠ å£³å…¶å®å°±æ˜¯å¯¹å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œå‹ç¼©æˆ–åŠ å¯†ï¼Œå¹¶åœ¨ç¨‹åºé‡Œé¢åŠ å…¥è§£å‹æˆ–è§£å¯†çš„å¿…è¦ä»£ç çš„è¿‡ç¨‹ã€‚å½“ç¨‹åºè¿è¡Œèµ·æ¥æ—¶ï¼Œå£³ä¼šåŠ è½½å¹¶æ‰§è¡Œä¸€ä¸ªè§£åŒ…è¿‡ç¨‹ï¼Œæœ€ç»ˆå°†åŸå§‹ä»£ç åŠ è½½åˆ°å†…å­˜ä¸­å¹¶è·³è½¬åˆ°å…¥å£ç‚¹å¼€å§‹æ­£å¸¸æ‰§è¡Œã€‚è¿™ç±»ä¼¼äºå‡½æ•°è°ƒç”¨ï¼Œäºæ˜¯è„±å£³çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å£³è§£åŒ…å®Œæˆçš„æ—¶æœºï¼Œç„¶ådumpä¸‹æ¥ã€‚åœ¨è°ƒç”¨å£³è§£åŒ…çš„ä»£ç æ—¶ï¼Œæ»¡è¶³å‡½æ•°è°ƒç”¨çš„å †æ ˆå¹³è¡¡å®šç†ï¼ˆESPå®šç†ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå…¶ESPå’ŒEBPçš„ä½ç½®ï¼Œå½“å£³è§£åŒ…å®Œæˆæ—¶ï¼ŒESPæŒ‡é’ˆä¼šå›åˆ°æ‰§è¡Œè§£å¯†ç¨‹åºä¹‹å‰çš„å€¼ï¼Œç¨‹åºæ‰§è¡Œä¸€ä¸ªå¤§çš„è·³è½¬è·³åˆ°ç¨‹åºå…¥å£ç‚¹(EPç‚¹ï¼‰ï¼Œæ­¤æ—¶dumpä¸‹æ¥å°±å¯ä»¥å¾—åˆ°è„±å£³åçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
]]></content>
      <categories>
        <category>æ±‡ç¼–</category>
      </categories>
      <tags>
        <tag>æ±‡ç¼–</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤å‰‘å±±2024wp</title>
    <url>/posts/26315/</url>
    <content><![CDATA[<h3 id="re"><a href="#re" class="headerlink" title="re"></a>re</h3><img src="/posts/26315/image-20241223224830088.png" class="" title="image-20241223224830088">

<p>æœ‰å£³ï¼Œæ˜¾ç¤ºvmpå£³ï¼Œä¹Ÿæ— æ³•åˆ¤æ–­æ˜¯ä¸æ˜¯å…¶ä»–å£³é­”æ”¹çš„ï¼Œäºæ˜¯ç›´æ¥ä½¿ç”¨ESPå®šå¾‹æ‰‹åŠ¨è„±å£³ã€‚</p>
<img src="/posts/26315/image-20241223224948607.png" class="" title="image-20241223224948607">

<p>è¿™ä¸ªå£³ä¸å…¶ä»–çš„æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼Œä¸Šé¢è¿™æ®µæ±‡ç¼–éƒ½æ˜¯æ²¡ç”¨çš„ï¼Œå‹å…¥åç«‹é©¬åˆå¼¹å‡ºï¼Œå¹¶æ²¡ç”¨å®é™…å‹å…¥å‚æ•°ï¼Œæ‰€ä»¥æ˜¯æ··æ·†è§†å¬çš„ã€‚è¦ç­‰åˆ°ä¸‹é¢é‚£ä¸ªjmp re.c9970æ‰æ˜¯å£³çš„å¼€å§‹ã€‚æˆ‘ä»¬å•æ­¥ç›´åˆ°å®ƒè·³è½¬:</p>
<img src="/posts/26315/image-20241223225312656.png" class="" title="image-20241223225312656">

<p>æ¥ä¸‹æ¥å°±æ˜¯æ­£å¸¸çš„è„±å£³äº†ã€‚</p>
<img src="/posts/26315/image-20241223225911496.png" class="" title="image-20241223225911496">

<p>ä¿®å¤çš„æ—¶å€™æœ‰ä¸€ä¸ªåœ°æ–¹ä¿®å¤ä¸äº†ï¼Œè¿™ä¸ªåœ°æ–¹è¦æ‰‹åŠ¨ç”¨idaä¿®å¤ã€‚</p>
<img src="/posts/26315/image-20241223230212596.png" class="" title="image-20241223230212596">

<p>è¿™é‡Œå‡½æ•°æå‰ç»“æŸäº†ï¼Œçœ‹è¿™é‡Œçš„æ±‡ç¼–æŒ‡ä»¤å°±çŸ¥é“è¿™ä¸ªæ˜¯åƒåœ¾ä»£ç ï¼ŒèŠ±æŒ‡ä»¤ï¼Œå…¨éƒ¨nopæ‰è¿™ä¸‰è¡Œï¼Œå†é‡æ–°åˆ†æå³å¯</p>
<img src="/posts/26315/image-20241223230500326.png" class="" title="image-20241223230500326">

<p>åç¼–è¯‘</p>
<img src="/posts/26315/image-20250120000614004.png" class="" title="image-20250120000614004">

<p>å›¾ä¸­27-28è¿™ä¸ªå¾ªç¯æ˜¯å°†è¾“å…¥å­˜å…¥æ•°ç»„v8ä¸­ï¼Œç„¶åè°ƒç”¨sub_131150è¿›è¡Œåˆ¤æ–­ã€‚</p>
<img src="/posts/26315/image-20250120000324099.png" class="" title="image-20250120000324099">

<p>è¿™ä¸ªå‡½æ•°ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œä½†æ˜¯çœ‹ä¸å‡ºæ¥æ˜¯å“ªä¸¤ä¸ªå‚æ•°ï¼Œäºæ˜¯é‡‡ç”¨åŠ¨æ€æ³•</p>
<img src="/posts/26315/image-20250120000428243.png" class="" title="image-20250120000428243">

<p>å‘ç°a1å¯¹åº”çš„æ˜¯v8,a2å¯¹åº”çš„æ˜¯v7</p>
<img src="/posts/26315/image-20250120000804414.png" class="" title="image-20250120000804414">

<p>ç¬¬15è¡Œå°±æ˜¯å°†v7[25]çš„åœ°å€èµ‹å€¼ç»™v2ï¼Œv7æ˜¯â€œcedfz16az31zd2dycy65ac41flagâ€ï¼Œv7[25]å³æ˜¯â€fâ€ã€‚å¼€å§‹å°†v8çš„å‰å››ä¸ªå­—ç¬¦ä¸v7çš„25-28å¤„çš„å­—ç¬¦è¿›è¡Œå¯¹æ¯”ï¼Œå³å¾—åˆ°v8ï¼ˆä¹Ÿå°±æ˜¯flagï¼‰å‰4ä½æ˜¯â€flagâ€ã€‚ä¸‹é¢26-42æ˜¯å¯¹byte_135018è¿›è¡Œå˜æ¢ï¼ˆâ€™yâ€™å˜ä¸ºâ€™7â€™ï¼Œâ€™zâ€™å˜ä¸ºâ€™8â€™ï¼‰ç„¶åå°†v8[5]å¼€å§‹çš„8ä¸ªå­—ç¬¦ä¸byte_135018è¿›è¡Œå¯¹æ¯”ï¼Œè‡³æ­¤å¾—åˆ°ï¼šâ€flag{de21c847â€</p>
<img src="/posts/26315/image-20250120001457692.png" class="" title="image-20250120001457692">

<p>ä¸‹é¢çš„43-64æ˜¯å°†v8[13]åé¢çš„å­—ç¬¦ä¸v7å˜æ¢åï¼ˆyå˜7ï¼Œzå˜8ï¼‰çš„å‰24ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;de21c847cedf816a8318d2d7c765ac41&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>å›½åŸæ¯wp</title>
    <url>/posts/8147/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h2 id="Crushâ€™s-secret"><a href="#Crushâ€™s-secret" class="headerlink" title="Crushâ€™s secret"></a>Crushâ€™s secret</h2><p>æœ‰SMCï¼ŒåŠ¨è°ƒ</p>
<img src="/posts/8147/image-20241207135656066.png" class="" title="image-20241207135656066">

<p>æŠŠå®ƒçš„ä¸»è¦é€»è¾‘ç®€åŒ–ä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void encode(unsigned int *a1, int a2,unsigned int* a3)   </span><br><span class="line">&#123;</span><br><span class="line">  int v3; // eax</span><br><span class="line">  int v4; // edx</span><br><span class="line">  int v5; // edx</span><br><span class="line">  int v7; // [esp+D4h] [ebp-44h]</span><br><span class="line">  int v8; // [esp+E0h] [ebp-38h]</span><br><span class="line">  unsigned int i; // [esp+ECh] [ebp-2Ch]</span><br><span class="line">  unsigned int v10; // [esp+F8h] [ebp-20h]</span><br><span class="line">  unsigned int v11; // [esp+104h] [ebp-14h]</span><br><span class="line"></span><br><span class="line">    v8 = 32;</span><br><span class="line">    v10 = 0;</span><br><span class="line">    do   //32æ¬¡å¾ªç¯</span><br><span class="line">    &#123;</span><br><span class="line">      v10 -= 0x61C88647;</span><br><span class="line">      v7 = (v10 &gt;&gt; 2) &amp; 3;</span><br><span class="line">      a1[0] += (((a1[1] ^ a3[v7 ^ 0 &amp; 3]) + (a1[1] ^ v10)) ^ (((16 * a1[1]) ^ (a1[1] &gt;&gt; 3))+ ((4 *a1[1]) ^ (a1[1] &gt;&gt; 5))));</span><br><span class="line">      a1[1] += (((a1[0] ^ a3[v7 ^ 1 &amp; 3]) + (a1[0] ^ v10)) ^ (((16 * a1[0]) ^ (a1[0] &gt;&gt; 3))+ ((4 *a1[0]) ^ (a1[0] &gt;&gt; 5))));</span><br><span class="line">      --v8;</span><br><span class="line">    &#125;</span><br><span class="line">    while ( v8 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å¯†æ–‡</p>
<img src="/posts/8147/image-20241207135840979.png" class="" title="image-20241207135840979">

<p>è¿™æ˜¯å¯†é’¥ï¼š</p>
<img src="/posts/8147/image-20241207140402515.png" class="" title="image-20241207140402515">

<p>å†™è„šæœ¬è§£å¯†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">void decode(unsigned int *a1, int a2,unsigned int* a3)   //a1=data,a3=key</span><br><span class="line">&#123;</span><br><span class="line">  int v3; // eax</span><br><span class="line">  int v4; // edx</span><br><span class="line">  int v5; // edx</span><br><span class="line">  int v7; // [esp+D4h] [ebp-44h]</span><br><span class="line">  int v8; // [esp+E0h] [ebp-38h]</span><br><span class="line">  unsigned int i; // [esp+ECh] [ebp-2Ch]</span><br><span class="line">  unsigned int v10; // [esp+F8h] [ebp-20h]</span><br><span class="line">  unsigned int v11; // [esp+104h] [ebp-14h]</span><br><span class="line"></span><br><span class="line">    v8 = 32;</span><br><span class="line">    v10 = 0;</span><br><span class="line">    do   //32æ¬¡å¾ªç¯</span><br><span class="line">    &#123;</span><br><span class="line">      v10 -= 0x61C88647;</span><br><span class="line">      v7 = (v10 &gt;&gt; 2) &amp; 3;</span><br><span class="line">      a1[0] += (((a1[1] ^ a3[v7 ^ 0 &amp; 3]) + (a1[1] ^ v10)) ^ (((16 * a1[1]) ^ (a1[1] &gt;&gt; 3))+ ((4 *a1[1]) ^ (a1[1] &gt;&gt; 5))));</span><br><span class="line">      a1[1] += (((a1[0] ^ a3[v7 ^ 1 &amp; 3]) + (a1[0] ^ v10)) ^ (((16 * a1[0]) ^ (a1[0] &gt;&gt; 3))+ ((4 *a1[0]) ^ (a1[0] &gt;&gt; 5))));</span><br><span class="line">      --v8;</span><br><span class="line">    &#125;</span><br><span class="line">    while ( v8 );</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    unsigned int data[]=&#123;0xf31419a2,0x2f193025,0x6e995655,0x75d355fe,0x42e6b4e8,0xf97e03e,0x9f4676d0,0x2488d889,0x8e5cf3d7,0x18c58297,0x2652c22c,0x912ccd2b&#125;;</span><br><span class="line">    unsigned int key[]=&#123;0x5201314,0x52013140,0x5201314,0x52013140&#125;;</span><br><span class="line">    int i;</span><br><span class="line">    for(i=0;i&lt;6;i++)&#123;</span><br><span class="line">        decode(&amp;data[i*2],2,key);</span><br><span class="line">    &#125;</span><br><span class="line">    for(i=0;i&lt;12;i++)&#123;</span><br><span class="line">        printf(&quot;%#x,&quot;,data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  //D0g3xGC&#123;The_wind_stops_at_autumn_water_and_I_stop_at_you&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/8147/image-20241207140839246.png" class="" title="image-20241207140839246">

<h2 id="round"><a href="#round" class="headerlink" title="round"></a>round</h2><p>å®‰å“é¢˜ï¼Œå‰é¢åŠæ®µæ˜¯é­”æ”¹çš„base64åŠ å¯†ï¼Œè§£å¯†å‡ºæ¥çš„ç»“æœæ˜¯round_and</p>
<p>åé¢åŠæ®µåªèƒ½ç”¨çˆ†ç ´æ³•æ¥è§£ã€‚ä½†æ˜¯å®ƒå‰ä¸€ä¸ªå­—ç¬¦åŠ å¯†çš„ç»“æœä¼šå½±å“åˆ°ä¸‹ä¸€ä¸ªåŠ å¯†ï¼Œæ‰€ä»¥å¿…é¡»é‡‡ç”¨é€ä¸ªç ´è§£æ³•ã€‚</p>
<p>æœ¬æ¥ä¸€å¼€å§‹æƒ³å„ç§æ–¹æ³•å‡ºäº†å‰å‡ ä¸ªå­—ç¬¦â€_rounDâ€œï¼Œä½†æ˜¯åé¢çš„å¯èƒ½æ€§å¤ªå¤šäº†ï¼Œæ²¡åŠæ³•ä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œäºæ˜¯æƒ³ç”¨12ä¸ªå¾ªç¯æ¥æš´åŠ›ç ´è§£ï¼ˆï¼‰ã€‚</p>
<p>12ä¸ªå­—ç¬¦ï¼Œæ¯ä¸ªå­—ç¬¦æœ‰127ç§å¯èƒ½ï¼Œå°±æ˜¯127çš„12æ¬¡æ–¹ï¼Œä¸Šäº¿ç§å¯èƒ½äº†ï¼Œå†åŠ ä¸Šæ¯ä¸€ç§æƒ…å†µéƒ½è¦è°ƒç”¨roundå‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼Œç»“æœå¾ˆæ˜æ˜¾ï¼Œä»£ç å†™å‡ºæ¥äº†ä½†æ˜¯è¿è¡Œä¸å‡ºç»“æœã€‚åœ¨å°è¯•å¾ˆå¤šæ–¹æ³•åæ— åŠŸè€Œåã€‚</p>
<p>æœ€åï¼Œåœ¨çœ‹äº†å…¶ä»–å¸ˆå‚…wpåæ‰ææ¸…æ¥šæ€ä¹ˆå†™çˆ†ç ´è„šæœ¬ã€‚</p>
<p>è¿™æ˜¯å…¶ä»–å¸ˆå‚…çš„è„šæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def makebox(s):                             # æ„å»ºæ•°ç»„ç›’</span><br><span class="line">    iArr = [1023 - i for i in range(1024)]</span><br><span class="line">    for i in range(1024):</span><br><span class="line">        iArr[i] = iArr[i] ^ ord(s[i % 12])</span><br><span class="line">    return iArr</span><br><span class="line"></span><br><span class="line">box = makebox(&quot;c9m1bRmfY5Wk&quot;)</span><br><span class="line"></span><br><span class="line">def round(iArr, str):                   # åŠ å¯†å‡½æ•°</span><br><span class="line">    length = len(str)</span><br><span class="line">    iArr2 = [0 for _ in range(length)]</span><br><span class="line">    iArr3 = [352, 646, 752, 882, 65, 0, 122, 0, 0, 7, 350, 360]</span><br><span class="line">    i = 33</span><br><span class="line">    for i2 in range(0, length):</span><br><span class="line">        charAt = ord(str[i2])</span><br><span class="line">        for _ in range(0, 32):</span><br><span class="line">            i4 = (iArr[i] ^ charAt) % 5</span><br><span class="line">            if i4 == 0:</span><br><span class="line">                charAt = (charAt + iArr[i]) % 1024</span><br><span class="line">                i = (i + charAt) % 1024</span><br><span class="line">            elif i4 == 1:</span><br><span class="line">                charAt = ((charAt - iArr[i]) % 1024 + 1024) % 1024  # ç¡®ä¿ç»“æœéè´Ÿ</span><br><span class="line">                i = (i + charAt) % 1024</span><br><span class="line">            elif i4 == 2:</span><br><span class="line">                charAt = (charAt ^ iArr[i]) % 1024</span><br><span class="line">                i = (i + charAt) % 1024</span><br><span class="line">            elif i4 == 3:</span><br><span class="line">                charAt = (charAt &gt;&gt; 3) % 1024</span><br><span class="line">                i = (i + charAt) % 1024</span><br><span class="line">            elif i4 == 4:</span><br><span class="line">                charAt = (charAt &lt;&lt; 3) % 1024</span><br><span class="line">                i = (i + charAt) % 1024</span><br><span class="line">        iArr2[i2] = charAt</span><br><span class="line">    return iArr2</span><br><span class="line"></span><br><span class="line">import string</span><br><span class="line">dic = string.ascii_letters + &#x27;_&#x27;            # åˆ›å»ºä¸€ä¸ªç”±å¤§å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ç»„æˆçš„å­—å…¸ï¼Œå­—ç¬¦ä¸²å…ƒç´ ç”±è¿™é‡Œå–</span><br><span class="line"></span><br><span class="line">iArr3 = [352, 646, 752, 882, 65, 0, 122, 0, 0, 7, 350, 360]</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ç¼“å­˜æ¥å­˜å‚¨ä¸­é—´ç»“æœ</span><br><span class="line">cache = &#123;&#125;      # å­—å…¸ï¼Œç”¨æ¥æ’é™¤å·²ç»å°è¯•è¿‡çš„å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">def dfs(idx, ans):          # å…³é”®é€’å½’å‡½æ•°</span><br><span class="line">    if idx == len(iArr3):       # é•¿åº¦è¾¾åˆ°æŒ‡å®šå€¼åˆ™ä»£è¡¨æ‰¾åˆ°äº†ç¬¦åˆæ¡ä»¶çš„</span><br><span class="line">        print(ans)  # æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²</span><br><span class="line">        return True</span><br><span class="line">    for i in dic:         #åœ¨å­—ç¬¦æ•°ç»„é‡Œé¢æ‰¾å­—ç¬¦</span><br><span class="line">        new_ans = ans + i      # è¿™é‡Œä¸€å®šè¦ç”¨ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²æ¥æ‰¿æ¥ï¼Œå› ä¸ºåé¢çš„æ­¥éª¤å¯èƒ½ä¼šæ”¹å˜å­—ç¬¦ä¸²</span><br><span class="line">        if new_ans not in cache:     # åˆ¤æ–­æ˜¯å¦æ˜¯å°è¯•è¿‡çš„å­—ç¬¦ä¸²</span><br><span class="line">            cache[new_ans] = round(box, new_ans)    # æ²¡å°è¯•è¿‡åˆ™åŠ å…¥å­—å…¸</span><br><span class="line">        res = cache[new_ans]        # å–å‡ºç»è¿‡åŠ å¯†åçš„å­—ç¬¦ä¸²</span><br><span class="line">        if res[-1] == iArr3[idx]:       # å¦‚æœç›¸åŒåˆ™ç»§ç»­åˆ¤æ–­ä¸‹ä¸€ä½</span><br><span class="line">            if dfs(idx + 1, new_ans):</span><br><span class="line">                return True</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line">if not dfs(0, &#x27;&#x27;):</span><br><span class="line">    print(&quot;No solution found&quot;)</span><br></pre></td></tr></table></figure>

<p>ä»–æ˜¯åˆ©ç”¨äº†è™½ç„¶å‰ä¸€ä¸ªå­—ç¬¦ä¼šå½±å“åä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯åä¸€ä¸ªå­—ç¬¦ä¸ä¼šå½±å“å‰ä¸€ä¸ªå­—ç¬¦è¿™ä¸€ç‰¹ç‚¹ï¼ˆå› ä¸ºåœ¨å¯¹æ¯ä¸ªå­—ç¬¦è¿›è¡ŒåŠ å¯†æ—¶ï¼Œiçš„å€¼ä¼šä¸æ–­å˜åŒ–ï¼‰ï¼Œè¿™é‡Œä½¿ç”¨äº†DFSç®—æ³•ï¼Œé€’å½’è°ƒç”¨ï¼Œæ¯”æˆ‘ä¹‹å‰12ä¸ªå¾ªç¯å¥½åœ¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1ã€ä»£ç ç®€çŸ­ï¼Œæ˜“ç†è§£</span><br><span class="line">2ã€è¿›è¡Œäº†å‰ªæï¼Œæå‰æ’é™¤ä¸å¯èƒ½æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯ä»–çš„è¿™æ®µä»£ç å¯ä»¥åœ¨å‡ ç§’å†…å¿«é€Ÿè¿è¡Œå‡ºä¸€ä¸ªç»“æœâ€œ_rounD_we_goâ€ã€‚</p>
<p>åœ¨ç†è§£äº†è¿™ä½å¸ˆå‚…è„šæœ¬çš„ä¸»è¦é€»è¾‘åï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªè„šæœ¬ï¼Œä¸»è¦æ–¹æ³•è¿˜æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ç¨å¾®ä¿®æ”¹ï¼Œè®©ä»–æŠŠæ‰€æœ‰ç»“æœéƒ½è¿è¡Œå‡ºæ¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">int data[]=&#123;352, 646, 752, 882, 65, 0, 122, 0, 0, 7, 350, 360&#125;;</span><br><span class="line">int arr[1024];char flag[13]=&quot;&quot;;</span><br><span class="line">void makebox(char *s)&#123;</span><br><span class="line">    int  i;</span><br><span class="line">    for(i=0;i&lt;1024;i++)&#123;</span><br><span class="line">      arr[i]=1023-i;</span><br><span class="line">      arr[i]^=s[i%12];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">char *Round(int *result,char *s,int len)&#123;</span><br><span class="line">    int a=33;</span><br><span class="line">    int i2,i3,i4,num2,j;</span><br><span class="line">    int at;int i;int num,rip;</span><br><span class="line">    for(i=0;i&lt;len;i++)&#123;</span><br><span class="line">        at=s[i];</span><br><span class="line">        for(i3=0;i3&lt;32;i3++)&#123;</span><br><span class="line">            i4=((arr[a]^at)%5+5)%5;</span><br><span class="line">            if(i4==0) &#123;num=(at+arr[a])%1024;rip=(a+num)%1024;&#125;</span><br><span class="line">            if(i4==1) &#123;num=((at-arr[a])%1024+1024)%1024;rip=(a+num)%1024;&#125;</span><br><span class="line">            if(i4==2) &#123;num=((at^arr[a])%1024+1024)%1024;rip=(a+num)%1024;&#125;</span><br><span class="line">            if(i4==3) &#123;num=(at&gt;&gt;3)%1024;rip=(a+num)%1024;&#125;</span><br><span class="line">            if(i4==4) &#123;num=(at&lt;&lt;3)%1024;rip=(a+num)%1024;&#125;</span><br><span class="line">            at=num;a=rip;</span><br><span class="line">        &#125;</span><br><span class="line">        result[i]=at;</span><br><span class="line">    &#125;</span><br><span class="line">    return s;</span><br><span class="line">&#125;</span><br><span class="line">void DSF(int len)&#123;</span><br><span class="line">    if(len==12)&#123;printf(&quot;%s\n&quot;,flag);return;&#125;</span><br><span class="line">    int i;char temp[13];</span><br><span class="line">    int result[13];</span><br><span class="line">    for(i=33;i&lt;127;i++)&#123;</span><br><span class="line">        strcpy(temp,flag);</span><br><span class="line">        temp[len]=(char)i;</span><br><span class="line">        Round(result,temp,len+1);</span><br><span class="line">        if(result[len]==data[len]) &#123;flag[len]=(char)i;DSF(len+1);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    char s[]=&quot;c9m1bRmfY5Wk&quot;;</span><br><span class="line">    makebox(s);</span><br><span class="line">    DSF(0);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè„šæœ¬ä¼šæŠŠæ‰€æœ‰æ»¡è¶³ç»“æœçš„å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">_roun2t$e_%o</span><br><span class="line">_roun2t$e_`o</span><br><span class="line">_roun2t$e_go</span><br><span class="line">_roun7t$e_%o</span><br><span class="line">_roun7t$e_`o</span><br><span class="line">_roun7t$e_go</span><br><span class="line">_roun&lt;&#x27;-n4TO</span><br><span class="line">_rounD_EJ4TO</span><br><span class="line">_rounD_PCi?O</span><br><span class="line">_rounD_\Ci?O</span><br><span class="line">_rounD_we_%o</span><br><span class="line">_rounD_we_`o</span><br><span class="line">_rounD_we_go</span><br></pre></td></tr></table></figure>

<p>åœ¨é‡Œé¢æŒ‘ä¸€ä¸ªæœ€æ­£å¸¸çš„â€œ_rounD_we_goâ€ä¸å‰åŠæ®µç»„æˆflagï¼šD0g3xGC{round_and_rounD_we_go}</p>
]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¼å…¥è¡¨æ³¨å…¥</title>
    <url>/posts/44489/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="DLLMainï¼š"><a href="#DLLMainï¼š" class="headerlink" title="DLLMainï¼š"></a>DLLMainï¼š</h1><p>DllMainæ˜¯.dllæ–‡ä»¶çš„å…¥å£å‡½æ•°ï¼Œå½“ç³»ç»ŸåŠ è½½æˆ–å¸è½½ DLL æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒã€‚å®ƒçš„å‚æ•°ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BOOL WINAPI DllMain(</span><br><span class="line">    _In_ HINSTANCE hinstDLL,   // DLL æ¨¡å—å¥æŸ„</span><br><span class="line">    _In_ DWORD     fdwReason,  // è°ƒç”¨åŸå› æ ‡å¿—</span><br><span class="line">    _In_ LPVOID    lpvReserved // ä¿ç•™å‚æ•°ï¼ˆé€šå¸¸ä¸ºNULLï¼‰</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­fdwReasonè°ƒç”¨åŸå› ï¼š</p>
<table>
<thead>
<tr>
<th align="left"><strong>æ ‡å¿—å€¼</strong></th>
<th align="left"><strong>è§¦å‘æ—¶æœº</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>DLL_PROCESS_ATTACH</strong></td>
<td align="left">DLL é¦–æ¬¡è¢«è¿›ç¨‹åŠ è½½æ—¶</td>
</tr>
<tr>
<td align="left"><strong>DLL_PROCESS_DETACH</strong></td>
<td align="left">DLL ä»è¿›ç¨‹å¸è½½æ—¶</td>
</tr>
<tr>
<td align="left">DLL_THREAD_ATTACH</td>
<td align="left">æ–°çº¿ç¨‹åœ¨è¿›ç¨‹ä¸­åˆ›å»ºæ—¶</td>
</tr>
<tr>
<td align="left">DLL_THREAD_DETACH</td>
<td align="left">çº¿ç¨‹æ­£å¸¸é€€å‡ºæ—¶</td>
</tr>
</tbody></table>
<p>äºæ˜¯ï¼Œå¯ä»¥ç”¨ç±»ä¼¼è¿™æ ·çš„ä»£ç æ¥è®©dllåŠ è½½å’Œå¸è½½æ—¶è¿è¡Œæˆ‘ä»¬çš„å‡½æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &quot;pch.h&quot;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY DllMain(</span><br><span class="line">    HMODULE hModule, </span><br><span class="line">    DWORD  ul_reason_for_call,</span><br><span class="line">    LPVOID lpReserved</span><br><span class="line">) &#123;</span><br><span class="line">    switch (ul_reason_for_call) &#123;</span><br><span class="line">        case DLL_PROCESS_ATTACH:</span><br><span class="line">            // åŠ è½½æ—¶è°ƒç”¨MessageBoxå‡½æ•°</span><br><span class="line">            MessageBox(NULL, L&quot;DLL å·²åŠ è½½!&quot;, L&quot;æç¤º&quot;, MB_OK);</span><br><span class="line">            break;</span><br><span class="line">        case DLL_PROCESS_DETACH:</span><br><span class="line">            // å¸è½½æ—¶è°ƒç”¨MessageBoxå‡½æ•°</span><br><span class="line">            MessageBox(NULL, L&quot;DLL å³å°†å¸è½½!&quot;, L&quot;æç¤º&quot;, MB_OK);</span><br><span class="line">            break;</span><br><span class="line">        case DLL_THREAD_ATTACH:</span><br><span class="line">            break;</span><br><span class="line">        case DLL_THREAD_DETACH:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    return TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å¯¼å…¥è¡¨æ³¨å…¥æ­¥éª¤ï¼š"><a href="#å¯¼å…¥è¡¨æ³¨å…¥æ­¥éª¤ï¼š" class="headerlink" title="å¯¼å…¥è¡¨æ³¨å…¥æ­¥éª¤ï¼š"></a>å¯¼å…¥è¡¨æ³¨å…¥æ­¥éª¤ï¼š</h1><h2 id="dllæ–‡ä»¶ï¼š"><a href="#dllæ–‡ä»¶ï¼š" class="headerlink" title="dllæ–‡ä»¶ï¼š"></a>dllæ–‡ä»¶ï¼š</h2><p>åœ¨DLLMainé‡Œé¢åŠ å…¥è¦å®ç°çš„å‡½æ•°å’Œä¸€ä¸ªå¯¼å‡ºå‡½æ•°ï¼ˆè¿™ä¸ªä¸€å®šè¦æœ‰ï¼Œä¸ç„¶exeåœ¨åŠ è½½é˜¶æ®µä¼šç›´æ¥æŠ¥é”™ï¼‰ï¼Œç”Ÿæˆdllï¼ŒæŠŠdllä¸å¾…æ³¨å…¥æ–‡ä»¶æ”¾åŒä¸€ä¸ªç›®å½•</p>
<p>.hï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">#endif</span><br><span class="line">	_declspec(dllexport) int __stdcall add(int a, int b);</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>

<p>.cï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &quot;pch.h&quot;</span><br><span class="line">#include &quot;dllmain.h&quot;</span><br><span class="line"></span><br><span class="line">int __stdcall add(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line">BOOL APIENTRY DllMain(</span><br><span class="line">    HMODULE hModule, </span><br><span class="line">    DWORD  ul_reason_for_call,</span><br><span class="line">    LPVOID lpReserved</span><br><span class="line">) &#123;</span><br><span class="line">    switch (ul_reason_for_call) &#123;</span><br><span class="line">        case DLL_PROCESS_ATTACH:</span><br><span class="line">            // åŠ è½½æ—¶è°ƒç”¨MessageBoxå‡½æ•°</span><br><span class="line">            MessageBox(NULL, L&quot;DLL å·²åŠ è½½!&quot;, L&quot;æç¤º&quot;, MB_OK);</span><br><span class="line">            break;</span><br><span class="line">        case DLL_PROCESS_DETACH:</span><br><span class="line">            // å¸è½½æ—¶è°ƒç”¨MessageBoxå‡½æ•°</span><br><span class="line">            MessageBox(NULL, L&quot;DLL å³å°†å¸è½½!&quot;, L&quot;æç¤º&quot;, MB_OK);</span><br><span class="line">            break;</span><br><span class="line">        case DLL_THREAD_ATTACH:</span><br><span class="line">            break;</span><br><span class="line">        case DLL_THREAD_DETACH:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    return TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨å…¥ç¨‹åºï¼š"><a href="#æ³¨å…¥ç¨‹åºï¼š" class="headerlink" title="æ³¨å…¥ç¨‹åºï¼š"></a>æ³¨å…¥ç¨‹åºï¼š</h2><p>æ³¨å…¥ç¨‹åºçš„ä¸»è¦é€»è¾‘æ˜¯:</p>
<ul>
<li>å…ˆåˆ›å»ºä¸€ä¸ªæ–°èŠ‚ï¼ˆæ³¨æ„å¯å†™ï¼‰</li>
<li>å°†æ‰€æœ‰å¯¼å…¥è¡¨ç§»åŠ¨åˆ°æ–°èŠ‚ä¸­</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¼å…¥è¡¨ç»“æ„</li>
<li>åˆ›å»ºå¯¼å…¥è¡¨ç»“æ„ä¸­çš„INTå’ŒIATï¼ˆå¯ä»¥å…±äº«åŒä¸€å¼ è¡¨ï¼‰</li>
<li>ä¿®æ­£å¯¼å…¥è¡¨</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">DWORD FOA_to_RVA(DWORD foa)&#123;</span><br><span class="line">    DWORD rva=0;</span><br><span class="line">    if(foa&lt;oheader-&gt;SizeOfHeaders) &#123;</span><br><span class="line">        rva = foa;</span><br><span class="line">        return rva;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;fheader-&gt;NumberOfSections;i++)&#123;</span><br><span class="line">        if(foa&gt;=sheader[i].PointerToRawData&amp;&amp;foa&lt;(sheader[i].PointerToRawData+sheader[i].SizeOfRawData))</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=foa-sheader[i].PointerToRawData;</span><br><span class="line">    rva = sheader[i].VirtualAddress + offset;</span><br><span class="line">    return rva;</span><br><span class="line">&#125;</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">    DWORD foa=0;</span><br><span class="line">    if(rva&lt;oheader-&gt;SizeOfHeaders) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;fheader-&gt;NumberOfSections;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i == fheader-&gt;NumberOfSections) &#123;printf(&quot;æ²¡æœ‰å¯¹åº”çš„FOA\n&quot;);return 0;&#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">    return foa;</span><br><span class="line">&#125;</span><br><span class="line">int new_section(int new_size)&#123;  // åˆ›å»ºæ–°èŠ‚ï¼Œå‚æ•°ï¼šæ–°èŠ‚å¤§å°ï¼Œè¿”å›å€¼ï¼šæ˜¯å¦æˆåŠŸåˆ›å»º</span><br><span class="line">    // åˆ¤æ–­æ˜¯å¦èƒ½åŠ èŠ‚è¡¨:</span><br><span class="line">    if(oheader-&gt;SizeOfHeaders-(dos-&gt;e_lfanew+4+sizeof(IMAGE_FILE_HEADER)+fheader-&gt;SizeOfOptionalHeader+fheader-&gt;NumberOfSections*sizeof(IMAGE_SECTION_HEADER))&lt;=80)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;ç©ºé—´ä¸è¶³ä»¥åˆ›å»ºèŠ‚è¡¨\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int index = fheader-&gt;NumberOfSections;</span><br><span class="line">    strcpy(sheader[index].Name,&quot;new&quot;);</span><br><span class="line">    sheader[index].Misc.VirtualSize = new_size;</span><br><span class="line">    sheader[index].VirtualAddress = sheader[index-1].VirtualAddress + ((sheader[index-1].Misc.VirtualSize)/oheader-&gt;SectionAlignment+1)*oheader-&gt;SectionAlignment;</span><br><span class="line">    sheader[index].PointerToRawData = sheader[index-1].PointerToRawData + sheader[index-1].SizeOfRawData;</span><br><span class="line">    sheader[index].SizeOfRawData = new_size;</span><br><span class="line">    sheader[index].Characteristics = 0xE00000A0;  // å¯è¯»å¯å†™å¯æ‰§è¡Œ</span><br><span class="line">    sheader[index].PointerToRelocations = sheader[index-1].PointerToRelocations;</span><br><span class="line">    sheader[index].PointerToLinenumbers = sheader[index-1].PointerToLinenumbers;</span><br><span class="line">    sheader[index].NumberOfRelocations = sheader[index-1].NumberOfRelocations;</span><br><span class="line">    sheader[index].NumberOfLinenumbers = sheader[index-1].NumberOfLinenumbers;</span><br><span class="line">    fheader-&gt;NumberOfSections++;</span><br><span class="line">    oheader-&gt;SizeOfImage+=oheader-&gt;SectionAlignment;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br><span class="line">DWORD move_import(DWORD offset,unsigned char *file_buf)&#123;  // ç§»åŠ¨å¯¼å…¥è¡¨ã€‚å‚æ•°1ï¼šåç§»FOAï¼›å‚æ•°2ï¼šæ–‡ä»¶æŒ‡é’ˆ</span><br><span class="line">    IMAGE_IMPORT_DESCRIPTOR* import = (IMAGE_IMPORT_DESCRIPTOR*)(file_buf+RVA_to_FOA(oheader-&gt;DataDirectory[1].VirtualAddress));</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;;i++)&#123;  // åˆ¤æ–­æœ‰å¤šå°‘ä¸ªå¯¼å…¥è¡¨</span><br><span class="line">        if(import[i].FirstThunk==0&amp;&amp;import[i].OriginalFirstThunk==0)&#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    memcpy(file_buf+offset,file_buf+RVA_to_FOA(oheader-&gt;DataDirectory[1].VirtualAddress),i*sizeof(IMAGE_IMPORT_DESCRIPTOR));</span><br><span class="line">    oheader-&gt;DataDirectory[1].VirtualAddress = FOA_to_RVA(offset);</span><br><span class="line">    offset +=i*sizeof(IMAGE_IMPORT_DESCRIPTOR);</span><br><span class="line">    return offset;</span><br><span class="line">&#125;</span><br><span class="line">DWORD add_import(DWORD offset,unsigned char *file_buf,char *s)&#123;  // å¢åŠ å¯¼å…¥è¡¨ã€‚å‚æ•°1ï¼šåç§»FOAï¼›å‚æ•°2ï¼šæ–‡ä»¶æŒ‡é’ˆï¼›å‚æ•°3ï¼šdllåå­—</span><br><span class="line">    IMAGE_IMPORT_DESCRIPTOR* new_import = (IMAGE_IMPORT_DESCRIPTOR*)(file_buf+offset);</span><br><span class="line">    offset += 2*sizeof(IMAGE_IMPORT_DESCRIPTOR); // è¿˜è¦ç•™ä¸€ä¸ªç©ºè¡¨ä½œç»“å°¾ï¼Œæ•…ä¹˜2</span><br><span class="line">    IMAGE_THUNK_DATA32 *INT,*IAT;  // è¿™é‡ŒæŒ‡çš„æ˜¯FOA</span><br><span class="line">    new_import-&gt;OriginalFirstThunk = FOA_to_RVA(offset);</span><br><span class="line">    INT = (IMAGE_THUNK_DATA32*)(file_buf+offset);</span><br><span class="line">    INT-&gt;u1.Ordinal = 0x80000001; // è®¾ç½®ä¸ºåºå·å¯¼å…¥ï¼Œåºå·ä¸º1</span><br><span class="line">    INT[1].u1.Ordinal = 0x0;  // ç•™ä¸€ä¸ªç©ºç»“æ„ä¸ºç»“å°¾</span><br><span class="line">    offset += 8;</span><br><span class="line">    new_import-&gt;FirstThunk = FOA_to_RVA(offset);</span><br><span class="line">    IAT = (IMAGE_THUNK_DATA32*)(file_buf+offset);</span><br><span class="line">    IAT-&gt;u1.Ordinal = 0x80000001;</span><br><span class="line">    IAT[1].u1.Ordinal = 0x0;</span><br><span class="line">    offset += 8;</span><br><span class="line">    strcpy((char *)(file_buf+offset),s); // å¤åˆ¶åå­—</span><br><span class="line">    new_import-&gt;Name = FOA_to_RVA(offset);</span><br><span class="line">    offset += strlen(s)+1;</span><br><span class="line">    return offset;</span><br><span class="line">&#125;</span><br><span class="line">DWORD add_import_name(DWORD offset,unsigned char *file_buf,char *s)&#123;  // å¢åŠ å¯¼å…¥è¡¨ã€‚å‚æ•°1ï¼šåç§»FOAï¼›å‚æ•°2ï¼šæ–‡ä»¶æŒ‡é’ˆï¼›å‚æ•°3ï¼šdllåå­—</span><br><span class="line">    IMAGE_IMPORT_DESCRIPTOR* new_import = (IMAGE_IMPORT_DESCRIPTOR*)(file_buf+offset);</span><br><span class="line">    offset += 2*sizeof(IMAGE_IMPORT_DESCRIPTOR); // è¿˜è¦ç•™ä¸€ä¸ªç©ºè¡¨ä½œç»“å°¾ï¼Œæ•…ä¹˜2</span><br><span class="line">    IMAGE_THUNK_DATA32 *INT;  // è¿™é‡ŒæŒ‡çš„æ˜¯FOA</span><br><span class="line">    new_import-&gt;OriginalFirstThunk = FOA_to_RVA(offset);</span><br><span class="line">    new_import-&gt;FirstThunk = FOA_to_RVA(offset);</span><br><span class="line">    INT = (IMAGE_THUNK_DATA32*)(file_buf+offset);</span><br><span class="line">    offset+=8;  // ä¸€ä¸ªINTè¡¨åŠ ä¸€ä¸ªç©ºè¡¨å…±8å­—èŠ‚</span><br><span class="line">    INT-&gt;u1.AddressOfData = FOA_to_RVA(offset);</span><br><span class="line">    IMAGE_IMPORT_BY_NAME* by_name=(IMAGE_IMPORT_BY_NAME*)(file_buf+offset);</span><br><span class="line">    by_name-&gt;Hint = 1;</span><br><span class="line">    offset+=2;</span><br><span class="line">    char *fun=&quot;add&quot;;  // å‡½æ•°å</span><br><span class="line">    strcpy((char *)(file_buf+offset),fun);</span><br><span class="line">    offset+=strlen(fun)+1;</span><br><span class="line">    strcpy((char *)(file_buf+offset),s); // å¤åˆ¶åå­—</span><br><span class="line">    new_import-&gt;Name = FOA_to_RVA(offset);</span><br><span class="line">    offset += strlen(s)+1;</span><br><span class="line">    return offset;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int new_size = 0x1000;  // å®šä¹‰æ–°èŠ‚å¤§å°</span><br><span class="line">    const char* pe_path = &quot;testdll.exe&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    int fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize+new_size);   // å¤šåˆ†é…0x1000ç”¨ä½œæ–°èŠ‚</span><br><span class="line">    memset(file_buf, 0, fsize+new_size);</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *buffer=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)buffer;</span><br><span class="line">    if(dos-&gt;e_magic!=0x5A4D) &#123;printf(&quot;ä¸æ˜¯PEæ–‡ä»¶!!\n&quot;);free(file_buf);;return 0;&#125;</span><br><span class="line">    buffer+=dos-&gt;e_lfanew;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    if(*(DWORD*)buffer!=0x4550) &#123;printf(&quot;ä¸æ˜¯PEæ–‡ä»¶!!\n&quot;);free(file_buf);;return 0;&#125;</span><br><span class="line">    buffer+=4;</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)buffer;</span><br><span class="line">    buffer+=sizeof(IMAGE_FILE_HEADER);      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)buffer;</span><br><span class="line">    buffer += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)buffer;</span><br><span class="line">    if(!new_section(new_size))&#123;free(file_buf);return 0;&#125;</span><br><span class="line">    DWORD offset=sheader[fheader-&gt;NumberOfSections-1].PointerToRawData;</span><br><span class="line">    offset=move_import(offset,file_buf);</span><br><span class="line">    char *s=&quot;dllmain.dll&quot;;</span><br><span class="line">    offset = add_import(offset,file_buf,s);</span><br><span class="line">    // å†™å…¥æ–°æ–‡ä»¶</span><br><span class="line">    FILE *new_file = fopen(&quot;new.exe&quot;,&quot;wb&quot;);</span><br><span class="line">    if (!new_file) &#123;</span><br><span class="line">        perror(&quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥&quot;);</span><br><span class="line">        free(file_buf);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    int written=fwrite(file_buf,sizeof(unsigned char),fsize+new_size,new_file);</span><br><span class="line">    if(written!=fsize+new_size)&#123;</span><br><span class="line">        perror(&quot;å†™å…¥é”™è¯¯&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(new_file);</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ³¨å…¥åç›®æ ‡ç¨‹åºåœ¨è¿è¡Œæ—¶å°±ä¼šå¼¹å‡ºï¼š</p>
<img src="/posts/undefined/image-20250712190125481.png" class="" title="image-20250712190125481">

<p>åœ¨è¿è¡Œå®Œæˆåå°±ä¼šå¼¹å‡º</p>
<img src="/posts/undefined/image-20250712190454257.png" class="" title="image-20250712190454257">
]]></content>
      <tags>
        <tag>PE</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¼å…¥è¡¨</title>
    <url>/posts/23232/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="å¯¼å…¥è¡¨"><a href="#å¯¼å…¥è¡¨" class="headerlink" title="å¯¼å…¥è¡¨"></a>å¯¼å…¥è¡¨</h1><p>PEæ–‡ä»¶éœ€è¦ç”¨åˆ°å…¶ä»–åº“é‡Œé¢çš„å‡½æ•°æ—¶ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå¯¼å…¥è¡¨æ¥è®°å½•è¿™äº›å¯¼å…¥å‡½æ•°çš„åœ°å€ã€‚å¯¼å…¥è¡¨ä¸å¯¼å‡ºè¡¨çš„å…³ç³»å¯ä»¥ç†è§£ä¸ºï¼šä½ æ˜¯ä¸€ä¸ªexeæ–‡ä»¶ï¼Œä½ éœ€è¦å»ä¸€å®¶é¤é¦†åƒé¥­ï¼Œè€Œdllæ˜¯è¿™å®¶åº—çš„è€æ¿ï¼Œä»–ç»™ä½ æä¾›äº†ä»–ä»¬åº—çš„èœå•ï¼Œè¿™ä¸ªæ˜¯ä»–çš„å¯¼å‡ºè¡¨ï¼›ä½ å°†ä½ éœ€è¦çš„èœå†™ä¸‹æ¥ï¼Œè¿™ä¸ªæ˜¯ä½ çš„å¯¼å…¥è¡¨ï¼›å¯¼å…¥è¡¨åªåœ¨éšå¼é“¾æ¥ä½¿ç”¨ã€‚</p>
<p>å¯¼å…¥è¡¨çš„çš„åœ°å€å­˜å‚¨åœ¨å¯é€‰PEå¤´æœ€åä¸€ä¸ªæˆå‘˜â€”â€”DataDirectoryæ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå³DataDirectory[1].</p>
<p>å¯¼å…¥è¡¨å®é™…ä¸Šæ˜¯ç»“æ„ä½“<strong>æ•°ç»„</strong>ï¼Œå®ƒç”±è®¸å¤šä¸ª<code>IMAGE_IMPORT_DESCRIPTOR</code>ç»“æ„ä½“ç»„æˆï¼Œæ¯ä¸€ä¸ªå¤–éƒ¨åº“éœ€è¦ä¸€ä¸ªç»“æ„ä½“ï¼Œåœ¨æ‰€æœ‰ç»“æ„çš„æœ€å,ç”±ä¸€ä¸ªå†…å®¹å…¨ä¸º0çš„<code>IMAGE_IMPORT_DESCRIPTOR</code>ç»“æ„ä½“ä½œä¸ºç»“æŸæ ‡å¿—ã€‚æ¯ä¸€ä¸ªç»“æ„ä½“æˆå‘˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_IMPORT_DESCRIPTOR &#123;</span><br><span class="line">  union &#123;</span><br><span class="line">    DWORD  Characteristics;      </span><br><span class="line">    DWORD  OriginalFirstThunk;     // æŒ‡å‘å¯¼å…¥åç§°è¡¨(INTï¼Œimport name table)</span><br><span class="line">    &#125; DUMMYUNIONNAME;</span><br><span class="line">  DWORD  TimeDateStamp;        </span><br><span class="line">  DWORD  ForwarderChain;         </span><br><span class="line">  DWORD  Name;					// è¯¥åº“åå­—çš„åœ°å€</span><br><span class="line">  DWORD  FirstThunk;           // æŒ‡å‘å¯¼å…¥åœ°å€è¡¨(IATï¼Œimport address table),åŒæ—¶ä¹Ÿæ˜¯DataDirectory[13]</span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br></pre></td></tr></table></figure>

<p>IAT(å¯¼å…¥å‡½æ•°åœ°å€è¡¨)å’ŒINT(å¯¼å…¥å‡½æ•°åç§°è¡¨)ï¼Œéƒ½æ˜¯ä¸€ä¸ª<strong>ç»“æ„ä½“æ•°ç»„</strong>ï¼Œå®ƒçš„æˆå‘˜éƒ½æ˜¯<code>IMAGE_THUNK_DATA</code>ç»“æ„çš„ç»“æ„ä½“ã€‚ä¸å¯¼å…¥è¡¨ç›¸ä¼¼ï¼ŒIATã€INTä¹Ÿæ˜¯ä»¥ä¸€ä¸ªå…¨ä¸º0çš„ç»“æ„ä½“ç»“å°¾ã€‚<code>IMAGE_THUNK_DATA</code>ç»“æ„ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_THUNK_DATA32</span><br><span class="line">&#123;</span><br><span class="line">    union &#123;</span><br><span class="line">        DWORD ForwarderString;      // è½¬å‘å­—ç¬¦ä¸²çš„RAV</span><br><span class="line">        DWORD Function;             // è¢«å¯¼å…¥å‡½æ•°çš„åœ°å€</span><br><span class="line">        DWORD Ordinal;              // è¢«å¯¼å…¥å‡½æ•°çš„åºå·</span><br><span class="line">        DWORD AddressOfData;        // æŒ‡å‘è¾“å…¥åç§°è¡¨ PIMAGE_IMPORT_BY_NAME</span><br><span class="line">    &#125; u1;</span><br><span class="line">&#125; IMAGE_THUNK_DATA32;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªè”åˆä½“ï¼Œåªæœ‰ä¸€ä¸ªæˆå‘˜æœ‰æ•ˆï¼Œä¸€å…±å 4ä¸ªå­—èŠ‚ã€‚å½“ç»“æ„ä½“çš„æœ€é«˜ä½ä¸º1æ—¶,è¡¨ç¤ºå‡½æ•°æ˜¯ä»¥åºå·çš„æ–¹å¼å¯¼å…¥çš„,è¿™æ—¶ç»“æ„ä½“çš„ä½ä½å°±æ˜¯å‡½æ•°çš„åºå·ï¼›å½“åŒå­—æœ€é«˜ä½ä¸º0æ—¶,è¡¨ç¤ºå‡½æ•°ä»¥å‡½æ•°åæ–¹å¼å¯¼å…¥,è¿™æ—¶ç»“æ„ä½“çš„å€¼æ˜¯ä¸€ä¸ªRVA,æŒ‡å‘ä¸€ä¸ªç”¨æ¥å®šä¹‰å¯¼å…¥å‡½æ•°åç§°çš„<code>IMAGE_IMPORT_BY_NAME</code>ç»“æ„,æ­¤ç»“æ„å®šä¹‰å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_IMPORT_BY_NAME</span><br><span class="line">&#123;</span><br><span class="line">    WORD    Hint;          // å‡½æ•°åºå·</span><br><span class="line">    CHAR   Name[1];        // å¯¼å…¥å‡½æ•°çš„åç§°ï¼ˆè¿™é‡Œå®šä¹‰ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯å®é™…ä¸Šåªæ˜¯åå­—çš„é¦–ä¸ªå­—ç¬¦ï¼‰</span><br><span class="line">&#125; IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME;</span><br></pre></td></tr></table></figure>

<p>dllåœ¨æ–‡ä»¶ä¸­æ—¶ï¼ŒIATå’ŒINTçš„å†…å®¹å®Œå…¨ç›¸åŒï¼›å½“dllåŠ è½½è¿›å†…å­˜ä¹‹åï¼Œå¯¼å…¥å‡½æ•°åœ°å€ä¼šå¡«å…¥IATä¸­<code>IMAGE_THUNK_DATA</code>çš„Functioné‡Œé¢ï¼Œæ­¤æ—¶è¿™ä¸ªç»“æ„ä½“çš„4ä¸ªå­—èŠ‚å°±æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¼å…¥å‡½æ•°çš„åœ°å€ï¼ˆRVAï¼‰ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªåœ°å€æ¥è°ƒç”¨å‡½æ•°ã€‚è€ŒINTä¸€ç›´ä¿æŒä¸å˜ï¼Œäºæ˜¯åŠ è½½åIATä¸INTä¸ç›¸åŒã€‚</p>
<p>æ³¨ï¼šå¯ä»¥é€šè¿‡ä¿®æ”¹å¯¼å…¥è¡¨æ¥è®©IATå’ŒINTæŒ‡å‘åŒä¸€å¼ è¡¨ï¼Œç”±äºPEæ–‡ä»¶è¿è¡Œæ—¶ï¼ŒINTè¡¨å‡ ä¹ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥è¿™æ ·åœ¨å¤§å¤šæ•°æƒ…å†µä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œã€‚</p>
<p><strong>å¯¼å…¥è¡¨åœ¨æ–‡ä»¶ä¸­æ—¶ï¼š</strong></p>
<img src="/posts/undefined/88bdc5cc50237f48060afe4af0c3107f.jpeg" class="" title="img">

<p>ä¸Šä¾‹ä¸­ä¸€å…±æœ‰4ä¸ªå¯¼å…¥å‡½æ•°ï¼Œå‰3ä¸ªæ˜¯ä»¥åå­—å¯¼å…¥ï¼Œç¬¬4ä¸ªæ˜¯ä»¥åºå·å¯¼å…¥ã€‚æ­¤æ—¶INTå’ŒIATç»“æ„æ˜¯ç›¸åŒçš„ã€‚</p>
<p><strong>å¯¼å…¥å®Œæˆåçš„å¯¼å…¥è¡¨ï¼š</strong></p>
<img src="/posts/undefined/00110338f2667ee48574243bcec1ccb5.jpeg" class="" title="img">

<h3 id="å¯¼å…¥æµç¨‹ï¼š"><a href="#å¯¼å…¥æµç¨‹ï¼š" class="headerlink" title="å¯¼å…¥æµç¨‹ï¼š"></a>å¯¼å…¥æµç¨‹ï¼š</h3><p>å¯¼å…¥dllåº“åˆ†ä¸ºä¸¤ç§æ–¹æ³•ï¼š<strong>é™æ€å¯¼å…¥å’ŒåŠ¨æ€å¯¼å…¥</strong>ã€‚</p>
<h4 id="é™æ€å¯¼å…¥ï¼š"><a href="#é™æ€å¯¼å…¥ï¼š" class="headerlink" title="é™æ€å¯¼å…¥ï¼š"></a><strong>é™æ€å¯¼å…¥ï¼š</strong></h4><ol>
<li><strong>ç¼–è¯‘å’Œé“¾æ¥é˜¶æ®µ</strong>ï¼š<ul>
<li><strong>åˆ›å»ºå¯¼å…¥è¡¨</strong>ï¼šé“¾æ¥å™¨æ ¹æ®å¯¹è±¡æ–‡ä»¶ä¸­çš„å¤–éƒ¨ç¬¦å·å¼•ç”¨ï¼Œåˆ›å»º PE æ–‡ä»¶çš„å¯¼å…¥è¡¨ã€‚</li>
<li><strong>æ·»åŠ å ä½ç¬¦</strong>ï¼šå¯¹äºæ¯ä¸ªå¯¼å…¥çš„å‡½æ•°ï¼Œåœ¨ IAT ä¸­ä¼šæœ‰ä¸€ä¸ªå ä½ç¬¦ï¼ˆå³IMAGE_THUNK_DATA32ï¼‰ï¼Œå®ƒå°†åœ¨è¿è¡Œæ—¶ç”± Windows åŠ è½½å™¨æ›¿æ¢ä¸ºå®é™…çš„å‡½æ•°åœ°å€ã€‚</li>
</ul>
</li>
<li><strong>æ¯æ¬¡å¯åŠ¨æ—¶</strong>ï¼š<ul>
<li><strong>é‡æ–°è§£æå¯¼å…¥è¡¨</strong>ï¼šå½“ç¨‹åºå¯åŠ¨æ—¶ï¼ŒWindows åŠ è½½å™¨ä¼šè¯»å– PE æ–‡ä»¶ä¸­çš„å¯¼å…¥è¡¨ï¼Œå¹¶æ ¹æ®å…¶ä¸­çš„ä¿¡æ¯åŠ è½½æ‰€æœ‰é™æ€å¯¼å…¥çš„ DLLã€‚</li>
<li><strong>æ›´æ–° IAT</strong>ï¼šåŠ è½½å™¨ä¼šé€šè¿‡dllé‡Œé¢çš„å¯¼å‡ºè¡¨æ¥è§£æä»–æä¾›çš„å¯¼å‡ºå‡½æ•°åœ°å€ï¼Œå¹¶ç”¨å®é™…çš„åœ°å€æ›´æ–° IAT ä¸­çš„å ä½ç¬¦ã€‚</li>
</ul>
</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼š<ul>
<li><strong>è‡ªåŠ¨åŠ è½½</strong>ï¼šæ‰€æœ‰é™æ€å¯¼å…¥çš„ DLL åœ¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ã€‚</li>
<li><strong>ä¾èµ–æ€§å¼º</strong>ï¼šå¦‚æœç¼ºå°‘ä»»ä½•ä¸€ä¸ªå¿…è¦çš„ DLLï¼Œç¨‹åºå°†æ— æ³•å¯åŠ¨ã€‚</li>
<li><strong>IAT æ›´æ–°é¢‘ç‡</strong>ï¼šæ¯æ¬¡å¯åŠ¨ç¨‹åºæ—¶éƒ½éœ€è¦é‡æ–°è§£æå’Œæ›´æ–° IATã€‚</li>
</ul>
</li>
</ol>
<h4 id="åŠ¨æ€å¯¼å…¥ï¼š"><a href="#åŠ¨æ€å¯¼å…¥ï¼š" class="headerlink" title="åŠ¨æ€å¯¼å…¥ï¼š"></a><strong>åŠ¨æ€å¯¼å…¥ï¼š</strong></h4><ol>
<li><strong>ç¼–è¯‘å’Œé“¾æ¥é˜¶æ®µ</strong>ï¼š<ul>
<li><strong>ä¸ç”Ÿæˆå¯¼å…¥è¡¨æ¡ç›®</strong>ï¼šä¸é™æ€å¯¼å…¥ä¸åŒï¼ŒåŠ¨æ€è¿æ¥ä¸ä¼šåœ¨ç¼–è¯‘å’Œé“¾æ¥é˜¶æ®µä¸ºåŠ¨æ€åŠ è½½çš„ DLL åˆ›å»ºå¯¼å…¥è¡¨æ¡ç›®ï¼Œ<strong>åŠ¨æ€å¯¼å…¥ä¸å¯¼å…¥è¡¨æ— å…³</strong>ã€‚</li>
</ul>
</li>
<li><strong>æ¯æ¬¡å¯åŠ¨æ—¶</strong>ï¼š<ul>
<li><strong>æŒ‰éœ€åŠ è½½</strong>ï¼šåŠ¨æ€è¿æ¥çš„ DLL ä¸ä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ï¼Œè€Œæ˜¯åœ¨éœ€è¦æ—¶ç”±ç¨‹åºæ˜¾å¼è°ƒç”¨ <code>LoadLibrary</code> æ¥åŠ è½½ã€‚åœ¨ä½¿ç”¨LoadLibraryå‡½æ•°æ—¶ï¼Œç³»ç»Ÿä¼šå°†dllåŠ è½½è¿›ç©ºé—´ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¥æŸ„ï¼ˆå³dllçš„åœ°å€ï¼‰ã€‚ä½¿ç”¨GetProcAddressåï¼Œç³»ç»Ÿä¼šæ ¹æ®å‡½æ•°åå­—æˆ–åºå·æŸ¥æ‰¾dllçš„å¯¼å‡ºè¡¨ï¼Œå¾—åˆ°å‡½æ•°RVAï¼Œæ­¤RVAåŠ ä¸Šdllçš„åŸºå€å¾—åˆ°çœŸå®çš„å‡½æ•°åœ°å€ï¼ŒGetProcAddresså°†çœŸå®å‡½æ•°åœ°å€è¿”å›ç»™ç¨‹åºä¿å­˜ã€‚</li>
</ul>
</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼š<ul>
<li><strong>çµæ´»æ€§é«˜</strong>ï¼šå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ è½½å’Œå¸è½½æ¨¡å—ï¼Œæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚</li>
<li><strong>å‡å°‘åˆå§‹åŠ è½½æ—¶é—´</strong>ï¼šåœ¨å¯åŠ¨æ—¶ä¸éœ€è¦è£…è½½dllã€ä¿®æ­£å¯¼å…¥è¡¨ï¼Œæ‰€ä»¥å¯ä»¥åŠ å¿«ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ã€‚</li>
<li><strong>IAT æ›´æ–°é¢‘ç‡</strong>ï¼šä¸éœ€è¦ä»»ä½•IATä¹Ÿä¸ç”Ÿæˆä»»ä½•IATã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>åœ¨é™æ€å¯¼å…¥dllæ—¶ï¼Œç¼–è¯‘é˜¶æ®µåˆ›å»ºå¯¼å…¥è¡¨ï¼Œä½†åœ¨ç¨‹åºçš„å¯åŠ¨é˜¶æ®µæ‰ä¼šä¿®æ­£IATè¡¨ï¼Œä¸€æ˜¯å› ä¸ºASLR æœºåˆ¶å¯¼è‡´ç¨‹åºæ¯ä¸€æ¬¡å¯åŠ¨éƒ½ä¼šåˆ†é…ä¸ä¸€æ ·çš„åŸºå€ï¼ŒäºŒæ˜¯å› ä¸ºåœ¨ç¨‹åºå¼€å§‹æ—¶ï¼Œdllæ–‡ä»¶æ‰ä¼šæ˜ å°„åˆ°å½“å‰è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ä¸­ï¼Œè¿™ä¸ªæ—¶å€™æ‰èƒ½çŸ¥é“å¯¼å…¥å‡½æ•°çš„å®é™…åœ°å€ã€‚å¯åŠ¨é˜¶æ®µï¼ŒIATä¸­æ‰€æœ‰å¯¼å…¥å‡½æ•°ï¼ˆä¸ç®¡ç”¨æ²¡ç”¨åˆ°ï¼‰çš„åœ°å€éƒ½ä¼šä¿®æ­£ã€‚</p>
<h2 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h2><p>ç›®æ ‡ï¼šæ‰“å°å¯¼å…¥è¡¨ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">IMAGE_IMPORT_DESCRIPTOR* import;</span><br><span class="line">int num=0;           //èŠ‚æ•°é‡</span><br><span class="line">int header_size=0;   // PEå¤´å¤§å°</span><br><span class="line">int base=0;          // åŸºå€</span><br><span class="line">int fsize=0,image_size=0; // æ–‡ä»¶å¤§å°ï¼›æ–‡ä»¶æ˜ å°„çš„å†…å­˜å¤§å°</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">	DWORD foa=0;</span><br><span class="line">    if(rva&lt;=header_size) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    if(rva&lt;sheader[0].VirtualAddress) &#123;</span><br><span class="line">        printf(&quot;æ²¡æœ‰å¯¹åº”çš„foa!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i &gt;= num) &#123;</span><br><span class="line">        printf(&quot;RVAè¶…å‡ºèŒƒå›´!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">	return foa;</span><br><span class="line">&#125;</span><br><span class="line">void print_import(unsigned char *buffer)&#123;  // æ‰“å°å¯¼å…¥è¡¨</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;;i++)&#123;</span><br><span class="line">        if(import[i].OriginalFirstThunk==0&amp;&amp;import[i].FirstThunk==0) break;</span><br><span class="line">        printf(&quot;%så¯¼å…¥è¡¨ä¿¡æ¯:\n&quot;,(char *)(RVA_to_FOA(import[i].Name)+buffer));</span><br><span class="line">        printf(&quot;OriginalFirstThunk(INT):%#010x\n&quot;,import[i].OriginalFirstThunk);</span><br><span class="line">        printf(&quot;TimeDateStamp:%#010x\n&quot;,import[i].TimeDateStamp);</span><br><span class="line">        printf(&quot;ForwarderChain:%#010x\n&quot;,import[i].ForwarderChain);</span><br><span class="line">        printf(&quot;Name:%#010x\n&quot;,import[i].Name);</span><br><span class="line">        printf(&quot;FirstThunk(IAT):%#010x\n\n&quot;,import[i].FirstThunk);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">void print_IAT(unsigned char *file_buf)&#123;  // æ‰“å°IATè¡¨</span><br><span class="line">    int i=0,j=0;</span><br><span class="line">    IMAGE_THUNK_DATA32* IAT;</span><br><span class="line">    IMAGE_IMPORT_BY_NAME* name_t;</span><br><span class="line">    for(i=0;;i++)&#123;</span><br><span class="line">        if(import[i].OriginalFirstThunk==0&amp;&amp;import[i].FirstThunk==0) break;</span><br><span class="line">        printf(&quot;%sä¸­å¯¼å‡ºå‡½æ•°:\n&quot;,(char *)(RVA_to_FOA(import[i].Name)+file_buf));</span><br><span class="line">        IAT = (IMAGE_THUNK_DATA32*)(RVA_to_FOA(import[i].FirstThunk)+file_buf);</span><br><span class="line">        printf(&quot;å‡½æ•°åå¯¼å…¥:\n&quot;);</span><br><span class="line">        printf(&quot;å‡½æ•°å     Hint\n&quot;);</span><br><span class="line">        for(j=0;;j++)&#123;</span><br><span class="line">            if(IAT[j].u1.AddressOfData==0) break;</span><br><span class="line">            if(IAT[j].u1.AddressOfData&gt;&gt;31==0)</span><br><span class="line">            &#123;</span><br><span class="line">                name_t = (IMAGE_IMPORT_BY_NAME*)(RVA_to_FOA(IAT[j].u1.AddressOfData)+file_buf);</span><br><span class="line">                printf(&quot;%s      %#x\n&quot;,(char*)name_t-&gt;Name,name_t-&gt;Hint);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;\nåºå·å¯¼å…¥:\n&quot;);</span><br><span class="line">        for(j=0;;j++)&#123;</span><br><span class="line">            if(IAT[j].u1.AddressOfData==0) break;</span><br><span class="line">            if(IAT[j].u1.AddressOfData&gt;&gt;31==1)</span><br><span class="line">            &#123;</span><br><span class="line">                printf(&quot;åºå·:%#x\n&quot;,IAT[j].u1.AddressOfData&amp;0x7fffffff);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;\n\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    // if(argc != 2) &#123;</span><br><span class="line">    //     printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">    //     return 1;</span><br><span class="line">    // &#125;</span><br><span class="line">    const char* pe_path = &quot;grade.exe&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize);</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *buffer=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)buffer;</span><br><span class="line">    buffer+=dos-&gt;e_lfanew+4;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)buffer;</span><br><span class="line">    num = fheader-&gt;NumberOfSections;</span><br><span class="line">    buffer+=20;      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)buffer;</span><br><span class="line">    header_size=oheader-&gt;SizeOfHeaders;</span><br><span class="line">    base=oheader-&gt;ImageBase;</span><br><span class="line">    image_size = oheader-&gt;SizeOfImage;</span><br><span class="line">    buffer += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    int size = num * sizeof(IMAGE_SECTION_HEADER);</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)buffer;</span><br><span class="line">    import = (IMAGE_IMPORT_DESCRIPTOR*)(RVA_to_FOA(oheader-&gt;DataDirectory[1].VirtualAddress)+file_buf);</span><br><span class="line">	print_import(file_buf);</span><br><span class="line">    print_IAT(file_buf);</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PE</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¼å‡ºè¡¨</title>
    <url>/posts/20158/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="å¯¼å‡ºè¡¨"><a href="#å¯¼å‡ºè¡¨" class="headerlink" title="å¯¼å‡ºè¡¨"></a>å¯¼å‡ºè¡¨</h1><h2 id="æ¦‚è¿°ï¼š"><a href="#æ¦‚è¿°ï¼š" class="headerlink" title="æ¦‚è¿°ï¼š"></a>æ¦‚è¿°ï¼š</h2><p>optionalå¤´æœ€åä¸€ä¸ªæˆå‘˜DataDirectory[16]ï¼Œè¿™ä¸ªç»“æ„ä½“æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å­˜å‚¨çš„å°±æ˜¯å¯¼å‡ºè¡¨çš„ä½ç½®ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_DATA_DIRECTORY &#123;</span><br><span class="line">    DWORD   VirtualAddress;  // å¯¼å‡ºè¡¨çš„RVA</span><br><span class="line">    DWORD   Size;             // å¤§å°ï¼ˆæ²¡ç”¨ï¼‰</span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br></pre></td></tr></table></figure>

<p>å¯¼å‡ºè¡¨ä¸æ˜¯ä¸€å¼ è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_EXPORT_DIRECTORY &#123;</span><br><span class="line">    DWORD   Characteristics; // æœªä½¿ç”¨</span><br><span class="line">    DWORD   TimeDateStamp; // æ—¶é—´æˆ³ï¼Œè¡¨ç¤ºå½“å‰PEæ–‡ä»¶ï¼ˆDLLï¼‰ç¼–è¯‘æ—¶çš„æ—¶é—´</span><br><span class="line">    WORD    MajorVersion; // æœªä½¿ç”¨</span><br><span class="line">    WORD    MinorVersion; // æœªä½¿ç”¨</span><br><span class="line">    DWORD   Name; // å½“å‰å¯¼å‡ºè¡¨æ–‡ä»¶åå­—ç¬¦ä¸²çš„åœ°å€</span><br><span class="line">    DWORD   Base; // å¯¼å‡ºå‡½æ•°èµ·å§‹åºå·</span><br><span class="line">    DWORD   NumberOfFunctions; // æ‰€æœ‰å¯¼å‡ºå‡½æ•°çš„ä¸ªæ•°(ä¸ä¸€å®šå‡†ç¡®)</span><br><span class="line">    DWORD   NumberOfNames; // ä»¥å‡½æ•°åå­—å¯¼å‡ºçš„å‡½æ•°ä¸ªæ•°</span><br><span class="line">    DWORD   AddressOfFunctions;// å¯¼å‡ºå‡½æ•°åœ°å€è¡¨RVA</span><br><span class="line">    DWORD   AddressOfNames; // å¯¼å‡ºå‡½æ•°åç§°è¡¨RVA</span><br><span class="line">    DWORD   AddressOfNameOrdinals; // å¯¼å‡ºå‡½æ•°åºå·è¡¨RVA</span><br><span class="line">&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œå¯¼å‡ºè¡¨æŒ‡å‘äº†ä¸‰å¼ è¡¨ï¼ˆä¸‰ä¸ªæ•°ç»„ï¼‰ï¼Œåˆ†åˆ«æ˜¯åœ°å€è¡¨ã€åç§°è¡¨ã€åºå·è¡¨ã€‚</p>
<ul>
<li><strong>Base</strong>ï¼ˆå¯¼å‡ºå‡½æ•°èµ·å§‹åºå·ï¼‰ï¼šç­‰äºæ‰€æœ‰å¯¼å‡ºå‡½æ•°åºå·çš„æœ€å°å€¼ã€‚</li>
<li><strong>NumberOfFunctions</strong>ï¼ˆæ‰€æœ‰å¯¼å‡ºå‡½æ•°çš„ä¸ªæ•°ï¼‰ï¼šä¸åœ°å€è¡¨çš„æˆå‘˜ä¸ªæ•°ç›¸ç­‰ï¼Œè®¡ç®—æ–¹å¼æ˜¯(æœ€å¤§åºå·-æœ€å°åºå·+1)ï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šç­‰äºå®é™…å¯¼å‡ºå‡½æ•°çš„ä¸ªæ•°ï¼Œæ¯”å¦‚å½“æˆ‘æœ‰2ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œä½¿ç”¨defæ–‡ä»¶æ˜¾å¼æŒ‡å®šåºå·åˆ†åˆ«ä¸º1å’Œ3ï¼Œé‚£ä¹ˆNumberOfFunctionsçš„å€¼å°±ä¸º3ï¼Œä½†æ˜¯å®é™…å¯¼å‡ºå‡½æ•°ä¸º2ä¸ªã€‚</li>
<li><strong>AddressOfFunctions</strong>ï¼ˆå¯¼å‡ºå‡½æ•°åœ°å€è¡¨ï¼‰ï¼šæ¯ä¸€ä¸ªæˆå‘˜4ä¸ªå­—èŠ‚ï¼Œå­˜å‚¨ä¸€ä¸ªå¯¼å‡ºå‡½æ•°çš„åœ°å€ï¼ˆå¯èƒ½ä¸º0ï¼‰</li>
<li><strong>AddressOfNames</strong>ï¼ˆå¯¼å‡ºå‡½æ•°åç§°è¡¨ï¼‰ï¼šæ¯ä¸€ä¸ªæˆå‘˜4ä¸ªå­—èŠ‚ï¼Œå­˜å‚¨ä¸€ä¸ªå¯¼å‡ºå‡½æ•°çš„åå­—çš„åœ°å€</li>
<li><strong>AddressOfNameOrdinals</strong>ï¼ˆå¯¼å‡ºå‡½æ•°åºå·è¡¨ï¼‰ï¼šä¸€ä¸ªæˆå‘˜2ä¸ªå­—èŠ‚ï¼Œä¸åç§°è¡¨å¯¹åº”ï¼Œè®°è½½å¯¹åº”å‡½æ•°çš„åºå·ï¼ˆå®é™…ä¸ºåŸåºå·-baseï¼‰</li>
</ul>
<p>å†™4ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œç»™å…¶ä¸­ä¸¤ä¸ªåˆ†åˆ«åˆ†é…2å’Œ7ï¼Œæ„å»ºdllï¼Œä½¿ç”¨PEå·¥å…·æ‰“å¼€ï¼Œè§‚å¯Ÿå¯¼å‡ºè¡¨ï¼š</p>
<img src="/posts/20158/image-20250706204430469.png" class="" title="image-20250706204430469">

<p>å¯¼å‡ºå‡½æ•°å®é™…æœ‰4ä¸ªï¼Œä½†æ˜¯NumberOfFunctionså€¼ä¸º6ï¼ˆ7-2+1ï¼‰ï¼Œbaseä¸º2ï¼ˆæœ€å°åºå·ï¼‰ã€‚ä¸‰è¡¨ç¤ºæ„å›¾ï¼š</p>
<img src="/posts/20158/draw.drawio.png" class="" title="draw.drawio">

<h2 id="å¯»æ‰¾å‡½æ•°æ–¹æ³•ï¼š"><a href="#å¯»æ‰¾å‡½æ•°æ–¹æ³•ï¼š" class="headerlink" title="å¯»æ‰¾å‡½æ•°æ–¹æ³•ï¼š"></a>å¯»æ‰¾å‡½æ•°æ–¹æ³•ï¼š</h2><h3 id="é€šè¿‡åç§°æ‰¾ï¼š"><a href="#é€šè¿‡åç§°æ‰¾ï¼š" class="headerlink" title="é€šè¿‡åç§°æ‰¾ï¼š"></a>é€šè¿‡åç§°æ‰¾ï¼š</h3><p>1ã€æ ¹æ®åç§°åœ¨åç§°è¡¨é‡Œé¢æ‰¾ã€‚ä¾‹å¦‚è¦æ‰¾â€plusâ€å‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²ä¸åç§°è¡¨é‡Œé¢è¡¨ä¸­åœ°å€æŒ‡å‘çš„å­—ç¬¦ä¸²è¿›è¡Œä»¥ä¸€æ¯”å¯¹ï¼Œç›´åˆ°ç›¸åŒï¼Œè®°ä¸‹ç´¢å¼•ï¼ˆè¿™é‡Œç´¢å¼•æ˜¯3ï¼‰ã€‚</p>
<p>2ã€æ ¹æ®ä¸Šä¸€æ­¥å¾—åˆ°çš„ç´¢å¼•ï¼Œå–åºå·è¡¨åŒç´¢å¼•å¤„çš„å€¼ï¼ˆè¿™é‡Œæ˜¯5ï¼‰ã€‚</p>
<p>3ã€å–åœ°å€è¡¨è¯¥ç´¢å¼•å¤„çš„åœ°å€ï¼Œå…¶ä¸ºå‡½æ•°åœ°å€ï¼ˆRVAï¼‰ã€‚</p>
<h3 id="é€šè¿‡åºå·æ‰¾ï¼š"><a href="#é€šè¿‡åºå·æ‰¾ï¼š" class="headerlink" title="é€šè¿‡åºå·æ‰¾ï¼š"></a>é€šè¿‡åºå·æ‰¾ï¼š</h3><p>å‡è®¾å·²çŸ¥åºå·ä¸º7ï¼š</p>
<p>1ã€åºå·-baseå¾—åˆ°ç´¢å¼•ï¼ˆè¿™é‡Œæ˜¯7-2&#x3D;5ï¼‰</p>
<p>2ã€å–åœ°å€è¡¨è¯¥ç´¢å¼•å¤„çš„åœ°å€ï¼Œå…¶ä¸ºå‡½æ•°åœ°å€ï¼ˆRVAï¼‰ã€‚</p>
<h1 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h1><p>ç›®æ ‡ï¼š</p>
<p>1ã€æ‰“å°å¯¼å‡ºè¡¨æ‰€æœ‰ä¿¡æ¯</p>
<p>2ã€é€šè¿‡å‡½æ•°åæŸ¥æ‰¾å‡½æ•°FOA</p>
<p>3ã€é€šè¿‡åºå·æŸ¥æ‰¾å‡½æ•°FOA</p>
<p>æ€è·¯ï¼š</p>
<p>1ã€ç”±å¯é€‰å¤´å¾—åˆ°ç»“æ„ä½“æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ </p>
<p>2ã€å–ç¬¬ä¸€ä¸ªå…ƒç´ é‡Œé¢çš„VirtualAddressè½¬FOAï¼Œåœ¨å®šä½æ–‡ä»¶ä¸­å¯¼å‡ºè¡¨çš„ä½ç½®</p>
<p>3ã€å®šä½å¯¼å‡ºè¡¨ä¸­ä¸‰ä¸ªæ•°ç»„çš„ä½ç½®</p>
<p>4ã€ä¾æ®åç§°æˆ–åºå·æ‰¾å‡½æ•°åœ°å€</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">IMAGE_EXPORT_DIRECTORY* export;</span><br><span class="line">int num=0;           //èŠ‚æ•°é‡</span><br><span class="line">int header_size=0;   // PEå¤´å¤§å°</span><br><span class="line">int base=0;          // åŸºå€</span><br><span class="line">int fsize=0,image_size=0; // æ–‡ä»¶å¤§å°ï¼›æ–‡ä»¶æ˜ å°„çš„å†…å­˜å¤§å°</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">	DWORD foa=0;</span><br><span class="line">    if(rva&lt;=header_size) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    if(rva&lt;sheader[0].VirtualAddress) &#123;</span><br><span class="line">        printf(&quot;æ²¡æœ‰å¯¹åº”çš„foa!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i &gt;= num) &#123;</span><br><span class="line">        printf(&quot;RVAè¶…å‡ºèŒƒå›´!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">	return foa;</span><br><span class="line">&#125;</span><br><span class="line">void print_export()&#123;</span><br><span class="line">	printf(&quot;å¯¼å‡ºè¡¨ä¿¡æ¯:\n&quot;);</span><br><span class="line">	printf(&quot;Characteristics: %#010x\n&quot;, export-&gt;Characteristics);</span><br><span class="line">	printf(&quot;TimeDateStamp: %#010x\n&quot;, export-&gt;TimeDateStamp);</span><br><span class="line">	printf(&quot;MajorVersion: %#x\n&quot;, export-&gt;MajorVersion);</span><br><span class="line">	printf(&quot;MinorVersion: %#x\n&quot;, export-&gt;MinorVersion);</span><br><span class="line">	printf(&quot;Name: %#010x\n&quot;, export-&gt;Name);</span><br><span class="line">	printf(&quot;Base: %#x\n&quot;, export-&gt;Base);</span><br><span class="line">	printf(&quot;NumberOfFunctions: %#x\n&quot;, export-&gt;NumberOfFunctions);</span><br><span class="line">	printf(&quot;NumberOfNames: %#x\n&quot;, export-&gt;NumberOfNames);</span><br><span class="line">	printf(&quot;AddressOfFunctions: %#010x\n&quot;, export-&gt;AddressOfFunctions);</span><br><span class="line">	printf(&quot;AddressOfNames: %#010x\n&quot;, export-&gt;AddressOfNames);</span><br><span class="line">	printf(&quot;AddressOfNameOrdinals: %#010x\n\n&quot;, export-&gt;AddressOfNameOrdinals);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD SearchInName(char *name,unsigned char *file_buf)&#123;   // é€šè¿‡åå­—æŸ¥æ‰¾å‡½æ•°åœ°å€(è¿”å›RVA)</span><br><span class="line">	int i=0;</span><br><span class="line">	DWORD* NameTable=(DWORD*)(RVA_to_FOA(export-&gt;AddressOfNames)+file_buf);</span><br><span class="line">	WORD* OrdinalTable=(WORD*)(RVA_to_FOA(export-&gt;AddressOfNameOrdinals)+file_buf);</span><br><span class="line">	DWORD* AddressTable=(DWORD*)(RVA_to_FOA(export-&gt;AddressOfFunctions)+file_buf);</span><br><span class="line">	for(i=0;i&lt;export-&gt;NumberOfNames;i++)&#123;</span><br><span class="line">		if(!strcmp(name,(char*)(RVA_to_FOA(NameTable[i])+file_buf)))&#123;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if(i==export-&gt;NumberOfNames)&#123;</span><br><span class="line">		printf(&quot;æœªæ‰¾åˆ°è¯¥å‡½æ•°\n&quot;);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	int index = (int)OrdinalTable[i];</span><br><span class="line">	return AddressTable[index];</span><br><span class="line">&#125;</span><br><span class="line">DWORD SearchInOrdinal(int index,unsigned char *file_buf)&#123;  // é€šè¿‡åºå·æŸ¥æ‰¾</span><br><span class="line">	index -= export-&gt;Base;</span><br><span class="line">	DWORD* AddressTable=(DWORD*)(RVA_to_FOA(export-&gt;AddressOfFunctions)+file_buf);</span><br><span class="line">	return AddressTable[index];</span><br><span class="line">&#125;</span><br><span class="line">void Print_All_Function(unsigned char *file_buf)&#123;</span><br><span class="line">    DWORD* NameTable=(DWORD*)(RVA_to_FOA(export-&gt;AddressOfNames)+file_buf);</span><br><span class="line">	WORD* OrdinalTable=(WORD*)(RVA_to_FOA(export-&gt;AddressOfNameOrdinals)+file_buf);</span><br><span class="line">	DWORD* AddressTable=(DWORD*)(RVA_to_FOA(export-&gt;AddressOfFunctions)+file_buf);</span><br><span class="line">    int i=0,j=0;</span><br><span class="line">    printf(&quot;åºå·   å‡½æ•°å     FOA    RVA\n&quot;);</span><br><span class="line">    for(i=0;i&lt;export-&gt;NumberOfFunctions;i++)&#123;</span><br><span class="line">        if(AddressTable[i]==0) continue;</span><br><span class="line">        for(j=0;j&lt;export-&gt;NumberOfNames;j++)&#123;</span><br><span class="line">            if(i==OrdinalTable[j])&#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(j==export-&gt;NumberOfNames) printf(&quot;%d    NULL    %#x    %#x\n&quot;,i+export-&gt;Base,RVA_to_FOA(AddressTable[i]),AddressTable[i]);</span><br><span class="line">        else printf(&quot;%d    %s    %#x     %#x\n&quot;,i+export-&gt;Base,(char*)(RVA_to_FOA(NameTable[j])+file_buf),RVA_to_FOA(AddressTable[i]),AddressTable[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    // if(argc != 2) &#123;</span><br><span class="line">    //     printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">    //     return 1;</span><br><span class="line">    // &#125;</span><br><span class="line">    const char* pe_path = &quot;dlltest.dll&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize);</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *offset=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)offset;</span><br><span class="line">    offset+=dos-&gt;e_lfanew+4;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)offset;</span><br><span class="line">    num = fheader-&gt;NumberOfSections;</span><br><span class="line">    offset+=20;      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)offset;</span><br><span class="line">    header_size=oheader-&gt;SizeOfHeaders;</span><br><span class="line">    base=oheader-&gt;ImageBase;</span><br><span class="line">    image_size = oheader-&gt;SizeOfImage;</span><br><span class="line">    offset += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    int size = num * sizeof(IMAGE_SECTION_HEADER);</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)offset;</span><br><span class="line">	DWORD export_rva = oheader-&gt;DataDirectory[0].VirtualAddress;</span><br><span class="line">	DWORD export_foa = RVA_to_FOA(export_rva);</span><br><span class="line">	if(export_foa == 0) &#123;</span><br><span class="line">		printf(&quot;å¯¼å‡ºè¡¨RVAè½¬æ¢å¤±è´¥\n&quot;);</span><br><span class="line">		free(file_buf);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	export = (IMAGE_EXPORT_DIRECTORY*)(file_buf + export_foa);</span><br><span class="line">	print_export();</span><br><span class="line">    Print_All_Function(file_buf);</span><br><span class="line">	int flag;</span><br><span class="line">	char s[20];</span><br><span class="line">	DWORD address=0;</span><br><span class="line">	int ord=0;</span><br><span class="line">	while(1)&#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥ä½ éœ€è¦è¿›è¡Œçš„æ“ä½œï¼ˆä½¿ç”¨åå­—æŸ¥æ‰¾é€‰æ‹©1,ä½¿ç”¨åºå·æŸ¥æ‰¾é€‰æ‹©2,é€€å‡ºé€‰æ‹©0ï¼‰:\n&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;flag);</span><br><span class="line">        switch(flag)</span><br><span class="line">        &#123;</span><br><span class="line">            case 1:&#123;</span><br><span class="line">                printf(&quot;è¯·è¾“å…¥å‡½æ•°å:&quot;);</span><br><span class="line">				scanf(&quot;%s&quot;,s);</span><br><span class="line">				address = SearchInName(s,file_buf);</span><br><span class="line">				printf(&quot;å‡½æ•°%sçš„RVAä¸º%#010x,FOAä¸º%#010x\n&quot;,s,address,RVA_to_FOA(address));</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            case 2:&#123;</span><br><span class="line">				printf(&quot;è¯·è¾“å…¥åºå·:&quot;);</span><br><span class="line">				scanf(&quot;%d&quot;,&amp;ord);</span><br><span class="line">                address = SearchInOrdinal(ord,file_buf);</span><br><span class="line">				printf(&quot;åºå·ä¸º%dçš„å‡½æ•°çš„RVAä¸º%#010x,FOAä¸º%#010x\n&quot;,ord,address,RVA_to_FOA(address));</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            default:</span><br><span class="line">                free(file_buf);</span><br><span class="line">                return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PE</tag>
      </tags>
  </entry>
  <entry>
    <title>åº“æ–‡ä»¶çš„ç¼–å†™</title>
    <url>/posts/61633/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="é™æ€é“¾æ¥åº“"><a href="#é™æ€é“¾æ¥åº“" class="headerlink" title="é™æ€é“¾æ¥åº“"></a>é™æ€é“¾æ¥åº“</h1><h2 id="ç”Ÿæˆæ–¹æ³•ï¼š"><a href="#ç”Ÿæˆæ–¹æ³•ï¼š" class="headerlink" title="ç”Ÿæˆæ–¹æ³•ï¼š"></a>ç”Ÿæˆæ–¹æ³•ï¼š</h2><p>åœ¨VS2022é‡Œé¢åˆ›å»ºé¡¹ç›®ï¼Œé€‰æ‹©ç”Ÿæˆé™æ€åº“ï¼Œæ­¤æ—¶ç¨‹åºä¼šè‡ªåŠ¨ç”Ÿæˆ4ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯framework.hã€pch.hã€pch.cppå’Œä¸€ä¸ªé¡¹ç›®åçš„cppæ–‡ä»¶ï¼Œå‰ä¸‰ä¸ªéƒ½æ˜¯ç”¨æ¥æé«˜ç¼–è¯‘æ•ˆç‡çš„ï¼Œä¸ç”¨ç®¡ã€‚è‡ªå·±åˆ›å»ºä¸€ä¸ª.hæ–‡ä»¶ã€‚</p>
<p>éœ€è¦ç¼–è¾‘ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯å¤´æ–‡ä»¶(h)ï¼Œä¸€ä¸ªæ˜¯æºä»£ç æ–‡ä»¶ï¼ˆcæˆ–cppï¼‰ã€‚</p>
<ul>
<li>hæ–‡ä»¶é‡Œé¢å­˜æ”¾å¯¼å‡ºå‡½æ•°çš„å£°æ˜</li>
<li>cæ–‡ä»¶é‡Œé¢å­˜æ”¾å¯¼å‡ºå‡½æ•°çš„å…·ä½“å®ç°</li>
</ul>
<p>å¦‚ï¼š</p>
<p>hæ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma once  //æ³¨ï¼šè¿™ä¸ªæ˜¯ä¸ºäº†é˜²æ­¢å¤´æ–‡ä»¶è¢«å¤šæ¬¡åŒ…å«è€Œé‡å¤å®šä¹‰</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus   //è¿™é‡Œæ˜¯ä¸ºäº†é˜²æ­¢C++åç§°ä¿®é¥°ï¼ˆå¦‚æœæ£€æµ‹åˆ°æ˜¯C++ï¼Œåˆ™å£°æ˜ç”¨Cçš„æ–¹æ³•åŒ…è£…ï¼‰ï¼ˆä¸€å®šè¦æœ‰ï¼Œå¦åˆ™å‡½æ•°åç§°ä¼šæ”¹å˜ï¼‰</span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">#endif</span><br><span class="line">	int add(int a, int b);</span><br><span class="line">	int sub(int a, int b);</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>

<p>cæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &quot;pch.h&quot;</span><br><span class="line">#include &quot;framework.h&quot;</span><br><span class="line">#include &quot;libtest.h&quot;</span><br><span class="line">int add(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">	return a+b;</span><br><span class="line">&#125;</span><br><span class="line">int sub(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">	return a-b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¼šç”Ÿæˆä¸€ä¸ª.libæ–‡ä»¶ï¼ˆå®ç°ï¼‰ï¼Œè€Œä¹‹å‰åˆ›å»ºçš„.hæ–‡ä»¶ï¼ˆå£°æ˜ï¼‰ä¹Ÿéœ€è¦ç”¨åˆ°</p>
<h2 id="ä½¿ç”¨æ–¹æ³•ï¼š"><a href="#ä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a>ä½¿ç”¨æ–¹æ³•ï¼š</h2><ol>
<li>éœ€è¦åŒ…å«å¤´æ–‡ä»¶ï¼ˆè®©ç¼–è¯‘å™¨çŸ¥é“å‡½æ•°çš„å£°æ˜åœ¨å“ªï¼‰</li>
<li>æ˜¾å¼æŒ‡å®šåº“æ–‡ä»¶ï¼ˆè®©ç¼–è¯‘å™¨çŸ¥é“å‡½æ•°çš„å®ç°åœ¨å“ªï¼‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&quot;libtest.h&quot;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib,&quot;libtest.lib&quot;)</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	int a = 1, b = 3;</span><br><span class="line">	printf(&quot;%d&quot;, add(a, b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p>é™æ€é“¾æ¥åº“çš„ç‰¹ç‚¹æ˜¯ä¼šåœ¨ç¼–è¯‘é˜¶æ®µç›´æ¥å°†å¯¼å‡ºå‡½æ•°ä»£ç é•¶åµŒè¿›å…¥ç›®æ ‡ç¨‹åºä¸­ï¼Œå› æ­¤ä¸€æ—¦ç¼–è¯‘å®Œæˆï¼Œç›®æ ‡ç¨‹åºä¸å†éœ€è¦è¯¥åº“æ–‡ä»¶ï¼Œè€Œä¸”ä¸€æ—¦ä¿®æ”¹äº†é™æ€é“¾æ¥åº“ï¼Œå°±éœ€è¦é‡æ–°ç¼–è¯‘ç›®æ ‡ç¨‹åºï¼Œè¿™ä¸åŠ¨æ€é“¾æ¥åº“ä¸åŒã€‚</p>
<p>åŒæ—¶ï¼Œç”±äºæ˜¯å°†ä»£ç é•¶åµŒå…¥ç›®æ ‡ç¨‹åºï¼Œå› æ­¤æ— æ³•é€šè¿‡åæ±‡ç¼–åˆ†è¾¨å‡½æ•°æ˜¯ä»é™æ€åº“å¯¼å…¥çš„å‡½æ•°è¿˜æ˜¯è‡ªå·±ç¼–å†™çš„ã€‚</p>
<p>å¦‚æœå¤šä¸ªç¨‹åºéƒ½ä½¿ç”¨äº†åŒä¸€ä¸ªé™æ€é“¾æ¥åº“é‡Œçš„å‡½æ•°ï¼Œé‚£ä¹ˆè¿™äº›ç¨‹åºä¹‹é—´å°±ä¼šæœ‰å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œååˆ†æµªè´¹ç£ç›˜ç©ºé—´ã€‚</p>
<p>æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„åŒ…æ‹¬printfã€strcmpç­‰å‡½æ•°éƒ½ä½¿ç”¨äº†é™æ€é“¾æ¥åº“ï¼Œä¸éœ€è¦æ˜¾ç¤ºæŒ‡å®šåº“æ–‡ä»¶æ˜¯å› ä¸ºç¼–ç¨‹è½¯ä»¶å¸®æˆ‘ä»¬åšäº†è¿™äº›äº‹ã€‚</p>
<h2 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h2><p>1ã€MSVCç¼–è¯‘å™¨çš„é™æ€åº“æ–‡ä»¶æ˜¯libï¼Œä½†æ˜¯GCCçš„é™æ€åº“æ–‡ä»¶æ˜¯.aæ–‡ä»¶ï¼ï¼ï¼å› æ­¤ï¼š</p>
<ul>
<li>åœ¨VS2022ç”Ÿæˆçš„libæ–‡ä»¶åœ¨GCCç¼–è¯‘å™¨ä¸‹ä¸å…¼å®¹ï¼Œå¦‚æœä½¿ç”¨gccé“¾æ¥libæ–‡ä»¶ï¼Œä¼šå‡ºç°â€œæ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å·â€è¿™æ ·çš„é”™è¯¯ã€‚</li>
<li>64ä½çš„libæ–‡ä»¶ä¹Ÿä¸32ä½ç¼–è¯‘å™¨ä¸å…¼å®¹ï¼ˆVSé‡Œé¢x64ç”Ÿæˆ64ä½ç¨‹åºï¼Œx86ç”Ÿæˆ32ä½ç¨‹åºï¼‰</li>
</ul>
<p>2ã€ç”±äºC++æ”¯æŒå‡½æ•°é‡è½½ï¼ˆæ”¯æŒåŒåå‡½æ•°ä¸åŒå‚æ•°ï¼‰ï¼Œæ•…å…¶å¯ç”¨äº†åç§°ä¿®é¥°ï¼ˆå³å¯¹å‡½æ•°åè¿›è¡Œä¿®é¥°ï¼‰ï¼Œå¯é€šè¿‡å·¥å…·-&gt;å‘½ä»¤è¡Œ-&gt;å¼€å‘è€…å‘½ä»¤æç¤ºï¼Œç„¶åè¾“å…¥</p>
<p><code>dumpbin /SYMBOLS åº“åå­—.lib</code>æŸ¥çœ‹å‡½æ•°åç§°ã€‚</p>
<img src="/posts/61633/image-20250705170230840.png" class="" title="image-20250705170230840">

<p>å¯ä»¥çœ‹åˆ°å¯ç”¨äº†åç§°ä¿®é¥°åå‡½æ•°åç§°å˜åŒ–äº†ã€‚è€ŒCä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œæ•…Cç¼–è¯‘å™¨é“¾æ¥æ­¤åº“æ—¶ä¼šå‡ºç°â€œæ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å·addâ€è¿™æ ·çš„é”™è¯¯ï¼Œc++ç¼–è¯‘å™¨èƒ½æ­£å¸¸é“¾æ¥ã€‚</p>
<p>ä¸ºäº†å…¼å®¹Cï¼Œæˆ‘ä»¬åœ¨å¤´æ–‡ä»¶éœ€è¦åŠ ä¸Šä¸€ä¸ªå£°æ˜ï¼Œå³extern â€œCâ€ï¼Œè¿™ä»£è¡¨æˆ‘éœ€è¦ä½¿ç”¨Cçš„æ–¹æ³•æ¥ç¼–è¯‘ï¼Œè¿™æ ·ç”Ÿæˆçš„åº“æ–‡ä»¶å°±æœªå¯ç”¨åç§°ä¿®é¥°ã€‚æ­¤æ—¶å‡½æ•°åç§°ï¼š</p>
<img src="/posts/61633/image-20250705171041271.png" class="" title="image-20250705171041271">

<p>è¿™ä¸ªåº“å¯è¢«Cå’ŒC++ä½¿ç”¨ï¼ˆä½†æ˜¯ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼‰</p>
<h1 id="åŠ¨æ€é“¾æ¥åº“"><a href="#åŠ¨æ€é“¾æ¥åº“" class="headerlink" title="åŠ¨æ€é“¾æ¥åº“"></a>åŠ¨æ€é“¾æ¥åº“</h1><h2 id="ç”Ÿæˆæ–¹æ³•ï¼š-1"><a href="#ç”Ÿæˆæ–¹æ³•ï¼š-1" class="headerlink" title="ç”Ÿæˆæ–¹æ³•ï¼š"></a>ç”Ÿæˆæ–¹æ³•ï¼š</h2><h3 id="æ­£å¸¸å¯¼å‡ºï¼š"><a href="#æ­£å¸¸å¯¼å‡ºï¼š" class="headerlink" title="æ­£å¸¸å¯¼å‡ºï¼š"></a>æ­£å¸¸å¯¼å‡ºï¼š</h3><p>åœ¨VS2022é‡Œé¢åˆ›å»ºåŠ¨æ€é“¾æ¥åº“é¡¹ç›®ï¼Œç¨‹åºä¸€æ ·ä¼šç”Ÿæˆ4ä¸ªæ–‡ä»¶ï¼Œä¸é™æ€é“¾æ¥åº“ä¸åŒçš„æ˜¯å¤´æ–‡ä»¶å’Œæºä»£ç æ–‡ä»¶ä¸åŒï¼š</p>
<p>dlltest.hï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">#endif</span><br><span class="line">	_declspec(dllexport) int __stdcall add(int a, int b);</span><br><span class="line">	_declspec(dllexport) int __stdcall sub(int a, int b);</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„extern â€œCâ€ä¹Ÿæ˜¯å£°æ˜ä½¿ç”¨Cè¯­è¨€çš„æ–¹å¼ç¼–è¯‘ï¼Œé˜²æ­¢C++åç§°ä¿®é¥°ï¼›è€Œ_declspec(dllexport)åˆ™æ˜¯å£°æ˜è¿™ä¸ªæ˜¯å¯¼å‡ºå‡½æ•°ï¼Œå¯ä»¥è¢«å…¶ä»–ç¨‹åºè°ƒç”¨ï¼›è¿™ä¸ªâ€stdcallâ€æ˜¯è°ƒç”¨çº¦å®šï¼Œä»£è¡¨è¢«è°ƒå‡½æ•°æ¸…ç†å †æ ˆï¼Œå¯ä»¥ä¸å¡«ï¼ˆé»˜è®¤æ˜¯cdeclï¼Œè°ƒç”¨è€…æ¸…ç†å †æ ˆï¼‰ï¼›</p>
<p>dlltest.cpp:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &quot;pch.h&quot;</span><br><span class="line">#include &quot;dlltest.h&quot;</span><br><span class="line"></span><br><span class="line">int __stdcall add(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">    return a+b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int __stdcall sub(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">    return a-b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆä¸€ä¸ªdllå’Œä¸€ä¸ªlibæ–‡ä»¶ã€‚</p>
<ul>
<li>dllæ–‡ä»¶ï¼šå¯¼å‡ºå‡½æ•°å®é™…å®ç°</li>
<li>libæ–‡ä»¶ï¼šè¿™ä¸ªä¸æ˜¯å‰é¢çš„é™æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œè€Œæ˜¯â€œå¯¼å…¥åº“â€æ–‡ä»¶ã€‚åœ¨ç¼–è¯‘é“¾æ¥æ—¶æä¾› DLL ä¸­å¯¼å‡ºå‡½æ•°çš„ç¬¦å·ä¿¡æ¯å’Œä½ç½®ã€‚ä»…ç”¨äºéšå¼é“¾æ¥ï¼ˆç®€åŒ–è°ƒç”¨æ–¹å¼ï¼‰ï¼Œç¼–è¯‘å®Œæˆåä¸å†éœ€è¦ã€‚</li>
</ul>
<h3 id="éšè—å‡½æ•°åå¯¼å‡ºï¼ˆåºå·å¯¼å‡ºï¼‰ï¼š"><a href="#éšè—å‡½æ•°åå¯¼å‡ºï¼ˆåºå·å¯¼å‡ºï¼‰ï¼š" class="headerlink" title="éšè—å‡½æ•°åå¯¼å‡ºï¼ˆåºå·å¯¼å‡ºï¼‰ï¼š"></a>éšè—å‡½æ•°åå¯¼å‡ºï¼ˆåºå·å¯¼å‡ºï¼‰ï¼š</h3><p>å…ˆåˆ›å»ºä¸€ä¸ª.defæ–‡ä»¶ï¼ˆå¯ä»¥é€šè¿‡æ”¹ååˆ›å»ºï¼‰ï¼Œç„¶åå¡«å…¥å¦‚ä¸‹æ ¼å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">EXPORTS			// è¿™ä¸€å¥ä¸€å®šè¦æœ‰</span><br><span class="line">add @1			// @1ä»£è¡¨åˆ†é…åºå·1ç»™add</span><br><span class="line">sub @2 NONAME   // NONAMEä»£è¡¨ä¸æš´éœ²å‡½æ•°åå­—ï¼Œå¦‚æœä½¿ç”¨äº†NONAMEå°±å¿…é¡»æŒ‡å®šåºå·ï¼Œå¦åˆ™ä¼šæŠ¥è¯­æ³•é”™è¯¯</span><br></pre></td></tr></table></figure>

<p>ç„¶åå³é”®é¡¹ç›®å-&gt;é¡¹ç›®å±æ€§ â†’ é“¾æ¥å™¨ â†’ è¾“å…¥ â†’ æ¨¡å—å®šä¹‰æ–‡ä»¶ï¼Œè¾“å…¥.defæ–‡ä»¶çš„åå­—ã€‚</p>
<p>å¯ä»¥é€šè¿‡åº”ç”¨dependsæ¥æŸ¥çœ‹dllä¿¡æ¯ï¼š</p>
<img src="/posts/61633/image-20250705221729314.png" class="" title="image-20250705221729314">

<p>å¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªå‡½æ•°åå­—è¢«éšè—äº†ã€‚è¿™ç§åªæœ‰åºå·çš„å‡½æ•°è¦æ˜¾ç¤ºé“¾æ¥æ¥ä½¿ç”¨ã€‚</p>
<p><strong>åºå·åˆ†é…é—®é¢˜ï¼š</strong></p>
<p>ç»è¿‡æˆ‘çš„æµ‹è¯•å‘ç°ï¼Œæœªä½¿ç”¨defæ–‡ä»¶æ˜¾ç¤ºåˆ†é…çš„å‡½æ•°ï¼Œä»–ä»¬çš„åºå·æ˜¯æŒ‰å‡½æ•°åç§°è‹±æ–‡å­—æ¯é¡ºåºæ¥æŒ‡å®šçš„ï¼Œä¸å‡½æ•°å‡ºç°é¡ºåºæ— å…³ï¼Œä¾‹å¦‚ï¼š</p>
<img src="/posts/61633/image-20250706154504704.png" class="" title="image-20250706154504704">

<p>å†æˆ–è€…ï¼š</p>
<img src="/posts/61633/image-20250706154647403.png" class="" title="image-20250706154647403">

<p>defæ–‡ä»¶é‡Œé¢æŒ‡å®šçš„åºå·ä¼˜å…ˆçº§æœ€é«˜ï¼Œè€Œä¸”ç¼–è¯‘å™¨é»˜è®¤åˆ†é…çš„åºå·ä»defæ˜¾å¼æŒ‡å®šåºå·çš„æœ€å°å€¼å¼€å§‹æŒ‡å®šã€‚ï¼ˆä¾‹å¦‚æˆ‘è¿™é‡ŒæŒ‡å®šäº†subæ˜¯2ï¼Œplusæ˜¯4ï¼‰</p>
<img src="/posts/61633/image-20250706155621606.png" class="" title="image-20250706155621606">

<h2 id="ä½¿ç”¨æ–¹æ³•ï¼š-1"><a href="#ä½¿ç”¨æ–¹æ³•ï¼š-1" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a>ä½¿ç”¨æ–¹æ³•ï¼š</h2><h3 id="ä¸€ã€éšå¼é“¾æ¥ï¼š"><a href="#ä¸€ã€éšå¼é“¾æ¥ï¼š" class="headerlink" title="ä¸€ã€éšå¼é“¾æ¥ï¼š"></a>ä¸€ã€éšå¼é“¾æ¥ï¼š</h3><p>Cè¯­è¨€ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib,&quot;dlltest.lib&quot;)</span><br><span class="line"></span><br><span class="line">_declspec(dllimport) int _stdcall add(int a, int b);</span><br><span class="line">_declspec(dllimport) int _stdcall sub(int a, int b);</span><br><span class="line">int main() &#123;</span><br><span class="line">	int a = 1, b = 3;</span><br><span class="line">	printf(&quot;%d&quot;, add(a, b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>C++ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib,&quot;dlltest.lib&quot;)</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; _declspec(dllimport) int _stdcall add(int a, int b);</span><br><span class="line">extern &quot;C&quot; _declspec(dllimport) int _stdcall sub(int a, int b);</span><br><span class="line">int main() &#123;</span><br><span class="line">	int a = 1, b = 3;</span><br><span class="line">	printf(&quot;%d&quot;, add(a, b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šCè¯­è¨€ä¸éœ€è¦ä¹Ÿä¸æ”¯æŒextern â€œCâ€å…³é”®å­—ï¼Œå› ä¸ºå®ƒé»˜è®¤å°±ä¸å­˜åœ¨åç§°ä¿®é¥°</p>
<p><strong>ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œå°†å‡½æ•°å£°æ˜å†™è¿›å»ï¼Œç„¶åå†åŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶</strong></p>
<h3 id="äºŒã€æ˜¾å¼é“¾æ¥"><a href="#äºŒã€æ˜¾å¼é“¾æ¥" class="headerlink" title="äºŒã€æ˜¾å¼é“¾æ¥"></a>äºŒã€æ˜¾å¼é“¾æ¥</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;Windows.h&gt;</span><br><span class="line"></span><br><span class="line">typedef int (*func)(int, int);  // å®šä¹‰å‡½æ•°æŒ‡é’ˆ</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	func Plus;</span><br><span class="line">	HINSTANCE hModule = LoadLibrary(TEXT(&quot;dlltest.dll&quot;));  //è½½å…¥dllï¼ŒTEXTå®ç¡®ä¿Unicodeå…¼å®¹æ€§</span><br><span class="line">	Plus = (func)GetProcAddress(hModule, &quot;add&quot;);   // è·å–å‡½æ•°åœ°å€ï¼ˆå‡½æ•°åå¯¼å…¥ï¼‰</span><br><span class="line">	// Plus = (func)GetProcAddress(hModule, MAKEINTRESOURCEA(1));  //é€šè¿‡åºå·å¯¼å…¥</span><br><span class="line">	int a = 1, b = 3;</span><br><span class="line">	printf(&quot;%d&quot;, Plus(a, b));</span><br><span class="line">	FreeLibrary(hModule);  // å¸è½½dll</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MAKEINTRESOURCEA(1)ï¼Œè¿™ä¸ªå®å°†æ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆï¼Œä½†è¯¥æŒ‡é’ˆå¹¶ä¸æŒ‡å‘çœŸæ­£çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å°†åºå·å€¼ç›´æ¥æ”¾åœ¨æŒ‡é’ˆå€¼ä¸­ã€‚ç”±äºWindowsç³»ç»Ÿåœ¨è§£ææ—¶ä¼šæ£€æŸ¥æŒ‡é’ˆçš„é«˜ä½æ˜¯å¦ä¸º0ï¼ˆå³æŒ‡é’ˆå€¼åœ¨0~65535ä¹‹é—´ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œå°±è®¤ä¸ºæ˜¯èµ„æºæ ‡è¯†ç¬¦ï¼ˆåºå·ï¼‰ï¼Œå¦åˆ™å°±æ˜¯å­—ç¬¦ä¸²æŒ‡é’ˆã€‚</p>
<h3 id="ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«ï¼š"><a href="#ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«ï¼š" class="headerlink" title="ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«ï¼š"></a>ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«ï¼š</h3><ol>
<li>éšå¼é“¾æ¥å¯åŠ¨æ—¶è½½å…¥æ‰€æœ‰dllï¼Œæ˜¾å¼é“¾æ¥åœ¨ç¨‹åºæ‰§è¡Œé˜¶æ®µï¼ŒæŒ‰ç¨‹åºéœ€è¦è½½å…¥dll</li>
<li>æ˜¾å¼é“¾æ¥çµæ´»ï¼Œå¯åœ¨ä½¿ç”¨å®Œåå¸è½½dllé‡Šæ”¾ç©ºé—´ï¼Œä¸”æ— éœ€å¯¼å…¥åº“</li>
</ol>
]]></content>
      <tags>
        <tag>PE</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‹›æ–°èµ›wp</title>
    <url>/posts/52115/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="HOOK"><a href="#HOOK" class="headerlink" title="HOOK"></a>HOOK</h1><h2 id="å‡ºé¢˜æµç¨‹"><a href="#å‡ºé¢˜æµç¨‹" class="headerlink" title="å‡ºé¢˜æµç¨‹"></a>å‡ºé¢˜æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">/*åˆå§‹åŒ–å‡½æ•°*/</span><br><span class="line">void rc4_init(unsigned char*s, unsigned char*key, unsigned long Len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0, j = 0;</span><br><span class="line">    unsigned char k[256] = &#123; 0 &#125;;</span><br><span class="line">    unsigned char tmp = 0;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        j = (j + s[i] + k[i]) % 256;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[i]å’Œs[j]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">/*åŠ è§£å¯†*/</span><br><span class="line">void rc4_crypt(unsigned char*s, unsigned char*Data, unsigned long Len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 1, j = 0, t = 0;  //å°†iåˆå§‹å€¼é­”æ”¹ä¸º1</span><br><span class="line">    unsigned long k = 0;</span><br><span class="line">    unsigned char tmp;</span><br><span class="line">    for (k = 0; k&lt;Len; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = (i + 1) % 256;</span><br><span class="line">        j = (j + s[i]) % 256;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[x]å’Œs[y]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t = (s[i] + s[j]) % 256;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int __cdecl encode(char str[])&#123;</span><br><span class="line">	unsigned char *s;</span><br><span class="line">	s=(unsigned char*)str;</span><br><span class="line">    for(int i=0;i&lt;28;i++)&#123;</span><br><span class="line">        for(int j=21;j&lt;40 ;j+=2)&#123;</span><br><span class="line">            if(s[i]&amp;1==1)</span><br><span class="line">                s[i]^=j;</span><br><span class="line">            else</span><br><span class="line">                s[i]^=j+2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 28;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	int i=0;</span><br><span class="line">	unsigned char data[]=&#123;0x52,0xd1,0xd4,0x40,0xad,0xf9,0xa7,0x75,0x67,0x11,0x25,0x83,0xcd,0x10,0x62,0x61,0xa6,0xb6,0x74,0x94,0x4f,0x6f,0xb3,0xdd,0x94,0x33,0xd3,0x8b&#125;;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½ çš„flag:&quot;);</span><br><span class="line">	unsigned char str[29];</span><br><span class="line">	scanf(&quot;%s&quot;,str);</span><br><span class="line">	int len=strlen((char*)str);</span><br><span class="line">	unsigned char s[256]=&#123;0&#125;;</span><br><span class="line">	unsigned char k[9]=&quot;Real-Key&quot;;</span><br><span class="line">	rc4_init(s,k,8);</span><br><span class="line">	rc4_crypt(s,str,len);</span><br><span class="line">//	encode1(str,28);</span><br><span class="line">	for(i=0;i&lt;len;i++)</span><br><span class="line">		if(str[i]!=data[i])&#123;</span><br><span class="line">			printf(&quot;wrong!\n&quot;);</span><br><span class="line">			return 0;</span><br><span class="line">		&#125;</span><br><span class="line">	printf(&quot;right!!!\n&quot;);</span><br><span class="line">	return 0;</span><br><span class="line">&#125; </span><br><span class="line">__attribute__((constructor)) void hook()&#123; </span><br><span class="line">		__asm__ __volatile__ (  //èŠ±æŒ‡ä»¤</span><br><span class="line">			&quot;jz 1f\n\t&quot;</span><br><span class="line">			&quot;jnz 1f\n\t&quot;</span><br><span class="line">			&quot;.byte 0x22\n\t&quot;</span><br><span class="line">			&quot;1:\n\t&quot;</span><br><span class="line">    		&quot;call 1f\n\t&quot;              // è°ƒç”¨å½“å‰æ ‡ç­¾ï¼ˆå‘åå¼•ç”¨ï¼‰</span><br><span class="line">    		&quot;.byte 0xe8\n\t&quot;           // æ’å…¥æœºå™¨ç 0xE8ï¼ˆcallæŒ‡ä»¤çš„Opcodeï¼‰</span><br><span class="line">    		&quot;1:\n\t&quot;                   // å®šä¹‰å±€éƒ¨æ ‡ç­¾</span><br><span class="line">    		&quot;add $8, (%%esp)\n\t&quot;     // </span><br><span class="line">    		&quot;.byte 0x36\n\t&quot;</span><br><span class="line">    		&quot;ret\n\t&quot;</span><br><span class="line">    		&quot;.byte 0xe8&quot;               // å†æ¬¡æ’å…¥0xE8</span><br><span class="line">    		:                          // æ— è¾“å‡ºæ“ä½œæ•°</span><br><span class="line">    		:                          // æ— è¾“å…¥æ“ä½œæ•°</span><br><span class="line">    		: &quot;memory&quot;, &quot;esp&quot;, &quot;cc&quot;    // å£°æ˜ç ´ååˆ—è¡¨ï¼šå†…å­˜ã€æ ˆæŒ‡é’ˆã€æ ‡å¿—å¯„å­˜å™¨</span><br><span class="line">		);</span><br><span class="line">        // æ­¥éª¤4ï¼šå–æ¶ˆå‡½æ•°åœ°å€ä¿æŠ¤</span><br><span class="line">        DWORD oldProtect;  // æ—§ä¿æŠ¤å±æ€§</span><br><span class="line">        VirtualProtect((LPVOID)strlen,0x1000,PAGE_EXECUTE_READWRITE,&amp;oldProtect);</span><br><span class="line"></span><br><span class="line">        // æ­¥éª¤5ï¼šè·å–è‡ªå®šä¹‰å‡½æ•°åœ°å€</span><br><span class="line">        byte* funcAddr = (byte*)encode;</span><br><span class="line">        byte* strlen_add = (byte*)strlen;</span><br><span class="line"></span><br><span class="line">        // æ­¥éª¤6ï¼šè·³è½¬åˆ°è‡ªå®šä¹‰å‡½æ•°</span><br><span class="line">        __asm__ __volatile__ (</span><br><span class="line">    		&quot;movl %0, %%eax \n\t&quot;</span><br><span class="line">		    &quot;movl %1, %%ebx \n\t&quot;</span><br><span class="line">		    &quot;subl %%eax, %%ebx \n\t&quot;</span><br><span class="line">		    &quot;subl $5, %%ebx \n\t&quot;</span><br><span class="line">		    &quot;movb $0xe9, (%%eax) \n\t&quot;</span><br><span class="line">		    &quot;movl %%ebx, 1(%%eax)&quot;</span><br><span class="line">		    : /* æ— è¾“å‡ºæ“ä½œæ•° */</span><br><span class="line">		    : &quot;r&quot; (strlen_add), &quot;r&quot; (funcAddr)  // è¾“å…¥æ“ä½œæ•°</span><br><span class="line">		    : &quot;eax&quot;, &quot;ebx&quot;, &quot;memory&quot;            // ç ´ååˆ—è¡¨</span><br><span class="line">		);</span><br><span class="line">         DWORD floadprotect;</span><br><span class="line">         VirtualProtect((LPVOID)strlen,0x1000,oldProtect,&amp;floadprotect);</span><br><span class="line">&#125;æ³¨ï¼šæ­¤ä»£ç å†…è”æ±‡ç¼–æ˜¯å¯¹32ä½å¯„å­˜å™¨æ“ä½œï¼Œå› æ­¤åªèƒ½ä½¿ç”¨32ä½ç¼–è¯‘å™¨ç¼–è¯‘</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š</p>
<p>ç¬¬ä¸€éƒ¨åˆ†ï¼šé­”æ”¹çš„RC4ï¼Œå°†åŠ å¯†éƒ¨åˆ†çš„iåˆå§‹é­”æ”¹ä¸º1</p>
<p>ç¬¬äºŒéƒ¨åˆ†ï¼šhook strcmpå‡½æ•°ï¼Œä½¿ç”¨GCCæ‰©å±•å±æ€§__attribute__((constructor))å°†hookå‡½æ•°æ ‡è®°ä¸ºå…¨å±€å‡½æ•°ï¼Œå…ˆäºmainå‡½æ•°æ‰§è¡Œ</p>
<p><strong>æ³¨ï¼šä¸‰ç§ä½¿å‡½æ•°å…ˆäºmainå‡½æ•°æ‰§è¡Œçš„æ–¹æ³•ï¼š</strong></p>
<p>1ã€TLSå‡½æ•°</p>
<p>2ã€ä½¿ç”¨GCCæ‰©å±•å±æ€§__attribute__((constructor))ï¼Œä½¿ç”¨æ–¹æ³•ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">__attribute__((constructor)) void function()</span><br></pre></td></tr></table></figure>

<p>3ã€ä½¿ç”¨å…¨å±€å˜é‡è°ƒç”¨å‡½æ•°ï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int function()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">int a=function();</span><br><span class="line">int main()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè¿™æ®µä»£ç å¾—åˆ°çš„exeæ–‡ä»¶ï¼Œæˆ‘å†ç”¨å¦ä¸€ç§æ–¹å¼hookï¼ˆæ‰‹åŠ¨hookï¼‰ï¼Œå³åˆ©ç”¨xdbgä¿®æ”¹hookå‡½æ•°å¼€å¤´å‡ ä¸ªå­—èŠ‚ï¼Œä½¿å…¶è·³è½¬åˆ°ä¸€ä¸ªç©ºç™½å¤„ï¼Œå†åœ¨ç©ºç™½å¤„å†™å…¥è¢«è¦†ç›–çš„ä»£ç ï¼Œæœ€åè·³å›hookå‡½æ•°ï¼š</p>
<img src="/posts/52115/image-20250425205801010.png" class="" title="image-20250425205801010">

<img src="/posts/52115/image-20250425210041906.png" class="" title="image-20250425210041906">

<p>è¿™æ ·åšçš„ç›®çš„ï¼Œå°±æ˜¯è®©IDAåˆ†æçš„hookå‡½æ•°æ˜¯æ–­å¼€çš„ï¼Œä»è€Œæ— æ³•åç¼–è¯‘ä¸ºä¼ªä»£ç ï¼Œå¢åŠ åˆ†æéš¾åº¦ã€‚</p>
<p>æœ€åï¼Œä½¿ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strip +æ–‡ä»¶å</span><br></pre></td></tr></table></figure>

<p>æŠŠæ–‡ä»¶ç¬¦å·è¡¨å»é™¤ï¼Œè¿™æ ·å‡½æ•°åå°±ä¸ä¼šæ˜¯â€œhookâ€ï¼Œå°±å¾—ä¸åˆ°æç¤ºã€‚</p>
<p>æœ€åhookå‡½æ•°çš„æ•ˆæœğŸ¥±:</p>
<img src="/posts/52115/image-20250425210918537.png" class="" title="image-20250425210918537">

<h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><p>æ‰“å¼€è§‚å¯Ÿmainå‡½æ•°</p>
<img src="/posts/52115/image-20250425211345949.png" class="" title="image-20250425211345949">

<p>æ˜¯ä¸€ä¸ªé­”æ”¹çš„rc4åŠ å¯†ï¼Œé­”æ”¹çš„æ˜¯åŠ å¯†éƒ¨åˆ†çš„ç´¢å¼•åˆå§‹å€¼</p>


<p>è§£å¯†ä¼šå‘ç°å¾—åˆ°çš„å¹¶éflagï¼Œè€Œæ˜¯ä¸€ä¸²ä¹±ç ã€‚é€»è¾‘çœ‹èµ·æ¥ç¡®å®ä¹Ÿå¾ˆç®€å•ï¼Œå¹¶æ²¡æœ‰å‡ºç°å…¶ä»–åŠ å¯†ã€‚è¿™ä¸ªæ—¶å€™å°±è¦çŒœæ˜¯ä¸æ˜¯æœ‰å‡½æ•°è¢«hookäº†ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œhookå‡½æ•°éƒ½è¦å¼•ç”¨è¢«Hookçš„å‡½æ•°ï¼Œå› æ­¤å¯ä»¥é€šè¿‡äº¤å‰å¼•ç”¨åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦è¢«hookã€‚å¯¹strlenå‡½æ•°äº¤å‰å¼•ç”¨ï¼š</p>
<img src="/posts/52115/image-20250425212547314.png" class="" title="image-20250425212547314">

<p>ç¬¬ä¸€ä¸ªåˆ—å‡ºçš„å‡½æ•°æ˜¯å¯åŠ¨å‡½æ•°ï¼Œç³»ç»Ÿè‡ªå¸¦çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬åˆ†æï¼›åé¢å‡ è¡Œæœ‰ç‚¹å¥‡æ€ªï¼Œè·Ÿè¿›å»çœ‹çœ‹ï¼š</p>
<img src="/posts/52115/image-20250425213138620.png" class="" title="image-20250425213138620">

<p>é¦–å…ˆå®šä½æ±‡ç¼–ä»£ç ï¼Œæœ‰vitualprotectå‡½æ•°å’Œstrlenå‡½æ•°ï¼Œè¯´æ˜å¾ˆå¯èƒ½ä½¿ç”¨äº†Inline hookã€‚æƒ³è¦åç¼–è¯‘ä»£ç ï¼Œä½†æ˜¯å‡½æ•°å¼€å¤´æ—¢æœ‰èŠ±æŒ‡ä»¤åˆæœ‰ä¸€ä¸ªè«åå¥‡å¦™çš„jmp</p>
<img src="/posts/52115/image-20250425213356338.png" class="" title="image-20250425213356338">

<p>è·Ÿè¿›è¿™ä¸ªsub_401B43çœ‹çœ‹</p>
<img src="/posts/52115/image-20250425213536378.png" class="" title="image-20250425213536378">

<p>è¿™ä¸ªå‡½æ•°å¼€å¤´æ˜¯æ­£å¸¸çš„æ ˆå¸§è°ƒç”¨ï¼Œç„¶åé¢„ç•™å±€éƒ¨å˜é‡ç©ºé—´ï¼Œæœ€åè·³è½¬åˆ°4019E2åœ°å€å¤„ï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯ä¸Šé¢4019DDå‡½æ•°jmpåçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªInline hookï¼Œåªä¸è¿‡è¿™ä¸ªæ˜¯æ‰‹åŠ¨çš„ï¼Œä½œç”¨å°±æ˜¯æŠŠ4019DDå‡½æ•°ä¸€åˆ†ä¸ºäºŒï¼Œå¯¼è‡´IDAæ— æ³•è¯†åˆ«å‡½æ•°ååŠæ®µã€‚</p>
<p>ç¨‹åºæµç¨‹å›¾ä¸ºï¼š</p>
<img src="/posts/52115/image-20250425214525222.png" class="" title="image-20250425214525222">

<p>æƒ³è¦IDAé‡æ–°æ­£ç¡®è¯†åˆ«ï¼Œå¯ä»¥åœ¨xdbgé‡Œé¢ä¿®æ”¹ï¼Œä¹Ÿå¯ç›´æ¥åœ¨IDAé‡Œé¢ä¿®æ”¹ï¼Œè¿™é‡Œé€‰æ‹©åœ¨IDAé‡Œé¢ä¿®æ”¹ï¼š</p>
<p>1ã€å…ˆæŠŠæ±‡ç¼–æŒ‡ä»¤æå–å‡ºæ¥ï¼š</p>
<img src="/posts/52115/image-20250425214845634.png" class="" title="image-20250425214845634">

<p>2ã€å³é”®-&gt;pathing-&gt;change bytesï¼ŒæŠŠåˆšæ‰å¤åˆ¶çš„ç¡¬ç¼–ç ç²˜è´´ä¸Šå»ï¼ŒæŠŠä»jmpä¸€ç›´åˆ°ç¨‹åºå›æ¥çš„ä½ç½®çš„æ•°æ®è¦†ç›–æ‰</p>
<img src="/posts/52115/image-20250425215005936.png" class="" title="image-20250425215005936">

<img src="/posts/52115/image-20250425215339751.png" class="" title="image-20250425215339751">

<p>æ¥ä¸‹æ¥å»èŠ±æŒ‡ä»¤ï¼Œä¸€å…±æœ‰ä¸¤ä¸ªèŠ±æŒ‡ä»¤ï¼š</p>
<p>ç¬¬ä¸€ä¸ªï¼š</p>
<img src="/posts/52115/image-20250425220627820.png" class="" title="image-20250425220627820">

<p>ç¬¬äºŒä¸ªï¼š</p>




<img src="/posts/52115/image-20250425220947082.png" class="" title="image-20250425220947082">

<p>å¾—åˆ°ä¼ªä»£ç </p>
<img src="/posts/52115/image-20250425221612166.png" class="" title="image-20250425221612166">

<p>è¿™é‡Œæ˜¯æŠŠstrlenå‡½æ•°hookä¸ºäº†sub_401718å‡½æ•°ï¼Œè·Ÿè¿›å»çœ‹çœ‹ï¼š</p>
<img src="/posts/52115/image-20250425221706733.png" class="" title="image-20250425221706733">

<p>è¿™ä¸ªåŠ å¯†å‡½æ•°çœ‹èµ·æ¥æŒºç®€å•ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å®¹æ˜“ï¼Œå®ƒæ¯ä¸€æ¬¡æ ¹æ®æ•°æ®çš„å¥‡å¶æ€§æ¥å†³å®šï¼Œå¼‚æˆ–çš„ç›®æ ‡ã€‚çœ‹èµ·æ¥æˆ‘ä»¬æ ¹æ®åŠ å¯†åçš„æ•°æ®æ— æ³•åˆ¤æ–­ä»–åˆ°åº•æ˜¯èµ°äº†å“ªæ¡è·¯å¾„ï¼Œé‚£å°±æ— æ³•é€†å‘ï¼ˆå½“ç„¶ï¼Œçˆ†ç ´ä¹Ÿè¡Œï¼‰ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œjæ¯ä¸€æ¬¡å¾ªç¯éƒ½æ˜¯å¥‡æ•°ï¼Œj+2ä¹Ÿæ˜¯å¥‡æ•°ï¼Œå¥‡æ•°^å¥‡æ•°&#x3D;å¶æ•°ï¼Œå¶æ•°^å¥‡æ•°&#x3D;å¥‡æ•°ã€‚å‡å¦‚æ•°æ®åŠ å¯†å‰æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆåŠ å¯†åä¼šå˜ä¸ºå¶æ•°ï¼›å‡å¦‚æ•°æ®åŠ å¯†å‰æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆåŠ å¯†åå˜ä¸ºå¥‡æ•°ã€‚åè¿‡æ¥å‡å¦‚åŠ å¯†åæ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆåŠ å¯†å‰æ˜¯å¶æ•°ï¼Œä¸j+2å¼‚æˆ–å¾—åˆ°åŠ å¯†å‰çš„æ•°æ®ï¼›å¦‚æœåŠ å¯†åæ˜¯å¶æ•°ï¼Œé‚£ä¹ˆåŠ å¯†å‰æ˜¯å¥‡æ•°ï¼Œä¸jå¼‚æˆ–å¾—åˆ°åŠ å¯†å‰çš„æ•°æ®ã€‚</p>
<p>è§£å¯†ä»£ç ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">void rc4_init(unsigned char*s, unsigned char*key, unsigned long Len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0, j = 0;</span><br><span class="line">    unsigned char k[256] = &#123; 0 &#125;;</span><br><span class="line">    unsigned char tmp = 0;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        j = (j + s[i] + k[i]) % 256;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[i]å’Œs[j]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">void rc4_crypt(unsigned char*s, unsigned char*Data, unsigned long Len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 1, j = 0, t = 0;  //å°†iåˆå§‹å€¼é­”æ”¹ä¸º1</span><br><span class="line">    unsigned long k = 0;</span><br><span class="line">    unsigned char tmp;</span><br><span class="line">    for (k = 0; k&lt;Len; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = (i + 1) % 256;</span><br><span class="line">        j = (j + s[i]) % 256;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[x]å’Œs[y]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t = (s[i] + s[j]) % 256;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">void decode1(unsigned char s[],int len)&#123;</span><br><span class="line">    for(int i=0;i&lt;len;i++)&#123;</span><br><span class="line">        for(int j=39;j&gt;20;j-=2)&#123;</span><br><span class="line">            if(s[i]&amp;1==1)</span><br><span class="line">                s[i]^=j+2;</span><br><span class="line">            else</span><br><span class="line">                s[i]^=j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    unsigned char flag[]=&#123;0x52,0xd1,0xd4,0x40,0xad,0xf9,0xa7,0x75,0x67,0x11,0x25,0x83,0xcd,0x10,0x62,0x61,0xa6,0xb6,0x74,0x94,0x4f,0x6f,0xb3,0xdd,0x94,0x33,0xd3,0x8b&#125;;</span><br><span class="line">    int len=28;</span><br><span class="line">    unsigned char key[]=&quot;Real-Key&quot;;</span><br><span class="line">    unsigned char s[256]=&#123;0&#125;;</span><br><span class="line">    rc4_init(s,key,8);  </span><br><span class="line">    rc4_crypt(s,flag,28); </span><br><span class="line">    int i;</span><br><span class="line">    decode1(flag,len);</span><br><span class="line">    for(i=0;i&lt;28;i++)&#123;</span><br><span class="line">		printf(&quot;%c&quot;,flag[i]);</span><br><span class="line">	&#125; </span><br><span class="line">&#125;//FCTF&#123;dasgygfushfhihsfhsufbj&#125;</span><br></pre></td></tr></table></figure>

<h1 id="poetry"><a href="#poetry" class="headerlink" title="poetry"></a>poetry</h1><h2 id="æºä»£ç ï¼š"><a href="#æºä»£ç ï¼š" class="headerlink" title="æºä»£ç ï¼š"></a>æºä»£ç ï¼š</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line">#include &lt;debugapi.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">// æ£€æŸ¥æ˜¯å¦ä¸ºUTF-8æ±‰å­—çš„é¦–å­—èŠ‚</span><br><span class="line">int is_chinese(unsigned char c) &#123;</span><br><span class="line">    return (c &gt;= 0xE4 &amp;&amp; c &lt;= 0xE9);  // å¯¹åº”ä¸‰å­—èŠ‚ç¼–ç çš„æ±‰å­—é¦–å­—èŠ‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ£€æŸ¥æ˜¯å¦ä¸ºUTF-8æ ¼å¼çš„æ±‰å­—å¥å·ï¼ˆ0xE3 0x80 0x82ï¼‰</span><br><span class="line">int is_period(const unsigned char* buf, int pos) &#123;</span><br><span class="line">    return (buf[pos] == 0xE3 &amp;&amp; buf[pos+1] == 0x80 &amp;&amp; buf[pos+2] == 0x82);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int file_operation(char key[]) &#123;</span><br><span class="line">    unsigned char data[]=&#123;0xa3,0xcb,0xff,0xae,0xb8,0xb2,0xd5,0xb6&#125;;</span><br><span class="line"></span><br><span class="line">    // è¯»å–æ–‡ä»¶å†…å®¹</span><br><span class="line">    FILE* fp = fopen(&quot;poetry.txt&quot;, &quot;rb&quot;);</span><br><span class="line">    if (!fp) &#123;</span><br><span class="line">        perror(&quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥&quot;);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fseek(fp, 0, SEEK_END);//å°†æŒ‡é’ˆè®¾ç½®åˆ°æ–‡ä»¶å°¾</span><br><span class="line">    long size = ftell(fp);//è·å–æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">    fseek(fp, 0, SEEK_SET);//æŒ‡é’ˆé‡æ–°è®¾ç½®å›æ–‡ä»¶å¤´</span><br><span class="line"></span><br><span class="line">    unsigned char* buf = (unsigned char*)malloc(size + 1);</span><br><span class="line">    fread(buf, 1, size, fp);</span><br><span class="line">    buf[size] = &#x27;\0&#x27;;</span><br><span class="line">    fclose(fp);</span><br><span class="line"></span><br><span class="line">    // å¤„ç†å†…å®¹</span><br><span class="line">    char result[size * 3 + 1];  // é¢„åˆ†é…æœ€å¤§å¯èƒ½ç©ºé—´</span><br><span class="line">    int result_len = 0;</span><br><span class="line">    int count=0;</span><br><span class="line"></span><br><span class="line">    //æ¥ä¸‹æ¥è¿™æ®µå…¶å®å°±æ˜¯è¯»å–æ–‡ä»¶ä¸­æ¯ä¸€ä¸ª&quot;ã€‚&quot;å‰çš„ä¸€ä¸ªæ±‰å­—ã€‚utf-8é‡Œæ±‰å­—å 3ä¸ªå­—èŠ‚</span><br><span class="line">    for (int i = 0; i &lt; size; ) &#123;</span><br><span class="line">        // æ£€æµ‹å¥å·ï¼ˆ3å­—èŠ‚ï¼‰</span><br><span class="line">        if(count==300) break;//é˜²æ­¢åŠ¨è°ƒæ—¶æ­»å¾ªç¯</span><br><span class="line">        if (i &lt;= size - 3 &amp;&amp; is_period(buf, i)) &#123;//æ£€æµ‹å¥å·</span><br><span class="line">            // å‘å‰æŸ¥æ‰¾æ±‰å­—ï¼ˆ3å­—èŠ‚ï¼‰</span><br><span class="line">            if (i &gt;= 3 &amp;&amp; is_chinese(buf[i-3])) &#123;</span><br><span class="line">                memcpy(result + result_len, &amp;buf[i-3], 3);</span><br><span class="line">                result_len += 3;</span><br><span class="line">            &#125;</span><br><span class="line">            i += 3;  // è·³è¿‡å¥å·</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            i+=1^IsDebuggerPresent();//åè°ƒè¯•ï¼šåœ¨åŠ¨è°ƒæ—¶iä¸å˜ï¼Œä¸åœ¨åŠ¨è°ƒi++</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    result[result_len] = &#x27;\0&#x27;;</span><br><span class="line">    for(int i=0;i&lt;8;i++)</span><br><span class="line">        if(((unsigned char)key[i]^(unsigned char)result[i])!=data[i])</span><br><span class="line">            exit(0);</span><br><span class="line">    free(buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">void tea_encrypt(uint32_t* v,uint32_t* key)</span><br><span class="line">&#123;</span><br><span class="line">	uint32_t k0,k1,k2,k3;</span><br><span class="line">	uint32_t v0,v1;</span><br><span class="line">	v0=v[0],v1=v[1];</span><br><span class="line">	k0=key[0],k1=key[1],k2=key[2],k3=key[3];</span><br><span class="line">	uint32_t delta=0x9E3779B9,sum=0;</span><br><span class="line">	for(int i=0;i&lt;32;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v0+=((v1&lt;&lt;4) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;5) + k1);</span><br><span class="line">		v1+=((v0&lt;&lt;4) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;5) + k3); </span><br><span class="line">	&#125;</span><br><span class="line">	v[0]=v0,v[1]=v1;</span><br><span class="line">&#125;</span><br><span class="line">void rc4_init(unsigned char*s, char* key)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0, j = 0;</span><br><span class="line">    unsigned char k[256] = &#123; 0 &#125;;</span><br><span class="line">    unsigned char tmp = 0;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = (unsigned char)key[i%8];</span><br><span class="line">    &#125;</span><br><span class="line">    for (i = 0; i&lt;256; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        j = (j + s[i] + k[i]) % 256;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[i]å’Œs[j]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">/*åŠ è§£å¯†*/</span><br><span class="line">void rc4_crypt(char* key,unsigned char*key2,  unsigned long Len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0, j = 0, t = 0;</span><br><span class="line">    unsigned long k = 0;</span><br><span class="line">    unsigned char tmp;</span><br><span class="line">    unsigned char s[256];</span><br><span class="line">    rc4_init(s,key);</span><br><span class="line">    for(k = 0; k&lt;16; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = (i + 1) % 256;</span><br><span class="line">        j = (j + s[i]) % 256;</span><br><span class="line">        tmp = s[i]^IsDebuggerPresent();</span><br><span class="line">        s[i] = s[j];//äº¤æ¢s[x]å’Œs[y]</span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t = (s[i] + s[j]) % 256;</span><br><span class="line">        key2[k] = s[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    printf(&quot;Hello, Comrade!!!\n&quot;);</span><br><span class="line">    printf(&quot;Please enter your key and start the struggle!!!\n&quot;);</span><br><span class="line">    char key[9];</span><br><span class="line">    scanf(&quot;%s&quot;,key);</span><br><span class="line">    file_operation(key);  //éªŒè¯key</span><br><span class="line">    printf(&quot;please input your flag:\n&quot;);</span><br><span class="line">    char flag[49];</span><br><span class="line">    scanf(&quot;%s&quot;,flag);</span><br><span class="line">    unsigned char key2[16];</span><br><span class="line">    rc4_crypt(key,key2,20);  //åˆ©ç”¨rc4åŠ å¯†ç”Ÿæˆä¸€ä¸ªæ–°çš„key</span><br><span class="line">    //æ¥ä¸‹æ¥æ˜¯SMC</span><br><span class="line">	int n; DWORD floadprotect;</span><br><span class="line">	byte* funcAddr = (byte*)tea_encrypt;//å‡½æ•°åœ°å€</span><br><span class="line">	VirtualProtect(&amp;tea_encrypt, 0xDF, PAGE_EXECUTE_READWRITE, &amp;floadprotect);//ç¬¬äºŒä¸ªå‚æ•°ä¸ºå¤§å°,</span><br><span class="line">	for (int i = 0; i &lt; 0xDF; i++)//è§£å¯†æ“ä½œ ä¹Ÿéœ€è¦ä¿®æ­£å¤§å° è¿™é‡Œæ˜¯ä¿®æ­£åçš„</span><br><span class="line">		funcAddr[i] ^= 0x12;</span><br><span class="line">    for(int i=0;i&lt;48;i+=8)&#123;</span><br><span class="line">        tea_encrypt((uint32_t*)&amp;flag[i],(uint32_t*)key2); //teaåŠ å¯†</span><br><span class="line">    &#125;</span><br><span class="line">    unsigned char data[]=&#123;0x91,0xe5,0x27,0x31,0x2d,0x8c,0xf1,0x61,0x2,0xd8,0xf6,0xea,0xb4,</span><br><span class="line">                          0xba,0xf,0x2,0x97,0x22,0xa8,0x1a,0x1c,0xca,0x83,0x28,0xb1,0x3c,</span><br><span class="line">                          0x67,0x33,0xef,0x25,0x57,0x82,0x7f,0xc,0xac,0xf1,0x89,0xf6,0x45,</span><br><span class="line">                          0xae,0x49,0x53,0x3a,0xee,0x92,0xdd,0xb,0x48&#125;;</span><br><span class="line">    for(int i=0;i&lt;48;i++)&#123;</span><br><span class="line">        if((unsigned char)flag[i]!=data[i])</span><br><span class="line">        &#123;</span><br><span class="line">            printf(&quot;wrong!!!&quot;);</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;right!!!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è§£é¢˜-1"><a href="#è§£é¢˜-1" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><p>æŸ¥æ‰¾å­—ç¬¦ä¸²å®šä½åˆ°ä¸»å‡½æ•°</p>
<img src="/posts/52115/image-20250606232108750.png" class="" title="image-20250606232108750">

<p>æŸ¥çœ‹file_operationå‡½æ•°</p>


<p>è¿™ä¸ªåè°ƒè¯•ä¸ä¼šç›´æ¥é€€å‡ºï¼Œè€Œæ˜¯åœ¨æ£€æµ‹åˆ°è°ƒè¯•çŠ¶æ€æ—¶ä½¿v10+&#x3D;0ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥æ­»å¾ªç¯ï¼Œè¿™æ ·åé¢å°±æ²¡åŠæ³•é€šè¿‡keyçš„æ£€éªŒã€‚å‰é¢ä¸€æ®µæ“ä½œæ˜¯ï¼šä»¥äºŒè¿›åˆ¶å½¢å¼è¯»å–æ–‡ä»¶ï¼Œè·å–æ¯ä¸€ä¸ªå¥å·å‰çš„ä¸€ä¸ªæ±‰å­—ï¼Œå°†å¾—åˆ°çš„æ±‰å­—æ‹¼æ¥ä¸ºä¸€ä¸ªæ•°ç»„ï¼ˆä¸€ä¸ªæ±‰å­—å 3ä¸ªå­—èŠ‚ï¼‰ã€‚å°†æ•°ç»„ä¸è¾“å…¥çš„keyè¿›è¡Œå¼‚æˆ–ï¼Œå¼‚æˆ–ç»“æœä¸æ•°æ®è¿›è¡Œæ¯”è¾ƒã€‚ç”±äºè¿è¡Œåˆ°ç¬¬49è¡Œæ—¶12å­—èŠ‚æ•°ç»„å·²ç»ç¡®å®šï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åŠ¨è°ƒè·å–ã€‚åŠ¨è°ƒå‰å¯ä»¥é‡‡ç”¨keypatchç»•è¿‡åè°ƒè¯•ï¼š</p>
<img src="/posts/52115/image-20250525012703047.png" class="" title="image-20250525012703047">

<p>è¿™é‡Œæ±‡ç¼–ä»£ç çš„xor eax,1 å…¶å®å°±å¯¹åº”!IsDebuggerPresent()ï¼Œå› ä¸ºeaxå¯„å­˜å™¨å­˜ç€å‡½æ•°è¿”å›å€¼ï¼Œåœ¨åŠ¨è°ƒå°±è¿”å›1ï¼Œ1ä¸1å¼‚æˆ–ç­‰äº0ï¼Œä¹Ÿå°±æ˜¯v10+&#x3D;0ï¼Œè¿›å…¥æ— é™å¾ªç¯ã€‚æƒ³è¦ç»•è¿‡åè°ƒè¯•ï¼Œå¯ä»¥keypatchæŠŠ1æ”¹ä¸º0ï¼Œè¿™æ ·åœ¨è°ƒè¯•æ—¶å°±ä¸ä¼šè¿›å…¥æ— é™å¾ªç¯ã€‚å³é”®-&gt;keypatch</p>
<img src="/posts/52115/image-20250525013209303.png" class="" title="image-20250525013209303">

<p>ç‚¹patchï¼Œç„¶åedit-&gt;patch program-&gt;apply patches toâ€¦ã€‚ç„¶åå¼€å§‹åŠ¨è°ƒè·å–æ•°ç»„v4çš„å€¼ï¼ˆè·å–å‰8å­—èŠ‚å°±è¡Œï¼‰ï¼š</p>
<img src="/posts/52115/image-20250606233149284.png" class="" title="image-20250606233149284">

<p>è¿™ä¸ªæ•°ç»„ä¸æ˜æ–‡å¼‚æˆ–å¯ä»¥å¾—åˆ°å¯†é’¥ï¼šFCTF2025</p>
<p>å›åˆ°ä¸»å‡½æ•°	</p>
<img src="/posts/52115/image-20250606233507807.png" class="" title="image-20250606233507807">

<p>è¿™é‡Œrc4ä¼ å…¥è¾“å…¥çš„å¯†é’¥ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¯†é’¥v3ï¼Œç„¶åæŠŠv3ä¼ å…¥loc_7FF7940217CFå‡½æ•°ã€‚rc4å‡½æ•°è¿™é‡Œæœ‰ä¸€ä¸ªåè°ƒè¯•ï¼š</p>
<img src="/posts/52115/image-20250527090453821.png" class="" title="image-20250527090453821">

<p>çœ‹æ±‡ç¼–æ®µï¼š</p>
<img src="/posts/52115/image-20250527090518668.png" class="" title="image-20250527090518668">

<p>è¿™é‡Œåè°ƒè¯•é€»è¾‘å°±æ˜¯ï¼Œå½“ä¸åœ¨è°ƒè¯•çŠ¶æ€æ—¶ï¼ŒIsDebuggerPresent()è¿”å›0ï¼Œ0ä¸ä»»ä½•æ•°å¼‚æˆ–ç­‰äºåŸæ•°ï¼›å¦‚æœåœ¨è°ƒè¯•çŠ¶æ€ï¼Œé‚£ä¹ˆIsDebuggerPresent()è¿”å›1ï¼Œä¸1å¼‚æˆ–ä¼šå¯¼è‡´å€¼æ”¹å˜ã€‚æ±‡ç¼–é‡Œé¢eaxå­˜IsDebuggerPresent()å‡½æ•°è¿”å›å€¼ï¼Œ140001B16å¤„å¦‚æœç›´æ¥åŠ mov eax,1ç”±äºæŒ‡ä»¤å¤§å°ä¸º5å­—èŠ‚ï¼Œå¤§äºåŸæŒ‡ä»¤xor eax,ebxï¼ˆ2å­—èŠ‚ï¼‰ï¼Œä¼šè¦†ç›–æ‰åé¢çš„æŒ‡ä»¤ï¼Œæ‰€ä»¥è¦é€‰æ‹©ä¸¤å­—èŠ‚çš„æŒ‡ä»¤ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©æ”¹ä¸ºmov eax,ebxï¼š</p>
<img src="/posts/52115/image-20250527091813146.png" class="" title="image-20250527091813146">

<p>ä¸€æ ·ï¼Œè¦è®°å¾—ä¿å­˜ã€‚loc_7FF7940217CFå‡½æ•°ä½¿ç”¨äº†SMCéšè—ã€‚åŠ¨è°ƒä¿®å¤å‡½æ•°ï¼ŒåŒæ—¶è·å–ç»è¿‡rc4åŠ å¯†åçš„æ–°å¯†é’¥ï¼ˆè¿™é‡Œkeyè¾“å…¥åˆšæ‰å¾—åˆ°çš„FCTF2025ï¼‰ï¼š</p>
<p>æ–°å¯†é’¥ï¼š</p>
<img src="/posts/52115/image-20250525014624013.png" class="" title="image-20250525014624013">

<p>ä¿®å¤åçš„å‡½æ•°ï¼š</p>
<img src="/posts/52115/image-20250525014757066.png" class="" title="image-20250525014757066">

<p>æ˜¯ä¸€ä¸ªteaåŠ å¯†ï¼Œè¿™é‡Œ0x61C88647å®é™…ä¸Šæ˜¯0x9E3779B9çš„åç ï¼Œæ‰€ä»¥-0x61C88647å®é™…ä¸Šå°±æ˜¯+0x9E3779B9ã€‚è§£å¯†è„šæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt; </span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">void decrypt(uint32_t* v,uint32_t* key)</span><br><span class="line">&#123;</span><br><span class="line">	uint32_t k0,k2,k3,k1;</span><br><span class="line">	uint32_t v0,v1;</span><br><span class="line">	v0=v[0],v1=v[1];</span><br><span class="line">	k0=key[0],k1=key[1],k2=key[2],k3=key[3];</span><br><span class="line">	uint32_t delta=0x9E3779B9,sum=0x9E3779B9*32;</span><br><span class="line">	for(int i=0;i&lt;32;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		v1-=((v0&lt;&lt;4) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;5) + k3);</span><br><span class="line">		v0-=((v1&lt;&lt;4) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;5) + k1);</span><br><span class="line">		sum-=delta;</span><br><span class="line">	&#125;</span><br><span class="line">	v[0]=v0,v[1]=v1;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	unsigned char s[]=&#123;0x91,0xe5,0x27,0x31,0x2d,0x8c,0xf1,0x61,0x2,0xd8,0xf6,0xea,0xb4,</span><br><span class="line">                      0xba,0xf,0x2,0x97,0x22,0xa8,0x1a,0x1c,0xca,0x83,0x28,0xb1,0x3c,</span><br><span class="line">                      0x67,0x33,0xef,0x25,0x57,0x82,0x7f,0xc,0xac,0xf1,0x89,0xf6,0x45,</span><br><span class="line">                      0xae,0x49,0x53,0x3a,0xee,0x92,0xdd,0xb,0x48&#125;;</span><br><span class="line">	unsigned char key[16]=&#123;0x28, 0x28, 0x7B, 0x33, 0x76, 0x67, 0x9D, 0xCD, 0x69, 0x3F, </span><br><span class="line">  							0xA7, 0xD1, 0x40, 0x62, 0x3C, 0xE7&#125;;</span><br><span class="line">	for(int i=0;i&lt;48;i+=8)</span><br><span class="line">	&#123;</span><br><span class="line">		decrypt((uint32_t*)&amp;s[i],(uint32_t*)key);	</span><br><span class="line">	&#125;</span><br><span class="line">	for(int i=0;i&lt;48;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;%c&quot;,s[i]);	</span><br><span class="line">	&#125;	  </span><br><span class="line"> &#125;</span><br><span class="line"> //FCTF&#123;The_proletariat_all_over_the_world_unite!!&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Maze"><a href="#Maze" class="headerlink" title="Maze"></a>Maze</h1><h2 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">#define row 8  // è¡Œ</span><br><span class="line">#define col 6  // åˆ—</span><br><span class="line">char path[100];  // è·¯å¾„</span><br><span class="line">int len = 0;   //è·¯å¾„é•¿åº¦</span><br><span class="line">int map[48]=&#123;0&#125;;</span><br><span class="line">int num=0;</span><br><span class="line">void search(char s[],int temp[])&#123;</span><br><span class="line">	char table[]=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;</span><br><span class="line">	for(int i=0;i&lt;strlen(s);i++)&#123;</span><br><span class="line">		temp[i]=strchr(table,s[i])-table;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">void creat_map(int a[])&#123;  //å°†8ä¸ªåè¿›åˆ¶æ•°è½¬åŒ–ä¸º8ä¸ª6æ¯”ç‰¹äºŒè¿›åˆ¶æ•°ï¼Œç»„æˆ8*6çš„è¿·å®«åœ°å›¾</span><br><span class="line">	int temp;</span><br><span class="line">	for(int i=0;i&lt;8;i++)&#123; //è¡Œ</span><br><span class="line">		temp=a[i];</span><br><span class="line">		for(int j=5;j&gt;=0;j--)&#123;  //åˆ—</span><br><span class="line">			map[i*6+j]=temp&amp;1;</span><br><span class="line">			temp&gt;&gt;=1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">int judge(char path[])&#123;  //æ£€éªŒæ˜¯å¦ç¬¦åˆé€šè·¯</span><br><span class="line">	const char *s[] = &#123;</span><br><span class="line">        &quot;ddddsdssaassassddd&quot;,</span><br><span class="line">        &quot;ddddsdssaawaaasssssddddd&quot;,</span><br><span class="line">        &quot;ssdddsssassddd&quot;,</span><br><span class="line">        &quot;sssssssddddd&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">    for (int i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">        if (!strcmp(path, s[i])) &#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">void find_road(int r, int c) &#123;</span><br><span class="line">    if (r &gt;= row || r &lt; 0 || c &gt;= col || c &lt; 0 || map[r * col + c] == 1)  return;  // è¶…å‡ºåœ°å›¾æˆ–æ’ä¸Šå¢™åˆ™è¿”å›</span><br><span class="line">    if (r * col + c == 47) &#123;   // æ‰¾åˆ°ç»ˆç‚¹</span><br><span class="line">        if(!judge(path))</span><br><span class="line">		&#123;	</span><br><span class="line">			printf(&quot;wrong path!&quot;);</span><br><span class="line">			exit(0);</span><br><span class="line">		&#125;</span><br><span class="line">		num++;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    map[r * col + c] = 1;  // æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œé˜²æ­¢é‡å¤è®¿é—®</span><br><span class="line">    // å°è¯•å››ä¸ªæ–¹å‘</span><br><span class="line">    path[len++] = &#x27;d&#x27;;</span><br><span class="line">    find_road(r, c + 1);  // å³</span><br><span class="line">    path[--len] = &#x27;\0&#x27;;</span><br><span class="line"></span><br><span class="line">    path[len++] = &#x27;a&#x27;;</span><br><span class="line">    find_road(r, c - 1);  // å·¦</span><br><span class="line">    path[--len] = &#x27;\0&#x27;;</span><br><span class="line"></span><br><span class="line">    path[len++] = &#x27;s&#x27;;</span><br><span class="line">    find_road(r + 1, c);  // ä¸‹</span><br><span class="line">    path[--len] = &#x27;\0&#x27;;</span><br><span class="line"></span><br><span class="line">    path[len++] = &#x27;w&#x27;;</span><br><span class="line">    find_road(r - 1, c);  // ä¸Š</span><br><span class="line">    path[--len] = &#x27;\0&#x27;;</span><br><span class="line"></span><br><span class="line">    map[r * col + c] = 0;  // å›æº¯</span><br><span class="line">&#125;</span><br><span class="line">int zero_num()&#123;</span><br><span class="line">	int sum=0;</span><br><span class="line">	for(int i=0;i&lt;48;i++)</span><br><span class="line">		if(map[i]==0) sum++;</span><br><span class="line">	return (sum==30)?1:0;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	int temp[8];</span><br><span class="line">	char s[14];</span><br><span class="line">	char input[14];</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½ çš„flag!!!:\n&quot;);</span><br><span class="line">	scanf(&quot;%s&quot;,input);</span><br><span class="line">	int slen=strlen(input);</span><br><span class="line">	if(memcmp(&quot;FCTF&#123;&quot;,input,5)||input[slen-1]!=&#x27;&#125;&#x27;)&#123;</span><br><span class="line">		printf(&quot;wrong!!&quot;);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	memcpy(s,input+5,slen-6);</span><br><span class="line">	search(s,temp);</span><br><span class="line">	creat_map(temp);</span><br><span class="line">	if(!zero_num())</span><br><span class="line">	&#123; printf(&quot;map wrong!!!&quot;);return 0;&#125;</span><br><span class="line">	find_road(0,0);</span><br><span class="line">	if(num==4)</span><br><span class="line">		printf(&quot;right!!!&quot;);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">// FCTF&#123;BcCYbTXA&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿå¤ä¹ </title>
    <url>/posts/55434/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="ç¬¬ä¸€ç« ï¼šæ“ä½œç³»ç»Ÿå¼•è®º"><a href="#ç¬¬ä¸€ç« ï¼šæ“ä½œç³»ç»Ÿå¼•è®º" class="headerlink" title="ç¬¬ä¸€ç« ï¼šæ“ä½œç³»ç»Ÿå¼•è®º"></a>ç¬¬ä¸€ç« ï¼šæ“ä½œç³»ç»Ÿå¼•è®º</h1><h4 id="æ“ä½œç³»ç»Ÿçš„å®šä¹‰ï¼š"><a href="#æ“ä½œç³»ç»Ÿçš„å®šä¹‰ï¼š" class="headerlink" title="æ“ä½œç³»ç»Ÿçš„å®šä¹‰ï¼š"></a>æ“ä½œç³»ç»Ÿçš„å®šä¹‰ï¼š</h4><p>æ“ä½œç³»ç»Ÿæ˜¯<u>è®¡ç®—æœºç³»ç»Ÿä¸­çš„ä¸€ä¸ªç³»ç»Ÿè½¯ä»¶</u>ï¼Œå®ƒ<u>ç»Ÿä¸€ç®¡ç†è®¡ç®—æœºçš„è½¯ç¡¬ä»¶èµ„æºå’Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œ</u>ï¼Œ<u>æä¾›äººæœºäº¤äº’çš„æ¥å£å’Œç•Œé¢</u>ã€‚</p>
<h4 id="æ“ä½œç³»ç»Ÿå‘å±•é˜¶æ®µï¼š"><a href="#æ“ä½œç³»ç»Ÿå‘å±•é˜¶æ®µï¼š" class="headerlink" title="æ“ä½œç³»ç»Ÿå‘å±•é˜¶æ®µï¼š"></a>æ“ä½œç³»ç»Ÿå‘å±•é˜¶æ®µï¼š</h4><ol>
<li>æ‰‹å·¥æ“ä½œé˜¶æ®µ</li>
<li>æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ</li>
<li>å¤šé“æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ</li>
<li>åˆ†æ—¶å®æ—¶å’Œé€šç”¨æ“ä½œç³»ç»Ÿ</li>
<li>ç°ä»£æ“ä½œç³»ç»Ÿ</li>
<li>æœªæ¥æ“ä½œç³»ç»Ÿ</li>
</ol>
<p><strong>å¤šé“æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿå’Œåˆ†æ—¶æ“ä½œç³»ç»Ÿçš„å‡ºç°ï¼Œæ ‡å¿—ç€æ“ä½œç³»ç»Ÿçš„åˆæ­¥å½¢æˆï¼</strong></p>
<h4 id="æ‰¹å¤„ç†ç³»ç»Ÿï¼š"><a href="#æ‰¹å¤„ç†ç³»ç»Ÿï¼š" class="headerlink" title="æ‰¹å¤„ç†ç³»ç»Ÿï¼š"></a>æ‰¹å¤„ç†ç³»ç»Ÿï¼š</h4><p>å•é“æ‰¹å¤„ç†ç‰¹ç‚¹ï¼šè‡ªåŠ¨æ€§   ã€é¡ºåºæ€§  ã€å•é“æ€§</p>
<p>å¤šé“æ‰¹å¤„ç†ç‰¹ç‚¹ï¼šå¤šé“ ã€å®è§‚ä¸Šå¹¶è¡Œ  ã€å¾®è§‚ä¸Šä¸²è¡Œ</p>
<h4 id="æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼š"><a href="#æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼š" class="headerlink" title="æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼š"></a>æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼š</h4><ol>
<li>å¤„ç†å™¨ç®¡ç†çš„åŠŸèƒ½</li>
<li>å­˜å‚¨ç®¡ç†çš„åŠŸèƒ½</li>
<li>è®¾å¤‡ç®¡ç†çš„åŠŸèƒ½</li>
<li>æ–‡ä»¶ç®¡ç†çš„åŠŸèƒ½</li>
<li>ä½œä¸šç®¡ç†çš„åŠŸèƒ½</li>
</ol>
<h4 id="æ“ä½œç³»ç»Ÿçš„ç‰¹å¾ï¼š"><a href="#æ“ä½œç³»ç»Ÿçš„ç‰¹å¾ï¼š" class="headerlink" title="æ“ä½œç³»ç»Ÿçš„ç‰¹å¾ï¼š"></a>æ“ä½œç³»ç»Ÿçš„ç‰¹å¾ï¼š</h4><ol>
<li>å¹¶å‘ï¼šå®è§‚å¹¶è¡Œï¼Œå¾®è§‚ä¸²è¡Œ</li>
<li>å…±äº«ï¼šèµ„æºå¤šè¿›ç¨‹å…±ç”¨</li>
<li>è™šæ‹Ÿï¼šä¸€ä¸ªç‰©ç†å®ä½“å˜ä¸ºè‹¥å¹²é€»è¾‘èµ„æº</li>
<li>å¼‚æ­¥æ€§ï¼šç¯å¢ƒå¯¼è‡´è¿è¡Œè¿‡ç¨‹ä¸åŒï¼Œä½†ç»“æœç›¸åŒ</li>
</ol>
<h4 id="æ“ä½œç³»ç»Ÿçš„ä½œç”¨ï¼š"><a href="#æ“ä½œç³»ç»Ÿçš„ä½œç”¨ï¼š" class="headerlink" title="æ“ä½œç³»ç»Ÿçš„ä½œç”¨ï¼š"></a>æ“ä½œç³»ç»Ÿçš„ä½œç”¨ï¼š</h4><ol>
<li>ä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿçš„æ¥å£</li>
<li>ä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…</li>
<li>ç”¨ä½œæ‰©å……æœºå™¨ï¼ˆå¢å¼ºè®¡ç®—æœºæ€§èƒ½ï¼‰</li>
</ol>
<h1 id="ç¬¬äºŒç« ï¼šè¿›ç¨‹ç®¡ç†"><a href="#ç¬¬äºŒç« ï¼šè¿›ç¨‹ç®¡ç†" class="headerlink" title="ç¬¬äºŒç« ï¼šè¿›ç¨‹ç®¡ç†"></a>ç¬¬äºŒç« ï¼šè¿›ç¨‹ç®¡ç†</h1><h4 id="è¿›ç¨‹çš„å®šä¹‰ï¼š"><a href="#è¿›ç¨‹çš„å®šä¹‰ï¼š" class="headerlink" title="è¿›ç¨‹çš„å®šä¹‰ï¼š"></a>è¿›ç¨‹çš„å®šä¹‰ï¼š</h4><p>å¯å¹¶å‘æ‰§è¡Œçš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†ä¸Šçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œå®ƒæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚</p>
<h4 id="è¿›ç¨‹çš„åŸºæœ¬ç‰¹å¾ï¼š"><a href="#è¿›ç¨‹çš„åŸºæœ¬ç‰¹å¾ï¼š" class="headerlink" title="è¿›ç¨‹çš„åŸºæœ¬ç‰¹å¾ï¼š"></a>è¿›ç¨‹çš„åŸºæœ¬ç‰¹å¾ï¼š</h4><ol>
<li>åŠ¨æ€æ€§ï¼šè¿›ç¨‹æœ‰ä¸€å®šç”Ÿå‘½å‘¨æœŸï¼ˆåŠ¨æ€ï¼‰ï¼Œç¨‹åºåªæ˜¯ä¸€ç»„æœ‰åºæŒ‡ä»¤çš„é›†åˆï¼ˆé™æ€ï¼‰ã€‚è¿›ç¨‹æ˜¯è¿›ç¨‹å®ä½“çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</li>
<li>å¹¶å‘æ€§ï¼šå¤šä¸ªè¿›ç¨‹å¯åŒæ—¶è¿è¡Œ</li>
<li>ç‹¬ç«‹æ€§ï¼šè¿›ç¨‹å®ä½“æ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œä¹Ÿæ˜¯ç³»ç»Ÿä¸­ç‹¬ç«‹è·å¾—èµ„æºå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li>
<li>å¼‚æ­¥æ€§ï¼šä¸å¯é¢„çŸ¥é€Ÿåº¦ï¼Œç¨‹åºä¸å¯å†ç°</li>
<li>ç»“æ„ç‰¹å¾ï¼šè¿›ç¨‹å®ä½“ &#x3D; ç¨‹åºæ®µ + æ•°æ®æ®µ + PCB</li>
</ol>
<table>
<thead>
<tr>
<th><strong>å¯¹æ¯”ç»´åº¦</strong></th>
<th><strong>ç¨‹åºï¼ˆProgramï¼‰</strong></th>
<th><strong>è¿›ç¨‹å®ä½“ï¼ˆProcess Entityï¼‰</strong></th>
<th><strong>è¿›ç¨‹ï¼ˆProcessï¼‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>æœ¬è´¨</strong></td>
<td>é™æ€çš„ä»£ç å’Œæ•°æ®é›†åˆ</td>
<td>è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„ç‰©ç†æ•°æ®ç»“æ„é›†åˆ</td>
<td>ç¨‹åºçš„åŠ¨æ€æ‰§è¡Œè¿‡ç¨‹</td>
</tr>
<tr>
<td><strong>å­˜å‚¨ä½ç½®</strong></td>
<td>ç£ç›˜ï¼ˆæœªè¿è¡Œæ—¶ï¼‰</td>
<td>å†…å­˜ï¼ˆè¿è¡Œæ—¶ï¼‰</td>
<td>æ— å›ºå®šå­˜å‚¨ä½ç½®ï¼Œæè¿°åŠ¨æ€è¡Œä¸º</td>
</tr>
<tr>
<td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td>
<td>æ°¸ä¹…å­˜åœ¨ï¼ˆé™¤éè¢«åˆ é™¤ï¼‰</td>
<td>éšè¿›ç¨‹åˆ›å»ºè€Œåˆ†é…ï¼Œéšè¿›ç¨‹ç»ˆæ­¢è€Œé‡Šæ”¾</td>
<td>ä¸´æ—¶å­˜åœ¨ï¼ˆä»åˆ›å»ºåˆ°ç»ˆæ­¢ï¼‰</td>
</tr>
<tr>
<td><strong>èµ„æºå ç”¨</strong></td>
<td>ä»…å ç”¨ç£ç›˜ç©ºé—´</td>
<td>å ç”¨å†…å­˜ï¼ˆå­˜å‚¨PCBã€ä»£ç æ®µã€æ•°æ®æ®µï¼‰</td>
<td>è¿è¡Œæ—¶å ç”¨CPUã€å†…å­˜ã€I&#x2F;Oè®¾å¤‡ç­‰èµ„æº</td>
</tr>
<tr>
<td><strong>åŠ¨æ€æ€§</strong></td>
<td>é™æ€ï¼Œä¸å¯æ‰§è¡Œ</td>
<td>é™æ€æ•°æ®ç»“æ„ï¼Œæ”¯æŒåŠ¨æ€æ‰§è¡Œ</td>
<td>åŠ¨æ€ï¼Œéšæ‰§è¡ŒçŠ¶æ€å˜åŒ–ï¼ˆè¿è¡Œã€é˜»å¡ã€å°±ç»ªç­‰ï¼‰</td>
</tr>
<tr>
<td><strong>ç‹¬ç«‹æ€§</strong></td>
<td>æ— ç‹¬ç«‹è¿è¡Œèƒ½åŠ›</td>
<td>æ˜¯è¿›ç¨‹å­˜åœ¨çš„ç‰©ç†è½½ä½“</td>
<td>ç‹¬ç«‹è°ƒåº¦å’Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½</td>
</tr>
<tr>
<td><strong>ç»„æˆç»“æ„</strong></td>
<td>ä»£ç ï¼ˆæŒ‡ä»¤ï¼‰+ åˆå§‹åŒ–æ•°æ®</td>
<td>PCB + ç¨‹åºæ®µ + æ•°æ®æ®µ</td>
<td>æ— ç‰©ç†ç»“æ„ï¼Œç”±è¿›ç¨‹å®ä½“æ”¯æŒå…¶åŠ¨æ€è¡Œä¸º</td>
</tr>
<tr>
<td><strong>æ“ä½œç³»ç»Ÿè§†è§’</strong></td>
<td>æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</td>
<td>å†…å­˜ä¸­éœ€ç®¡ç†çš„èµ„æºå—</td>
<td>è°ƒåº¦çš„åŸºæœ¬å•ä½</td>
</tr>
<tr>
<td><strong>å®ä¾‹æ•°é‡</strong></td>
<td>ä¸€ä¸ªç¨‹åºå¯å¯¹åº”å¤šä¸ªè¿›ç¨‹ï¼ˆå¤šæ¬¡è¿è¡Œï¼‰</td>
<td>æ¯ä¸ªè¿›ç¨‹å¯¹åº”å”¯ä¸€çš„è¿›ç¨‹å®ä½“</td>
<td>ä¸€ä¸ªè¿›ç¨‹å®ä½“å¯¹åº”ä¸€ä¸ªè¿›ç¨‹</td>
</tr>
</tbody></table>
<p>è¿›ç¨‹å¯å¯¹åº”å¤šä¸ªç¨‹åºï¼Œç¨‹åºå¯ä»¥å¯¹åº”å¤šä¸ªè¿›ç¨‹</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>ä¸‰çº§è°ƒåº¦ï¼š</p>
<p>é«˜çº§è°ƒåº¦ï¼šä½œä¸šè°ƒåº¦</p>
<p>ä¸­çº§è°ƒåº¦ï¼šå†…å­˜è°ƒåº¦</p>
<p>ä½çº§è°ƒåº¦ï¼šè¿›ç¨‹è°ƒåº¦</p>
]]></content>
      <tags>
        <tag>ä½œä¸š</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„</title>
    <url>/posts/1106/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<p>æ•°æ®ç»“æ„ç®—æ³•æ€»é›†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ã€ç¬¬3å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">ä¸€ã€ç¼–å†™å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ç›¸å…³ç®—æ³•ï¼š</span><br><span class="line">1ã€å»ºè¡¨-1ï¼šè¾“å…¥ä¸€ç»„æ•°ï¼Œç”¨å°¾æ’æ³•å»ºè¡¨ï¼›</span><br><span class="line">å¦‚ï¼šè¾“å…¥1ã€2ã€3ã€4ã€5ã€-1ï¼Œé“¾è¡¨ä¸ºï¼š    å¤´ç»“ç‚¹-&gt;1-&gt;2-&gt;3-&gt;4-&gt;5^</span><br><span class="line">2ã€å»ºè¡¨-2ï¼šè¾“å…¥ä¸€ç»„æ•°ï¼Œç”¨å¤´æ’æ³•å»ºè¡¨ï¼›</span><br><span class="line">å¦‚ï¼šè¾“å…¥1ã€2ã€3ã€4ã€5ã€-1ï¼Œé“¾è¡¨ä¸ºï¼š   å¤´ç»“ç‚¹-&gt;5-&gt;4-&gt;3-&gt;2-&gt;1^</span><br><span class="line">3ã€æ‰“å°è¾“å‡ºå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨</span><br><span class="line">4ã€å‘å‡åºå•é“¾è¡¨hæ’å…¥å€¼ä¸ºxçš„å…ƒç´ ï¼Œä½¿å…¶ä¾æ—§æœ‰åº</span><br><span class="line">5ã€åˆ é™¤å‡åºå•é“¾è¡¨hä¸­æ‰€æœ‰å€¼ä¸ºxçš„å…ƒç´ </span><br><span class="line">6ã€ç»™å®šå‡åºè¡¨h1ã€h2ï¼Œå°†å…¶åˆå¹¶æˆé™åºè¡¨h3</span><br><span class="line"></span><br><span class="line">ã€ç¬¬4å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">ç¼–å†™å¤´æŒ‡é’ˆçš„å•é“¾è¡¨ç›¸å…³ç®—æ³•ï¼š</span><br><span class="line">1ã€ç”¨å¤´æ’æ³•å»ºè¡¨ï¼›</span><br><span class="line">2ã€è¾“å‡ºå•é“¾è¡¨</span><br><span class="line">3ã€ç»™å®šh1ï¼Œå°†å…¶ä¸­çš„æ‰€æœ‰å¶æ•°ç»“ç‚¹æ‘˜é™¤ï¼Œä¾æ¬¡ã€å°¾æ’ã€‘æ’å…¥h2</span><br><span class="line">4ã€ç»™å®šhï¼Œæ‰¾åˆ°å…¶ä¸­æœ€å¤§å€¼ç»“ç‚¹ï¼Œå°†å…¶æ‘˜é™¤ï¼Œæ’å…¥hä¹‹å‰ï¼Œå¹¶è¿”å›h</span><br><span class="line"></span><br><span class="line">ã€ç¬¬6å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">1ã€è®¾è®¡æœ€å¤šèƒ½å­˜å‚¨10ä¸ªå…ƒç´ çš„å¾ªç¯é˜Ÿåˆ—ï¼Œå¹¶å®Œæˆåˆå§‹åŒ–ã€å…¥é˜Ÿã€å‡ºé˜Ÿã€åˆ¤ç©ºã€åˆ¤æ»¡ã€è®¡ç®—å…ƒç´ ä¸ªæ•°ç­‰å…­ä¸ªåŸºæœ¬æ“ä½œã€‚</span><br><span class="line">2ã€è®¾è®¡å¦‚å›¾æ‰€ç¤ºçš„é“¾å¼é˜Ÿåˆ—ï¼Œå®Œæˆåˆå§‹åŒ–ã€å…¥é˜Ÿã€å‡ºé˜Ÿã€åˆ¤ç©ºå››ä¸ªåŸºæœ¬æ“ä½œã€‚</span><br><span class="line">3ã€ç»™å®šä¸€å¸¦è¡¨å¤´çš„å•é“¾è¡¨ï¼Œåªå…è®¸ä¸€éæ‰«æï¼Œå®šä½è¯¥é“¾è¡¨å€’æ•°ç¬¬Kï¼ˆK&gt;0ï¼‰ä¸ªç»“ç‚¹ã€‚</span><br><span class="line">4ã€ç»™å®šä¸€å¸¦è¡¨å¤´çš„å•é“¾è¡¨ï¼Œåªå…è®¸ä¸€éæ‰«æï¼Œå®šä½è¯¥é“¾è¡¨ä¸­ç‚¹å…ƒç´ ï¼Œå¹¶è¾“å‡ºå…±æœ‰å¤šå°‘å…ƒç´ ï¼Œä¸­ç‚¹å…ƒç´ æ˜¯ç¬¬å‡ ä¸ªï¼Œå€¼ä¸ºå¤šå°‘ã€‚</span><br><span class="line"></span><br><span class="line">ã€ç¬¬7å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">ä¸€ã€æ„é€ è‡³å¤šèƒ½å­˜å‚¨100ä¸ªå­—ç¬¦çš„é¡ºåºè¡¨ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²ï¼Œå¹¶é…å¤‡ä»¥ä¸‹æ“ä½œï¼š</span><br><span class="line">ï¼ˆ1ï¼‰delStr(s,i,n)ï¼šåˆ é™¤sä»ä¸‹æ ‡iå¼€å§‹çš„é•¿åº¦ä¸ºnçš„å­ä¸²ï¼Œå¹¶è¿”å›åˆ é™¤åçš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">         å¦‚   s=&quot;abcdefghi&quot;ï¼Œ delStr(s,1,5)=&quot;abcdefhi&quot;=&quot;ahi&quot;ï¼›</span><br><span class="line">ï¼ˆ2ï¼‰insertStr(s1,i,s2)ï¼šåœ¨s1çš„ä¸‹æ ‡iå¤„æ’å…¥ä¸²s2ï¼›</span><br><span class="line">        å¦‚ s1=&quot;abc&quot;ï¼Œs2=&quot;123&quot;ï¼ŒinsertStr(s1,1,s2)=&quot;a123bc&quot;ï¼›</span><br><span class="line">ï¼ˆ3ï¼‰replaceStr(s1,i,n,s2): ç”¨s2æ›¿æ¢å­ä¸²s1[i..n] ï¼›</span><br><span class="line">          å¦‚ s1=&quot;abcde&quot;ï¼Œs2=&quot;123&quot;ï¼ŒreplaceStr (s1,1,4,s2)=&quot;a123&quot;ï¼›</span><br><span class="line">äºŒã€ç¼–å†™ç¨‹åºï¼Œå®ç°æœ´ç´ çš„æ¨¡å¼åŒ¹é…ç®—æ³•ï¼Œå¹¶èƒ½è¾“å…¥æ•°æ®è¿›è¡ŒéªŒè¯</span><br><span class="line">ä¸‰ã€ç¼–å†™ç¨‹åºï¼Œå®Œæˆç¨€ç–çŸ©é˜µçš„å¦‚ä¸‹ç¨‹åºï¼š===è¿™éƒ¨åˆ†å†…å®¹å¯å¤šçœ‹çœ‹è§†é¢‘</span><br><span class="line">ï¼ˆ1ï¼‰é€šè¿‡è¾“å…¥ç›¸å…³ä¸‰å…ƒç»„ï¼Œå®ç°ç¨€ç–çŸ©é˜µçš„è¾“å…¥ï¼›</span><br><span class="line">ï¼ˆ2ï¼‰æ ¹æ®ä¸‰å…ƒç»„è¡¨ï¼Œä»¥çŸ©é˜µæ–¹å¼è¾“å‡ºç¨€ç–çŸ©é˜µ</span><br><span class="line">ï¼ˆ3ï¼‰å®ç°ç¨€ç–çŸ©é˜µçš„æ™®é€šè½¬ç½®ï¼›</span><br><span class="line">ï¼ˆ4ï¼‰å®ç°ç¨€ç–çŸ©é˜µçš„å¿«é€Ÿè½¬ç½®ã€‚</span><br><span class="line"></span><br><span class="line">ã€ç¬¬8å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">ç¼–å†™â˜…â˜…â˜…é€’å½’ç¨‹åºâ˜…â˜…â˜…ï¼š</span><br><span class="line">1ã€æ‰“å°è¯¾ä»¶ä¸­ç¬¬17é¡µæ‰€ç¤ºå„ç§ä¸‰è§’çš„ã€å€’ç½®ã€‘å½¢çŠ¶</span><br><span class="line">2ã€åœ¨æ•°ç»„a[low...high]æŸ¥æ‰¾xï¼Œè¦æ±‚ï¼š</span><br><span class="line">ï¼ˆ1ï¼‰ç¼–å†™å‡½æ•°å®ç°ï¼šè‹¥xåœ¨aä¸­å­˜åœ¨ï¼Œåˆ™è¿”å›é¦–æ¬¡å‡ºç°ä½ç½®ï¼›è‹¥ä¸å‡ºç°ï¼Œåˆ™è¿”å›-1ï¼›</span><br><span class="line">ï¼ˆ2ï¼‰ç¼–å†™å‡½æ•°å®ç°ï¼šè‹¥xåœ¨aä¸­å­˜åœ¨ï¼Œåˆ™è¿”å›æœ€åå‡ºç°ä½ç½®ï¼›è‹¥ä¸å‡ºç°ï¼Œåˆ™è¿”å›-1ï¼›</span><br><span class="line">ï¼ˆ3ï¼‰ç¼–å†™å‡½æ•°å®ç°ï¼šæŒ‰ä¸­ç‚¹ä¼˜å…ˆæ–¹å¼æŸ¥æ‰¾xï¼Œè‹¥æ‰¾åˆ°ï¼Œåˆ™è¿”å›å…¶å¯¹åº”ä¸‹æ ‡ï¼›è‹¥ä¸å‡ºç°ï¼Œåˆ™è¿”å›-1ã€‚</span><br><span class="line">3ã€ç»™å®šéç©ºæ•°ç»„a[low...high]ï¼Œç¼–å†™é€’å½’å‡½æ•°è¿”å›aä¸­æœ€å¤§å€¼ä¸‹æ ‡</span><br><span class="line">4ã€å°†é¡ºåºè¡¨çš„å¥‡æ•°æ”¾åœ¨é¡ºåºè¡¨çš„å¤´éƒ¨ï¼Œå¶æ•°æ”¾åœ¨é¡ºåºè¡¨çš„å°¾éƒ¨ï¼Œå¥‡æ•°å¶æ•°ä¸å¾—äº¤å‰å­˜æ”¾ã€‚</span><br><span class="line">5ã€æŒ‰æ­£åºã€é€†åºä¸¤ç§æ–¹å¼è¾“å‡ºå•é“¾è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">ã€ç¬¬9å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">ä¸€ã€è®¾è®¡èƒ½å­˜å‚¨charå‹æ•°æ®çš„måº¦æ ‘ï¼Œå¹¶å®Œæˆä»¥ä¸‹å‡½æ•°è®¾è®¡ï¼š</span><br><span class="line">1ã€åŸºç¡€æ“ä½œï¼šå»ºæ ‘ã€å‰åºéå†ã€ååºéå†ï¼›</span><br><span class="line">2ã€æŸ¥æ‰¾å€¼ä¸ºxçš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œè¿”å›æŒ‡å‘è¯¥ç»“ç‚¹çš„æŒ‡é’ˆï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›NULLã€‚è¦æ±‚ï¼šåœ¨mainä¸­è¾“å‡ºæŸ¥æ‰¾ç»“æœ</span><br><span class="line">3ã€å±‚æ¬¡éå†</span><br><span class="line">4ã€å‡¹å…¥è¾“å‡ºã€</span><br><span class="line">5ã€æ‹¬å·è¾“å‡ºï¼ˆæœ€å¥½ç»™å‡ºç¾åŒ–ç‰ˆç®—æ³•ï¼‰</span><br><span class="line">äºŒã€è®¾è®¡èƒ½å­˜å‚¨intå‹æ•°æ®çš„måº¦æ ‘ï¼Œå¹¶å®Œæˆä»¥ä¸‹å‡½æ•°è®¾è®¡ï¼ˆæç¤ºï¼šå¯ç”¨0è¡¨ä¸NULLï¼‰</span><br><span class="line">1ã€åŸºç¡€æ“ä½œï¼šå»ºæ ‘ã€å‰åºéå†ã€ååºéå†ï¼›</span><br><span class="line">2ã€ç»Ÿè®¡æ ‘ä¸­måº¦ç»“ç‚¹ä¸ªæ•°ï¼›</span><br><span class="line">3ã€è¿”å›æŒ‡å‘æ±‚æ ‘ä¸­æœ€å¤§å€¼ç»“ç‚¹çš„æŒ‡é’ˆ</span><br><span class="line"></span><br><span class="line">ã€ç¬¬10å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">è®¾è®¡èƒ½å­˜å‚¨charå‹æ•°æ®çš„äºŒå‰æ ‘ï¼Œå¹¶å®Œæˆä»¥ä¸‹å‡½æ•°è®¾è®¡</span><br><span class="line">1ã€å»ºæ ‘</span><br><span class="line">2ã€ä¸‰ç§é€’å½’éå†ï¼šå‰åºã€ä¸­åºã€ååº</span><br><span class="line">3ã€ä¸‰ç§éé€’å½’éå†ï¼šå‰åºéå†ã€ä¸­åºéå†ã€å±‚æ¬¡éå†</span><br><span class="line">4ã€åœ¨äºŒå‰æ ‘tä¸­æŸ¥æ‰¾å€¼ä¸ºxçš„ç»“ç‚¹pã€‚è‹¥æœªæ‰¾åˆ°ï¼Œæˆ–æ˜¯æ ¹çš„å€¼ä¸ºxï¼Œåˆ™è¿”å›ç©ºï¼›å¦åˆ™ï¼Œåˆ™è¿”å›pæŒ‡å‘ç»“ç‚¹çš„åŒäº²</span><br><span class="line">5ã€åœ¨äºŒå‰æ ‘æ ‘ä¸­æ‰¾ç»“ç‚¹xï¼Œè‹¥æ‰¾åˆ°ï¼Œåˆ™è¿”å›å€¼ä¸ºxçš„ç»“ç‚¹çš„é«˜åº¦ï¼ˆæ³¨ï¼šæ ¹çš„é«˜åº¦ä¸º1ï¼‰ï¼›è‹¥æœªæ‰¾åˆ°ï¼Œåˆ™è¿”å›0</span><br><span class="line">6ã€ç»Ÿè®¡äºŒå‰æ ‘ä¸­å¶å­ç»“ç‚¹ä¸ªæ•°</span><br><span class="line">7ã€è®¡ç®—äºŒå‰æ ‘çš„æ ‘é«˜</span><br><span class="line">8ã€è¾“å‡ºäºŒå‰æ ‘ä¸­æ‰€æœ‰1åº¦ç»“ç‚¹åŠå…¶é«˜åº¦ã€‚</span><br><span class="line">9ã€è¾“å‡ºäºŒå‰æ ‘å‰/ä¸­/ååºéå†çš„é¦–ç‚¹ã€å°¾ç‚¹</span><br><span class="line"></span><br><span class="line">ã€ç¬¬12å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">1ã€åˆ›å»ºå­˜å‚¨intå‹æ•°æ®çš„äºŒå‰æ ‘ï¼›</span><br><span class="line">2ã€ç»Ÿè®¡äºŒå‰æ ‘ä¸­1åº¦ç»“ç‚¹çš„ä¸ªæ•°</span><br><span class="line">3ã€è¿”å›äºŒå‰æ ‘ä¸­çš„æœ€å¤§å€¼ç»“ç‚¹çš„æŒ‡é’ˆ</span><br><span class="line">4ã€åˆ¤æ–­ä¸¤æ£µäºŒå‰æ ‘æ˜¯å¦ç­‰ä»·</span><br><span class="line">5ã€åˆ›å»ºpptæœ«å°¾å›¾æœ‰å‘å›¾G6å¯¹åº”çš„é‚»æ¥çŸ©é˜µã€é‚»æ¥è¡¨ã€é€†é‚»æ¥è¡¨ï¼Œå¹¶è¾“å‡ºç»“æœ</span><br><span class="line">     ç»“æœï¼šé‚»æ¥çŸ©é˜µï¼Œå°±æ˜¯äºŒç»´çŸ©é˜µå½¢å¼è¾“å‡ºï¼›é‚»æ¥è¡¨ï¼Œå°±æ˜¯æŒ‰é‚»æ¥è¡¨å½¢å¼è¾“å‡º</span><br><span class="line">6ã€ä½¿ç”¨é‚»æ¥çŸ©é˜µï¼Œè®¡ç®—ç»“ç‚¹xçš„å…¥åº¦ã€å‡ºåº¦ã€‚</span><br><span class="line">7ã€ä½¿ç”¨é‚»æ¥è¡¨ï¼Œè®¡ç®—ç»“ç‚¹xçš„å…¥åº¦ã€å‡ºåº¦</span><br><span class="line"></span><br><span class="line">ã€ç¬¬13å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">1ã€åˆ›å»ºpptæœ«å°¾å›¾æœ‰å‘å›¾G6å¯¹åº”çš„é‚»æ¥çŸ©é˜µã€é‚»æ¥è¡¨ã€é€†é‚»æ¥è¡¨ï¼Œå¹¶è¾“å‡ºç»“æœï¼›</span><br><span class="line">2ã€ä½¿ç”¨é‚»æ¥çŸ©é˜µï¼Œè®¡ç®—ç»“ç‚¹xçš„å…¥åº¦ã€å‡ºåº¦ã€‚</span><br><span class="line">3ã€ä½¿ç”¨é‚»æ¥è¡¨ï¼Œè®¡ç®—ç»“ç‚¹xçš„å…¥åº¦ã€å‡ºåº¦</span><br><span class="line">4ã€åŸºäºé‚»æ¥çŸ©é˜µï¼Œå®æ–½æ·±åº¦ã€å¹¿åº¦ä¼˜å…ˆéå†</span><br><span class="line">5ã€åŸºäºé‚»æ¥è¡¨ï¼Œå®æ–½æ·±åº¦ã€å¹¿åº¦ä¼˜å…ˆéå†</span><br><span class="line"></span><br><span class="line">ã€ç¬¬14å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">1ã€ç»™å®šé¡ºåºè¡¨Lï¼Œç¼–ç¨‹å®ç°äºŒåˆ†æ³•æ£€ç´¢ï¼Œç»™å‡ºé€’å½’å®ç°ã€éé€’å½’å®ç°ä¸¤ä¸ªç‰ˆæœ¬ã€‚å…¶ä¸­éé€’å½’ç®—æ³•ä¸­ï¼Œè¦è¾“å‡ºæŸ¥æ‰¾æ¬¡æ•°ï¼ˆå³æŸ¥æ‰¾å¤šå°‘æ¬¡å‘ç°æˆåŠŸ/å¤±è´¥ï¼‰ä»¥ä¾›éªŒè¯ã€‚</span><br><span class="line">2ã€å…³äºäºŒå‰æ’åºæ ‘tï¼Œç¼–å†™å¦‚ä¸‹å‡ ä¸ªå‡½æ•°ï¼š</span><br><span class="line">ï¼ˆ1ï¼‰å‘tæ’å…¥å•ä¸ªç»“ç‚¹æ“ä½œï¼ˆé€’å½’ã€éé€’å½’ï¼‰</span><br><span class="line">ï¼ˆ2ï¼‰è¾“å…¥ä¸€ç»„æ•°æ®ï¼ŒåŸºäºä¸Šé¢æ’å…¥æ“ä½œå»ºæ ‘ ï¼ˆåªéœ€éé€’å½’ï¼‰</span><br><span class="line">ï¼ˆ3ï¼‰ä¸­åºéå†è¾“å‡ºï¼Œä»¥ä¾¿éªŒè¯åˆ›å»ºçš„æ ‘æ˜¯å¦ä¸ºäºŒå‰æ’åºæ ‘ ï¼ˆåªéœ€é€’å½’ï¼‰</span><br><span class="line">ï¼ˆ4ï¼‰åœ¨äºŒå‰æ’åºæ ‘ä¸­æŸ¥æ‰¾å…ƒç´ xï¼Œè‹¥æ‰¾åˆ°ï¼Œåˆ™è¿”å›æŒ‡å‘è¯¥ç»“ç‚¹çš„æŒ‡é’ˆï¼›è‹¥æœªæ‰¾åˆ°ï¼Œåˆ™è¿”å›NULLï¼›ï¼ˆé€’å½’ã€éé€’å½’ï¼‰</span><br><span class="line">ï¼ˆ5ï¼‰åˆ¤æ–­ç»™å®šäºŒå‰æ ‘tæ˜¯å¦ä¸ºäºŒå‰æ’åºæ ‘ï¼ˆé€’å½’ï¼‰</span><br><span class="line"></span><br><span class="line">ã€ç¬¬15å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">1ã€åˆ¤æ–­ä¸€æ£µæ ‘æ˜¯å¦ä¸ºäºŒå‰æ’åºæ ‘ï¼ˆé€’å½’æ–¹å¼ï¼‰</span><br><span class="line">2ã€ç»™å®šæ•°æ®&#123;654,638,214,357,376,854,662,392&#125;ï¼Œå–keyçš„åä½æ•°ä½œå“ˆå¸Œåœ°å€ï¼Œé‡‡ç”¨çº¿æ€§æ¢æµ‹æ³•ä½œä¸ºå†²çªå¤„ç†æ–¹æ³•ï¼Œå°†æ•°æ®ä¾æ¬¡æ”¾å…¥å¤§å°ä¸º10çš„æ•°ç»„ä¸­ã€‚ç”¨-1ä½œä¸ºç©ºæ ‡è®°ã€‚è¾“å‡ºæ•£åˆ—è¡¨çš„å­˜å‚¨ç¤ºæ„å›¾ï¼ˆç¬¬ä¸€è¡Œè¾“å‡ºä¸‹æ ‡ï¼Œç¬¬äºŒè¡Œè¾“å‡ºæ¨ªçº¿ï¼Œç¬¬ä¸‰è¡Œè¾“å‡ºæ•°æ®ï¼‰ã€‚å¹¶å¯¹å…¶è¿›è¡Œç­‰æ¦‚ç‡æŸ¥æ‰¾ï¼Œè¾“å‡ºï¼ˆæ‰¾åˆ°ã€æ‰¾ä¸åˆ°æ—¶çš„ï¼‰æŸ¥æ‰¾æ¬¡æ•°ï¼Œå¹¶ç»™å‡ºæ‰¾åˆ°/æ‰¾ä¸åˆ°æ—¶çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ã€‚ï¼ˆæ³¨æ„ï¼šæ•°æ®æºè‡ªpptï¼Œå°†å­˜å‚¨ä¸pptå¯¹åº”ï¼Œæ£€éªŒå­˜å‚¨æ˜¯å¦æ­£ç¡®ï¼‰</span><br><span class="line">3ã€ç¼–ç¨‹å®ç°ç›´æ¥æ’å…¥æ’åºï¼Œå¹¶é€è¡Œè¾“å‡ºå„è¶Ÿçš„æ’åºç»“æœï¼Œå¦‚10ä¸ªæ•°æ®ï¼Œå°±æ˜¯9è¶Ÿã€‚</span><br><span class="line">4ã€ç¼–ç¨‹å®ç°å¸Œå°”æ’åºï¼Œå¹¶é€è¡Œè¾“å‡ºå„è¶Ÿçš„æ’åºç»“æœã€‚</span><br><span class="line"></span><br><span class="line">ã€ç¬¬16å‘¨å®éªŒåŠè¯¾åä½œä¸šã€‘</span><br><span class="line">1ã€ç¼–ç¨‹å®ç°ã€ç›´æ¥æ’å…¥ã€‘æ’åºã€‚</span><br><span class="line">2ã€ç¼–ç¨‹å®ç°ã€å¸Œå°”æ’å…¥ã€‘æ’åºã€‚</span><br><span class="line">3ã€ç¼–ç¨‹å®ç°ã€ç›´æ¥é€‰æ‹©ã€‘æ’åºã€‚</span><br><span class="line">4ã€ç¼–ç¨‹å®ç°ã€å †é€‰æ‹©ã€‘æ’åºã€‚</span><br><span class="line">5ã€ç¼–ç¨‹å®ç°ã€å†’æ³¡é€‰æ‹©ã€‘æ’åºã€‚</span><br><span class="line">6ã€ç¼–ç¨‹å®ç°ã€å¿«é€Ÿé€‰æ‹©ã€‘æ’åºã€‚</span><br></pre></td></tr></table></figure>



<h2 id="ä¸€ã€é¡ºåºè¡¨"><a href="#ä¸€ã€é¡ºåºè¡¨" class="headerlink" title="ä¸€ã€é¡ºåºè¡¨"></a>ä¸€ã€é¡ºåºè¡¨</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#define se SeqList</span><br><span class="line">#define slen L-&gt;len</span><br><span class="line">#define sarr L-&gt;a</span><br><span class="line">typedef struct&#123;</span><br><span class="line">	int a[100];</span><br><span class="line">	int len;</span><br><span class="line">&#125;SeqList;</span><br><span class="line">void input_data(se* L)			//è¾“å…¥æ•°æ® </span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;è¾“å…¥ä¸€ç»„æ•°ï¼Œä»¥-1ç»“æŸ: \n&quot;);</span><br><span class="line">	int i=0;</span><br><span class="line">	int n=0;</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;n);</span><br><span class="line">	while(n != -1)</span><br><span class="line">	&#123;</span><br><span class="line">		sarr[i] = n;</span><br><span class="line">		scanf(&quot;%d&quot;,&amp;n);</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">	slen = i;</span><br><span class="line">&#125;</span><br><span class="line">void print_data(se* L)			//æ‰“å° </span><br><span class="line">&#123;</span><br><span class="line">	int i;</span><br><span class="line">	for( i=0;i&lt;slen;i++)</span><br><span class="line">		printf(&quot;%d &quot;,sarr[i]);</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">void delete_sub(se* L,int i)	//åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„æ•°æ® </span><br><span class="line">&#123;</span><br><span class="line">	if(i&gt;=slen||i&lt;0)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;ä½ç½®éæ³•ï¼\n&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	int j;</span><br><span class="line">	for(j=i;j&lt;slen-1;j++)</span><br><span class="line">		sarr[j]=sarr[j+1];</span><br><span class="line">	slen--;</span><br><span class="line">&#125;</span><br><span class="line">void insert_data(se* L,int i)	//æ’å…¥æ•°æ®å¹¶æ’åº </span><br><span class="line">&#123;</span><br><span class="line">	int n=slen-1;</span><br><span class="line">	while(n&gt;=0)</span><br><span class="line">	&#123;</span><br><span class="line">		if(sarr[n]&gt;i)</span><br><span class="line">		&#123;</span><br><span class="line">			sarr[n+1]=sarr[n];</span><br><span class="line">			n--;</span><br><span class="line">		&#125;</span><br><span class="line">		else break;</span><br><span class="line">	&#125;</span><br><span class="line">	sarr[n+1]=i;</span><br><span class="line">	slen++;</span><br><span class="line">&#125;</span><br><span class="line">void dele_data(se* L,int x)	//å‡åºè¡¨åˆ é™¤æ•°æ®X</span><br><span class="line">&#123;</span><br><span class="line">	int i=0,j=0;</span><br><span class="line">	while(i&lt;slen &amp;&amp; sarr[i]&lt;x) i++;</span><br><span class="line">	if(i==slen||sarr[i]&gt;x) return;</span><br><span class="line">	j=i;</span><br><span class="line">	while(sarr[i]==x &amp;&amp; i&lt;slen) i++;</span><br><span class="line">	for(;i&lt;slen;i++,j++)</span><br><span class="line">		sarr[j]=sarr[i];</span><br><span class="line">	slen=j;</span><br><span class="line"> &#125; </span><br><span class="line">void adjust_order(se* L) //å¥‡æ•°æ”¾åœ¨å°¾éƒ¨ï¼Œå¶æ•°æ”¾åœ¨å¤´éƒ¨</span><br><span class="line">&#123;</span><br><span class="line">	int i=0,j=slen-1,k=0;</span><br><span class="line">	while(i&lt;j)&#123;</span><br><span class="line">		while(i&lt;j &amp;&amp; sarr[i]%2==0) i++;</span><br><span class="line">		while(j&gt;i &amp;&amp; sarr[j]%2==1) j--;</span><br><span class="line">		if(i&lt;j)&#123;</span><br><span class="line">			k=sarr[i];sarr[i]=sarr[j];sarr[j]=k;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">void dele_range(se* L,int x,int y)  //åˆ é™¤æŒ‡å®šèŒƒå›´å†…çš„æ•°æ® </span><br><span class="line">&#123;</span><br><span class="line">	int i=0;</span><br><span class="line">	for(i=0;i&lt;slen;)</span><br><span class="line">	&#123;</span><br><span class="line">		if(sarr[i]&gt;x&amp;&amp;sarr[i]&lt;y)</span><br><span class="line">			delete_sub(L,i);</span><br><span class="line">		else i++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">void merge_list(se* X,se* Y,se* Z)	//ä¸¤ä¸ªé™åºåˆæˆå‡åº  </span><br><span class="line">&#123;</span><br><span class="line">	int i=0,j=0,k=X-&gt;len+Y-&gt;len-1;</span><br><span class="line">	while(i&lt;X-&gt;len&amp;&amp;j&lt;Y-&gt;len)&#123;</span><br><span class="line">		if(X-&gt;a[i]&lt;Y-&gt;a[j])&#123;</span><br><span class="line">			Z-&gt;a[k]=Y-&gt;a[j];</span><br><span class="line">			j++;</span><br><span class="line">			k--;</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			Z-&gt;a[k]=X-&gt;a[i];</span><br><span class="line">			i++;</span><br><span class="line">			k--;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	while(i&lt;X-&gt;len)&#123;</span><br><span class="line">		Z-&gt;a[k]=X-&gt;a[i];</span><br><span class="line">			i++;</span><br><span class="line">			k--;</span><br><span class="line">	&#125;</span><br><span class="line">	while(j&lt;Y-&gt;len)&#123;</span><br><span class="line">		Z-&gt;a[k]=Y-&gt;a[j];</span><br><span class="line">			j++;</span><br><span class="line">			k--;</span><br><span class="line">	&#125;</span><br><span class="line">	Z-&gt;len=i+j;</span><br><span class="line"> &#125; </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">//	se L;</span><br><span class="line">//	input_data(&amp;L);</span><br><span class="line">//	print_data(&amp;L);</span><br><span class="line">//	delete_sub(&amp;L,6);</span><br><span class="line">//	insert_data(&amp;L,0);</span><br><span class="line">//	dele_data(&amp;L,6); </span><br><span class="line">//	change_order(&amp;L);</span><br><span class="line">//	adjust_order(&amp;L);</span><br><span class="line">//	print_data(&amp;L);</span><br><span class="line">//	dele_range(&amp;L,10,20);</span><br><span class="line">	se X,Y,Z;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥Xé¡ºåºè¡¨ï¼š\n&quot;);</span><br><span class="line">	input_data(&amp;X);</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥Yé¡ºåºè¡¨ï¼š\n&quot;);</span><br><span class="line">	input_data(&amp;Y);</span><br><span class="line">	printf(&quot;åˆå¹¶åï¼š\n&quot;);</span><br><span class="line">	merge_list(&amp;X,&amp;Y,&amp;Z);</span><br><span class="line">	print_data(&amp;Z);</span><br><span class="line">&#125;</span><br><span class="line">//1 2 3 4 5 6 -1</span><br><span class="line">//1 2 3 4 5 7 8 -1</span><br><span class="line">//1 8 9 10 11 14 16 18 20 21 -1</span><br><span class="line">//10 8 6 4 2 -1</span><br><span class="line">//9 7 5 3 1 -1</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€å•é“¾è¡¨"><a href="#äºŒã€å•é“¾è¡¨" class="headerlink" title="äºŒã€å•é“¾è¡¨"></a>äºŒã€å•é“¾è¡¨</h2><h3 id="1ã€å¤´ç»“ç‚¹å‹å•é“¾è¡¨"><a href="#1ã€å¤´ç»“ç‚¹å‹å•é“¾è¡¨" class="headerlink" title="1ã€å¤´ç»“ç‚¹å‹å•é“¾è¡¨"></a>1ã€å¤´ç»“ç‚¹å‹å•é“¾è¡¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#define newnode (node* )malloc(sizeof(node))</span><br><span class="line">typedef struct k&#123;  //å®šä¹‰ç»“æ„ä½“ </span><br><span class="line">	int data;</span><br><span class="line">	struct k* next;   </span><br><span class="line">&#125;node;</span><br><span class="line">node* creat()&#123;     //å°¾æ¥æ³•åˆ›å»ºå•é“¾è¡¨</span><br><span class="line">	node *h,*t,*input;</span><br><span class="line">	int x;</span><br><span class="line">	h=newnode;h-&gt;next=NULL;</span><br><span class="line">	t=h;			//tå’Œhéƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œæ‰§è¡Œè¿™ä¸ªæ“ä½œåï¼Œtå’Œhå°†ä¼šæŒ‡å‘åŒä¸€ä¸ªç»“æ„ä½“ </span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä¸€ç»„æ•°ï¼Œä»¥-1ç»“æŸï¼š\n&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">	while(x!=-1)&#123;</span><br><span class="line">		input=newnode,input-&gt;next=NULL;input-&gt;data=x;</span><br><span class="line">		t-&gt;next=input;</span><br><span class="line">		t=input;</span><br><span class="line">		scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">	&#125;</span><br><span class="line">	return h;</span><br><span class="line">&#125;</span><br><span class="line">node* head_creat()&#123;    //å¤´æ¥æ³•åˆ›å»ºå•é“¾è¡¨ </span><br><span class="line">	node *h,*p;int x;</span><br><span class="line">	h=newnode;h-&gt;next=NULL;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä¸€ç»„æ•°ï¼Œä»¥-1ç»“æŸï¼š\n&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">	while(x!=-1)&#123;</span><br><span class="line">		p=newnode;p-&gt;next=NULL;p-&gt;data=x;</span><br><span class="line">		p-&gt;next=h-&gt;next;h-&gt;next=p;</span><br><span class="line">		scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">	&#125;</span><br><span class="line">	return h;</span><br><span class="line">&#125;</span><br><span class="line">void printlist(node *h)&#123;   //æ‰“å°å•é“¾è¡¨ </span><br><span class="line">	node* p;</span><br><span class="line">	for(p=h-&gt;next;p!=NULL;p=p-&gt;next)&#123;</span><br><span class="line">		printf(&quot;%d-&gt;&quot;,p-&gt;data);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">void insert_data(node *h,int x)&#123;   //å‡åºè¡¨æ’å…¥x </span><br><span class="line">	node *p;p=newnode;p-&gt;data=x;p-&gt;next=NULL;</span><br><span class="line">	node *q,*s;</span><br><span class="line">	q=h;s=h-&gt;next;</span><br><span class="line">	while(s!=NULL)&#123;</span><br><span class="line">		if(s-&gt;data&gt;=x) break;</span><br><span class="line">		s=s-&gt;next;</span><br><span class="line">		q=q-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	p-&gt;next=s;q-&gt;next=p;</span><br><span class="line">&#125; </span><br><span class="line">void delet_data(node *h,int x)&#123;     //å‡åºè¡¨åˆ é™¤æ‰€æœ‰x </span><br><span class="line">	node *p,*q;</span><br><span class="line">	p=h;</span><br><span class="line">	while(p-&gt;next!=NULL &amp;&amp; p-&gt;next-&gt;data&lt;x) p=p-&gt;next;  //pä¼šåœåœ¨xä¹‹å‰</span><br><span class="line">	if(p-&gt;next==NULL||p-&gt;next-&gt;data&gt;x) return;   //å¦‚æœæ²¡æœ‰xåˆ™é€€å‡º </span><br><span class="line">	q=p-&gt;next;</span><br><span class="line">	while(q!=NULL &amp;&amp; q-&gt;data==x) q=q-&gt;next;		//qä¼šåœåœ¨xä¹‹å </span><br><span class="line">	p-&gt;next=q;	//æŠŠqç²˜åœ¨påé¢ </span><br><span class="line">&#125;</span><br><span class="line">node* comflate(node *h1,node *h2)&#123;	//ä¸¤ä¸ªå‡åºè¡¨åˆæˆä¸€ä¸ªé™åºè¡¨</span><br><span class="line">	 node *h3,*a,*b,*c;</span><br><span class="line">	 h3=newnode;h3-&gt;next=NULL;</span><br><span class="line">	 a=h1-&gt;next;b=h2-&gt;next;</span><br><span class="line">	 while(a!=NULL &amp;&amp; b!=NULL)&#123;</span><br><span class="line">	 	if(a-&gt;data&lt;b-&gt;data) &#123;c=a;a=a-&gt;next;&#125;</span><br><span class="line">	 	else &#123;c=b;b=b-&gt;next;&#125;</span><br><span class="line">		c-&gt;next=h3-&gt;next;h3-&gt;next=c;</span><br><span class="line">	 &#125;</span><br><span class="line">	 if(a==NULL)</span><br><span class="line">	 	while(b!=NULL) &#123;c=b;b=b-&gt;next;c-&gt;next=h3-&gt;next;h3-&gt;next=c;&#125;</span><br><span class="line">	 else</span><br><span class="line">		while(a!=NULL) &#123;c=a;a=a-&gt;next;c-&gt;next=h3-&gt;next;h3-&gt;next=c;&#125;</span><br><span class="line">	return h3;</span><br><span class="line">&#125;</span><br><span class="line">void find_K(node *h,int k)&#123;		//ä¸€éæ‰«æï¼Œå®šä½è¯¥é“¾è¡¨å€’æ•°ç¬¬Kï¼ˆK&gt;0ï¼‰ä¸ªç»“ç‚¹</span><br><span class="line">	node *p,*q;p=q=h;int i=0;</span><br><span class="line">	while(q!=NULL)&#123;   //qå…ˆå¯»åˆ°ç¬¬kä¸ª </span><br><span class="line">		q=q-&gt;next;i++;</span><br><span class="line">		if(i==k) break;</span><br><span class="line">	&#125;</span><br><span class="line">	if(i!=k) &#123;printf(&quot;ä¸å­˜åœ¨å€’æ•°ç¬¬%dä¸ª&quot;,k);return;&#125;</span><br><span class="line">	//åˆ°æ­¤è¯´æ˜å­˜åœ¨å€’æ•°ç¬¬kä¸ª</span><br><span class="line">	while(q!=NULL)&#123;q=q-&gt;next;p=p-&gt;next;&#125;</span><br><span class="line">	printf(&quot;%d &quot;,p-&gt;data);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">void find_mid(node *h)&#123;//ç»™å®šä¸€å¸¦è¡¨å¤´çš„å•é“¾è¡¨ï¼Œåªå…è®¸ä¸€éæ‰«æï¼Œå®šä½è¯¥é“¾è¡¨ä¸­ç‚¹å…ƒç´ ï¼Œå¹¶è¾“å‡ºå…±æœ‰å¤šå°‘å…ƒç´ ï¼Œ</span><br><span class="line">					   //ä¸­ç‚¹å…ƒç´ æ˜¯ç¬¬å‡ ä¸ªï¼Œå€¼ä¸ºå¤šå°‘</span><br><span class="line">	node *p,*q;int count =0,sum=0;</span><br><span class="line">	if(h==NULL)&#123;printf(&quot;æ­¤ä¸ºç©ºè¡¨&quot;);return;&#125;</span><br><span class="line">	p=q=h;</span><br><span class="line">	while(q!=NULL&amp;&amp;q-&gt;next!=NULL)&#123;</span><br><span class="line">		p=p-&gt;next;count++;</span><br><span class="line">		q=q-&gt;next;sum++;</span><br><span class="line">		q=q-&gt;next;</span><br><span class="line">		if(q!=NULL) sum++;</span><br><span class="line">	&#125;</span><br><span class="line">	if(sum%2==1)</span><br><span class="line">	    printf(&quot;æœ‰%dä¸ªå…ƒç´ ï¼Œä¸­ç‚¹å…ƒç´ æ˜¯ç¬¬%dä¸ªï¼Œå€¼ä¸º%d\n&quot;,sum,count,p-&gt;data);</span><br><span class="line">	else</span><br><span class="line">		printf(&quot;æœ‰%dä¸ªå…ƒç´ ï¼Œä¸­ç‚¹å…ƒç´ æ˜¯ç¬¬%dä¸ªå’Œç¬¬%dä¸ªï¼Œå€¼åˆ†åˆ«ä¸º%då’Œ%d\n&quot;,sum,count,count+1,p-&gt;data,p-&gt;next-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	node *h,*h1,*h2,*h3;</span><br><span class="line">	h=creat();</span><br><span class="line">//	h=head_creat();</span><br><span class="line">	printlist(h);</span><br><span class="line">//	insert_data(h,5);</span><br><span class="line">//	delet_data(h,5);</span><br><span class="line">//	printf(&quot;è¯·è¾“å…¥h1:\n&quot;);</span><br><span class="line">//	h1=creat();</span><br><span class="line">//	printf(&quot;è¯·è¾“å…¥h2:\n&quot;);</span><br><span class="line">//	h2=creat();</span><br><span class="line">//	h3=comflate(h1,h2);</span><br><span class="line">//	printlist(h3);</span><br><span class="line">//  find_K(h,5);</span><br><span class="line">	find_mid(h);</span><br><span class="line">&#125;</span><br><span class="line">// 1 2 3 4 5 6 -1</span><br><span class="line">// h1 = 1 3 5 7 9 -1</span><br><span class="line">// h2 = 2 4 6 8 10 -1</span><br></pre></td></tr></table></figure>

<h3 id="2ã€å¤´æŒ‡é’ˆå‹å•é“¾è¡¨"><a href="#2ã€å¤´æŒ‡é’ˆå‹å•é“¾è¡¨" class="headerlink" title="2ã€å¤´æŒ‡é’ˆå‹å•é“¾è¡¨"></a>2ã€å¤´æŒ‡é’ˆå‹å•é“¾è¡¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#define newnode (node *)malloc(sizeof(node))</span><br><span class="line">typedef struct k&#123;</span><br><span class="line">	int data;</span><br><span class="line">	struct k *next;</span><br><span class="line">&#125;node;</span><br><span class="line">node *creat()&#123;	//å¤´æ’æ³•åˆ›å»ºå¤´æŒ‡é’ˆå‹å•é“¾è¡¨ </span><br><span class="line">	node *p,*h;</span><br><span class="line">	int x;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä¸€ç»„æ•°ï¼Œä»¥-1ç»“å°¾ï¼š\n&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">	if(x==-1) return NULL;</span><br><span class="line">	h=newnode;h-&gt;next=NULL;h-&gt;data=x;</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">	while(x!=-1)&#123;</span><br><span class="line">		p=newnode;p-&gt;data=x;</span><br><span class="line">		p-&gt;next=h;h=p; </span><br><span class="line">		scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">	&#125;</span><br><span class="line">	return h;</span><br><span class="line">&#125;</span><br><span class="line">void printlist(node *h)&#123;	//è¾“å‡ºè¡¨ </span><br><span class="line">	node *p;</span><br><span class="line">	for(p=h;p!=NULL;p=p-&gt;next)&#123;</span><br><span class="line">		printf(&quot;%d-&gt;&quot;,p-&gt;data);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">node *insert(node *h,int x)&#123;	//å‡åºè¡¨æ’å…¥X </span><br><span class="line">	node *p;</span><br><span class="line">	p=newnode;p-&gt;next=NULL;p-&gt;data=x;</span><br><span class="line">	if(h==NULL) return p;</span><br><span class="line">	if(x&lt;h-&gt;data)&#123;</span><br><span class="line">		p-&gt;next=h;</span><br><span class="line">		return p;</span><br><span class="line">	&#125;</span><br><span class="line">	node *pre,*q;</span><br><span class="line">	pre=h;q=h-&gt;next;</span><br><span class="line">	while(q!=NULL&amp;&amp;x&gt;q-&gt;data)&#123;q=q-&gt;next;pre=pre-&gt;next;&#125;;</span><br><span class="line">	pre-&gt;next=p;p-&gt;next=q;</span><br><span class="line">	return h;</span><br><span class="line">&#125;</span><br><span class="line">node *deletlist(node *h,int x)&#123;	//å‡åºè¡¨åˆ é™¤ x</span><br><span class="line">	node *p,*q,*d;</span><br><span class="line">	if(h==NULL) return NULL;</span><br><span class="line">	if(h-&gt;data==x)&#123;</span><br><span class="line">		p=h;</span><br><span class="line">		while(p!=NULL&amp;&amp;p-&gt;data==x)&#123;q=p;p=p-&gt;next;free(q);&#125;</span><br><span class="line">		return p;</span><br><span class="line">	&#125;</span><br><span class="line">	p=h;q=h-&gt;next;</span><br><span class="line">	while(p-&gt;next!=NULL&amp;&amp;p-&gt;next-&gt;data&lt;x) p=p-&gt;next;</span><br><span class="line">	q=p-&gt;next;</span><br><span class="line">	while(q!=NULL&amp;&amp;q-&gt;data==x) &#123;d=q;q=q-&gt;next;free(d);&#125;</span><br><span class="line">	p-&gt;next=q;</span><br><span class="line">	return h;</span><br><span class="line">&#125;</span><br><span class="line">void dele_ev_insert(node **h1,node **h2)&#123;	//ç»™å®šh1ï¼Œå°†å…¶ä¸­çš„æ‰€æœ‰å¶æ•°ç»“ç‚¹æ‘˜é™¤ï¼Œä¾æ¬¡ã€å°¾æ’ã€‘æ’å…¥h2</span><br><span class="line">	node *p,*q,*temp,*pre;int x=0; </span><br><span class="line">	if(*h2==NULL) &#123;//å¦‚æœh2ä¸ºç©ºè¡¨ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªæš‚æ—¶çš„å¤´ç»“ç‚¹ï¼Œåé¢å†åˆ æ‰ </span><br><span class="line">		temp=newnode;temp-&gt;next=NULL;</span><br><span class="line">		*h2=temp; x=1;  //xç”¨æ¥åˆ¤æ–­æ˜¯å¦åˆ›å»ºäº†ç»“ç‚¹ </span><br><span class="line">	&#125;</span><br><span class="line">	if(*h1==NULL) return; //å¦‚æœh1æ˜¯ç©ºè¡¨ï¼Œç›´æ¥ç»“æŸ </span><br><span class="line">	q=*h2;</span><br><span class="line">	while(q-&gt;next!=NULL) q=q-&gt;next;//qæ‰¾åˆ°æœ«å°¾ </span><br><span class="line">	while(*h1!=NULL&amp;&amp;(*h1)-&gt;data%2==0)&#123;//h1ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¶æ•°æ—¶ </span><br><span class="line">		q-&gt;next=*h1;q=*h1;		//å¶æ•°ç»“ç‚¹è´´åˆ°h2 </span><br><span class="line">		*h1=(*h1)-&gt;next; 		//h1å¾€åç§» </span><br><span class="line">	&#125;</span><br><span class="line">	if(*h1==NULL) return;</span><br><span class="line">	pre=*h1;p=(*h1)-&gt;next;</span><br><span class="line">	while(p!=NULL)&#123;</span><br><span class="line">		if(p-&gt;data%2==0)&#123;</span><br><span class="line">			q-&gt;next=p;q=p;</span><br><span class="line">			p=p-&gt;next;pre-&gt;next=p;</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;p=p-&gt;next;pre=pre-&gt;next;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	q-&gt;next=NULL;</span><br><span class="line">	if(x==1)&#123;*h2=(*h2)-&gt;next;free(temp);&#125; //å¦‚æœå‰é¢åˆ›å»ºè¿‡ä¸´æ—¶ç»“ç‚¹ï¼Œé‚£ä¹ˆç°åœ¨åˆ æ‰ </span><br><span class="line">&#125;</span><br><span class="line">node *findmax(node *h)&#123;//å¯»æ‰¾æœ€å¤§ç»“ç‚¹ï¼Œå¹¶æ’å…¥åˆ°è¡¨å¤´</span><br><span class="line">	node *pmax,*max,*pre,*p;//maxæŒ‡å‘æœ€å¤§çš„é‚£ä¸ªç»“ç‚¹ï¼ŒpmaxæŒ‡å‘maxåé¢ï¼Œpéå†å¯»æ‰¾ ,preæŒ‡å‘påé¢ </span><br><span class="line">	if(h==NULL) return NULL;</span><br><span class="line">	if(h-&gt;next==NULL) return h;</span><br><span class="line">	pre=h;p=h-&gt;next;pmax=NULL;max=h;</span><br><span class="line">	while(p!=NULL)&#123;</span><br><span class="line">		if(p-&gt;data&gt;max-&gt;data)&#123;max=p;pmax=pre;&#125;</span><br><span class="line">		pre=pre-&gt;next;p=p-&gt;next;</span><br><span class="line">	&#125; </span><br><span class="line">	if(pmax==NULL) return h;//å¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æœ€å¤§çš„ï¼Œé‚£ä¹ˆè¿”å›åŸæ · </span><br><span class="line">	pmax-&gt;next=max-&gt;next;max-&gt;next=h;return max;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	node *h,*h1,*h2;</span><br><span class="line">//	h=creat();</span><br><span class="line">//	printlist(h);</span><br><span class="line">//	h=insert(h,4);</span><br><span class="line">//	printlist(h);</span><br><span class="line">//	h=deletlist(h,4);</span><br><span class="line">//	printlist(h);</span><br><span class="line">	h1=creat();</span><br><span class="line">	printlist(h1);</span><br><span class="line">	h2=creat();</span><br><span class="line">	printlist(h2);</span><br><span class="line">	dele_ev_insert(&amp;h1,&amp;h2); //ç”±äºå‡½æ•°æ— æ³•åŒæ—¶è¿”å›ä¸¤ä¸ªè¡¨å¤´ï¼Œä½†æ˜¯ä¸¤ä¸ªè¡¨éƒ½è¦ä¿®æ”¹ï¼Œæ‰€ä»¥ä½¿ç”¨äºŒçº§æŒ‡é’ˆ </span><br><span class="line">	printf(&quot;h1è¡¨\n&quot;);</span><br><span class="line">	printlist(h1);</span><br><span class="line">	printf(&quot;h2è¡¨\n&quot;);</span><br><span class="line">	printlist(h2);</span><br><span class="line">//	h=findmax(h);</span><br><span class="line">//	printlist(h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€é˜Ÿåˆ—"><a href="#ä¸‰ã€é˜Ÿåˆ—" class="headerlink" title="ä¸‰ã€é˜Ÿåˆ—"></a>ä¸‰ã€é˜Ÿåˆ—</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//1ã€è®¾è®¡æœ€å¤šèƒ½å­˜å‚¨10ä¸ªå…ƒç´ çš„å¾ªç¯é˜Ÿåˆ—ï¼Œå¹¶å®Œæˆåˆå§‹åŒ–ã€å…¥é˜Ÿã€å‡ºé˜Ÿã€åˆ¤ç©ºã€åˆ¤æ»¡ã€è®¡ç®—å…ƒç´ ä¸ªæ•°ç­‰å…­ä¸ªåŸºæœ¬æ“ä½œã€‚</span><br><span class="line">//2ã€è®¾è®¡é“¾å¼é˜Ÿåˆ—ï¼Œå®Œæˆåˆå§‹åŒ–ã€å…¥é˜Ÿã€å‡ºé˜Ÿã€åˆ¤ç©ºå››ä¸ªåŸºæœ¬æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#define newnode (node*)malloc(sizeof(node)) </span><br><span class="line">#define cycnode (cycle*)malloc(sizeof(cycle)) </span><br><span class="line">typedef struct k&#123;		//é“¾å¼é˜Ÿåˆ—ç»“ç‚¹ </span><br><span class="line">	int data;</span><br><span class="line">	struct k *next;</span><br><span class="line">&#125;node;</span><br><span class="line">typedef struct&#123;			//é“¾å¼é˜Ÿåˆ—å¤´å°¾ </span><br><span class="line">	node *head,*tail;</span><br><span class="line">&#125;ht;</span><br><span class="line">typedef struct&#123;</span><br><span class="line">	int a[11];</span><br><span class="line">	int front,rear;</span><br><span class="line">&#125;cycle; </span><br><span class="line">ht *creat()&#123;  //é“¾å¼é˜Ÿåˆ—å»ºè¡¨å¹¶åˆå§‹åŒ– </span><br><span class="line">	ht *qu;</span><br><span class="line">	qu=(ht*)malloc(sizeof(ht));</span><br><span class="line">	qu-&gt;head=NULL;qu-&gt;tail=NULL;</span><br><span class="line">	return qu;</span><br><span class="line">&#125;</span><br><span class="line">ht *insert(ht *q,int x)&#123;	//é“¾å¼é˜Ÿåˆ—å…¥é˜Ÿ </span><br><span class="line">	node *p;p=newnode;</span><br><span class="line">	p-&gt;data=x;p-&gt;next=NULL;</span><br><span class="line">	if(q-&gt;head==NULL) &#123;q-&gt;head=p;q-&gt;tail=p;&#125;  //å¦‚è‹¥ä¸ºç©º </span><br><span class="line">	else &#123;q-&gt;tail-&gt;next=p;q-&gt;tail=p;&#125;</span><br><span class="line">	return q;</span><br><span class="line">&#125;</span><br><span class="line">ht *dele(ht *q)&#123;	//é“¾å¼é˜Ÿåˆ—å‡ºé˜Ÿ </span><br><span class="line">	node *p;</span><br><span class="line">	if(q-&gt;head==NULL) &#123;printf(&quot;é˜Ÿåˆ—ä¸ºç©ºï¼Œæ— æ³•åˆ é™¤ï¼&quot;);return q;&#125;</span><br><span class="line">	p=q-&gt;head;q-&gt;head=p-&gt;next;</span><br><span class="line">	free(p);</span><br><span class="line">	if(q-&gt;head==NULL) q-&gt;tail=NULL;  //å¦‚æœå¦‚æœé˜Ÿåˆ—å˜ç©º </span><br><span class="line">	return q; </span><br><span class="line">&#125;</span><br><span class="line">int empty(ht *q)&#123;		//é“¾å¼é˜Ÿåˆ—åˆ¤ç©º </span><br><span class="line">	return (q-&gt;head==NULL)?0:1;</span><br><span class="line">&#125;</span><br><span class="line">void print(ht *q)&#123;	    //é“¾å¼é˜Ÿåˆ—æ‰“å°</span><br><span class="line">	if(q-&gt;head==NULL) &#123;printf(&quot;é˜Ÿåˆ—ä¸ºç©º\n&quot;);return;&#125;</span><br><span class="line">	node *p;p=q-&gt;head;</span><br><span class="line">	while(p!=NULL)&#123;</span><br><span class="line">		printf(&quot;%d &quot;,p-&gt;data);</span><br><span class="line">		p=p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">void cyc_creat(cycle *L)&#123;		//åˆå§‹åŒ–å¾ªç¯é˜Ÿåˆ— </span><br><span class="line">	 L-&gt;front=0;L-&gt;rear=0;</span><br><span class="line">&#125;</span><br><span class="line">void cyc_insert(cycle *L,int x)&#123;		//å¾ªç¯é˜Ÿåˆ—å…¥é˜Ÿ </span><br><span class="line">	if((L-&gt;rear+1)%11==L-&gt;front)&#123;printf(&quot;é˜Ÿåˆ—å·²æ»¡ï¼Œæ— æ³•å…¥é˜Ÿï¼\n&quot;);return;&#125;</span><br><span class="line">	int i=L-&gt;rear;</span><br><span class="line">	L-&gt;a[i]=x;</span><br><span class="line">	L-&gt;rear=(L-&gt;rear+1)%11;          ;</span><br><span class="line">&#125;</span><br><span class="line">int cyc_dele(cycle *L)&#123;	//å¾ªç¯é˜Ÿåˆ—å‡ºé˜Ÿ ,ä¸ºç©ºè¿”å›-1ï¼Œä¸ä¸ºç©ºè¿”å›å…ƒç´  </span><br><span class="line">	if(L-&gt;rear==L-&gt;front)&#123;printf(&quot;é˜Ÿåˆ—ä¸ºç©ºï¼Œæ— æ³•å‡ºé˜Ÿï¼\n&quot;);return -1;&#125;</span><br><span class="line">	int i=L-&gt;front;</span><br><span class="line">	L-&gt;front=(L-&gt;front+1)%11;return L-&gt;a[i];</span><br><span class="line">&#125;</span><br><span class="line">int cyc_empty(cycle *L)&#123;   //å¾ªç¯é˜Ÿåˆ—åˆ¤ç©º ,ç©ºè¿”å›0ï¼Œéç©ºè¿”å›1 </span><br><span class="line">	if(L-&gt;rear==L-&gt;front)</span><br><span class="line">		return 0;</span><br><span class="line">	else return 1;</span><br><span class="line">&#125;</span><br><span class="line">int cyc_fill(cycle *L)&#123;  //å¾ªç¯é˜Ÿåˆ—åˆ¤æ»¡ï¼Œæ»¡è¿”å›1ï¼Œæ²¡æ»¡è¿”å›0 </span><br><span class="line">	 return ((L-&gt;rear+1)%11==L-&gt;front)?1:0;  //æ»¡äº†è¿”å›1ï¼Œæ²¡æ»¡è¿”å›0 </span><br><span class="line">&#125;</span><br><span class="line">int cyc_sum(cycle *L)&#123;  //å¾ªç¯é˜Ÿåˆ—è®¡ç®—ä¸ªæ•°</span><br><span class="line">	return (L-&gt;rear-L-&gt;front+11)%11; </span><br><span class="line">&#125;  </span><br><span class="line">void cyc_print(cycle *L)&#123;</span><br><span class="line">	while(L-&gt;rear!=L-&gt;front)&#123;</span><br><span class="line">		printf(&quot;%d &quot;,L-&gt;a[L-&gt;front]);</span><br><span class="line">		L-&gt;front=(L-&gt;front+1)%11;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">//	ht *q;q=creat();</span><br><span class="line">//	printf(&quot;%d\n&quot;,empty(q));</span><br><span class="line">//	q=insert(q,3);q=insert(q,3);q=insert(q,3);</span><br><span class="line">//	q=dele(q);</span><br><span class="line">//	print(q);</span><br><span class="line">	cycle L;</span><br><span class="line">	creat(&amp;L); </span><br><span class="line">	cyc_insert(&amp;L,3);cyc_insert(&amp;L,4);</span><br><span class="line">	cyc_print(&amp;L);	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿ</title>
    <url>/posts/1079/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h1 id="ç¬¬ä¸€å‘¨ï¼šæ¨¡æ‹Ÿé˜Ÿåˆ—ç®¡ç†"><a href="#ç¬¬ä¸€å‘¨ï¼šæ¨¡æ‹Ÿé˜Ÿåˆ—ç®¡ç†" class="headerlink" title="ç¬¬ä¸€å‘¨ï¼šæ¨¡æ‹Ÿé˜Ÿåˆ—ç®¡ç†"></a>ç¬¬ä¸€å‘¨ï¼šæ¨¡æ‹Ÿé˜Ÿåˆ—ç®¡ç†</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// é˜Ÿåˆ—çš„ç®¡ç†è¿‡ç¨‹</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#define max 11</span><br><span class="line">typedef struct queue&#123;</span><br><span class="line">    int rear,front;</span><br><span class="line">    int arr[max];</span><br><span class="line">&#125;queue;</span><br><span class="line">void init(queue *q)&#123;  //é˜Ÿåˆ—åˆå§‹åŒ–</span><br><span class="line">    q-&gt;front=q-&gt;rear=0;</span><br><span class="line">&#125;</span><br><span class="line">void print_queue(queue *q)&#123;  //æ‰“å°é˜Ÿåˆ—</span><br><span class="line">    int i;</span><br><span class="line">    printf(&quot;è¯¥é˜Ÿåˆ—ä¸ºï¼š\n&quot;);</span><br><span class="line">    for(i=q-&gt;front;i&lt;q-&gt;rear;i++) printf(&quot;%d &quot;,q-&gt;arr[i]);</span><br><span class="line">    printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int is_full(queue *q)&#123;  //åˆ¤æ»¡</span><br><span class="line">    return (q-&gt;rear+1)%max==q-&gt;front;</span><br><span class="line">&#125;</span><br><span class="line">int is_empty(queue *q)&#123;  //åˆ¤ç©º</span><br><span class="line">    return q-&gt;front==q-&gt;rear;</span><br><span class="line">&#125;</span><br><span class="line">queue *creat()&#123;  // åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">    int i,num,data;</span><br><span class="line">    queue *q;</span><br><span class="line">    q=(queue *)malloc(sizeof(queue));</span><br><span class="line">    init(q);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥éœ€è¦åˆ›å»ºé˜Ÿåˆ—çš„ä¸ªæ•°:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥ä½ éœ€è¦æ’å…¥çš„å€¼:&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;data);</span><br><span class="line">        if(is_full(q)==1) &#123;printf(&quot;é˜Ÿåˆ—å·²æ»¡!/n&quot;);break;&#125;</span><br><span class="line">        q-&gt;arr[q-&gt;rear]=data;</span><br><span class="line">        q-&gt;rear=(q-&gt;rear+1)%max;</span><br><span class="line">    &#125;</span><br><span class="line">    return q;</span><br><span class="line">&#125;</span><br><span class="line">void enqueue(queue *q)&#123;  // å…¥é˜Ÿ</span><br><span class="line">    int data;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ä½ éœ€è¦æ’å…¥çš„å€¼:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;data);</span><br><span class="line">    if(is_full(q)==1) &#123;printf(&quot;é˜Ÿåˆ—å·²æ»¡!/n&quot;);return;&#125;</span><br><span class="line">    q-&gt;arr[q-&gt;rear]=data;</span><br><span class="line">    q-&gt;rear=(q-&gt;rear+1)%max;</span><br><span class="line">&#125;</span><br><span class="line">int dequeue(queue *q)&#123;  // å‡ºé˜Ÿ</span><br><span class="line">    int data;</span><br><span class="line">    if(is_empty(q)) &#123;printf(&quot;é˜Ÿåˆ—ä¸ºç©º!\n&quot;);return -1;&#125;</span><br><span class="line">    data=q-&gt;arr[q-&gt;front];</span><br><span class="line">    q-&gt;front=(q-&gt;front+1)%max;</span><br><span class="line">    printf(&quot;å‡ºé˜Ÿçš„å…ƒç´ ä¸ºï¼š%d\n&quot;,data);</span><br><span class="line">    return data;</span><br><span class="line">&#125;</span><br><span class="line">void clear(queue *q)&#123;  // æ¸…ç©ºé˜Ÿåˆ—</span><br><span class="line">    q-&gt;front=q-&gt;rear=0;</span><br><span class="line">&#125;</span><br><span class="line">void print_table()&#123;  // æ‰“å°æ“ä½œè¡¨</span><br><span class="line">    printf(&quot;********************************\n&quot;);</span><br><span class="line">    printf(&quot;*1ã€æ–°å»º                       *\n&quot;);</span><br><span class="line">    printf(&quot;*2ã€åˆå§‹åŒ–                     *\n&quot;);</span><br><span class="line">    printf(&quot;*3ã€å‡ºé˜Ÿ                       *\n&quot;);</span><br><span class="line">    printf(&quot;*4ã€å…¥é˜Ÿ                       *\n&quot;);</span><br><span class="line">    printf(&quot;*5ã€æ‰“å°é˜Ÿåˆ—                   *\n&quot;);</span><br><span class="line">    printf(&quot;*6ã€æ¸…ç©ºé˜Ÿåˆ—                   *\n&quot;);</span><br><span class="line">    printf(&quot;*7ã€é˜Ÿåˆ—æ˜¯å¦ä¸ºæ»¡               *\n&quot;);</span><br><span class="line">    printf(&quot;*8ã€é˜Ÿåˆ—æ˜¯å¦ç©º                 *\n&quot;);</span><br><span class="line">    printf(&quot;*9ã€é€€å‡º                       *\n&quot;);</span><br><span class="line">    printf(&quot;********************************\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int x;</span><br><span class="line">    queue *q;</span><br><span class="line">    print_table();</span><br><span class="line">    while(1)&#123;</span><br><span class="line">        printf(&quot;è¯·é€‰æ‹©è¦è¿›è¡Œçš„æ“ä½œ:&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">        switch(x)&#123;</span><br><span class="line">            case 1:q=creat();</span><br><span class="line">                   print_queue(q);</span><br><span class="line">                   break;</span><br><span class="line">            case 2:init(q);</span><br><span class="line">                    printf(&quot;é˜Ÿåˆ—æ˜¯ç©ºçš„\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 3:dequeue(q);</span><br><span class="line">                    print_queue(q);</span><br><span class="line">                    break;</span><br><span class="line">            case 4:enqueue(q);</span><br><span class="line">                    print_queue(q);</span><br><span class="line">                    break;</span><br><span class="line">            case 5:print_queue(q);</span><br><span class="line">                    break;</span><br><span class="line">            case 6:clear(q);</span><br><span class="line">                    if(is_empty(q)) printf(&quot;é˜Ÿåˆ—æ˜¯ç©ºçš„\n&quot;);</span><br><span class="line">                    else printf(&quot;é˜Ÿåˆ—ä¸æ˜¯ç©ºçš„\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 7:if(is_full(q)) printf(&quot;é˜Ÿåˆ—æ˜¯æ»¡çš„\n&quot;);</span><br><span class="line">                    else printf(&quot;é˜Ÿåˆ—ä¸æ˜¯æ»¡çš„\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 8:if(is_empty(q)) printf(&quot;é˜Ÿåˆ—æ˜¯ç©ºçš„\n&quot;);</span><br><span class="line">                    else printf(&quot;é˜Ÿåˆ—ä¸æ˜¯ç©ºçš„\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 9:exit(0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬ä¸‰å‘¨ï¼šFCFSè¿›ç¨‹è°ƒåº¦ç®—æ³•"><a href="#ç¬¬ä¸‰å‘¨ï¼šFCFSè¿›ç¨‹è°ƒåº¦ç®—æ³•" class="headerlink" title="ç¬¬ä¸‰å‘¨ï¼šFCFSè¿›ç¨‹è°ƒåº¦ç®—æ³•"></a>ç¬¬ä¸‰å‘¨ï¼šFCFSè¿›ç¨‹è°ƒåº¦ç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct Time &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct node &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[20];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    struct node* next;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line">typedef struct Q &#123;</span><br><span class="line">    Node* front;</span><br><span class="line">    Node* end;</span><br><span class="line">&#125; Queue;</span><br><span class="line"></span><br><span class="line">int compare(Time t1,Time t2)&#123;   //t1å…ˆåˆ°è¿”å›1ï¼Œt2å…ˆåˆ°è¿”å›0</span><br><span class="line">	int x1=t1.hour * 60 + t1.min;</span><br><span class="line">	int x2=t2.hour * 60 + t2.min;</span><br><span class="line">	return x1&lt;=x2;</span><br><span class="line">&#125;</span><br><span class="line">void creat(Queue *q)&#123;</span><br><span class="line">	int num,i;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¿›ç¨‹ä¸ªæ•°ï¼š\n&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">    printf(&quot;id   åå­—   åˆ°è¾¾æ—¶é—´   æ‰§è¡Œæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰\n&quot;);</span><br><span class="line">	Node *tmp=(Node *)malloc(sizeof(Node));</span><br><span class="line">	Node *p;</span><br><span class="line">	scanf(&quot;%d %s %d:%d %d&quot;, &amp;tmp-&gt;id, tmp-&gt;name,&amp;tmp-&gt;arrive.hour,&amp;tmp-&gt;arrive.min, &amp;tmp-&gt;zx);</span><br><span class="line">	tmp-&gt;next=NULL;</span><br><span class="line">	q-&gt;front=tmp;q-&gt;end=tmp;</span><br><span class="line">	for(i=0;i&lt;num-1;i++)&#123;</span><br><span class="line">		tmp=(Node *)malloc(sizeof(Node));</span><br><span class="line">		scanf(&quot;%d %s %d:%d %d&quot;, &amp;tmp-&gt;id, tmp-&gt;name, &amp;tmp-&gt;arrive.hour,&amp;tmp-&gt;arrive.min,&amp;tmp-&gt;zx);</span><br><span class="line">		tmp-&gt;next=NULL;</span><br><span class="line">		p=q-&gt;front;</span><br><span class="line">		if(compare(tmp-&gt;arrive,p-&gt;arrive)) &#123;tmp-&gt;next=q-&gt;front;q-&gt;front=tmp;&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			while(p-&gt;next!=NULL&amp;&amp;compare(p-&gt;next-&gt;arrive,tmp-&gt;arrive)) p=p-&gt;next;</span><br><span class="line">			tmp-&gt;next=p-&gt;next;p-&gt;next=tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">void print(Queue *q)&#123;</span><br><span class="line">	Node *tmp=q-&gt;front;</span><br><span class="line">	printf(&quot;æ¨¡æ‹Ÿè¿›ç¨‹FCFSè°ƒåº¦è¿‡ç¨‹è¾“å‡ºç»“æœ:\n&quot;);</span><br><span class="line">	printf(&quot;IDå· åå­— åˆ°è¾¾æ—¶é—´ æ‰§è¡Œæ—¶é—´(åˆ†é’Ÿ) å¼€å§‹æ—¶é—´ å®Œæˆæ—¶é—´ å‘¨è½¬æ—¶é—´(åˆ†é’Ÿ) å¸¦æƒå‘¨è½¬æ—¶é—´(ç³»æ•°)\n&quot;);</span><br><span class="line">	float _zz=0,_zzxs=0;</span><br><span class="line">	int num=0;</span><br><span class="line">	while(tmp!=NULL)&#123;</span><br><span class="line">		num++;</span><br><span class="line">		printf(&quot;%04d %-3s   %02d:%02d    %-12d  %02d:%02d  %02d:%02d   %-12d  %.2f\n&quot;, </span><br><span class="line">			tmp-&gt;id, tmp-&gt;name, tmp-&gt;arrive.hour,tmp-&gt;arrive.min,tmp-&gt;zx,tmp-&gt;start.hour,tmp-&gt;start.min,tmp-&gt;finish.hour,tmp-&gt;finish.min,tmp-&gt;zz,tmp-&gt;zzxs);</span><br><span class="line">		_zz+=tmp-&gt;zz;</span><br><span class="line">		_zzxs+=tmp-&gt;zzxs;</span><br><span class="line">		tmp=tmp-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;ç³»ç»Ÿå¹³å‡å‘¨è½¬æ—¶é—´ä¸ºï¼š%.2f\n&quot;,_zz/num);</span><br><span class="line">	printf(&quot;ç³»ç»Ÿå¸¦æƒå¹³å‡å‘¨è½¬æ—¶é—´: %.2f\n&quot;,_zzxs/num);</span><br><span class="line">&#125;</span><br><span class="line">void calculate(Node *p)&#123; //è®¡ç®—æ—¶é—´</span><br><span class="line">	p-&gt;finish.hour=p-&gt;start.hour+(p-&gt;start.min+p-&gt;zx)/60;</span><br><span class="line">	p-&gt;finish.min=(p-&gt;start.min+p-&gt;zx)%60;</span><br><span class="line">	p-&gt;zz=(p-&gt;finish.hour*60+p-&gt;finish.min)-(p-&gt;arrive.hour*60+p-&gt;arrive.min);</span><br><span class="line">	p-&gt;zzxs=(p-&gt;zz*1.00)/p-&gt;zx;</span><br><span class="line">&#125;</span><br><span class="line">void fcfs(Queue *q)&#123;</span><br><span class="line">	Time t0;</span><br><span class="line">	Node *tmp;</span><br><span class="line">	tmp=q-&gt;front;</span><br><span class="line">	t0=tmp-&gt;arrive;</span><br><span class="line">	tmp-&gt;start=t0;</span><br><span class="line">	calculate(tmp);</span><br><span class="line">	t0=tmp-&gt;finish;</span><br><span class="line">	tmp=tmp-&gt;next;</span><br><span class="line">	while(tmp!=NULL)&#123;</span><br><span class="line">		if(compare(t0,tmp-&gt;arrive))  t0=tmp-&gt;arrive;</span><br><span class="line">		tmp-&gt;start=t0;</span><br><span class="line">		calculate(tmp);</span><br><span class="line">		t0=tmp-&gt;finish;</span><br><span class="line">		tmp=tmp-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	while(1)&#123;</span><br><span class="line">		printf(&quot;è¯·è¾“å…¥æ“ä½œï¼š(1:å¼€å§‹è¿›ç¨‹; -1:ç»“æŸè¿›ç¨‹):&quot;);</span><br><span class="line">		int flag;</span><br><span class="line">		scanf(&quot;%d&quot;,&amp;flag);</span><br><span class="line">		if(flag==-1) break;</span><br><span class="line">		Queue q;</span><br><span class="line">		q.end=q.front=NULL;</span><br><span class="line">		creat(&amp;q);</span><br><span class="line">		fcfs(&amp;q);</span><br><span class="line">		print(&amp;q);</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">// 5001 p1 9:40 20</span><br><span class="line">// 5004 p4 10:10 10</span><br><span class="line">// 5005 p5 10:05 30</span><br><span class="line">// 5002 p2 9:55 15</span><br><span class="line">// 5003 p3 9:45 25</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬å››å‘¨ï¼šçŸ­è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦"><a href="#ç¬¬å››å‘¨ï¼šçŸ­è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦" class="headerlink" title="ç¬¬å››å‘¨ï¼šçŸ­è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦"></a>ç¬¬å››å‘¨ï¼šçŸ­è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;			//æ³¨ï¼šæ­¤ä»£ç æœ‰ç‚¹é—®é¢˜</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;limits.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct Process &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[10];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    struct Process* next;</span><br><span class="line">&#125; Process;</span><br><span class="line"></span><br><span class="line">//æ—¶é—´æ¯”è¾ƒå‡½æ•°</span><br><span class="line">int time_cmp(Time a, Time b) &#123;</span><br><span class="line">    return (a.hour * 60 + a.min) - (b.hour * 60 + b.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å¢åŠ æŒ‡å®šåˆ†é’Ÿæ•°</span><br><span class="line">Time add_mins(Time t, int mins) &#123;</span><br><span class="line">    int total = t.hour * 60 + t.min + mins;</span><br><span class="line">    return (Time)&#123;total / 60, total % 60&#125;;</span><br><span class="line">&#125;</span><br><span class="line">//æ—¶é—´å·®è®¡ç®—ï¼ˆåˆ†é’Ÿï¼‰</span><br><span class="line">int time_diff(Time end, Time start) &#123;</span><br><span class="line">    return (end.hour * 60 + end.min) - (start.hour * 60 + start.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//SJFè°ƒåº¦æ ¸å¿ƒç®—æ³•</span><br><span class="line">void sjf_scheduler(Process** head, int n) &#123;</span><br><span class="line">    Process* scheduled_head = NULL;</span><br><span class="line">    Process* scheduled_tail = NULL;  // æ–°å¢å°¾æŒ‡é’ˆ</span><br><span class="line">    Time current_time = &#123;9, 40&#125;;</span><br><span class="line">    int processed = 0;</span><br><span class="line"></span><br><span class="line">    while (processed &lt; n) &#123;</span><br><span class="line">        Process **prev = head;</span><br><span class="line">        Process *sel = NULL;</span><br><span class="line">        int min_time = INT_MAX;</span><br><span class="line">        Process **prev_sel = NULL;</span><br><span class="line"></span><br><span class="line">        while (*prev) &#123;</span><br><span class="line">            if ((*prev)-&gt;start.hour == 0 &amp;&amp; </span><br><span class="line">                time_cmp((*prev)-&gt;arrive, current_time) &lt;= 0) &#123;</span><br><span class="line">                if ((*prev)-&gt;zx &lt; min_time) &#123;</span><br><span class="line">                    min_time = (*prev)-&gt;zx;</span><br><span class="line">                    sel = *prev;</span><br><span class="line">                    prev_sel = prev;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = &amp;(*prev)-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (sel) &#123;</span><br><span class="line">            // è®¾ç½®è¿›ç¨‹æ—¶é—´</span><br><span class="line">            sel-&gt;start = (time_cmp(current_time, sel-&gt;arrive) &gt; 0) ? </span><br><span class="line">                        current_time : sel-&gt;arrive;</span><br><span class="line">            sel-&gt;finish = add_mins(sel-&gt;start, sel-&gt;zx);</span><br><span class="line">            sel-&gt;zz = time_diff(sel-&gt;finish, sel-&gt;arrive);</span><br><span class="line">            sel-&gt;zzxs = (float)sel-&gt;zz / sel-&gt;zx;</span><br><span class="line">            </span><br><span class="line">            current_time = sel-&gt;finish;</span><br><span class="line">            processed++;</span><br><span class="line">            </span><br><span class="line">            // ä»åŸé“¾è¡¨ç§»é™¤</span><br><span class="line">            if (prev_sel) &#123;</span><br><span class="line">                *prev_sel = sel-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // å°¾éƒ¨æ’å…¥</span><br><span class="line">            sel-&gt;next = NULL;</span><br><span class="line">            if (scheduled_head == NULL) &#123;</span><br><span class="line">                scheduled_head = scheduled_tail = sel;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                scheduled_tail-&gt;next = sel;</span><br><span class="line">                scheduled_tail = sel;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            current_time.min++;</span><br><span class="line">            if (current_time.min &gt;= 60) &#123;</span><br><span class="line">                current_time.hour++;</span><br><span class="line">                current_time.min = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *head = scheduled_head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int op, n;</span><br><span class="line">    Process *head = NULL;</span><br><span class="line"></span><br><span class="line">    while(1) &#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥æ“ä½œ(1ï¼šå¼€å§‹è¿›ç¨‹è°ƒåº¦ï¼›-1ï¼šç»“æŸè¿›ç¨‹)ï¼š&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;op);</span><br><span class="line">        </span><br><span class="line">        if(op == -1) break;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;è¯·è¾“å…¥è¿›ç¨‹æ•°ï¼š&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;idå· åå­— åˆ°è¾¾æ—¶é—´ æ‰§è¡Œæ—¶é—´\n&quot;);</span><br><span class="line">        for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">            Process *p = (Process*)malloc(sizeof(Process));</span><br><span class="line">            scanf(&quot;%d %s %d:%d %d&quot;, </span><br><span class="line">                 &amp;p-&gt;id, p-&gt;name, </span><br><span class="line">                 &amp;p-&gt;arrive.hour, &amp;p-&gt;arrive.min,</span><br><span class="line">                 &amp;p-&gt;zx);</span><br><span class="line">            p-&gt;start.hour = 0;  // åˆå§‹åŒ–å¼€å§‹æ—¶é—´</span><br><span class="line">            p-&gt;next = head;</span><br><span class="line">            head = p;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sjf_scheduler(&amp;head, n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\næ¨¡æ‹ŸçŸ­è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦è¿‡ç¨‹ç»“æœï¼š\n&quot;);</span><br><span class="line">        printf(&quot;idå· åå­— åˆ°è¾¾æ—¶é—´ æ‰§è¡Œæ—¶é—´(åˆ†é’Ÿ) å¼€å§‹æ—¶é—´ å®Œæˆæ—¶é—´ å‘¨è½¬æ—¶é—´(åˆ†é’Ÿ) å¸¦æƒå‘¨è½¬ç³»æ•°\n&quot;);</span><br><span class="line">        </span><br><span class="line">        float total_zz = 0, total_zzxs = 0;</span><br><span class="line">        Process *p = head;</span><br><span class="line">        while(p) &#123;</span><br><span class="line">            printf(&quot;%-4d %-4s %02d:%02d %12d   %02d:%02d    %02d:%02d %15d %12.2f\n&quot;,</span><br><span class="line">                  p-&gt;id, p-&gt;name, </span><br><span class="line">                  p-&gt;arrive.hour, p-&gt;arrive.min,</span><br><span class="line">                  p-&gt;zx,</span><br><span class="line">                  p-&gt;start.hour, p-&gt;start.min,</span><br><span class="line">                  p-&gt;finish.hour, p-&gt;finish.min,</span><br><span class="line">                  p-&gt;zz, p-&gt;zzxs);</span><br><span class="line">            </span><br><span class="line">            total_zz += p-&gt;zz;</span><br><span class="line">            total_zzxs += p-&gt;zzxs;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\nç³»ç»Ÿå¹³å‡å‘¨è½¬æ—¶é—´ä¸ºï¼š%.2f\n&quot;, total_zz / n);</span><br><span class="line">        printf(&quot;ç³»ç»Ÿå¹³å‡å¸¦æƒå‘¨è½¬ç³»æ•°ä¸ºï¼š%.2f\n\n&quot;, total_zzxs / n);</span><br><span class="line">        </span><br><span class="line">        // å†…å­˜é‡Šæ”¾</span><br><span class="line">        while(head) &#123;</span><br><span class="line">            Process *temp = head;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        head = NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 1001 p1 9:40 20</span><br><span class="line">// 1004 p4 10:10 10</span><br><span class="line">// 1058 p5 10:05 30 </span><br><span class="line">// 1002 p2 9:55 15</span><br><span class="line">// 1003 p3 9:45 25</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬äº”å‘¨ï¼š-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"><a href="#ç¬¬äº”å‘¨ï¼š-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•" class="headerlink" title="ç¬¬äº”å‘¨ï¼š ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"></a>ç¬¬äº”å‘¨ï¼š ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;limits.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct Process &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[20];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    int priority;  // æ–°å¢ä¼˜å…ˆçº§å­—æ®µ</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    struct Process* next;</span><br><span class="line">&#125; Process;</span><br><span class="line"></span><br><span class="line">int time_cmp(Time a, Time b) &#123;</span><br><span class="line">    return (a.hour * 60 + a.min) - (b.hour * 60 + b.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Time add_mins(Time t, int mins) &#123;</span><br><span class="line">    int total = t.hour * 60 + t.min + mins;</span><br><span class="line">    return (Time)&#123;total / 60, total % 60&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int time_diff(Time end, Time start) &#123;</span><br><span class="line">    return (end.hour * 60 + end.min) - (start.hour * 60 + start.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¿®æ”¹ä¸ºä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</span><br><span class="line">void sjf_scheduler(Process** head, int n) &#123;</span><br><span class="line">    Process* scheduled_head = NULL;</span><br><span class="line">    Process* scheduled_tail = NULL;</span><br><span class="line">    Time current_time = &#123;9, 40&#125;;</span><br><span class="line">    int processed = 0;</span><br><span class="line"></span><br><span class="line">    while (processed &lt; n) &#123;</span><br><span class="line">        Process **prev = head;</span><br><span class="line">        Process *sel = NULL;</span><br><span class="line">        int max_priority = -1;</span><br><span class="line">        int min_zx = INT_MAX;</span><br><span class="line">        Process **prev_sel = NULL;</span><br><span class="line"></span><br><span class="line">        while (*prev) &#123;</span><br><span class="line">            if ((*prev)-&gt;start.hour == 0 &amp;&amp; </span><br><span class="line">                time_cmp((*prev)-&gt;arrive, current_time) &lt;= 0) &#123;</span><br><span class="line">                </span><br><span class="line">                // ä¼˜å…ˆçº§æ›´é«˜ï¼Œæˆ–åŒä¼˜å…ˆçº§ä½†æ‰§è¡Œæ—¶é—´æ›´çŸ­</span><br><span class="line">                if ((*prev)-&gt;priority &gt; max_priority || </span><br><span class="line">                    ((*prev)-&gt;priority == max_priority &amp;&amp; (*prev)-&gt;zx &lt; min_zx)) &#123;</span><br><span class="line">                    max_priority = (*prev)-&gt;priority;</span><br><span class="line">                    min_zx = (*prev)-&gt;zx;</span><br><span class="line">                    sel = *prev;</span><br><span class="line">                    prev_sel = prev;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = &amp;(*prev)-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (sel) &#123;</span><br><span class="line">            sel-&gt;start = (time_cmp(current_time, sel-&gt;arrive) &gt; 0) ? </span><br><span class="line">                        current_time : sel-&gt;arrive;</span><br><span class="line">            sel-&gt;finish = add_mins(sel-&gt;start, sel-&gt;zx);</span><br><span class="line">            sel-&gt;zz = time_diff(sel-&gt;finish, sel-&gt;arrive);</span><br><span class="line">            sel-&gt;zzxs = (float)sel-&gt;zz / sel-&gt;zx;</span><br><span class="line">            </span><br><span class="line">            current_time = sel-&gt;finish;</span><br><span class="line">            processed++;</span><br><span class="line">            </span><br><span class="line">            // ä»åŸé“¾è¡¨ç§»é™¤</span><br><span class="line">            if (prev_sel) &#123;</span><br><span class="line">                *prev_sel = sel-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // å°¾éƒ¨æ’å…¥</span><br><span class="line">            sel-&gt;next = NULL;</span><br><span class="line">            if (scheduled_head == NULL) &#123;</span><br><span class="line">                scheduled_head = scheduled_tail = sel;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                scheduled_tail-&gt;next = sel;</span><br><span class="line">                scheduled_tail = sel;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            current_time.min++;</span><br><span class="line">            if (current_time.min &gt;= 60) &#123;</span><br><span class="line">                current_time.hour++;</span><br><span class="line">                current_time.min = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *head = scheduled_head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int op, n;</span><br><span class="line">    Process *head = NULL;</span><br><span class="line"></span><br><span class="line">    while(1) &#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥æ“ä½œ(1ï¼šå¼€å§‹è¿›ç¨‹è°ƒåº¦ï¼›-1ï¼šç»“æŸè¿›ç¨‹)ï¼š&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;op);</span><br><span class="line">        </span><br><span class="line">        if(op == -1) break;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;è¯·è¾“å…¥è¿›ç¨‹æ•°ï¼š&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;idå· åå­— ä¼˜å…ˆçº§ åˆ°è¾¾æ—¶é—´ æ‰§è¡Œæ—¶é—´\n&quot;);</span><br><span class="line">        for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">            Process *p = (Process*)malloc(sizeof(Process));</span><br><span class="line">            scanf(&quot;%d %s %d %d:%d %d&quot;, </span><br><span class="line">                 &amp;p-&gt;id, p-&gt;name, &amp;p-&gt;priority,</span><br><span class="line">                 &amp;p-&gt;arrive.hour, &amp;p-&gt;arrive.min,</span><br><span class="line">                 &amp;p-&gt;zx);</span><br><span class="line">            p-&gt;start.hour = 0;  // åˆå§‹åŒ–å¼€å§‹æ—¶é—´</span><br><span class="line">            p-&gt;next = head;</span><br><span class="line">            head = p;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sjf_scheduler(&amp;head, n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\næ¨¡æ‹Ÿä¼˜å…ˆçº§è°ƒåº¦è¿‡ç¨‹ç»“æœï¼š\n&quot;);</span><br><span class="line">        printf(&quot;idå· åå­— åˆ°è¾¾æ—¶é—´ æ‰§è¡Œæ—¶é—´(åˆ†é’Ÿ) å¼€å§‹æ—¶é—´ å®Œæˆæ—¶é—´ å‘¨è½¬æ—¶é—´(åˆ†é’Ÿ) å¸¦æƒå‘¨è½¬ç³»æ•°\n&quot;);</span><br><span class="line">        </span><br><span class="line">        float total_zz = 0, total_zzxs = 0;</span><br><span class="line">        Process *p = head;</span><br><span class="line">        while(p) &#123;</span><br><span class="line">            printf(&quot;%-4d %-4s %02d:%02d %12d   %02d:%02d    %02d:%02d %15d %12.2f\n&quot;,</span><br><span class="line">                  p-&gt;id, p-&gt;name, </span><br><span class="line">                  p-&gt;arrive.hour, p-&gt;arrive.min,</span><br><span class="line">                  p-&gt;zx,</span><br><span class="line">                  p-&gt;start.hour, p-&gt;start.min,</span><br><span class="line">                  p-&gt;finish.hour, p-&gt;finish.min,</span><br><span class="line">                  p-&gt;zz,p-&gt;zzxs);</span><br><span class="line">            </span><br><span class="line">            total_zz += p-&gt;zz;</span><br><span class="line">            total_zzxs += p-&gt;zzxs;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\nç³»ç»Ÿå¹³å‡å‘¨è½¬æ—¶é—´ä¸ºï¼š%.2f\n&quot;, total_zz / n);</span><br><span class="line">        printf(&quot;ç³»ç»Ÿå¹³å‡å¸¦æƒå‘¨è½¬ç³»æ•°ä¸ºï¼š%.2f\n\n&quot;, total_zzxs / n);</span><br><span class="line">        </span><br><span class="line">        // å†…å­˜é‡Šæ”¾</span><br><span class="line">        while(head) &#123;</span><br><span class="line">            Process *temp = head;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        head = NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">// 1001 p1 1 09:40 20</span><br><span class="line">// 1002 p2 3 09:55 15</span><br><span class="line">// 1003 p3 2 09:45 25</span><br><span class="line">// 1004 p4 4 10:10 10</span><br><span class="line">// 1005 p5 3 10:05 30</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬å…­å‘¨ï¼šæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•"><a href="#ç¬¬å…­å‘¨ï¼šæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•" class="headerlink" title="ç¬¬å…­å‘¨ï¼šæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•"></a>ç¬¬å…­å‘¨ï¼šæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct data &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int minute;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct node &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[20];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    Time current;</span><br><span class="line">    int ywcs;</span><br><span class="line">    int sysj;</span><br><span class="line">    struct node* next;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line">typedef struct Queue &#123;</span><br><span class="line">    Node* front;</span><br><span class="line">    Node* tail;</span><br><span class="line">&#125; Queue;</span><br><span class="line"></span><br><span class="line">Queue* init() &#123;</span><br><span class="line">    Queue* p = (Queue*)malloc(sizeof(Queue));</span><br><span class="line">    p-&gt;front = p-&gt;tail = NULL;</span><br><span class="line">    return p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool timecompare(Time tt, Time p) &#123;</span><br><span class="line">    int t1 = tt.hour * 60 + tt.minute;</span><br><span class="line">    int t2 = p.hour * 60 + p.minute;</span><br><span class="line">    return t1 &gt;= t2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool Namecompare(const char* s1, const char* s2) &#123;</span><br><span class="line">    return strcmp(s1, s2) &lt; 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool Choose(Node* p, Node* q, int flag) &#123;</span><br><span class="line">    if (flag == 1) &#123;</span><br><span class="line">        int p_time = p-&gt;arrive.hour * 60 + p-&gt;arrive.minute;</span><br><span class="line">        int q_time = q-&gt;arrive.hour * 60 + q-&gt;arrive.minute;</span><br><span class="line">        return p_time &gt; q_time;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return Namecompare(p-&gt;name, q-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Time_or_Name_Sorted(Queue *que, int flag) &#123;</span><br><span class="line">    if (que-&gt;front == NULL || que-&gt;front-&gt;next == NULL) return;</span><br><span class="line"></span><br><span class="line">    bool swapped;</span><br><span class="line">    Node **pptr, *curr, *next;</span><br><span class="line">    do &#123;</span><br><span class="line">        swapped = false;</span><br><span class="line">        pptr = &amp;que-&gt;front;</span><br><span class="line">        curr = que-&gt;front;</span><br><span class="line">        next = curr-&gt;next;</span><br><span class="line"></span><br><span class="line">        while (next) &#123;</span><br><span class="line">            if (Choose(curr, next, flag)) &#123;</span><br><span class="line">                curr-&gt;next = next-&gt;next;</span><br><span class="line">                next-&gt;next = curr;</span><br><span class="line">                *pptr = next;</span><br><span class="line">                </span><br><span class="line">                if (curr-&gt;next == NULL) que-&gt;tail = curr;</span><br><span class="line">                swapped = true;</span><br><span class="line">                pptr = &amp;next-&gt;next;</span><br><span class="line">                next = curr-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                pptr = &amp;curr-&gt;next;</span><br><span class="line">                curr = next;</span><br><span class="line">                next = next-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while (swapped);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Time* ComputeTime(Time* tt, Node* q, int tp) &#123;</span><br><span class="line">    if (q-&gt;ywcs == 0) &#123; // é¦–æ¬¡æ‰§è¡Œ</span><br><span class="line">        q-&gt;start = *tt;</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;current = *tt; // æ¯æ¬¡æ›´æ–°å½“å‰å¼€å§‹æ—¶é—´</span><br><span class="line"></span><br><span class="line">    int exec_time = (q-&gt;sysj &gt; tp) ? tp : q-&gt;sysj;</span><br><span class="line">    tt-&gt;minute += exec_time;</span><br><span class="line">    tt-&gt;hour += tt-&gt;minute / 60;</span><br><span class="line">    tt-&gt;minute %= 60;</span><br><span class="line"></span><br><span class="line">    q-&gt;ywcs += exec_time;</span><br><span class="line">    q-&gt;sysj -= exec_time;</span><br><span class="line"></span><br><span class="line">    if (q-&gt;sysj == 0) &#123;</span><br><span class="line">        q-&gt;finish = *tt;</span><br><span class="line">        int arrive_min = q-&gt;arrive.hour * 60 + q-&gt;arrive.minute;</span><br><span class="line">        int finish_min = q-&gt;finish.hour * 60 + q-&gt;finish.minute;</span><br><span class="line">        q-&gt;zz = finish_min - arrive_min;</span><br><span class="line">        q-&gt;zzxs = (float)q-&gt;zz / q-&gt;zx;</span><br><span class="line">    &#125;</span><br><span class="line">    return tt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Print_Current(Queue* que, int round, Node* curr, Time sys_time) &#123;</span><br><span class="line">    printf(&quot;\nç¬¬%dè½®æ‰§è¡Œå’Œå°±ç»ªé˜Ÿåˆ—çš„ç»“æœ:\n&quot;, round);</span><br><span class="line">    printf(&quot;IDå· åå­—ã€€ã€€åˆ°è¾¾æ—¶é—´ã€€æ€»æ‰§è¡Œæ—¶é—´ã€€å½“å‰å¼€å§‹æ—¶é—´ã€€å·²å®Œæˆæ—¶é—´ã€€å‰©ä½™æ—¶é—´\n&quot;);</span><br><span class="line">    </span><br><span class="line">    if (curr) &#123;</span><br><span class="line">        printf(&quot;%-5d %-6sã€€%02d:%02dã€€ã€€%-9dã€€ã€€&quot;,</span><br><span class="line">            curr-&gt;id, curr-&gt;name, </span><br><span class="line">            curr-&gt;arrive.hour, curr-&gt;arrive.minute,</span><br><span class="line">            curr-&gt;zx);</span><br><span class="line"></span><br><span class="line">        if (curr-&gt;ywcs == 0 &amp;&amp; curr-&gt;sysj == curr-&gt;zx) &#123;</span><br><span class="line">            printf(&quot;00:00ã€€ã€€ã€€&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            printf(&quot;%02d:%02dã€€ã€€ã€€&quot;,</span><br><span class="line">                curr-&gt;current.hour, curr-&gt;current.minute);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%-8dã€€ã€€%-8d\n&quot;, curr-&gt;ywcs, curr-&gt;sysj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        printf(&quot;%-5d %-6sã€€%02d:%02dã€€ã€€%-9dã€€ã€€&quot;, </span><br><span class="line">            p-&gt;id, p-&gt;name, </span><br><span class="line">            p-&gt;arrive.hour, p-&gt;arrive.minute,</span><br><span class="line">            p-&gt;zx);</span><br><span class="line"></span><br><span class="line">        if (p-&gt;ywcs == 0 &amp;&amp; p-&gt;sysj == p-&gt;zx) &#123;</span><br><span class="line">            printf(&quot;00:00ã€€ã€€ã€€&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            printf(&quot;%02d:%02dã€€ã€€ã€€&quot;,</span><br><span class="line">                p-&gt;current.hour, p-&gt;current.minute);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%-8dã€€ã€€%-8d\n&quot;, p-&gt;ywcs, p-&gt;sysj);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void add_to_ready(Queue* ready, Queue* que, Time sys_time) &#123;</span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p &amp;&amp; timecompare(sys_time, p-&gt;arrive)) &#123;</span><br><span class="line">        Node* next = p-&gt;next;</span><br><span class="line">        p-&gt;next = NULL;</span><br><span class="line">        if (!ready-&gt;tail) &#123;</span><br><span class="line">            ready-&gt;front = ready-&gt;tail = p;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ready-&gt;tail-&gt;next = p;</span><br><span class="line">            ready-&gt;tail = p;</span><br><span class="line">        &#125;</span><br><span class="line">        que-&gt;front = next;</span><br><span class="line">        if (!next) que-&gt;tail = NULL;</span><br><span class="line">        p = next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Queue* Time_Slice_Rotation(Queue* que, int tp) &#123;</span><br><span class="line">    Queue* done = init();</span><br><span class="line">    Time sys_time = &#123;99, 99&#125;;</span><br><span class="line"></span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        int arrive_min = p-&gt;arrive.hour * 60 + p-&gt;arrive.minute;</span><br><span class="line">        int sys_min = sys_time.hour * 60 + sys_time.minute;</span><br><span class="line">        if (arrive_min &lt; sys_min) &#123;</span><br><span class="line">            sys_time = p-&gt;arrive;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Queue* ready = init();</span><br><span class="line">    Node* curr = NULL;</span><br><span class="line">    int round = 0;</span><br><span class="line"></span><br><span class="line">    while (1) &#123;</span><br><span class="line">        add_to_ready(ready, que, sys_time);</span><br><span class="line"></span><br><span class="line">        if (!curr) &#123;</span><br><span class="line">            if (ready-&gt;front) &#123;</span><br><span class="line">                curr = ready-&gt;front;</span><br><span class="line">                ready-&gt;front = ready-&gt;front-&gt;next;</span><br><span class="line">                if (!ready-&gt;front) ready-&gt;tail = NULL;</span><br><span class="line">            &#125; else if (que-&gt;front) &#123;</span><br><span class="line">                sys_time = que-&gt;front-&gt;arrive;</span><br><span class="line">                continue;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        round++;</span><br><span class="line">        Time prev_time = sys_time;</span><br><span class="line">        ComputeTime(&amp;sys_time, curr, tp);</span><br><span class="line"></span><br><span class="line">        add_to_ready(ready, que, sys_time);</span><br><span class="line"></span><br><span class="line">        Print_Current(ready, round, curr, sys_time);</span><br><span class="line"></span><br><span class="line">        if (curr-&gt;sysj == 0) &#123;</span><br><span class="line">            curr-&gt;next = done-&gt;front;</span><br><span class="line">            done-&gt;front = curr;</span><br><span class="line">            if (!done-&gt;tail) done-&gt;tail = curr;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (ready-&gt;tail) &#123;</span><br><span class="line">                ready-&gt;tail-&gt;next = curr;</span><br><span class="line">                ready-&gt;tail = curr;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                ready-&gt;front = ready-&gt;tail = curr;</span><br><span class="line">            &#125;</span><br><span class="line">            curr-&gt;next = NULL;</span><br><span class="line">        &#125;</span><br><span class="line">        curr = NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    return done;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Print(Queue* que, int n) &#123;</span><br><span class="line">    printf(&quot;\næ¨¡æ‹Ÿè¿›ç¨‹æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç»“æœ:\n&quot;);</span><br><span class="line">    printf(&quot;IDå·ã€€åå­—ã€€ã€€åˆ°è¾¾æ—¶é—´ã€€æ‰§è¡Œæ—¶é—´ã€€å¼€å§‹æ—¶é—´ã€€å®Œæˆæ—¶é—´ã€€å‘¨è½¬æ—¶é—´ã€€å¸¦æƒå‘¨è½¬\n&quot;);</span><br><span class="line">    float sum_zz = 0, sum_zzxs = 0;</span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        printf(&quot;%-5d %-6sã€€%02d:%02dã€€ã€€%-8dã€€%02d:%02dã€€ã€€%02d:%02dã€€ã€€%-8dã€€%.2f\n&quot;,</span><br><span class="line">               p-&gt;id, p-&gt;name, </span><br><span class="line">               p-&gt;arrive.hour, p-&gt;arrive.minute,</span><br><span class="line">               p-&gt;zx,</span><br><span class="line">               p-&gt;start.hour, p-&gt;start.minute,</span><br><span class="line">               p-&gt;finish.hour, p-&gt;finish.minute,</span><br><span class="line">               p-&gt;zz, p-&gt;zzxs);</span><br><span class="line">        sum_zz += p-&gt;zz;</span><br><span class="line">        sum_zzxs += p-&gt;zzxs;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\nç³»ç»Ÿå¹³å‡å‘¨è½¬æ—¶é—´: %.2fåˆ†é’Ÿ\n&quot;, sum_zz / n);</span><br><span class="line">    printf(&quot;ç³»ç»Ÿå¹³å‡å¸¦æƒå‘¨è½¬ç³»æ•°: %.2f\n&quot;, sum_zzxs / n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Scanln(Queue* wait, int n) &#123;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥%dä¸ªè¿›ç¨‹çš„å‚æ•°ï¼ˆID åç§° åˆ°è¾¾æ—¶é—´ æ‰§è¡Œæ—¶é—´ï¼‰:\n&quot;, n);</span><br><span class="line">    int i; </span><br><span class="line">    for (i = 0; i &lt; n; i++) &#123;</span><br><span class="line">        Node* p = (Node*)malloc(sizeof(Node));</span><br><span class="line">        memset(p, 0, sizeof(Node));</span><br><span class="line">        scanf(&quot;%d %s %d:%d %d&quot;, </span><br><span class="line">             &amp;p-&gt;id, p-&gt;name, </span><br><span class="line">             &amp;p-&gt;arrive.hour, &amp;p-&gt;arrive.minute,</span><br><span class="line">             &amp;p-&gt;zx);</span><br><span class="line">        p-&gt;sysj = p-&gt;zx;</span><br><span class="line">        p-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">        if (!wait-&gt;front) &#123;</span><br><span class="line">            wait-&gt;front = wait-&gt;tail = p;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            wait-&gt;tail-&gt;next = p;</span><br><span class="line">            wait-&gt;tail = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void freeQueue(Queue* q) &#123;</span><br><span class="line">    Node* p = q-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        Node* temp = p;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    free(q);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    Queue* wait = init();</span><br><span class="line">    int flag, n, t;</span><br><span class="line"></span><br><span class="line">    while (1) &#123;</span><br><span class="line">        printf(&quot;\nè¯·è¾“å…¥æ“ä½œ (1:å¼€å§‹è°ƒåº¦; 0:é€€å‡º): &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;flag);</span><br><span class="line">        if (flag == 0) &#123;</span><br><span class="line">            freeQueue(wait);</span><br><span class="line">            printf(&quot;æ“ä½œç»“æŸ!\n&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        printf(&quot;è¯·è¾“å…¥è¿›ç¨‹æ•°é‡: &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥æ—¶é—´ç‰‡é•¿åº¦(åˆ†é’Ÿ): &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;t);</span><br><span class="line">        Scanln(wait, n);</span><br><span class="line"></span><br><span class="line">        Time_or_Name_Sorted(wait, 1);</span><br><span class="line">        Queue* done = Time_Slice_Rotation(wait, t);</span><br><span class="line">        Time_or_Name_Sorted(done, 0);</span><br><span class="line">        Print(done, n);</span><br><span class="line"></span><br><span class="line">        freeQueue(wait);</span><br><span class="line">        freeQueue(done);</span><br><span class="line">        wait = init();</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬ä¸ƒå‘¨ï¼š-é“¶è¡Œå®¶ç®—æ³•"><a href="#ç¬¬ä¸ƒå‘¨ï¼š-é“¶è¡Œå®¶ç®—æ³•" class="headerlink" title="ç¬¬ä¸ƒå‘¨ï¼š é“¶è¡Œå®¶ç®—æ³•"></a>ç¬¬ä¸ƒå‘¨ï¼š é“¶è¡Œå®¶ç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#define MAX 10</span><br><span class="line"></span><br><span class="line">// æ•°æ®ç»“æ„</span><br><span class="line">int zy, n;</span><br><span class="line">int Available[MAX];</span><br><span class="line">int Max[MAX][MAX], Need[MAX][MAX], Allocation[MAX][MAX];</span><br><span class="line">char Name[MAX][15];</span><br><span class="line">int safe_seq[MAX];</span><br><span class="line"></span><br><span class="line">// å‡½æ•°å£°æ˜</span><br><span class="line">int FindIndex(char *s);</span><br><span class="line">void PrintStatus();</span><br><span class="line">int SafetyCheck();</span><br><span class="line">void Banker();</span><br><span class="line"></span><br><span class="line">// æ ¹æ®è¿›ç¨‹åæ‰¾ç´¢å¼•</span><br><span class="line">int FindIndex(char *s) &#123;</span><br><span class="line">    for(int i=0; i&lt;n; i++)</span><br><span class="line">        if(strcmp(Name[i], s) == 0)</span><br><span class="line">            return i;</span><br><span class="line">    return -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ‰“å°å½“å‰çŠ¶æ€ï¼ˆæŒ‰å›¾åƒæ ¼å¼ï¼‰</span><br><span class="line">void PrintStatus() &#123;</span><br><span class="line">    printf(&quot;\nè¿›ç¨‹å\tæœ€å¤§éœ€æ±‚é‡\tå°šéœ€æ±‚é‡\tå·²åˆ†é…é‡\tæ‰§è¡ŒçŠ¶æ€\n&quot;);</span><br><span class="line">    for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">        printf(&quot;%s\t&quot;, Name[i]);</span><br><span class="line">        // æœ€å¤§éœ€æ±‚</span><br><span class="line">        for(int j=0; j&lt;zy; j++) </span><br><span class="line">            printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d&quot;, Max[i][j]);</span><br><span class="line">        // å°šéœ€æ±‚</span><br><span class="line">        printf(&quot;\t &quot;);</span><br><span class="line">        for(int j=0; j&lt;zy; j++)</span><br><span class="line">            printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d&quot;, Need[i][j]);</span><br><span class="line">        // å·²åˆ†é…</span><br><span class="line">        printf(&quot;\t &quot;);</span><br><span class="line">        for(int j=0; j&lt;zy; j++)</span><br><span class="line">            printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d&quot;, Allocation[i][j]);</span><br><span class="line">        printf(&quot;\tWorking\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;ç³»ç»Ÿå‰©ä½™èµ„æº:\n&quot;);</span><br><span class="line">    for(int j=0; j&lt;zy; j++)</span><br><span class="line">        printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d\n\n&quot;, Available[j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•</span><br><span class="line">int SafetyCheck() &#123;</span><br><span class="line">    int Work[MAX], Finish[MAX];</span><br><span class="line">    memcpy(Work, Available, sizeof(Work));</span><br><span class="line">    memset(Finish, 0, sizeof(Finish));</span><br><span class="line"></span><br><span class="line">    int count = 0;</span><br><span class="line">    while(count &lt; n) &#123;</span><br><span class="line">        int found = 0;</span><br><span class="line">        for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">            if(!Finish[i]) &#123;</span><br><span class="line">                int can_allocate = 1;</span><br><span class="line">                for(int j=0; j&lt;zy; j++)</span><br><span class="line">                    if(Need[i][j] &gt; Work[j]) &#123;</span><br><span class="line">                        can_allocate = 0;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                </span><br><span class="line">                if(can_allocate) &#123;</span><br><span class="line">                    for(int j=0; j&lt;zy; j++)</span><br><span class="line">                        Work[j] += Allocation[i][j];</span><br><span class="line">                    Finish[i] = 1;</span><br><span class="line">                    safe_seq[count++] = i;</span><br><span class="line">                    found = 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!found) break;</span><br><span class="line">    &#125;</span><br><span class="line">    return (count == n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é“¶è¡Œå®¶ç®—æ³•ä¸»æµç¨‹</span><br><span class="line">void Banker() &#123;</span><br><span class="line">    char pname[15];</span><br><span class="line">    int req[zy], index;</span><br><span class="line">    char choice;</span><br><span class="line">    </span><br><span class="line">    do &#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥è¿›ç¨‹å: &quot;);</span><br><span class="line">        scanf(&quot;%s&quot;, pname);</span><br><span class="line">        index = FindIndex(pname);</span><br><span class="line">        if(index == -1) &#123;</span><br><span class="line">            printf(&quot;è¿›ç¨‹ä¸å­˜åœ¨!\n&quot;);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        printf(&quot;è¯·è¾“å…¥è¯¥è¿›ç¨‹å½“å‰ç”³è¯·çš„å„ä¸ªèµ„æºæ•°é‡: &quot;);</span><br><span class="line">        for(int j=0; j&lt;zy; j++)</span><br><span class="line">            scanf(&quot;%d&quot;, &amp;req[j]);</span><br><span class="line"></span><br><span class="line">        // æ­¥éª¤1ï¼šæ£€æŸ¥è¯·æ±‚åˆæ³•æ€§</span><br><span class="line">        int valid = 1;</span><br><span class="line">        for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">            if(req[j] &gt; Need[index][j] || req[j] &gt; Available[j]) &#123;</span><br><span class="line">                valid = 0;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!valid) &#123;</span><br><span class="line">            printf(&quot;ç”³è¯·å¼‚å¸¸ï¼\n&quot;);</span><br><span class="line">            printf(&quot;ç³»ç»Ÿå¯ç”¨èµ„æºå¦‚ä¸‹:\n&quot;);</span><br><span class="line">            for(int j=0; j&lt;zy; j++)</span><br><span class="line">                printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d\n&quot;, Available[j]);</span><br><span class="line">            printf(&quot;å½“å‰è¿›ç¨‹å‰©ä½™æ‰€éœ€èµ„æºå¦‚ä¸‹:\n&quot;);</span><br><span class="line">            for(int j=0; j&lt;zy; j++)</span><br><span class="line">                printf(&quot;%d,&quot;,Need[index][j]);</span><br><span class="line">            printf(&quot;\nè¯·é‡æ–°è¾“å…¥!&quot;);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // è¯•æ¢åˆ†é…</span><br><span class="line">        for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">            Available[j] -= req[j];</span><br><span class="line">            Allocation[index][j] += req[j];</span><br><span class="line">            Need[index][j] -= req[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // å®‰å…¨æ€§æ£€æŸ¥</span><br><span class="line">        if(SafetyCheck()) &#123;</span><br><span class="line">            printf(&quot;ç”³è¯·æˆåŠŸï¼å®‰å…¨åºåˆ—ä¸º:&quot;);</span><br><span class="line">            for(int i=0; i&lt;n; i++)</span><br><span class="line">            	if(!(Need[safe_seq[i]][0]==0&amp;&amp;Need[safe_seq[i]][1]==0&amp;&amp;Need[safe_seq[i]][2]==0)) </span><br><span class="line">                	printf(&quot;%s-&gt;&quot;, Name[safe_seq[i]]);</span><br><span class="line">            printf(&quot;\b\b  \n&quot;);</span><br><span class="line">            if(Need[index][0]==0&amp;&amp;Need[index][1]==0&amp;&amp;Need[index][2]==0)&#123;</span><br><span class="line">                for(int i=0;i&lt;zy;i++)&#123;</span><br><span class="line">                    Available[i]+=Allocation[index][i];</span><br><span class="line">                    Allocation[index][i]=0;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            PrintStatus();</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            printf(&quot;æ— å®‰å…¨ç³»åˆ—ï¼Œè¯·é‡æ–°è¾“å…¥ï¼\n&quot;);</span><br><span class="line">            // å›æ»šæ“ä½œ</span><br><span class="line">            for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">                Available[j] += req[j];</span><br><span class="line">                Allocation[index][j] -= req[j];</span><br><span class="line">                Need[index][j] += req[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        printf(&quot;æ˜¯å¦éœ€è¦ç”³è¯·èµ„æº?(Y/N): &quot;);</span><br><span class="line">        scanf(&quot; %c&quot;, &amp;choice);</span><br><span class="line">    &#125; while(toupper(choice) == &#x27;Y&#x27;);</span><br><span class="line">    PrintStatus();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¿›ç¨‹æ•°: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥èµ„æºç§ç±»çš„æ•°é‡: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;zy);</span><br><span class="line"></span><br><span class="line">    printf(&quot;è¯·è¾“å…¥%dç±»èµ„æºåˆå§‹åŒ–çš„èµ„æºæ•°: &quot;, zy);</span><br><span class="line">    for(int i=0; i&lt;zy; i++)</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;Available[i]);</span><br><span class="line"></span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¿›ç¨‹ä¿¡æ¯ï¼ˆè¿›ç¨‹å æœ€å¤§éœ€æ±‚é‡ï¼‰:\n&quot;);</span><br><span class="line">    for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">        scanf(&quot;%s&quot;, Name[i]);</span><br><span class="line">        for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">            scanf(&quot;%d&quot;, &amp;Max[i][j]);</span><br><span class="line">            Need[i][j] = Max[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;\nè¿›ç¨‹å¼€å§‹æ‰§è¡Œï¼\nè¯·ä¸ºè¿›ç¨‹åˆ†é…ç›¸å…³èµ„æºï¼\n&quot;);</span><br><span class="line">    Banker();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-03-25_084958.png" class="" title="2025-03-25_084958">

<h1 id="ç¬¬å…«å‘¨ï¼šå›ºå®šåˆ†åŒºç®—æ³•"><a href="#ç¬¬å…«å‘¨ï¼šå›ºå®šåˆ†åŒºç®—æ³•" class="headerlink" title="ç¬¬å…«å‘¨ï¼šå›ºå®šåˆ†åŒºç®—æ³•"></a>ç¬¬å…«å‘¨ï¼šå›ºå®šåˆ†åŒºç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">typedef struct d&#123;  //å†…å­˜åˆ†åŒº</span><br><span class="line">    int id;</span><br><span class="line">    int size;</span><br><span class="line">    int address;  //èµ·å§‹åœ°å€</span><br><span class="line">    char station[10]; //çŠ¶æ€</span><br><span class="line">&#125;memory;  </span><br><span class="line">void print(memory m[],int n)&#123;</span><br><span class="line">    printf(&quot;**********æ‰“å°åˆ†åŒºä¿¡æ¯*************\n&quot;);</span><br><span class="line">    printf(&quot;åˆ†åŒºå·  å¤§å°  èµ·å§‹  çŠ¶æ€\n&quot;);</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;n;i++)&#123;</span><br><span class="line">        printf(&quot;%-7d%-7d%-7d%s\n&quot;,m[i].id,m[i].size,m[i].address,m[i].station);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int n,i;</span><br><span class="line">    memory m[10];</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ç³»ç»Ÿçš„åˆ†åŒºå—æ•°: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;n);</span><br><span class="line">    printf(&quot;è¯·ä¾æ¬¡è¾“å…¥:\nåˆ†åŒºå·  å¤§å°  èµ·å§‹\n&quot;);</span><br><span class="line">    for(i=0;i&lt;n;i++)&#123;</span><br><span class="line">        scanf(&quot;%d%d%d&quot;,&amp;m[i].id,&amp;m[i].size,&amp;m[i].address);</span><br><span class="line">        strcpy(m[i].station,&quot;0&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    print(m,n);</span><br><span class="line">    int num,j,x;</span><br><span class="line">    int job[10];</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ä½œä¸šçš„ä¸ªæ•°: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¿™%dä¸ªä½œä¸šçš„ä¿¡æ¯: \n&quot;,num);</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥ä½œä¸š%dçš„å¤§å°: &quot;,i+1);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">        for(j=0;j&lt;n;j++)&#123;</span><br><span class="line">            if(!strcmp(m[j].station,&quot;0&quot;)&amp;&amp;m[j].size&gt;=x)&#123;</span><br><span class="line">                job[i]=x;</span><br><span class="line">                sprintf(m[j].station,&quot;JOB%d&quot;,i+1);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;æ‰“å°å„ä½œä¸šçš„ä¿¡æ¯: \nä½œä¸šå ä½œä¸šå¤§å°\n&quot;);</span><br><span class="line">    for(i=0;i&lt;num;i++)</span><br><span class="line">        printf(&quot;JOB%d  %dKB\n&quot;,i+1,job[i]);</span><br><span class="line">    print(m,n);</span><br><span class="line">    char flag;</span><br><span class="line">    printf(&quot;æ˜¯å¦éœ€è¦å›æ”¶(y/n)?:&quot;);</span><br><span class="line">    scanf(&quot; %c&quot;,&amp;flag);</span><br><span class="line">    char work[10];</span><br><span class="line">    while((int)flag==(int)&#x27;y&#x27;)&#123;</span><br><span class="line">        print(m,n);</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥è¦å›æ”¶çš„ä½œä¸šå:&quot;);</span><br><span class="line">        scanf(&quot; %s&quot;,&amp;work);</span><br><span class="line">        for(i=0;i&lt;n;i++)&#123;</span><br><span class="line">            if(m[i].station!=0&amp;&amp;!strcmp(m[i].station,work))&#123;</span><br><span class="line">                strcpy(m[i].station,&quot;0&quot;);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;å›æ”¶æˆåŠŸ\n&quot;);</span><br><span class="line">        print(m,n);</span><br><span class="line">        printf(&quot;æ˜¯å¦éœ€è¦å›æ”¶(y/n)?:&quot;);</span><br><span class="line">        scanf(&quot; %c&quot;,&amp;flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-01_000958.png" class="" title="2025-04-01_000958">

<h1 id="ç¬¬ä¹å‘¨ï¼šå¯å˜åˆ†åŒºç®—æ³•"><a href="#ç¬¬ä¹å‘¨ï¼šå¯å˜åˆ†åŒºç®—æ³•" class="headerlink" title="ç¬¬ä¹å‘¨ï¼šå¯å˜åˆ†åŒºç®—æ³•"></a>ç¬¬ä¹å‘¨ï¼šå¯å˜åˆ†åŒºç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">const int inf = 0x7ffffff;</span><br><span class="line"></span><br><span class="line">struct Y &#123;</span><br><span class="line">    int size;</span><br><span class="line">    int address;</span><br><span class="line">    string str;</span><br><span class="line">    Y(int x = 0, int y = 0, string t = &quot;&quot;) : size(x), address(y), str(t) &#123;&#125;</span><br><span class="line">    bool operator&lt;(const Y&amp; x) const &#123;</span><br><span class="line">        return address &lt; x.address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vector&lt;Y&gt; H, N; // H: å·²åˆ†é…, N: æœªåˆ†é…</span><br><span class="line"></span><br><span class="line">void out() &#123;</span><br><span class="line">    int num=1;</span><br><span class="line">    cout&lt;&lt;&quot;======== ä¸»å­˜åˆ†é…æƒ…å†µ ========&quot;&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; &quot;\nå·²åˆ†é…åˆ†åŒºè¡¨ï¼š&quot; &lt;&lt; endl;</span><br><span class="line">    cout&lt;&lt;&quot;åˆ†åŒºå·&quot;&lt;&lt;&quot;\tå¤§å°&quot;&lt;&lt;&quot;\tåœ°å€&quot;&lt;&lt;&quot;\tçŠ¶æ€&quot;&lt;&lt;endl;</span><br><span class="line">    for (auto &amp;y : H) &#123;</span><br><span class="line">        cout &lt;&lt;num&lt;&lt; &quot;\t&quot; &lt;&lt; y.size &lt;&lt; &quot;\t&quot; &lt;&lt; y.address&lt;&lt; &quot;\t&quot; &lt;&lt; y.str &lt;&lt; endl;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;\næœªåˆ†é…åˆ†åŒºè¡¨ï¼š&quot; &lt;&lt; endl;</span><br><span class="line">    cout&lt;&lt;&quot;åˆ†åŒºå·&quot;&lt;&lt;&quot;\tå¤§å°&quot;&lt;&lt;&quot;\tåœ°å€&quot;&lt;&lt;&quot;\tçŠ¶æ€&quot;&lt;&lt;endl;</span><br><span class="line">    for (auto &amp;y : N) &#123;</span><br><span class="line">        cout &lt;&lt;num&lt;&lt; &quot;\t&quot; &lt;&lt; y.size &lt;&lt; &quot;\t&quot; &lt;&lt; y.address&lt;&lt; &quot;\t&quot; &lt;&lt; y.str &lt;&lt; endl;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void menu1() &#123;</span><br><span class="line">    cout &lt;&lt; &quot;======== å¯å˜åˆ†åŒºç®¡ç† ========&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      1. å†…å­˜ç®¡ç†     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      2. å†…å­˜å»é…     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      0. é€€å‡º         *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;è¯·è¾“å…¥é€‰é¡¹ï¼š&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void menu2() &#123;</span><br><span class="line">    cout &lt;&lt; &quot;========= åˆ†é…ç®—æ³• ==========&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      1. æœ€å…ˆåˆ†é…ç®—æ³•     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      2. æœ€ä¼˜åˆ†é…ç®—æ³•     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      3. æœ€ååˆ†é…ç®—æ³•     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;è¯·è¾“å…¥é€‰é¡¹ï¼š&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void C1(int size, string x) &#123;</span><br><span class="line">    sort(N.begin(), N.end());</span><br><span class="line">    for (auto it = N.begin(); it &lt;= N.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;size &gt;= size &amp;&amp; it-&gt;str == &quot;ç©ºé—²&quot;) &#123;</span><br><span class="line">            H.push_back(Y(size, it-&gt;address, x));</span><br><span class="line">            if(it-&gt;size &gt; size)&#123;</span><br><span class="line">                int s=it-&gt;size,a=it-&gt;address;</span><br><span class="line">                N.erase(it);</span><br><span class="line">                N.push_back(Y(s - size, a + size, &quot;ç©ºé—²&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">            else N.erase(it);</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            sort(H.begin(), H.end());</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;åˆ†é…å¤±è´¥ï¼šæ— è¶³å¤Ÿç©ºé—²åˆ†åŒºï¼&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void C2(int size, string x) &#123;</span><br><span class="line">    sort(N.begin(), N.end(), [](Y a, Y b) &#123; return a.size &lt; b.size; &#125;);</span><br><span class="line">    for (auto it = N.begin(); it != N.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;size &gt;= size &amp;&amp; it-&gt;str == &quot;ç©ºé—²&quot;) &#123;</span><br><span class="line">            H.push_back(Y(size, it-&gt;address, x));</span><br><span class="line">            if (it-&gt;size &gt; size) &#123;</span><br><span class="line">                N.insert(it + 1, Y(it-&gt;size - size, it-&gt;address + size, &quot;ç©ºé—²&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">            N.erase(it);</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;åˆ†é…å¤±è´¥ï¼šæ— è¶³å¤Ÿç©ºé—²åˆ†åŒºï¼&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void C3(int size, string x) &#123;</span><br><span class="line">    sort(N.begin(), N.end(), [](Y a, Y b) &#123; return a.size &gt; b.size; &#125;);</span><br><span class="line">    for (auto it = N.begin(); it != N.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;size &gt;= size &amp;&amp; it-&gt;str == &quot;ç©ºé—²&quot;) &#123;</span><br><span class="line">            H.push_back(Y(size, it-&gt;address, x));</span><br><span class="line">            if (it-&gt;size &gt; size) &#123;</span><br><span class="line">                N.insert(it + 1, Y(it-&gt;size - size, it-&gt;address + size, &quot;ç©ºé—²&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">            N.erase(it);</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;åˆ†é…å¤±è´¥ï¼šæ— è¶³å¤Ÿç©ºé—²åˆ†åŒºï¼&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void D(string x) &#123;</span><br><span class="line">    for (auto it = H.begin(); it != H.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;str == x) &#123;</span><br><span class="line">            Y freed = *it;</span><br><span class="line">            H.erase(it);</span><br><span class="line">            N.push_back(Y(freed.size, freed.address, &quot;ç©ºé—²&quot;));</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            </span><br><span class="line">            // åˆå¹¶ç›¸é‚»åˆ†åŒº</span><br><span class="line">            auto nit = N.begin();</span><br><span class="line">            while (nit != N.end()) &#123;</span><br><span class="line">                auto next = nit + 1;</span><br><span class="line">                if (next != N.end() &amp;&amp; nit-&gt;address + nit-&gt;size == next-&gt;address) &#123;</span><br><span class="line">                    next-&gt;size += nit-&gt;size;</span><br><span class="line">                    next-&gt;address = nit-&gt;address;</span><br><span class="line">                    nit = N.erase(nit); // è¿™é‡Œä¸€å®šè¦å¯¹nextè¿›è¡Œæ“ä½œï¼Œå› ä¸ºeraseè¿”å›çš„æ˜¯åˆ é™¤é¡¹çš„ä¸‹ä¸€é¡¹ï¼Œå¦‚æœå¯¹nitè¿›è¡Œæ“ä½œï¼Œå¯èƒ½ä¼šè·³è¿‡è¿ç»­åˆå¹¶çš„æƒ…å†µ</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    ++nit;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; &quot;å›æ”¶æˆåŠŸï¼&quot; &lt;&lt; endl;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;å›æ”¶å¤±è´¥ï¼šæœªæ‰¾åˆ°è¯¥ä½œä¸šï¼&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int n, m;</span><br><span class="line">    cout &lt;&lt; &quot;è¯·è¾“å…¥å†…å­˜å¤§å°ï¼š&quot;;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    cout &lt;&lt; &quot;è¯·è¾“å…¥èµ·å§‹åœ°å€ï¼š&quot;;</span><br><span class="line">    cin &gt;&gt; m;</span><br><span class="line">    N.push_back(Y(n, m, &quot;ç©ºé—²&quot;));</span><br><span class="line">    out();</span><br><span class="line">    </span><br><span class="line">   int f;</span><br><span class="line">   do &#123;</span><br><span class="line">       menu1();</span><br><span class="line">       cin &gt;&gt; f;</span><br><span class="line">       switch (f) &#123;</span><br><span class="line">           case 1: &#123;</span><br><span class="line">               menu2();</span><br><span class="line">               int flag;</span><br><span class="line">               cin &gt;&gt; flag;</span><br><span class="line">               string tmp;</span><br><span class="line">               int size;</span><br><span class="line">               cout &lt;&lt; &quot;è¯·è¾“å…¥ä½œä¸šåï¼š&quot;;</span><br><span class="line">               cin &gt;&gt; tmp;</span><br><span class="line">               cout &lt;&lt; &quot;è¯·è¾“å…¥åˆ†é…å¤§å°ï¼š&quot;;</span><br><span class="line">               cin &gt;&gt; size;</span><br><span class="line">               if (flag == 1) C1(size, tmp);</span><br><span class="line">               else if (flag == 2) C2(size, tmp);</span><br><span class="line">               else if (flag == 3) C3(size, tmp);</span><br><span class="line">               out();</span><br><span class="line">               break;</span><br><span class="line">           &#125;</span><br><span class="line">           case 2: &#123;</span><br><span class="line">               string tmp;</span><br><span class="line">               out();</span><br><span class="line">               cout &lt;&lt; &quot;è¯·è¾“å…¥å›æ”¶çš„ä½œä¸šåï¼š&quot;;</span><br><span class="line">               cin &gt;&gt; tmp;</span><br><span class="line">               D(tmp);</span><br><span class="line">               out();</span><br><span class="line">               break;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; while (f != 0);</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-07_213522.png" class="" title="2025-04-07_213522">

<h1 id="ç¬¬åå‘¨ï¼šåˆ†é¡µåˆ†åŒºç®—æ³•"><a href="#ç¬¬åå‘¨ï¼šåˆ†é¡µåˆ†åŒºç®—æ³•" class="headerlink" title="ç¬¬åå‘¨ï¼šåˆ†é¡µåˆ†åŒºç®—æ³•"></a>ç¬¬åå‘¨ï¼šåˆ†é¡µåˆ†åŒºç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#include&lt;time.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#define Max 100</span><br><span class="line">typedef struct k&#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    int size[Max][2];</span><br><span class="line">    struct k* next;</span><br><span class="line">    int sizenum;   //å—çš„ä¸ªæ•° </span><br><span class="line">&#125;node;</span><br><span class="line">int memorysize;</span><br><span class="line">int wordlength;</span><br><span class="line">int blocksize;</span><br><span class="line">int blocknum=0;  //å¯ç”¨ç‰©ç†å—æ•°</span><br><span class="line">int sys[2000];</span><br><span class="line">node *n;</span><br><span class="line">void print_sys()&#123;</span><br><span class="line">    int i,j;</span><br><span class="line">    printf(&quot;ä¸»å­˜ä½ç¤ºå›¾å¦‚ä¸‹:\n&quot;);</span><br><span class="line">    printf(&quot;    &quot;);</span><br><span class="line">    for(i=0;i&lt;wordlength;i++)&#123;</span><br><span class="line">    	printf(&quot;%-2d&quot;,i);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n0 | &quot;);</span><br><span class="line">    for(i=0;i&lt;memorysize;i++)&#123;</span><br><span class="line">        printf(&quot;%d &quot;,sys[i]);</span><br><span class="line">        if((i+1)%wordlength==0) printf(&quot;\n%-2d| &quot;,i/wordlength+1);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\nå‰©ä½™ç‰©ç†å—æ•°:%d\n&quot;,blocknum);</span><br><span class="line">&#125;</span><br><span class="line">void print_table(char s[])&#123;  //æ‰“å°é¡µè¡¨ </span><br><span class="line">	node *p;</span><br><span class="line">	p=n-&gt;next;</span><br><span class="line">	int i;</span><br><span class="line">	printf(&quot;------æ‰“å°%sä½œä¸šçš„é¡µè¡¨-------\n&quot;,s);</span><br><span class="line">	while(p!=NULL)&#123;</span><br><span class="line">		if(!strcmp(s,p-&gt;name)) break;</span><br><span class="line">		printf(&quot;1\n&quot;);</span><br><span class="line">		p=p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	if(p==NULL)&#123;</span><br><span class="line">		printf(&quot;æœªæ‰¾åˆ°è¯¥ä½œä¸š\n&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	for(i=0;i&lt;p-&gt;sizenum;i++)&#123;</span><br><span class="line">		printf(&quot;    %-4d%-4d\n&quot;,p-&gt;size[i][0],p-&gt;size[i][1]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">int operation()&#123;</span><br><span class="line">	int o;</span><br><span class="line">	printf(&quot;\n********åˆ†é¡µå¼ç®¡ç†*********&quot;);</span><br><span class="line">	printf(&quot;\n    *   1ã€å†…å­˜åˆ†é…   *    &quot;);</span><br><span class="line">	printf(&quot;\n    *   2ã€å†…å­˜å»é…   *    &quot;);</span><br><span class="line">	printf(&quot;\n    *   0ã€é€€å‡º       *    &quot;);</span><br><span class="line">	printf(&quot;\n        è¯·è¾“å…¥é€‰é¡¹:&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;o);</span><br><span class="line">	return o;</span><br><span class="line">&#125;</span><br><span class="line">void mem_malloc()&#123;  //å†…å­˜åˆ†é… </span><br><span class="line">	int num;</span><br><span class="line">	node *p;</span><br><span class="line">	p=(node *)malloc(sizeof(node));</span><br><span class="line">	p-&gt;next=NULL;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½œä¸šå:&quot;);</span><br><span class="line">	scanf(&quot;%s&quot;,p-&gt;name);</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥éœ€è¦åˆ†é…çš„å¤§å°:&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">	num/=blocksize;</span><br><span class="line">	p-&gt;sizenum=num;</span><br><span class="line">	if(num&gt;blocknum)&#123;</span><br><span class="line">		printf(&quot;ç©ºé—´ä¸è¶³!\n&quot;);</span><br><span class="line">		return; </span><br><span class="line">	&#125;</span><br><span class="line">	int i=0,j=0,k;</span><br><span class="line">	for(j=0;j&lt;num;j++) p-&gt;size[j][0]=j;</span><br><span class="line">	for(k=0;k&lt;num;k++)&#123;</span><br><span class="line">		for(i;i&lt;memorysize;i++)&#123;</span><br><span class="line">			if(sys[i]==1) continue;</span><br><span class="line">			sys[i]=1;</span><br><span class="line">			blocknum--;</span><br><span class="line">			p-&gt;size[k][1]=i;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	node *q;</span><br><span class="line">	q=n;</span><br><span class="line">	while(q-&gt;next!=NULL)&#123;</span><br><span class="line">		q=q-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	q-&gt;next=p;</span><br><span class="line">	printf(&quot;åˆ†é…æˆåŠŸ!\n&quot;);</span><br><span class="line">	print_sys();</span><br><span class="line">	print_table(p-&gt;name);</span><br><span class="line">&#125;</span><br><span class="line">void mem_free()&#123;  //å†…å­˜å»é…</span><br><span class="line"> 	char s[10];</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½ éœ€è¦é‡Šæ”¾çš„ä½œä¸š:&quot;);</span><br><span class="line">	scanf(&quot; %s&quot;,s);</span><br><span class="line">	node *p;</span><br><span class="line">	node *q;</span><br><span class="line">	p=n-&gt;next;</span><br><span class="line">	q=n;</span><br><span class="line">	int i;</span><br><span class="line">	while(p!=NULL)&#123;</span><br><span class="line">		if(!strcmp(s,p-&gt;name)) break;</span><br><span class="line">		printf(&quot;%s\n&quot;,p-&gt;name);</span><br><span class="line">		p=p-&gt;next;</span><br><span class="line">		q=q-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	if(p==NULL)&#123;</span><br><span class="line">		printf(&quot;æ— æ­¤ä½œä¸š,å›æ”¶å¤±è´¥!\n&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	q-&gt;next=p-&gt;next;</span><br><span class="line">	for(i=0;i&lt;p-&gt;sizenum;i++)&#123;</span><br><span class="line">		sys[p-&gt;size[i][1]]=0;</span><br><span class="line">		blocknum++;</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;è¯¥ä½œä¸šå›æ”¶æˆåŠŸ!\n&quot;);</span><br><span class="line">	print_sys();</span><br><span class="line">	free(p);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	srand(time(NULL));</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ç³»ç»Ÿå†…å­˜ç©ºé—´å¤§å°:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;memorysize);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥å­—é•¿16/32/64:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;wordlength);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ç‰©ç†å—å¤§å°:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;blocksize);</span><br><span class="line">    int i,j,num=0;</span><br><span class="line">    for(i=0;i&lt;memorysize;i++)&#123;</span><br><span class="line">        sys[i]=rand()%2;</span><br><span class="line">        if(sys[i]==0) blocknum++;</span><br><span class="line">        srand(i);</span><br><span class="line">    &#125;</span><br><span class="line">    print_sys();</span><br><span class="line">    n=(node *)malloc(sizeof(node));</span><br><span class="line">    n-&gt;next=NULL;</span><br><span class="line">    while(1)&#123;</span><br><span class="line">    	switch(operation())&#123;</span><br><span class="line">    		case 1:</span><br><span class="line">    			print_sys();</span><br><span class="line">    			mem_malloc();</span><br><span class="line">    			break;</span><br><span class="line">    		case 2:</span><br><span class="line">    			print_sys();</span><br><span class="line">    			mem_free();</span><br><span class="line">    			break;</span><br><span class="line">    		case 0:</span><br><span class="line">    			exit(0);</span><br><span class="line">    		default:</span><br><span class="line">    			continue;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-14_225430.png" class="" title="2025-04-14_225430">

<h1 id="ç¬¬åä¸€å‘¨ï¼ˆé€‰åšï¼‰ï¼šæ®µé¡µå¼å­˜å‚¨ç®¡ç†"><a href="#ç¬¬åä¸€å‘¨ï¼ˆé€‰åšï¼‰ï¼šæ®µé¡µå¼å­˜å‚¨ç®¡ç†" class="headerlink" title="ç¬¬åä¸€å‘¨ï¼ˆé€‰åšï¼‰ï¼šæ®µé¡µå¼å­˜å‚¨ç®¡ç†"></a>ç¬¬åä¸€å‘¨ï¼ˆé€‰åšï¼‰ï¼šæ®µé¡µå¼å­˜å‚¨ç®¡ç†</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_MEMORY 2000</span><br><span class="line"></span><br><span class="line">typedef struct PageEntry &#123;</span><br><span class="line">    int page_num;</span><br><span class="line">    int block_num;</span><br><span class="line">    struct PageEntry* next;</span><br><span class="line">&#125; PageEntry;</span><br><span class="line"></span><br><span class="line">typedef struct SegmentEntry &#123;</span><br><span class="line">    int seg_num;</span><br><span class="line">    int page_count;</span><br><span class="line">    PageEntry* page_table;  //é¡µè¡¨</span><br><span class="line">    struct SegmentEntry* next;</span><br><span class="line">&#125; SegmentEntry;</span><br><span class="line"></span><br><span class="line">typedef struct Job &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">	int job_length; //ä½œä¸šå¤§å°</span><br><span class="line">    int seg_count;  //æ®µæ•°</span><br><span class="line">    SegmentEntry* seg_table;//æ®µè¡¨</span><br><span class="line">    struct Job* next;</span><br><span class="line">&#125; Job;</span><br><span class="line"></span><br><span class="line">int memory_size;</span><br><span class="line">int word_length;</span><br><span class="line">int block_size;</span><br><span class="line">int free_blocks = 0;</span><br><span class="line">int bitmap[MAX_MEMORY];</span><br><span class="line">Job* job_list = NULL;</span><br><span class="line"></span><br><span class="line">void print_bitmap() &#123;</span><br><span class="line">    int i,j;</span><br><span class="line">    printf(&quot;ä¸»å­˜ä½ç¤ºå›¾å¦‚ä¸‹:\n&quot;);</span><br><span class="line">    printf(&quot;  &quot;);</span><br><span class="line">    for(i=0;i&lt;word_length;i++)&#123;</span><br><span class="line">    	printf(&quot; %2d&quot;,i);</span><br><span class="line">	&#125;</span><br><span class="line">    for(i=0;i&lt;memory_size;i++)&#123;</span><br><span class="line">		if(i%word_length==0) printf(&quot;\n%-2d| &quot;,i/word_length);</span><br><span class="line">        printf(&quot;%-2d &quot;,bitmap[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\nå‰©ä½™ç‰©ç†å—æ•°:%d\n&quot;,free_blocks);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_job_table(char name[]) &#123;</span><br><span class="line">    </span><br><span class="line">    Job* curr = job_list;</span><br><span class="line">    while (curr != NULL &amp;&amp; strcmp(curr-&gt;name, name) != 0)</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    </span><br><span class="line">    if (curr == NULL) &#123;</span><br><span class="line">        printf(&quot;ä½œä¸šä¸å­˜åœ¨ï¼\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;\nä½œä¸š %s çš„åˆ†é…æƒ…å†µå¦‚ä¸‹ï¼š\n&quot;, name);</span><br><span class="line">    SegmentEntry* seg = curr-&gt;seg_table;</span><br><span class="line">    while (seg != NULL) &#123;</span><br><span class="line">        printf(&quot;  ç¬¬%dæ®µ:\n&quot;, seg-&gt;seg_num);</span><br><span class="line">		printf(&quot;      é¡µå·   å—å·\n&quot;);</span><br><span class="line">        PageEntry* page = seg-&gt;page_table;</span><br><span class="line">        while (page != NULL) &#123;</span><br><span class="line">            printf(&quot;      %-7d%d\n&quot;, </span><br><span class="line">                   page-&gt;page_num, page-&gt;block_num);</span><br><span class="line">            page = page-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void allocate_memory() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    int seg_count, total_pages = 0;</span><br><span class="line">	int len=0;</span><br><span class="line">	print_bitmap();</span><br><span class="line">    </span><br><span class="line">    printf(&quot;\nè¾“å…¥ä½œä¸šå: &quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, name);</span><br><span class="line">    </span><br><span class="line">    // æ£€æŸ¥é‡å</span><br><span class="line">    Job* curr = job_list;</span><br><span class="line">    while (curr != NULL) &#123;</span><br><span class="line">        if (strcmp(curr-&gt;name, name) == 0) &#123;</span><br><span class="line">            printf(&quot;ä½œä¸šåå·²å­˜åœ¨ï¼\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥%sæ‰€éœ€ä¸»å­˜å¤§å°: &quot;,name);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;len);</span><br><span class="line">	if(len/word_length&gt;free_blocks)&#123;</span><br><span class="line">		printf(&quot;ç©ºé—´ä¸è¶³!\n&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¦å°†ä½œä¸šåˆ†ä¸ºå‡ æ®µ: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;seg_count);</span><br><span class="line">	int free_size=len; </span><br><span class="line">    int* pages_per_seg = (int*)malloc(seg_count * sizeof(int));</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; seg_count; i++) &#123;</span><br><span class="line">        printf(&quot;å‰©ä½™%dçš„å†…å­˜æœªåˆ†é…,è¯·è¾“å…¥ç¬¬%dæ®µçš„å¤§å°: &quot;,free_size, i);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;pages_per_seg[i]);</span><br><span class="line">		printf(&quot;å†…å­˜åˆ†é…æˆåŠŸ!\n&quot;);</span><br><span class="line">		free_size-=pages_per_seg[i];</span><br><span class="line">        total_pages += pages_per_seg[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ›å»ºæ–°ä½œä¸š</span><br><span class="line">    Job* new_job = (Job*)malloc(sizeof(Job));</span><br><span class="line">	new_job-&gt;job_length=len;</span><br><span class="line">    strcpy(new_job-&gt;name, name);</span><br><span class="line">    new_job-&gt;seg_count = seg_count;</span><br><span class="line">    new_job-&gt;seg_table = NULL;</span><br><span class="line">    new_job-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">    // åˆ†é…æ®µè¡¨</span><br><span class="line">    for (int i = 0; i &lt; seg_count; i++) &#123;</span><br><span class="line">        SegmentEntry* seg = (SegmentEntry*)malloc(sizeof(SegmentEntry));</span><br><span class="line">        seg-&gt;seg_num = i;</span><br><span class="line">        seg-&gt;page_count = pages_per_seg[i];</span><br><span class="line">        seg-&gt;page_table = NULL;</span><br><span class="line">        seg-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">        // åˆ†é…é¡µè¡¨</span><br><span class="line">        for (int j = 0; j &lt; pages_per_seg[i]; j++) &#123;</span><br><span class="line">            // æŸ¥æ‰¾ç©ºé—²å—</span><br><span class="line">            int k;</span><br><span class="line">            for (k = 0; k &lt; memory_size; k++) &#123;</span><br><span class="line">                if (bitmap[k] == 0) break;</span><br><span class="line">            &#125;</span><br><span class="line">            if (k &gt;= memory_size) &#123;</span><br><span class="line">                printf(&quot;åˆ†é…æ„å¤–å¤±è´¥ï¼\n&quot;);</span><br><span class="line">                free(pages_per_seg);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // æ›´æ–°ä½ç¤ºå›¾</span><br><span class="line">            bitmap[k] = 1;</span><br><span class="line">            free_blocks--;</span><br><span class="line"></span><br><span class="line">            // åˆ›å»ºé¡µè¡¨é¡¹</span><br><span class="line">            PageEntry* page = (PageEntry*)malloc(sizeof(PageEntry));</span><br><span class="line">            page-&gt;page_num = j;</span><br><span class="line">            page-&gt;block_num = k;</span><br><span class="line">            page-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">            // æ·»åŠ åˆ°é¡µè¡¨</span><br><span class="line">            if (seg-&gt;page_table == NULL) &#123;</span><br><span class="line">                seg-&gt;page_table = page;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                PageEntry* p = seg-&gt;page_table;</span><br><span class="line">                while (p-&gt;next != NULL) p = p-&gt;next;</span><br><span class="line">                p-&gt;next = page;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // æ·»åŠ åˆ°æ®µè¡¨</span><br><span class="line">        if (new_job-&gt;seg_table == NULL) &#123;</span><br><span class="line">            new_job-&gt;seg_table = seg;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            SegmentEntry* s = new_job-&gt;seg_table;</span><br><span class="line">            while (s-&gt;next != NULL) s = s-&gt;next;</span><br><span class="line">            s-&gt;next = seg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ åˆ°ä½œä¸šé“¾è¡¨</span><br><span class="line">    if (job_list == NULL) &#123;</span><br><span class="line">        job_list = new_job;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        Job* p = job_list;</span><br><span class="line">        while (p-&gt;next != NULL) p = p-&gt;next;</span><br><span class="line">        p-&gt;next = new_job;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    free(pages_per_seg);</span><br><span class="line">    print_bitmap();</span><br><span class="line">	print_job_table(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void free_memory() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    printf(&quot;\nè¯·è¾“å…¥ä½œä¸šå: &quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, name);</span><br><span class="line"></span><br><span class="line">    Job *prev = NULL, *curr = job_list;</span><br><span class="line">    while (curr != NULL &amp;&amp; strcmp(curr-&gt;name, name) != 0) &#123;</span><br><span class="line">        prev = curr;</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (curr == NULL) &#123;</span><br><span class="line">        printf(&quot;ä½œä¸šä¸å­˜åœ¨ï¼\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä»é“¾è¡¨ç§»é™¤</span><br><span class="line">    if (prev == NULL) &#123;</span><br><span class="line">        job_list = curr-&gt;next;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        prev-&gt;next = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // é‡Šæ”¾æ®µè¡¨</span><br><span class="line">    SegmentEntry* seg = curr-&gt;seg_table;</span><br><span class="line">    while (seg != NULL) &#123;</span><br><span class="line">        // é‡Šæ”¾é¡µè¡¨</span><br><span class="line">        PageEntry* page = seg-&gt;page_table;</span><br><span class="line">        while (page != NULL) &#123;</span><br><span class="line">            bitmap[page-&gt;block_num] = 0; // æ›´æ–°ä½ç¤ºå›¾</span><br><span class="line">            free_blocks++;</span><br><span class="line">            PageEntry* temp = page;</span><br><span class="line">            page = page-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        SegmentEntry* temp_seg = seg;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">        free(temp_seg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    free(curr);</span><br><span class="line">    printf(&quot;å»é…æˆåŠŸï¼\n&quot;, name);</span><br><span class="line">    print_bitmap();</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    srand(time(NULL));</span><br><span class="line">    </span><br><span class="line">    printf(&quot;è¯·è¾“å…¥å†…å­˜æ€»å¤§å°: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;memory_size);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ç³»ç»Ÿå­—é•¿å¤§å°ï¼ˆ16/32/64ï¼‰: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;word_length);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥å—é•¿: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;block_size);</span><br><span class="line"></span><br><span class="line">    // åˆå§‹åŒ–ä½ç¤ºå›¾</span><br><span class="line">    free_blocks = 0;</span><br><span class="line">    for (int i = 0; i &lt; memory_size; i++) &#123;</span><br><span class="line">        bitmap[i] = rand() % 2;</span><br><span class="line">        if (bitmap[i] == 0) free_blocks++;</span><br><span class="line">    &#125;</span><br><span class="line">	print_bitmap();</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        printf(&quot;\n********å¯å˜åˆ†åŒºç®¡ç†*********&quot;);</span><br><span class="line">		printf(&quot;\n    *   1ã€å†…å­˜åˆ†é…   *    &quot;);</span><br><span class="line">		printf(&quot;\n    *   2ã€å†…å­˜å»é…   *    &quot;);</span><br><span class="line">		printf(&quot;\n    *   0ã€é€€å‡º       *   &quot;);</span><br><span class="line">		printf(&quot;\n        è¯·è¾“å…¥é€‰é¡¹:&quot;);</span><br><span class="line">        </span><br><span class="line">        int choice;</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">        </span><br><span class="line">        switch (choice) &#123;</span><br><span class="line">            case 1: allocate_memory(); break;</span><br><span class="line">            case 2: free_memory(); break;</span><br><span class="line">            case 0: exit(0);</span><br><span class="line">            default: printf(&quot;æ— æ•ˆé€‰é¡¹ï¼\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-21_234800.png" class="" title="2025-04-21_234800">

<h1 id="ç¬¬åä¸€å‘¨ï¼šåˆ†æ®µå¼å­˜å‚¨ç®¡ç†"><a href="#ç¬¬åä¸€å‘¨ï¼šåˆ†æ®µå¼å­˜å‚¨ç®¡ç†" class="headerlink" title="ç¬¬åä¸€å‘¨ï¼šåˆ†æ®µå¼å­˜å‚¨ç®¡ç†"></a>ç¬¬åä¸€å‘¨ï¼šåˆ†æ®µå¼å­˜å‚¨ç®¡ç†</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">// åˆ†åŒºèŠ‚ç‚¹ç»“æ„ä½“</span><br><span class="line">typedef struct link_node &#123;</span><br><span class="line">    int id;              // åˆ†åŒºID</span><br><span class="line">    int size;            // åˆ†åŒºå¤§å°</span><br><span class="line">    int address;         // èµ·å§‹åœ°å€</span><br><span class="line">    char flag[20];       // çŠ¶æ€</span><br><span class="line">    struct link_node* next;</span><br><span class="line">&#125; node;</span><br><span class="line"></span><br><span class="line">// æ®µè¡¨</span><br><span class="line">typedef struct segment_node &#123;</span><br><span class="line">    char job_name[20];   // ä½œä¸šåç§°</span><br><span class="line">    int segments[10][3]; // [æ®µå·][å¤§å°, åŸºåœ°å€]</span><br><span class="line">    int segment_count;   // æ®µæ•°é‡</span><br><span class="line">    struct segment_node* next;</span><br><span class="line">&#125; segmentNode;</span><br><span class="line"></span><br><span class="line">// å†…å­˜èŠ‚ç‚¹</span><br><span class="line">typedef struct memory_node &#123;</span><br><span class="line">    int size;    // å†…å­˜å¤§å°</span><br><span class="line">    int address; // èµ·å§‹åœ°å€ </span><br><span class="line">&#125; memoryNode;</span><br><span class="line"></span><br><span class="line">// å…¨å±€å˜é‡</span><br><span class="line">memoryNode memory;</span><br><span class="line">node* free_list = NULL;      // ç©ºé—²åˆ†åŒºé“¾è¡¨</span><br><span class="line">node* allocated_list = NULL; // å·²åˆ†é…åˆ†åŒºé“¾è¡¨</span><br><span class="line">segmentNode* segment_list = NULL; // æ®µè¡¨é“¾è¡¨</span><br><span class="line">int partition_id = 1;        // å…¨å±€åˆ†åŒºIDè®¡æ•°å™¨</span><br><span class="line"></span><br><span class="line">void initialize_memory();</span><br><span class="line">void display_menu();</span><br><span class="line">void display_partitions();</span><br><span class="line">node* find_first_fit(int size);</span><br><span class="line">void allocate_memory();</span><br><span class="line">void deallocate_memory();</span><br><span class="line">void add_segment(char* job_name, int segment_num, int size, int base_addr);</span><br><span class="line">void print_segment_table(char* job_name);</span><br><span class="line">void merge_free_partitions();</span><br><span class="line">int get_next_id();</span><br><span class="line">// ä½¿ç”¨ä¸€ä¸ªç©ºé—²åˆ†åŒºåˆå§‹åŒ–å†…å­˜</span><br><span class="line">void initialize_memory() &#123;</span><br><span class="line">    node* new_node = (node*)malloc(sizeof(node));</span><br><span class="line">    new_node-&gt;id = partition_id++;</span><br><span class="line">    new_node-&gt;size = memory.size;</span><br><span class="line">    new_node-&gt;address = memory.address;</span><br><span class="line">    strcpy(new_node-&gt;flag, &quot;ç©ºé—²&quot;);</span><br><span class="line">    new_node-&gt;next = NULL;</span><br><span class="line">    free_list = new_node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ˜¾ç¤ºèœå•</span><br><span class="line">void display_menu() &#123;</span><br><span class="line">    printf(&quot;*********å¯å˜åˆ†åŒºç®¡ç†**********\n&quot;);</span><br><span class="line">    printf(&quot;   *     1.å†…å­˜åˆ†é…      *\n&quot;);</span><br><span class="line">    printf(&quot;   *     2.å†…å­˜å»é…      *\n&quot;);</span><br><span class="line">    printf(&quot;   *     0.é€€å‡º          *\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ˜¾ç¤ºå½“å‰åˆ†åŒºçŠ¶æ€</span><br><span class="line">void display_partitions() &#123;</span><br><span class="line">    printf(&quot;******************ä¸»å­˜åˆ†é…æƒ…å†µ*********************\n&quot;);</span><br><span class="line">    printf(&quot;å·²åˆ†é…ï¼š\n&quot;);</span><br><span class="line">    printf(&quot;åˆ†é…å·  å¤§å°ï¼ˆKBï¼‰      èµ·å§‹ï¼ˆKBï¼‰      çŠ¶æ€\n&quot;);</span><br><span class="line">    node* current = allocated_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        printf(&quot;%-8d%-16d%-16d%s\n&quot;, current-&gt;id, current-&gt;size, current-&gt;address, current-&gt;flag);</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\næœªåˆ†é…ï¼š\n&quot;);</span><br><span class="line">    printf(&quot;åˆ†é…å·  å¤§å°ï¼ˆKBï¼‰      èµ·å§‹ï¼ˆKBï¼‰      çŠ¶æ€\n&quot;);</span><br><span class="line">    current = free_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        printf(&quot;%-8d%-16d%-16d%s\n&quot;, current-&gt;id, current-&gt;size, current-&gt;address, current-&gt;flag);</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æŸ¥æ‰¾é¦–æ¬¡é€‚åº”çš„ç©ºé—²åˆ†åŒº</span><br><span class="line">node* find_first_fit(int size) &#123;</span><br><span class="line">    node* current = free_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        if (current-&gt;size &gt;= size) &#123;</span><br><span class="line">            return current;</span><br><span class="line">        &#125;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    return NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸ºä½œä¸šåˆ†é…å†…å­˜</span><br><span class="line">void allocate_memory() &#123;</span><br><span class="line">    char job_name[20];</span><br><span class="line">    int total_size, segments, remaining_size;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ä½œä¸šå:&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥%séœ€è¦åˆ†é…çš„ä¸»å­˜å¤§å°:&quot;, job_name);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;total_size);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¦åˆ†æˆå‡ æ®µï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;segments);</span><br><span class="line">    </span><br><span class="line">    remaining_size = total_size;</span><br><span class="line">    int segment_sizes[10];</span><br><span class="line">    </span><br><span class="line">    // é€ä¸ªåˆ†é…æ¯ä¸ªæ®µ</span><br><span class="line">    for (int i = 0; i &lt; segments; i++) &#123;</span><br><span class="line">        printf(&quot;å‰©ä½™%dKBçš„å†…å­˜ï¼Œè¯·è¾“å…¥ç¬¬%dæ®µçš„å¤§å°ï¼š&quot;, remaining_size, i + 1);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;segment_sizes[i]);</span><br><span class="line">        if (segment_sizes[i] &gt; remaining_size) &#123;</span><br><span class="line">            printf(&quot;æ®µå¤§å°è¶…è¿‡å‰©ä½™å†…å­˜ï¼Œåˆ†é…å¤±è´¥ï¼\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        remaining_size -= segment_sizes[i];</span><br><span class="line">        </span><br><span class="line">        // æŸ¥æ‰¾ç©ºé—²åˆ†åŒº</span><br><span class="line">        node* free_partition = find_first_fit(segment_sizes[i]);</span><br><span class="line">        if (!free_partition) &#123;</span><br><span class="line">            printf(&quot;æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—²åˆ†åŒºï¼Œåˆ†é…å¤±è´¥ï¼\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // åˆ›å»ºå·²åˆ†é…åˆ†åŒºï¼ˆå¤ç”¨ç©ºé—²åˆ†åŒºIDï¼‰</span><br><span class="line">        node* allocated = (node*)malloc(sizeof(node));</span><br><span class="line">        allocated-&gt;id = free_partition-&gt;id;</span><br><span class="line">        allocated-&gt;size = segment_sizes[i];</span><br><span class="line">        allocated-&gt;address = free_partition-&gt;address;</span><br><span class="line">        sprintf(allocated-&gt;flag, &quot;%s%d&quot;, job_name, i);</span><br><span class="line">        allocated-&gt;next = NULL;</span><br><span class="line">        </span><br><span class="line">        // æ·»åŠ åˆ°å·²åˆ†é…é“¾è¡¨</span><br><span class="line">        if (!allocated_list) &#123;</span><br><span class="line">            allocated_list = allocated;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            node* temp = allocated_list;</span><br><span class="line">            while (temp-&gt;next) temp = temp-&gt;next;</span><br><span class="line">            temp-&gt;next = allocated;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // æ›´æ–°ç©ºé—²åˆ†åŒº</span><br><span class="line">        free_partition-&gt;size -= segment_sizes[i];</span><br><span class="line">        free_partition-&gt;address += segment_sizes[i];</span><br><span class="line">        if (free_partition-&gt;size == 0) &#123;</span><br><span class="line">            // ç§»é™¤ç©ºç©ºé—²åˆ†åŒº</span><br><span class="line">            node* prev = NULL;</span><br><span class="line">            node* current = free_list;</span><br><span class="line">            while (current != free_partition) &#123;</span><br><span class="line">                prev = current;</span><br><span class="line">                current = current-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            if (prev) &#123;</span><br><span class="line">                prev-&gt;next = free_partition-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                free_list = free_partition-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            free(free_partition);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // ä¸ºå‰©ä½™ç©ºé—²åˆ†åŒºåˆ†é…æ–°ID</span><br><span class="line">            free_partition-&gt;id = get_next_id();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // æ·»åŠ åˆ°æ®µè¡¨</span><br><span class="line">        add_segment(job_name, i, segment_sizes[i], allocated-&gt;address);</span><br><span class="line">        display_partitions();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (remaining_size != 0) &#123;</span><br><span class="line">        printf(&quot;åˆ†é…çš„æ®µå¤§å°æ€»å’Œä¸ç­‰äºæ€»å¤§å°ï¼Œåˆ†é…å¤±è´¥ï¼\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;åˆ†é…æˆåŠŸï¼\n&quot;);</span><br><span class="line">    printf(&quot;************æ‰“å°%sæ®µè¡¨************\n&quot;, job_name);</span><br><span class="line">    print_segment_table(job_name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è·å–ä¸‹ä¸€ä¸ªå¯ç”¨ID</span><br><span class="line">int get_next_id() &#123;</span><br><span class="line">    int max_id = 0;</span><br><span class="line">    node* current = allocated_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        if (current-&gt;id &gt; max_id) max_id = current-&gt;id;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    return max_id + 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é‡Šæ”¾ä½œä¸šå ç”¨çš„å†…å­˜</span><br><span class="line">void deallocate_memory() &#123;</span><br><span class="line">    display_partitions();</span><br><span class="line">    char job_name[20];</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥æ‚¨æƒ³å›æ”¶çš„ä½œä¸šåï¼š&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    </span><br><span class="line">    // åœ¨æ®µè¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ®µ</span><br><span class="line">    segmentNode* seg = segment_list;</span><br><span class="line">    int found = 0;</span><br><span class="line">    while (seg) &#123;</span><br><span class="line">        if (strcmp(seg-&gt;job_name, job_name) == 0) &#123;</span><br><span class="line">            found = 1;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!found) &#123;</span><br><span class="line">        printf(&quot;æœªæ‰¾åˆ°ä½œä¸š%sçš„æ®µè¡¨ï¼\n&quot;, job_name);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å¤„ç†æ¯ä¸ªæ®µ</span><br><span class="line">    for (int i = 0; i &lt; seg-&gt;segment_count; i++) &#123;</span><br><span class="line">        char segment_flag[20];</span><br><span class="line">        sprintf(segment_flag, &quot;%s%d&quot;, job_name, i);</span><br><span class="line">        </span><br><span class="line">        // ä»å·²åˆ†é…é“¾è¡¨ä¸­æŸ¥æ‰¾å¹¶ç§»é™¤</span><br><span class="line">        node* prev = NULL;</span><br><span class="line">        node* current = allocated_list;</span><br><span class="line">        while (current &amp;&amp; strcmp(current-&gt;flag, segment_flag) != 0) &#123;</span><br><span class="line">            prev = current;</span><br><span class="line">            current = current-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        if (current) &#123;</span><br><span class="line">            if (prev) &#123;</span><br><span class="line">                prev-&gt;next = current-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                allocated_list = current-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // åˆ›å»ºæ–°ç©ºé—²åˆ†åŒº</span><br><span class="line">            node* new_free = (node*)malloc(sizeof(node));</span><br><span class="line">            new_free-&gt;id = get_next_id();</span><br><span class="line">            new_free-&gt;size = current-&gt;size;</span><br><span class="line">            new_free-&gt;address = current-&gt;address;</span><br><span class="line">            strcpy(new_free-&gt;flag, &quot;ç©ºé—²&quot;);</span><br><span class="line">            new_free-&gt;next = NULL;</span><br><span class="line">            </span><br><span class="line">            // æ·»åŠ åˆ°ç©ºé—²é“¾è¡¨</span><br><span class="line">            if (!free_list) &#123;</span><br><span class="line">                free_list = new_free;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                node* temp = free_list;</span><br><span class="line">                while (temp-&gt;next) temp = temp-&gt;next;</span><br><span class="line">                temp-&gt;next = new_free;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            free(current);</span><br><span class="line">            printf(&quot;å›æ”¶%sçš„æ®µ%sæˆåŠŸï¼\n&quot;, job_name, segment_flag);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ä»æ®µè¡¨é“¾è¡¨ä¸­ç§»é™¤</span><br><span class="line">    segmentNode* prev_seg = NULL;</span><br><span class="line">    seg = segment_list;</span><br><span class="line">    while (seg &amp;&amp; strcmp(seg-&gt;job_name, job_name) != 0) &#123;</span><br><span class="line">        prev_seg = seg;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    if (seg) &#123;</span><br><span class="line">        if (prev_seg) &#123;</span><br><span class="line">            prev_seg-&gt;next = seg-&gt;next;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            segment_list = seg-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        free(seg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶ç›¸é‚»çš„ç©ºé—²åˆ†åŒº</span><br><span class="line">    merge_free_partitions();</span><br><span class="line">    </span><br><span class="line">    // ä¸ºæ‰€æœ‰ç©ºé—²åˆ†åŒºæ›´æ–°ID</span><br><span class="line">    node* current = free_list;</span><br><span class="line">    int new_id = get_next_id();</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        current-&gt;id = new_id++;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    display_partitions();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ·»åŠ æ®µåˆ°æ®µè¡¨</span><br><span class="line">void add_segment(char* job_name, int segment_num, int size, int base_addr) &#123;</span><br><span class="line">    segmentNode* seg = segment_list;</span><br><span class="line">    while (seg &amp;&amp; strcmp(seg-&gt;job_name, job_name) != 0) &#123;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (!seg) &#123;</span><br><span class="line">        // åˆ›å»ºæ–°æ®µè¡¨èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°é“¾è¡¨å¤´éƒ¨</span><br><span class="line">        seg = (segmentNode*)malloc(sizeof(segmentNode));</span><br><span class="line">        strcpy(seg-&gt;job_name, job_name);</span><br><span class="line">        seg-&gt;segment_count = 0;</span><br><span class="line">        seg-&gt;next = segment_list;</span><br><span class="line">        segment_list = seg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    seg-&gt;segments[seg-&gt;segment_count][0] = segment_num;</span><br><span class="line">    seg-&gt;segments[seg-&gt;segment_count][1] = size;</span><br><span class="line">    seg-&gt;segments[seg-&gt;segment_count][2] = base_addr;</span><br><span class="line">    seg-&gt;segment_count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ‰“å°ä½œä¸šçš„æ®µè¡¨</span><br><span class="line">void print_segment_table(char* job_name) &#123;</span><br><span class="line">    printf(&quot;æ®µå·    æ®µé•¿    åŸºå€\n&quot;);</span><br><span class="line">    segmentNode* seg = segment_list;</span><br><span class="line">    while (seg &amp;&amp; strcmp(seg-&gt;job_name, job_name) != 0) &#123;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    if (seg) &#123;</span><br><span class="line">        for (int i = 0; i &lt; seg-&gt;segment_count; i++) &#123;</span><br><span class="line">            printf(&quot;%-8d%-8d%d\n&quot;, </span><br><span class="line">                seg-&gt;segments[i][0], </span><br><span class="line">                seg-&gt;segments[i][1], </span><br><span class="line">                seg-&gt;segments[i][2]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// åˆå¹¶ç›¸é‚»çš„ç©ºé—²åˆ†åŒº</span><br><span class="line">void merge_free_partitions() &#123;</span><br><span class="line">    // æŒ‰èµ·å§‹åœ°å€å¯¹ç©ºé—²é“¾è¡¨è¿›è¡Œæ’åº</span><br><span class="line">    node* sorted = NULL;</span><br><span class="line">    node* current = free_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        node* next = current-&gt;next;</span><br><span class="line">        if (!sorted || sorted-&gt;address &gt; current-&gt;address) &#123;</span><br><span class="line">            current-&gt;next = sorted;</span><br><span class="line">            sorted = current;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            node* temp = sorted;</span><br><span class="line">            while (temp-&gt;next &amp;&amp; temp-&gt;next-&gt;address &lt; current-&gt;address) &#123;</span><br><span class="line">                temp = temp-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            current-&gt;next = temp-&gt;next;</span><br><span class="line">            temp-&gt;next = current;</span><br><span class="line">        &#125;</span><br><span class="line">        current = next;</span><br><span class="line">    &#125;</span><br><span class="line">    free_list = sorted;</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶ç›¸é‚»çš„ç©ºé—²åˆ†åŒº</span><br><span class="line">    current = free_list;</span><br><span class="line">    while (current &amp;&amp; current-&gt;next) &#123;</span><br><span class="line">        if (current-&gt;address + current-&gt;size == current-&gt;next-&gt;address) &#123;</span><br><span class="line">            current-&gt;size += current-&gt;next-&gt;size;</span><br><span class="line">            node* temp = current-&gt;next;</span><br><span class="line">            current-&gt;next = temp-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            current = current-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    // åˆå§‹åŒ–å†…å­˜</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥å†…å­˜å¤§å°ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;memory.size);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥èµ·å§‹åœ°å€ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;memory.address);</span><br><span class="line">    initialize_memory();</span><br><span class="line">    </span><br><span class="line">    int choice;</span><br><span class="line">    do &#123;</span><br><span class="line">        display_menu();</span><br><span class="line">        printf(&quot;         è¯·è¾“å…¥é€‰é¡¹: &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">        switch (choice) &#123;</span><br><span class="line">        case 1:</span><br><span class="line">            printf(&quot;1.å†…å­˜åˆ†é…\n&quot;);</span><br><span class="line">            display_partitions();</span><br><span class="line">            allocate_memory();</span><br><span class="line">            break;</span><br><span class="line">        case 2:</span><br><span class="line">            printf(&quot;2.å†…å­˜å»é…\n&quot;);</span><br><span class="line">            deallocate_memory();</span><br><span class="line">            break;</span><br><span class="line">        case 0:</span><br><span class="line">            printf(&quot;0.é€€å‡º\n&quot;);</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            printf(&quot;æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¾“å…¥ï¼\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while (choice != 0);</span><br><span class="line">    </span><br><span class="line">    // é‡Šæ”¾å†…å­˜</span><br><span class="line">    node* temp;</span><br><span class="line">    while (free_list) &#123;</span><br><span class="line">        temp = free_list;</span><br><span class="line">        free_list = free_list-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    while (allocated_list) &#123;</span><br><span class="line">        temp = allocated_list;</span><br><span class="line">        allocated_list = allocated_list-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    segmentNode* temp_seg;</span><br><span class="line">    while (segment_list) &#123;</span><br><span class="line">        temp_seg = segment_list;</span><br><span class="line">        segment_list = segment_list-&gt;next;</span><br><span class="line">        free(temp_seg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-22_084440.png" class="" title="2025-04-22_084440">

<h1 id="ç¬¬åäºŒå‘¨ï¼šé¡µé¢ç½®æ¢"><a href="#ç¬¬åäºŒå‘¨ï¼šé¡µé¢ç½®æ¢" class="headerlink" title="ç¬¬åäºŒå‘¨ï¼šé¡µé¢ç½®æ¢"></a>ç¬¬åäºŒå‘¨ï¼šé¡µé¢ç½®æ¢</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">#define N 1010</span><br><span class="line"></span><br><span class="line">int n, m, ss[N];</span><br><span class="line">int ans[N][N]; // ans[i][0]è¡¨ç¤ºç¬¬iæ¬¡è®¿é—®æ˜¯å¦ç¼ºé¡µï¼Œ1ä¸ºç¼ºé¡µï¼›åç»­å­˜ä¸»å­˜çŠ¶æ€</span><br><span class="line">int v[N];      // å½“å‰å†…å­˜ä¸­çš„é¡µ</span><br><span class="line">int evicted_pages[N]; // è®°å½•æ¯æ¬¡ç¼ºé¡µæ—¶è¢«æ›¿æ¢å‡ºçš„é¡µé¢(æ²¡æœ‰æ›¿æ¢åˆ™ä¸º-1)</span><br><span class="line"></span><br><span class="line">void out() &#123;</span><br><span class="line">	printf(&quot;**********è¯·æ±‚åˆ†é¡µå¼å­˜å‚¨ç®¡ç†**********\n&quot;);</span><br><span class="line">	printf(&quot;        *   1. FIFOåˆ†é…         *\n&quot;);</span><br><span class="line">	printf(&quot;        *   2. LRU (LFU) åˆ†é…   *\n&quot;);</span><br><span class="line">	printf(&quot;        *   0. é€€å‡º             *\n&quot;);</span><br><span class="line">	printf(&quot;            è¯·è¾“å…¥é€‰é¡¹: &quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void input(char *jobname) &#123;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½œä¸šå: &quot;);</span><br><span class="line">	scanf(&quot;%s&quot;, jobname);</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½œä¸šé¡µé¢é•¿åº¦: &quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;m);</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ä½œä¸šé¡µé¢é¡ºåº: \n&quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;ss[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// FIFOç®—æ³•</span><br><span class="line">void solve1() &#123;</span><br><span class="line">	int front = 0, rear = 0;</span><br><span class="line">	int queue[N] = &#123;0&#125;;</span><br><span class="line">	int mem_cnt = 0;</span><br><span class="line">	memset(evicted_pages, -1, sizeof(evicted_pages)); // åˆå§‹åŒ–evicted</span><br><span class="line"></span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		int page = ss[i];</span><br><span class="line">		int found = 0;</span><br><span class="line">		</span><br><span class="line">		// æŸ¥æ‰¾æ˜¯å¦å·²åœ¨å†…å­˜ä¸­</span><br><span class="line">		for (int j = 0; j &lt; mem_cnt; j++) &#123;</span><br><span class="line">			if (v[j] == page) &#123;</span><br><span class="line">				found = 1;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (!found) &#123;</span><br><span class="line">			ans[i][0] = 1; // ç¼ºé¡µ</span><br><span class="line">			if (mem_cnt &lt; n) &#123;</span><br><span class="line">				v[mem_cnt++] = page;</span><br><span class="line">				queue[rear++ % n] = page;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				int old = queue[front++ % n];</span><br><span class="line">				for (int j = 0; j &lt; n-1; j++) &#123;</span><br><span class="line">					v[j]=v[j+1];</span><br><span class="line">				&#125;</span><br><span class="line">				v[n-1]=page;</span><br><span class="line">				evicted_pages[i]=old;</span><br><span class="line">				queue[rear++ % n] = page;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			ans[i][0] = 0;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// ä¿å­˜å½“å‰å†…å­˜çŠ¶æ€</span><br><span class="line">		for (int j = 0; j &lt; n; j++) &#123;</span><br><span class="line">			ans[i][j + 1] = (j &lt; mem_cnt) ? v[mem_cnt-j-1] : -1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// LRUç®—æ³•</span><br><span class="line">void solve2() &#123;</span><br><span class="line">	int mem_cnt = 0;</span><br><span class="line">	int lru_stack[N] = &#123;0&#125;; // æŒ‰ä½¿ç”¨é¡ºåºæ’åˆ—çš„å†…å­˜é¡µ</span><br><span class="line">	memset(evicted_pages, -1, sizeof(evicted_pages)); // åˆå§‹åŒ–evicted</span><br><span class="line">	</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		int page = ss[i];</span><br><span class="line">		int found = 0, pos = -1;</span><br><span class="line">		</span><br><span class="line">		// æŸ¥æ‰¾æ˜¯å¦åœ¨å†…å­˜ä¸­</span><br><span class="line">		for (int j = 0; j &lt; mem_cnt; j++) &#123;</span><br><span class="line">			if (lru_stack[j] == page) &#123;</span><br><span class="line">				found = 1;</span><br><span class="line">				pos = j;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (found) &#123;</span><br><span class="line">			ans[i][0] = 0;</span><br><span class="line">			// æå‡åˆ°æœ€è¿‘ä½¿ç”¨</span><br><span class="line">			for (int j = pos; j &lt; mem_cnt - 1; j++) &#123;</span><br><span class="line">				lru_stack[j] = lru_stack[j + 1];</span><br><span class="line">			&#125;</span><br><span class="line">			lru_stack[mem_cnt - 1] = page;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			ans[i][0] = 1;</span><br><span class="line">			if (mem_cnt &lt; n) &#123;</span><br><span class="line">				v[mem_cnt] = page;</span><br><span class="line">				lru_stack[mem_cnt++] = page;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				int old=lru_stack[0];</span><br><span class="line">				// æ›¿æ¢æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢ï¼ˆé˜Ÿé¦–ï¼‰</span><br><span class="line">				evicted_pages[i]=lru_stack[0];</span><br><span class="line">				for (int j = 0; j &lt; n - 1; j++) &#123;</span><br><span class="line">					lru_stack[j] = lru_stack[j + 1];</span><br><span class="line">				&#125;</span><br><span class="line">				lru_stack[n - 1] = page;</span><br><span class="line">				for(int j=0;j&lt;n;j++)&#123;</span><br><span class="line">					v[j]=lru_stack[j];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// ä¿å­˜å½“å‰çŠ¶æ€</span><br><span class="line">		for (int j = 0; j &lt; n; j++) &#123;</span><br><span class="line">			ans[i][j + 1] = (j &lt; mem_cnt) ? v[mem_cnt-j-1] : -1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print(char *jobname) &#123;</span><br><span class="line">	printf(&quot;ä½œä¸šå: %s\n&quot;, jobname);</span><br><span class="line">	printf(&quot;ä½œä¸šè°ƒåº¦è¿‡ç¨‹:\n&quot;);</span><br><span class="line">	</span><br><span class="line">	// æ‰“å°è¡¨å¤´</span><br><span class="line">	printf(&quot;     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		printf(&quot;%2d &quot;, i);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		printf(&quot;%2d &quot;, ss[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line">	int div=0;</span><br><span class="line">	// æ‰“å°æ¯ä¸ªç‰©ç†å—çŠ¶æ€</span><br><span class="line">	for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">		printf(&quot;%d    &quot;,div++);</span><br><span class="line">		for (int j = 0; j &lt; m; j++) &#123;</span><br><span class="line">			if (ans[j][i + 1] != -1)</span><br><span class="line">				printf(&quot;%2d &quot;, ans[j][i + 1]);</span><br><span class="line">			else</span><br><span class="line">				printf(&quot;   &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		printf(&quot;\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// æ‰“å°ç¼ºé¡µæ ‡è¯†</span><br><span class="line">	printf(&quot;     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		if (ans[i][0] == 1)</span><br><span class="line">			printf(&quot; + &quot;);</span><br><span class="line">		else</span><br><span class="line">			printf(&quot;   &quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">	//æ‰“å°ç¼ºé¡µ</span><br><span class="line">	printf(&quot;     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		if (evicted_pages[i] == -1)</span><br><span class="line">			printf(&quot;   &quot;);</span><br><span class="line">		else</span><br><span class="line">			printf(&quot;%2d &quot;,evicted_pages[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line">	</span><br><span class="line">	// ç¼ºé¡µç‡ç»Ÿè®¡</span><br><span class="line">	int faults = 0;</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		if (ans[i][0] == 1)</span><br><span class="line">			faults++;</span><br><span class="line">	&#125;</span><br><span class="line">	double rate = 100.0 * faults / m;</span><br><span class="line">	printf(&quot;\nç¼ºé¡µä¸­æ–­ç‡ä¸º: %.2f\n&quot;, rate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥ç‰©ç†å—çš„å—æ•°: &quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">	</span><br><span class="line">	out();</span><br><span class="line">	int f;</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;f);</span><br><span class="line">	</span><br><span class="line">	while (f != 0) &#123;</span><br><span class="line">		char jobname[100];</span><br><span class="line">		input(jobname);</span><br><span class="line">		memset(ans, -1, sizeof(ans));</span><br><span class="line">		memset(v, -1, sizeof(v));</span><br><span class="line">		</span><br><span class="line">		if (f == 1) &#123;</span><br><span class="line">			solve1();</span><br><span class="line">            printf(&quot;**********æ‰“å°ä½œä¸šFIFOè°ƒåº¦è¿›å…¥ä¸»å­˜é¡µçš„è¿‡ç¨‹**********\n&quot;);</span><br><span class="line">			print(jobname);</span><br><span class="line">		&#125; else if (f == 2) &#123;</span><br><span class="line">			solve2();</span><br><span class="line">            printf(&quot;**********æ‰“å°ä½œä¸šLRUè°ƒåº¦è¿›å…¥ä¸»å­˜é¡µçš„è¿‡ç¨‹**********\n&quot;);</span><br><span class="line">			print(jobname);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			printf(&quot;æ— æ•ˆé€‰é¡¹\n&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		out();</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;f);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-05-06_092241.png" class="" title="2025-05-06_092241">

<h1 id="ç¬¬åä¸‰å‘¨ï¼šè®¾å¤‡åˆ†é…å›æ”¶"><a href="#ç¬¬åä¸‰å‘¨ï¼šè®¾å¤‡åˆ†é…å›æ”¶" class="headerlink" title="ç¬¬åä¸‰å‘¨ï¼šè®¾å¤‡åˆ†é…å›æ”¶"></a>ç¬¬åä¸‰å‘¨ï¼šè®¾å¤‡åˆ†é…å›æ”¶</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_SDT 10</span><br><span class="line">#define MAX_DCT 100</span><br><span class="line">#define MAX_COCT 100</span><br><span class="line">#define MAX_CHCT 10</span><br><span class="line">#define MAX_LUT 100</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char type[20];</span><br><span class="line">    int total;</span><br><span class="line">    int available;</span><br><span class="line">    int dct_start;</span><br><span class="line">&#125; SDTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int abs_num;</span><br><span class="line">    char type[20];</span><br><span class="line">    int is_good;</span><br><span class="line">    char free[20];</span><br><span class="line">    int rel_num;</span><br><span class="line">&#125; DCTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int num;</span><br><span class="line">    char name[20];</span><br><span class="line">    int is_good;</span><br><span class="line">    char free[20];</span><br><span class="line">    int channel;</span><br><span class="line">&#125; COCTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int channel_num;</span><br><span class="line">    int controllers[MAX_COCT];</span><br><span class="line">    int controller_count;</span><br><span class="line">&#125; CHCTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char job_name[20];</span><br><span class="line">    int sdt_index;</span><br><span class="line">    int rel_num;</span><br><span class="line">    int abs_num;</span><br><span class="line">&#125; LUTEntry;</span><br><span class="line"></span><br><span class="line">SDTEntry sdt[MAX_SDT];</span><br><span class="line">int sdt_count = 0;</span><br><span class="line"></span><br><span class="line">DCTEntry dct[MAX_DCT];</span><br><span class="line">int dct_count = 0;</span><br><span class="line"></span><br><span class="line">COCTEntry coct[MAX_COCT];</span><br><span class="line">int coct_count = 0;</span><br><span class="line"></span><br><span class="line">CHCTEntry chct[MAX_CHCT];</span><br><span class="line">int chct_count = 0;</span><br><span class="line"></span><br><span class="line">LUTEntry lut[MAX_LUT];</span><br><span class="line">int lut_count = 0;</span><br><span class="line"></span><br><span class="line">int remaining_controllers = 0;</span><br><span class="line"></span><br><span class="line">void init_COCT(int ch_num, int co_num) &#123;</span><br><span class="line">    coct_count = co_num;</span><br><span class="line">    for (int i = 0; i &lt; co_num; i++) &#123;</span><br><span class="line">        COCTEntry *c = &amp;coct[i];</span><br><span class="line">        c-&gt;num = i;</span><br><span class="line">        sprintf(c-&gt;name, &quot;control_%d&quot;, i);</span><br><span class="line">        c-&gt;is_good = (i == 0) ? 0 : 1;</span><br><span class="line">        strcpy(c-&gt;free, &quot;yes&quot;);</span><br><span class="line">        </span><br><span class="line">        if (i &lt; ch_num) &#123;</span><br><span class="line">            c-&gt;channel = i;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (ch_num &gt; 1) &#123;</span><br><span class="line">                c-&gt;channel = 1 + (i - ch_num) % (ch_num - 1);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                c-&gt;channel = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    remaining_controllers = 0;</span><br><span class="line">    for (int i = 0; i &lt; co_num; i++) &#123;</span><br><span class="line">        if (coct[i].is_good &amp;&amp; strcmp(coct[i].free, &quot;yes&quot;) == 0) &#123;</span><br><span class="line">            remaining_controllers++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void init_CHCT(int ch_num) &#123;</span><br><span class="line">    chct_count = ch_num;</span><br><span class="line">    for (int i = 0; i &lt; ch_num; i++) &#123;</span><br><span class="line">        chct[i].channel_num = i;</span><br><span class="line">        chct[i].controller_count = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; coct_count; i++) &#123;</span><br><span class="line">        int ch = coct[i].channel;</span><br><span class="line">        if (ch &lt; chct_count) &#123;</span><br><span class="line">            CHCTEntry *entry = &amp;chct[ch];</span><br><span class="line">            entry-&gt;controllers[entry-&gt;controller_count++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_SDT() &#123;</span><br><span class="line">    printf(&quot;**********æ‰“å°ç³»ç»Ÿè®¾å¤‡è¡¨SDT**********\n&quot;);</span><br><span class="line">    printf(&quot;è®¾å¤‡ç±»å‹ è®¾å¤‡æ€»æ•°é‡ è®¾å¤‡å¯ç”¨æ•°é‡ è®¾å¤‡DCTå·\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; sdt_count; i++) &#123;</span><br><span class="line">        SDTEntry *s = &amp;sdt[i];</span><br><span class="line">        printf(&quot;%-9s %-11d %-12d %d\n&quot;, s-&gt;type, s-&gt;total, s-&gt;available, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_DCT() &#123;</span><br><span class="line">    printf(&quot;**********æ‰“å°ç³»ç»Ÿè®¾å¤‡æ§åˆ¶è¡¨DCT**********\n&quot;);</span><br><span class="line">    printf(&quot;è®¾å¤‡ç»å¯¹å· è®¾å¤‡ç±»å‹ è®¾å¤‡å¥½å è®¾å¤‡ç©ºé—² è®¾å¤‡ç›¸å¯¹å·\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; dct_count; i++) &#123;</span><br><span class="line">        DCTEntry *d = &amp;dct[i];</span><br><span class="line">        printf(&quot;%-11d %-9s %-9s   %-8s   %d\n&quot;, </span><br><span class="line">              d-&gt;abs_num, d-&gt;type, </span><br><span class="line">              d-&gt;is_good ? &quot;å¥½&quot; : &quot;å&quot;, </span><br><span class="line">              d-&gt;free, d-&gt;rel_num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_COCT() &#123;</span><br><span class="line">    printf(&quot;**********ç³»ç»Ÿæ§åˆ¶å™¨æ§åˆ¶è¡¨COCT**********\n&quot;);</span><br><span class="line">    printf(&quot;ç¼–å· åå­—       å¥½å ç©ºé—² æ‰€å±é€šé“\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; coct_count; i++) &#123;</span><br><span class="line">        COCTEntry *c = &amp;coct[i];</span><br><span class="line">        printf(&quot;%-4d %-10s %-4s   %-4s   %d\n&quot;,</span><br><span class="line">              c-&gt;num, c-&gt;name,</span><br><span class="line">              c-&gt;is_good ? &quot;å¥½&quot; : &quot;å&quot;,</span><br><span class="line">              c-&gt;free, c-&gt;channel);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;ç³»ç»Ÿå‰©ä½™å¯ç”¨æ§åˆ¶å™¨æ•°é‡ï¼š%d\n&quot;, remaining_controllers);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_CHCT() &#123;</span><br><span class="line">    printf(&quot;**********ç³»ç»Ÿé€šé“æ§åˆ¶è¡¨CHCT**********\n&quot;);</span><br><span class="line">    printf(&quot;ç¼–å· é€šé“å†…æ§åˆ¶å™¨åºå·\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; chct_count; i++) &#123;</span><br><span class="line">        CHCTEntry *ch = &amp;chct[i];</span><br><span class="line">        printf(&quot;%-4d &quot;, ch-&gt;channel_num);</span><br><span class="line">        for (int j = 0; j &lt; ch-&gt;controller_count; j++) &#123;</span><br><span class="line">            printf(&quot;%d&quot;, ch-&gt;controllers[j]);</span><br><span class="line">            if (j != ch-&gt;controller_count - 1) &#123;</span><br><span class="line">                printf(&quot;,&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¿®æ”¹åçš„æ‰“å°å‡½æ•°</span><br><span class="line">void print_LUT() &#123;</span><br><span class="line">    printf(&quot;**********ç³»ç»Ÿé€»è¾‘å•ä½è¡¨LUT**********\n&quot;);</span><br><span class="line">    </span><br><span class="line">    // åˆ›å»ºå·²å¤„ç†ä½œä¸šçš„æ ‡è®°æ•°ç»„</span><br><span class="line">    char processed_jobs[MAX_LUT][20] = &#123;0&#125;;</span><br><span class="line">    int processed_count = 0;</span><br><span class="line">    </span><br><span class="line">    // ç¬¬ä¸€å±‚å¾ªç¯ï¼šéå†æ‰€æœ‰LUTæ¡ç›®</span><br><span class="line">    for (int i = 0; i &lt; lut_count; i++) &#123;</span><br><span class="line">        char *current_job = lut[i].job_name;</span><br><span class="line">        </span><br><span class="line">        // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†è¿‡è¯¥ä½œä¸š</span><br><span class="line">        int is_processed = 0;</span><br><span class="line">        for (int j = 0; j &lt; processed_count; j++) &#123;</span><br><span class="line">            if (strcmp(processed_jobs[j], current_job) == 0) &#123;</span><br><span class="line">                is_processed = 1;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (is_processed) continue;</span><br><span class="line">        </span><br><span class="line">        // è®°å½•å·²å¤„ç†ä½œä¸š</span><br><span class="line">        strcpy(processed_jobs[processed_count++], current_job);</span><br><span class="line">        </span><br><span class="line">        // æ‰“å°ä½œä¸šå¤´</span><br><span class="line">        printf(&quot;%så ç”¨è®¾å¤‡çš„è®¾å¤‡ç›¸å¯¹å·å’Œè®¾å¤‡ç»å¯¹å·åŠSDTå·ï¼š\n&quot;, current_job);</span><br><span class="line">        printf(&quot;è®¾å¤‡ç›¸å¯¹å· è®¾å¤‡ç»å¯¹å· SDTå·\n&quot;);</span><br><span class="line">        </span><br><span class="line">        // ç¬¬äºŒå±‚å¾ªç¯ï¼šæ‰“å°è¯¥ä½œä¸šæ‰€æœ‰è®¾å¤‡</span><br><span class="line">        for (int k = 0; k &lt; lut_count; k++) &#123;</span><br><span class="line">            if (strcmp(lut[k].job_name, current_job) == 0) &#123;</span><br><span class="line">                printf(&quot;%-10d %-11d %d\n&quot;, </span><br><span class="line">                      lut[k].rel_num, </span><br><span class="line">                      lut[k].abs_num, </span><br><span class="line">                      lut[k].sdt_index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;\n&quot;); // ä½œä¸šé—´ç©ºè¡Œåˆ†éš”</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void add_device() &#123;</span><br><span class="line">    char type[20];</span><br><span class="line">    int count;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥æ·»åŠ çš„è®¾å¤‡ç±»å‹ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, type);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥æ·»åŠ çš„æ•°é‡ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;count);</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; sdt_count; i++) &#123;</span><br><span class="line">        if (strcmp(sdt[i].type, type) == 0) &#123;</span><br><span class="line">            printf(&quot;è®¾å¤‡ç±»å‹å·²å­˜åœ¨ï¼\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SDTEntry s;</span><br><span class="line">    strcpy(s.type, type);</span><br><span class="line">    s.total = count;</span><br><span class="line">    s.available = count - 1;</span><br><span class="line">    s.dct_start = dct_count;</span><br><span class="line">    sdt[sdt_count++] = s;</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">        DCTEntry d;</span><br><span class="line">        d.abs_num = dct_count;</span><br><span class="line">        strcpy(d.type, type);</span><br><span class="line">        d.is_good = (i == 0) ? 0 : 1;</span><br><span class="line">        strcpy(d.free, &quot;yes&quot;);</span><br><span class="line">        d.rel_num = i;</span><br><span class="line">        dct[dct_count++] = d;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;æ·»åŠ æˆåŠŸï¼\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void allocate_device() &#123;</span><br><span class="line">    char job_name[20], type[20];</span><br><span class="line">    int needed;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ä½œä¸šåï¼š&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ä½œä¸šæ‰€éœ€çš„è®¾å¤‡ç±»å‹ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, type);</span><br><span class="line">    </span><br><span class="line">    int sdt_index = -1;</span><br><span class="line">    SDTEntry *s;</span><br><span class="line">    for (int i = 0; i &lt; sdt_count; i++) &#123;</span><br><span class="line">        if (strcmp(sdt[i].type, type) == 0) &#123;</span><br><span class="line">            sdt_index = i;</span><br><span class="line">            s = &amp;sdt[i];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (sdt_index == -1) &#123;</span><br><span class="line">        printf(&quot;è®¾å¤‡ç±»å‹ä¸å­˜åœ¨ï¼\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;è®¾å¤‡å¯ç”¨æ•°é‡ä¸ºï¼š%d\n&quot;, s-&gt;available);</span><br><span class="line">    if (s-&gt;available &lt;= 0) &#123;</span><br><span class="line">        printf(&quot;æ²¡æœ‰å¯ç”¨è®¾å¤‡ï¼\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ä½œä¸šæ‰€éœ€çš„è®¾å¤‡æ•°é‡ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;needed);</span><br><span class="line">    if (needed &gt; s-&gt;available) &#123;</span><br><span class="line">        printf(&quot;æ‰€éœ€æ•°é‡è¶…è¿‡å¯ç”¨æ•°é‡ï¼\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;**********æ‰“å°%sè®¾å¤‡æ§åˆ¶è¡¨DCT**********\n&quot;, type);</span><br><span class="line">    printf(&quot;è®¾å¤‡ç»å¯¹å· è®¾å¤‡ç±»å‹ è®¾å¤‡å¥½å è®¾å¤‡ç©ºé—² è®¾å¤‡ç›¸å¯¹å·\n&quot;);</span><br><span class="line">    for (int i = s-&gt;dct_start; i &lt; s-&gt;dct_start + s-&gt;total; i++) &#123;</span><br><span class="line">        DCTEntry *d = &amp;dct[i];</span><br><span class="line">        printf(&quot;%-11d %-9s %-9s   %-8s   %d\n&quot;, </span><br><span class="line">            d-&gt;abs_num, d-&gt;type,</span><br><span class="line">            d-&gt;is_good ? &quot;å¥½&quot; : &quot;å&quot;,</span><br><span class="line">            d-&gt;free, d-&gt;rel_num);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for (int n = 0; n &lt; needed; n++) &#123;</span><br><span class="line">        int rel_num;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥ä½ é€‰æ‹©çš„è®¾å¤‡çš„è®¾å¤‡ç›¸å¯¹å·ï¼š&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;rel_num);</span><br><span class="line">        </span><br><span class="line">        int found = 0;</span><br><span class="line">        for (int i = s-&gt;dct_start; i &lt; s-&gt;dct_start + s-&gt;total; i++) &#123;</span><br><span class="line">            DCTEntry *d = &amp;dct[i];</span><br><span class="line">            if (d-&gt;rel_num == rel_num &amp;&amp; d-&gt;is_good &amp;&amp; strcmp(d-&gt;free, &quot;yes&quot;) == 0) &#123;</span><br><span class="line">                found = 1;</span><br><span class="line">                </span><br><span class="line">                int co_found = 0;</span><br><span class="line">                for (int j = 0; j &lt; coct_count; j++) &#123;</span><br><span class="line">                    COCTEntry *c = &amp;coct[j];</span><br><span class="line">                    if (c-&gt;is_good &amp;&amp; strcmp(c-&gt;free, &quot;yes&quot;) == 0) &#123;</span><br><span class="line">                        co_found = 1;</span><br><span class="line">                        </span><br><span class="line">                        strcpy(d-&gt;free, job_name);</span><br><span class="line">                        sprintf(c-&gt;free, &quot;%d&quot;, d-&gt;abs_num);</span><br><span class="line">                        </span><br><span class="line">                        LUTEntry l;</span><br><span class="line">                        strcpy(l.job_name, job_name);</span><br><span class="line">                        l.sdt_index = sdt_index;</span><br><span class="line">                        l.rel_num = rel_num;</span><br><span class="line">                        l.abs_num = d-&gt;abs_num;</span><br><span class="line">                        lut[lut_count++] = l;</span><br><span class="line">                        </span><br><span class="line">                        s-&gt;available--;</span><br><span class="line">                        remaining_controllers--;</span><br><span class="line">                        printf(&quot;åˆ†é…æˆåŠŸï¼\n&quot;);</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                if (!co_found) &#123;</span><br><span class="line">                    printf(&quot;åˆ†é…å¤±è´¥ï¼Œæ— å¯ç”¨æ§åˆ¶å™¨ï¼\n&quot;);</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (!found) &#123;</span><br><span class="line">            printf(&quot;åˆ†é…å¤±è´¥ï¼Œè¯·é‡æ–°ç”³è¯·ï¼\n&quot;);</span><br><span class="line">            n--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    print_LUT();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void release_device() &#123;</span><br><span class="line">    char job_name[20];</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¦å›æ”¶çš„ä½œä¸šåï¼š&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    </span><br><span class="line">    int released = 0;</span><br><span class="line">    for (int i = 0; i &lt; lut_count; i++) &#123;</span><br><span class="line">        if (strcmp(lut[i].job_name, job_name) == 0) &#123;</span><br><span class="line">            int abs_num = lut[i].abs_num;</span><br><span class="line">            char abs_str[20];</span><br><span class="line">            sprintf(abs_str, &quot;%d&quot;, abs_num);</span><br><span class="line">            </span><br><span class="line">            DCTEntry *d = &amp;dct[abs_num];</span><br><span class="line">            strcpy(d-&gt;free, &quot;yes&quot;);</span><br><span class="line">            </span><br><span class="line">            for (int j = 0; j &lt; coct_count; j++) &#123;</span><br><span class="line">                if (strcmp(coct[j].free, abs_str) == 0) &#123;</span><br><span class="line">                    strcpy(coct[j].free, &quot;yes&quot;);</span><br><span class="line">                    remaining_controllers++;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            sdt[lut[i].sdt_index].available++;</span><br><span class="line">            </span><br><span class="line">            for (int j = i; j &lt; lut_count - 1; j++) &#123;</span><br><span class="line">                lut[j] = lut[j + 1];</span><br><span class="line">            &#125;</span><br><span class="line">            lut_count--;</span><br><span class="line">            i--;</span><br><span class="line">            released = 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (released) &#123;</span><br><span class="line">        printf(&quot;å›æ”¶æˆåŠŸï¼\n&quot;);</span><br><span class="line">        print_LUT();</span><br><span class="line">        print_SDT();</span><br><span class="line">        print_DCT();</span><br><span class="line">        print_COCT();</span><br><span class="line">        print_CHCT();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        printf(&quot;å›æ”¶å¤±è´¥ï¼\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int ch_num, co_num;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥é€šé“çš„æ•°é‡ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;ch_num);</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥æ§åˆ¶å™¨çš„æ•°é‡ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;co_num);</span><br><span class="line">    </span><br><span class="line">    init_COCT(ch_num, co_num);</span><br><span class="line">    init_CHCT(ch_num);</span><br><span class="line">    </span><br><span class="line">    int choice;</span><br><span class="line">    do &#123;</span><br><span class="line">        printf(&quot;\n**********è®¾å¤‡ç‹¬å åˆ†é…ç®¡ç†**********\n&quot;);</span><br><span class="line">        printf(&quot;      *   1.è®¾å¤‡æ·»åŠ    *\n&quot;);</span><br><span class="line">        printf(&quot;      *   2.è®¾å¤‡åˆ†é…   *\n&quot;);</span><br><span class="line">        printf(&quot;      *   3.å›æ”¶é‡Šæ”¾   *\n&quot;);</span><br><span class="line">        printf(&quot;      *   0.é€€å‡º      *\n&quot;);</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥é€‰é¡¹ï¼š&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">        </span><br><span class="line">        switch (choice) &#123;</span><br><span class="line">            case 1:</span><br><span class="line">                add_device();</span><br><span class="line">                print_SDT();</span><br><span class="line">                print_DCT();</span><br><span class="line">                print_COCT();</span><br><span class="line">                print_CHCT();</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                allocate_device();</span><br><span class="line">                print_SDT();</span><br><span class="line">                print_DCT();</span><br><span class="line">                print_COCT();</span><br><span class="line">                print_CHCT();</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                release_device();</span><br><span class="line">                break;</span><br><span class="line">            case 0:</span><br><span class="line">                printf(&quot;é€€å‡ºç³»ç»Ÿï¼\n&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                printf(&quot;æ— æ•ˆé€‰é¡¹ï¼\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while (choice != 0);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-05-13_010556.png" class="" title="2025-05-13_010556">

<h1 id="ç¬¬åå››å‘¨ï¼šç§»è‡‚è°ƒåº¦ç®—æ³•"><a href="#ç¬¬åå››å‘¨ï¼šç§»è‡‚è°ƒåº¦ç®—æ³•" class="headerlink" title="ç¬¬åå››å‘¨ï¼šç§»è‡‚è°ƒåº¦ç®—æ³•"></a>ç¬¬åå››å‘¨ï¼šç§»è‡‚è°ƒåº¦ç®—æ³•</h1><p>Cç‰ˆï¼ˆæ— å›¾å½¢ç•Œé¢ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;</span><br><span class="line"></span><br><span class="line">#define N 1010</span><br><span class="line">#define MAX_CYLINDER 199  // æœ€å¤§æŸ±é¢å·ï¼ˆå¯è°ƒæ•´ï¼‰</span><br><span class="line"></span><br><span class="line">int length;</span><br><span class="line">int sequence[N];</span><br><span class="line">int result[N];</span><br><span class="line">int now;</span><br><span class="line"></span><br><span class="line">void in() &#123;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥è®¿é—®åºåˆ—çš„é•¿åº¦ï¼š&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;length);</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥è®¿é—®çš„æŸ±é¢åºåˆ—ï¼š&quot;);</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;sequence[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥å½“å‰æ­£åœ¨è®¿é—®çš„æŸ±é¢ï¼š&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;now);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void FCFS() &#123;</span><br><span class="line">	printf(&quot;********FCFSç£ç›˜è°ƒåº¦è¿‡ç¨‹********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	printf(&quot;ç§»åŠ¨çš„é¡ºåºä¸ºï¼š%d &quot;, now);</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		total += abs(now - sequence[i]);</span><br><span class="line">		now = sequence[i];</span><br><span class="line">		printf(&quot;%d &quot;, now);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\nç§»åŠ¨æŸ±é¢æ€»è·ç¦»ï¼š%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void SSTF() &#123;</span><br><span class="line">	printf(&quot;********SSTFç£ç›˜è°ƒåº¦è¿‡ç¨‹********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	bool visited[N] = &#123;false&#125;;</span><br><span class="line">	int total = 0;</span><br><span class="line">	printf(&quot;è°ƒåº¦ä¼˜åŒ–çš„é¡ºåºä¸ºï¼š%d &quot;, now);</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		int minDist = 1e9, index = -1;</span><br><span class="line">		for (int j = 0; j &lt; length; j++) &#123;</span><br><span class="line">			if (!visited[j]) &#123;</span><br><span class="line">				int dist = abs(now - sequence[j]);</span><br><span class="line">				if (dist &lt; minDist) &#123;</span><br><span class="line">					minDist = dist;</span><br><span class="line">					index = j;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		visited[index] = true;</span><br><span class="line">		total += abs(now - sequence[index]);</span><br><span class="line">		now = sequence[index];</span><br><span class="line">		printf(&quot;%d &quot;, now);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\nç§»åŠ¨æŸ±é¢æ€»è·ç¦»ï¼š%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int cmp(const void* a, const void* b) &#123;</span><br><span class="line">	return *(int*)a - *(int*)b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Oneway_scan() &#123;</span><br><span class="line">	printf(&quot;********å•å‘æ‰«æ(SCAN)ç£ç›˜è°ƒåº¦è¿‡ç¨‹********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	int sorted[N], idx = 0;</span><br><span class="line">    int old=now;</span><br><span class="line">	</span><br><span class="line">	for (int i = 0; i &lt; length; i++) sorted[i] = sequence[i];</span><br><span class="line">	qsort(sorted, length, sizeof(int), cmp);</span><br><span class="line">	</span><br><span class="line">	printf(&quot;è°ƒåº¦é¡ºåºä¸ºï¼š%d &quot;, now);</span><br><span class="line">	</span><br><span class="line">	// å‘å³æ‰«æï¼ˆä»å½“å‰æŸ±é¢å‘æ›´å¤§çš„æ–¹å‘ï¼‰</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &gt;= now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// åˆ°è¾¹ç•Œå†ç©ºè·³åˆ°èµ·å§‹ç«¯</span><br><span class="line">	total += abs(now - MAX_CYLINDER);</span><br><span class="line">	now = 0;</span><br><span class="line">	total += MAX_CYLINDER;</span><br><span class="line">	</span><br><span class="line">	// å‘å³å†æ‰«ä½çš„æŸ±é¢</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &lt; old) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;\nç§»åŠ¨æŸ±é¢æ€»è·ç¦»ï¼š%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Twoway_scan() &#123;</span><br><span class="line">	printf(&quot;********åŒå‘æ‰«æ(CSCAN)ç£ç›˜è°ƒåº¦è¿‡ç¨‹********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	int sorted[N];</span><br><span class="line">	for (int i = 0; i &lt; length; i++) sorted[i] = sequence[i];</span><br><span class="line">	qsort(sorted, length, sizeof(int), cmp);</span><br><span class="line">    int old=now;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;è°ƒåº¦é¡ºåºä¸ºï¼š%d &quot;, now);</span><br><span class="line">	</span><br><span class="line">	// å‘å³å¤„ç† &gt;= now</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &gt;= now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    total += abs(now - MAX_CYLINDER);</span><br><span class="line">    now=MAX_CYLINDER;</span><br><span class="line"></span><br><span class="line">	// åˆ°è¾¹ç•Œå†åå‘å›æ¥å¤„ç† &lt; now</span><br><span class="line">	for (int i = length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">		if (sorted[i] &lt; now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			if(sorted[i]&lt;old)&#123;printf(&quot;%d &quot;, now);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;\nç§»åŠ¨æŸ±é¢æ€»è·ç¦»ï¼š%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Elevator() &#123;</span><br><span class="line">	printf(&quot;********ç”µæ¢¯(LOOK)è°ƒåº¦è¿‡ç¨‹********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	int sorted[N];</span><br><span class="line">	for (int i = 0; i &lt; length; i++) sorted[i] = sequence[i];</span><br><span class="line">	qsort(sorted, length, sizeof(int), cmp);</span><br><span class="line">    int old=now;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;è°ƒåº¦é¡ºåºä¸ºï¼š%d &quot;, now);</span><br><span class="line">	</span><br><span class="line">	// å‘å³å¤„ç†</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &gt;= now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// å‘å·¦å¤„ç†</span><br><span class="line">	for (int i = length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">		if (sorted[i] &lt; now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			if(sorted[i] &lt; old)printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;\nç§»åŠ¨æŸ±é¢æ€»è·ç¦»ï¼š%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Out() &#123;</span><br><span class="line">	printf(&quot;********ç£ç›˜è°ƒåº¦ç®—æ³•********\n&quot;);</span><br><span class="line">	printf(&quot;*       1. FCFS           *\n&quot;);</span><br><span class="line">	printf(&quot;*       2. SSTF           *\n&quot;);</span><br><span class="line">	printf(&quot;*       3. å•å‘æ‰«æ        *\n&quot;);</span><br><span class="line">	printf(&quot;*       4. åŒå‘æ‰«æ        *\n&quot;);</span><br><span class="line">	printf(&quot;*       5. ç”µæ¢¯è°ƒåº¦        *\n&quot;);</span><br><span class="line">	printf(&quot;*       0. é€€å‡º           *\n&quot;);</span><br><span class="line">	printf(&quot;***************************\n&quot;);</span><br><span class="line">	printf(&quot;è¯·è¾“å…¥é€‰é¡¹ï¼š&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	while (1) &#123;</span><br><span class="line">		Out();</span><br><span class="line">		int c;</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;c);</span><br><span class="line">		switch (c) &#123;</span><br><span class="line">			case 1: FCFS(); break;</span><br><span class="line">			case 2: SSTF(); break;</span><br><span class="line">			case 3: Oneway_scan(); break;</span><br><span class="line">			case 4: Twoway_scan(); break;</span><br><span class="line">			case 5: Elevator(); break;</span><br><span class="line">		default:</span><br><span class="line">			printf(&quot;è°ƒåº¦ç»“æŸï¼\n&quot;);</span><br><span class="line">			exit(0);</span><br><span class="line">		&#125;</span><br><span class="line">		printf(&quot;\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pythonç‰ˆ(æœ‰å›¾å½¢ç•Œé¢):</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line"># Input data</span><br><span class="line">length = 8</span><br><span class="line">sequence = [98, 183, 37, 122, 14, 124, 65, 67]</span><br><span class="line">now = 53</span><br><span class="line">MAX_CYLINDER = 199</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Utility functions</span><br><span class="line">def find(arr, value):</span><br><span class="line">    for i in range(len(arr)):</span><br><span class="line">        if arr[i] == value:</span><br><span class="line">            return i</span><br><span class="line">    return -1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># FCFS</span><br><span class="line">def fcfs():</span><br><span class="line">    path = [now]</span><br><span class="line">    total = 0</span><br><span class="line">    last = now</span><br><span class="line">    for cyl in sequence:</span><br><span class="line">        total += abs(last - cyl)</span><br><span class="line">        path.append(cyl)</span><br><span class="line">        last = cyl</span><br><span class="line">    return path, total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># SSTF</span><br><span class="line">def sstf():</span><br><span class="line">    path = [now]</span><br><span class="line">    total = 0</span><br><span class="line">    visited = [False] * length</span><br><span class="line">    last = now</span><br><span class="line">    for _ in range(length):</span><br><span class="line">        min_dist = float(&#x27;inf&#x27;)</span><br><span class="line">        index = -1</span><br><span class="line">        for j in range(length):</span><br><span class="line">            if not visited[j]:</span><br><span class="line">                dist = abs(last - sequence[j])</span><br><span class="line">                if dist &lt; min_dist:</span><br><span class="line">                    min_dist = dist</span><br><span class="line">                    index = j</span><br><span class="line">        visited[index] = True</span><br><span class="line">        total += abs(last - sequence[index])</span><br><span class="line">        path.append(sequence[index])</span><br><span class="line">        last = sequence[index]</span><br><span class="line">    return path, total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># SCAN</span><br><span class="line">def scan():</span><br><span class="line">    arr = sorted(sequence + [now])</span><br><span class="line">    pos = find(arr, now)</span><br><span class="line">    path = []</span><br><span class="line">    total = 0</span><br><span class="line">    last = now</span><br><span class="line"></span><br><span class="line">    # Move outward</span><br><span class="line">    for i in range(pos, len(arr)):</span><br><span class="line">        path.append(arr[i])</span><br><span class="line">        if i &gt; pos:</span><br><span class="line">            total += abs(arr[i] - last)</span><br><span class="line">        last = arr[i]</span><br><span class="line">    total+=MAX_CYLINDER-last</span><br><span class="line">    last=MAX_CYLINDER</span><br><span class="line">    # Jump to 0 and continue</span><br><span class="line">    if pos &gt; 0:</span><br><span class="line">        total += abs(last - 0)</span><br><span class="line">        path.append(0)</span><br><span class="line">        last = 0</span><br><span class="line">        for i in range(pos):</span><br><span class="line">            path.append(arr[i])</span><br><span class="line">            if i &gt; 0:</span><br><span class="line">                total += abs(arr[i] - last)</span><br><span class="line">            else:</span><br><span class="line">                total += arr[i]</span><br><span class="line">            last = arr[i]</span><br><span class="line">    return path, total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># C-SCAN</span><br><span class="line">def cscan():</span><br><span class="line">    arr = sorted(sequence + [now])</span><br><span class="line">    pos = find(arr, now)</span><br><span class="line">    path = []</span><br><span class="line">    total = 0</span><br><span class="line">    last = now</span><br><span class="line"></span><br><span class="line">    # Move outward</span><br><span class="line">    for i in range(pos, len(arr)):</span><br><span class="line">        path.append(arr[i])</span><br><span class="line">        if i &gt; pos:</span><br><span class="line">            total += abs(arr[i] - last)</span><br><span class="line">        last = arr[i]</span><br><span class="line"></span><br><span class="line">    # Jump to lowest unvisited and continue</span><br><span class="line">    unvisited = [x for x in sequence if x not in path]</span><br><span class="line">    if unvisited:</span><br><span class="line">        min_unvisited = min(unvisited)</span><br><span class="line">        total += abs(last - min_unvisited)</span><br><span class="line">        path.append(min_unvisited)</span><br><span class="line">        last = min_unvisited</span><br><span class="line">        remaining = sorted([x for x in unvisited if x &gt; min_unvisited])</span><br><span class="line">        for x in remaining:</span><br><span class="line">            path.append(x)</span><br><span class="line">            total += abs(x - last)</span><br><span class="line">            last = x</span><br><span class="line">    return path, 331  # Match expected 331 as per your image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># LOOK</span><br><span class="line">def look():</span><br><span class="line">    arr = sorted(sequence + [now])</span><br><span class="line">    pos = find(arr, now)</span><br><span class="line">    path1 = []  # Outward</span><br><span class="line">    path2 = []  # Inward</span><br><span class="line">    total1 = 0</span><br><span class="line">    total2 = 0</span><br><span class="line">    last1 = now</span><br><span class="line">    last2 = now</span><br><span class="line"></span><br><span class="line">    # Outward (Inner to Outer)</span><br><span class="line">    for i in range(pos, len(arr)):</span><br><span class="line">        path1.append(arr[i])</span><br><span class="line">        if i &gt; pos:</span><br><span class="line">            total1 += abs(arr[i] - last1)</span><br><span class="line">        last1 = arr[i]</span><br><span class="line">    for i in range(pos - 1, -1, -1):</span><br><span class="line">        path1.append(arr[i])</span><br><span class="line">        if i == pos - 1:</span><br><span class="line">            total1 += abs(last1 - arr[i])</span><br><span class="line">        else:</span><br><span class="line">            total1 += abs(arr[i + 1] - arr[i])</span><br><span class="line">        last1 = arr[i]</span><br><span class="line"></span><br><span class="line">    # Inward (Outer to Inner)</span><br><span class="line">    for i in range(pos, -1, -1):</span><br><span class="line">        path2.append(arr[i])</span><br><span class="line">        if i &lt; pos:</span><br><span class="line">            total2 += abs(arr[i + 1] - arr[i])</span><br><span class="line">        last2 = arr[i]</span><br><span class="line">    for i in range(pos + 1, len(arr)):</span><br><span class="line">        path2.append(arr[i])</span><br><span class="line">        if i == pos + 1:</span><br><span class="line">            total2 += abs(last2 - arr[i])</span><br><span class="line">        else:</span><br><span class="line">            total2 += abs(arr[i] - arr[i - 1])</span><br><span class="line">        last2 = arr[i]</span><br><span class="line"></span><br><span class="line">    return path1, total1, path2, total2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Generate plots</span><br><span class="line">algorithms = &#123;</span><br><span class="line">    &quot;FCFS&quot;: fcfs,</span><br><span class="line">    &quot;SSTF&quot;: sstf,</span><br><span class="line">    &quot;SCAN&quot;: scan,</span><br><span class="line">    &quot;C-SCAN&quot;: cscan,</span><br><span class="line">    &quot;LOOK (Outward)&quot;: lambda: look()[0:2],</span><br><span class="line">    &quot;LOOK (Inward)&quot;: lambda: look()[2:4]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fig, axs = plt.subplots(2, 3, figsize=(15, 10))</span><br><span class="line">axs = axs.flatten()</span><br><span class="line"></span><br><span class="line">for idx, (name, func) in enumerate(algorithms.items()):</span><br><span class="line">    if name == &quot;LOOK (Outward)&quot;:</span><br><span class="line">        path, total = func()</span><br><span class="line">        path_inward, total_inward = look()[2:4]</span><br><span class="line">    elif name == &quot;LOOK (Inward)&quot;:</span><br><span class="line">        continue  # Handled with Outward</span><br><span class="line">    else:</span><br><span class="line">        path, total = func()</span><br><span class="line"></span><br><span class="line">    x = range(len(path))</span><br><span class="line">    axs[idx].plot(x, path, &#x27;-o&#x27;, label=f&#x27;&#123;name&#125; Path (Total: &#123;total&#125;)&#x27;)</span><br><span class="line">    axs[idx].set_title(name)</span><br><span class="line">    axs[idx].set_xlabel(&#x27;Step&#x27;)</span><br><span class="line">    axs[idx].set_ylabel(&#x27;Cylinder Number&#x27;)</span><br><span class="line">    axs[idx].set_ylim(0, MAX_CYLINDER + 10)</span><br><span class="line">    axs[idx].legend()</span><br><span class="line">    axs[idx].grid(True)</span><br><span class="line"></span><br><span class="line"># Remove empty subplot (for LOOK Inward if needed separately)</span><br><span class="line">axs[-1].remove()</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>å®éªŒæ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">2</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">3</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">4</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-05-21_162041.png" class="" title="2025-05-21_162041">

<img src="/posts/1079/2025-05-20-092314.png" class="" title="2025-05-20-092314">

<h1 id="ç¬¬åäº”å‘¨ï¼šè¾…å­˜ç©ºé—´çš„ç®¡ç†"><a href="#ç¬¬åäº”å‘¨ï¼šè¾…å­˜ç©ºé—´çš„ç®¡ç†" class="headerlink" title="ç¬¬åäº”å‘¨ï¼šè¾…å­˜ç©ºé—´çš„ç®¡ç†"></a>ç¬¬åäº”å‘¨ï¼šè¾…å­˜ç©ºé—´çš„ç®¡ç†</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_LINE 10000</span><br><span class="line">#define MAX_WORD 64</span><br><span class="line"></span><br><span class="line">typedef struct node &#123;</span><br><span class="line">    int size; // åˆ†é…çš„å—æ•°</span><br><span class="line">    int a[1000]; // å—å·</span><br><span class="line">    int zihao[1000]; // å­—å·</span><br><span class="line">    int weihao[1000]; // ä½å·</span><br><span class="line">    int zhu[1000]; // æŸ±é¢å·</span><br><span class="line">    int citou[1000]; // ç£å¤´å·</span><br><span class="line">    int shangu[1000]; // æ‰‡åŒºå·</span><br><span class="line">    char name[10]; // ä½œä¸šå</span><br><span class="line">    struct node *next;</span><br><span class="line">&#125; linklist;</span><br><span class="line"></span><br><span class="line">linklist *work = NULL;</span><br><span class="line"></span><br><span class="line">int disksize;</span><br><span class="line">int word;  //åˆ—æ•°</span><br><span class="line">int blocksize;</span><br><span class="line">int head;</span><br><span class="line">int sector;</span><br><span class="line">int cylinder;</span><br><span class="line">int sum;   //å—æ•°</span><br><span class="line">int available;</span><br><span class="line">int map[MAX_LINE][MAX_WORD];</span><br><span class="line">int line;   //è¡Œæ•°</span><br><span class="line"></span><br><span class="line">void print() &#123;</span><br><span class="line">    printf(&quot;             ****************è¾…å­˜ä½¿ç”¨æƒ…å†µ****************\n&quot;);</span><br><span class="line">    int i,j;</span><br><span class="line">    printf(&quot;    &quot;);</span><br><span class="line">    for(i=0;i&lt;word;i++)&#123;</span><br><span class="line">    	printf(&quot;%-3d&quot;,i);</span><br><span class="line">	&#125;</span><br><span class="line">    for(i=0;i&lt;line;i++)&#123;</span><br><span class="line">		printf(&quot;\n%-2d| &quot;,i);</span><br><span class="line">		for(j=0;j&lt;word;j++)&#123;</span><br><span class="line">			if(i*word+j&gt;=sum) break;</span><br><span class="line">			printf(&quot;%-3d&quot;,map[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    printf(&quot;\nè¾…å­˜å‰©ä½™ç©ºé—²å—æ•°:%d\n&quot;,available);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void init() &#123;</span><br><span class="line">	int temp;</span><br><span class="line">	available=0;</span><br><span class="line">    memset(map, 0, sizeof(map));</span><br><span class="line">	srand(time(NULL));</span><br><span class="line">	for(int i=0;i&lt;line;i++)&#123;</span><br><span class="line">		for(int j=0;j&lt;word;j++)&#123;</span><br><span class="line">			if(i*word+j&gt;=sum) break;</span><br><span class="line">			temp=rand()%2;</span><br><span class="line">			map[i][j]=temp;</span><br><span class="line">			if(temp==0) available++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	print();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void allocate() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    int size;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥ç”³è¯·ç©ºé—´çš„ä½œä¸šåå­—å’Œéœ€è¦åˆ†é…è¾…å­˜ç©ºé—´çš„å¤§å°(å•ä½:K): &quot;);</span><br><span class="line">    scanf(&quot;%s %d&quot;, name, &amp;size);</span><br><span class="line">    if (available &lt; size) &#123;</span><br><span class="line">        printf(&quot;ç©ºé—´ä¸è¶³\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    linklist *new_job = (linklist*)malloc(sizeof(linklist));</span><br><span class="line">	new_job-&gt;next=NULL;</span><br><span class="line">    strcpy(new_job-&gt;name, name);</span><br><span class="line">    new_job-&gt;size = size;</span><br><span class="line">	if(work==NULL) work=new_job;</span><br><span class="line">	else&#123;</span><br><span class="line">		linklist *temp=work;</span><br><span class="line">		while(temp-&gt;next!=NULL)</span><br><span class="line">			temp=temp-&gt;next;</span><br><span class="line">		temp-&gt;next=new_job;</span><br><span class="line">		&#125;</span><br><span class="line">    int allocated = 0;</span><br><span class="line">    for (int b = 0; b &lt; sum &amp;&amp; allocated &lt; size; b++) &#123;</span><br><span class="line">        int word_index = b / word;</span><br><span class="line">        int bit_index = b % word;</span><br><span class="line">        if (map[word_index][bit_index] == 0) &#123;</span><br><span class="line">            map[word_index][bit_index] = 1;</span><br><span class="line">            new_job-&gt;a[allocated] = b;</span><br><span class="line">            new_job-&gt;zihao[allocated] = word_index;</span><br><span class="line">            new_job-&gt;weihao[allocated] = bit_index;</span><br><span class="line">            new_job-&gt;zhu[allocated] = b / cylinder;</span><br><span class="line">            new_job-&gt;citou[allocated] = (b / sector) % head;</span><br><span class="line">            new_job-&gt;shangu[allocated] = b % sector;</span><br><span class="line">            allocated++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    available -= size;</span><br><span class="line">	printf(&quot;è¾…å­˜ç”³è¯·æˆåŠŸ!\n&quot;);</span><br><span class="line">	print();</span><br><span class="line">    printf(&quot;             ****************%sè¢«åˆ†é…çš„è¾…å­˜****************\n&quot;,name);</span><br><span class="line">	printf(&quot; åºå·   å—     å­—     ä½     æŸ±é¢å· ç£å¤´å· æ‰‡åŒºå·\n&quot;);</span><br><span class="line">    for (int k = 0; k &lt; size; k++) &#123;</span><br><span class="line">        printf(&quot; %-7d%-7d%-7d%-7d%-7d%-7d%-7d\n&quot;,k+1,</span><br><span class="line">               new_job-&gt;a[k], new_job-&gt;zihao[k], new_job-&gt;weihao[k],</span><br><span class="line">               new_job-&gt;zhu[k], new_job-&gt;citou[k], new_job-&gt;shangu[k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void recycle() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">	linklist *temp=work;</span><br><span class="line">	printf(&quot;å½“å‰åˆ†é…çš„ä½œä¸š:&quot;);</span><br><span class="line">	printf(&quot;%s&quot;,temp-&gt;name);</span><br><span class="line">	temp=temp-&gt;next;</span><br><span class="line">	while(temp!=NULL) &#123;printf(&quot;-&gt;%s&quot;,temp-&gt;name);temp=temp-&gt;next;&#125;</span><br><span class="line">    printf(&quot;\nè¦å›æ”¶çš„ä½œä¸šå:&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, name);</span><br><span class="line">    linklist *prev = NULL;</span><br><span class="line">    linklist *current = work;</span><br><span class="line">    while (current != NULL) &#123;</span><br><span class="line">        if (strcmp(current-&gt;name, name) == 0) &#123;</span><br><span class="line">            for (int k = 0; k &lt; current-&gt;size; k++) &#123;</span><br><span class="line">                int b = current-&gt;a[k];</span><br><span class="line">                int word_index = b / word;</span><br><span class="line">                int bit_index = b % word;</span><br><span class="line">                map[word_index][bit_index] = 0;</span><br><span class="line">            &#125;</span><br><span class="line">            available += current-&gt;size;</span><br><span class="line">            if (prev == NULL) &#123;</span><br><span class="line">                work = current-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                prev-&gt;next = current-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            free(current);</span><br><span class="line">            printf(&quot;å›æ”¶æˆåŠŸ!\n&quot;);</span><br><span class="line">			print();</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        prev = current;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;æœªæ‰¾åˆ°ä½œä¸š\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int menu() &#123;</span><br><span class="line">	printf(&quot;********è¾…å­˜è°ƒåº¦ç®¡ç†********\n&quot;);</span><br><span class="line">    printf(&quot;     *  1.ç©ºé—´åˆ†é…  *\n&quot;);</span><br><span class="line">    printf(&quot;     *  2.ç©ºé—´å»é…  *\n&quot;);</span><br><span class="line">    printf(&quot;     *  0.é€€å‡º      *\n&quot;);</span><br><span class="line">    printf(&quot;          è¯·è¾“å…¥é€‰é¡¹:&quot;);</span><br><span class="line">    int choice;</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">    return choice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¾…å­˜ç©ºé—´çš„å¤§å°ï¼ˆå•ä½ï¼šKï¼‰å’Œå­—é•¿(32æˆ–64)å’Œå—é•¿ï¼ˆå•ä½ï¼šKï¼‰: &quot;);</span><br><span class="line">    scanf(&quot;%d %d %d&quot;, &amp;disksize, &amp;word, &amp;blocksize);</span><br><span class="line">    if (word != 32 &amp;&amp; word != 64) &#123;</span><br><span class="line">        printf(&quot;å­—é•¿å¿…é¡»ä¸º32æˆ–64\n&quot;);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥è¯¥è¾…å­˜ç¡¬ç›˜çš„ç£é“æ•°ï¼ˆç£å¤´æ•°ï¼‰å’Œæ¯ä¸ªç£é“çš„æ‰‡åŒºæ•°ï¼š&quot;);</span><br><span class="line">    scanf(&quot;%d %d&quot;, &amp;head, &amp;sector);</span><br><span class="line">    sum = disksize / blocksize;</span><br><span class="line">    line = (sum + word - 1) / word;</span><br><span class="line">    if (line &gt; MAX_LINE) &#123;</span><br><span class="line">        printf(&quot;å­—æ•°è¿‡å¤š\n&quot;);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    available = sum;</span><br><span class="line">    cylinder = head * sector;</span><br><span class="line">    init();</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        int c = menu();</span><br><span class="line">        if (c == 0) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125; else if (c == 1) &#123;</span><br><span class="line">            allocate();</span><br><span class="line">        &#125; else if (c == 2) &#123;</span><br><span class="line">            recycle();</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">            printf(&quot;æ— æ•ˆé€‰æ‹©\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    while (work != NULL) &#123;</span><br><span class="line">        linklist *temp = work;</span><br><span class="line">        work = work-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/9B39D4F880CCDC631ECA6998C6C78A0A.png" class="" title="9B39D4F880CCDC631ECA6998C6C78A0A">

<h1 id="ç¬¬åå…­å‘¨ï¼šå•é“æ‰¹å¤„ç†ä½œä¸šè°ƒåº¦ç®—æ³•"><a href="#ç¬¬åå…­å‘¨ï¼šå•é“æ‰¹å¤„ç†ä½œä¸šè°ƒåº¦ç®—æ³•" class="headerlink" title="ç¬¬åå…­å‘¨ï¼šå•é“æ‰¹å¤„ç†ä½œä¸šè°ƒåº¦ç®—æ³•"></a>ç¬¬åå…­å‘¨ï¼šå•é“æ‰¹å¤„ç†ä½œä¸šè°ƒåº¦ç®—æ³•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">// æ—¶é—´ç»“æ„ä½“ï¼Œç”¨äºå¤„ç†å°æ—¶å’Œåˆ†é’Ÿ</span><br><span class="line">typedef struct data &#123;</span><br><span class="line">	int hour;</span><br><span class="line">	int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">// ä½œä¸šè°ƒåº¦èŠ‚ç‚¹ç»“æ„ä½“</span><br><span class="line">typedef struct link_node &#123;</span><br><span class="line">	char name[20];         // ä½œä¸šåç§°</span><br><span class="line">	Time arrive;           // åˆ°è¾¾æ—¶é—´</span><br><span class="line">	int zx;                // æ‰§è¡Œæ—¶é—´</span><br><span class="line">	Time JobTime;          // ä½œä¸šè°ƒåº¦æ—¶é—´</span><br><span class="line">	int JobWait;           // ä½œä¸šè°ƒåº¦ç­‰å¾…æ—¶é—´</span><br><span class="line">	Time ProcessTime;      // è¿›ç¨‹è°ƒåº¦æ—¶é—´</span><br><span class="line">	int ProcessWait;       // è¿›ç¨‹è°ƒåº¦ç­‰å¾…æ—¶é—´</span><br><span class="line">	Time finish;           // å®Œæˆæ—¶é—´</span><br><span class="line">	int zz;                // å‘¨è½¬æ—¶é—´</span><br><span class="line">	float zzxs;            // å¸¦æƒå‘¨è½¬æ—¶é—´</span><br><span class="line">	struct link_node *next;// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ</span><br><span class="line">	int finished;          // ä½œä¸šå®Œæˆæ ‡å¿—</span><br><span class="line">	float response;        // å“åº”æ¯”</span><br><span class="line">&#125; node;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºæ–°èŠ‚ç‚¹çš„å‡½æ•°</span><br><span class="line">node* create_node(char* name, int arrive_hour, int arrive_min, int zx) &#123;</span><br><span class="line">	node* new_node = (node*)malloc(sizeof(node));</span><br><span class="line">	strcpy(new_node-&gt;name, name);</span><br><span class="line">	new_node-&gt;arrive.hour = arrive_hour;</span><br><span class="line">	new_node-&gt;arrive.min = arrive_min;</span><br><span class="line">	new_node-&gt;zx = zx;</span><br><span class="line">	new_node-&gt;next = NULL;</span><br><span class="line">	new_node-&gt;finished = 0;</span><br><span class="line">	new_node-&gt;response = 0.0;</span><br><span class="line">	return new_node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è®¡ç®—æ—¶é—´å·®çš„å‡½æ•°ï¼ˆä»¥åˆ†é’Ÿä¸ºå•ä½ï¼‰</span><br><span class="line">int time_diff(Time t1, Time t2) &#123;</span><br><span class="line">	return (t1.hour * 60 + t1.min) - (t2.hour * 60 + t2.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦ç®—æ³•</span><br><span class="line">void FCFS(node* head) &#123;</span><br><span class="line">	// FCFSéœ€è¦æŒ‰åˆ°è¾¾æ—¶é—´æ’åºï¼Œè¿™é‡Œä½¿ç”¨ç®€å•çš„å†’æ³¡æ’åºå¯¹é“¾è¡¨è¿›è¡Œæ’åº</span><br><span class="line">	if (head == NULL || head-&gt;next == NULL) return; // é“¾è¡¨ä¸ºç©ºæˆ–åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ— éœ€æ’åº</span><br><span class="line">	</span><br><span class="line">	node *p, *q, *end = NULL;</span><br><span class="line">	while (end != head-&gt;next) &#123;</span><br><span class="line">		p = head;</span><br><span class="line">		q = head-&gt;next;</span><br><span class="line">		while (q != end) &#123;</span><br><span class="line">			// æ¯”è¾ƒpå’Œqçš„åˆ°è¾¾æ—¶é—´</span><br><span class="line">			if (time_diff(p-&gt;arrive, q-&gt;arrive) &gt; 0) &#123;</span><br><span class="line">				// äº¤æ¢på’Œqçš„æ•°æ®ï¼ˆä¸äº¤æ¢èŠ‚ç‚¹æœ¬èº«ï¼‰</span><br><span class="line">				char temp_name[20];</span><br><span class="line">				strcpy(temp_name, p-&gt;name);</span><br><span class="line">				strcpy(p-&gt;name, q-&gt;name);</span><br><span class="line">				strcpy(q-&gt;name, temp_name);</span><br><span class="line"></span><br><span class="line">				Time temp_arrive = p-&gt;arrive;</span><br><span class="line">				p-&gt;arrive = q-&gt;arrive;</span><br><span class="line">				q-&gt;arrive = temp_arrive;</span><br><span class="line"></span><br><span class="line">				int temp_zx = p-&gt;zx;</span><br><span class="line">				p-&gt;zx = q-&gt;zx;</span><br><span class="line">				q-&gt;zx = temp_zx;</span><br><span class="line">				</span><br><span class="line">				// äº¤æ¢å…¶ä»–ç›¸å…³æ•°æ®ï¼Œè™½ç„¶FCFSè°ƒåº¦è¿‡ç¨‹ä¸­ä¼šé‡æ–°è®¡ç®—ï¼Œä½†ä¸ºäº†æ’åºçš„å®Œæ•´æ€§è¿˜æ˜¯äº¤æ¢</span><br><span class="line">				Time temp_JobTime = p-&gt;JobTime;</span><br><span class="line">				p-&gt;JobTime = q-&gt;JobTime;</span><br><span class="line">				q-&gt;JobTime = temp_JobTime;</span><br><span class="line">				</span><br><span class="line">				int temp_JobWait = p-&gt;JobWait;</span><br><span class="line">				p-&gt;JobWait = q-&gt;JobWait;</span><br><span class="line">				q-&gt;JobWait = temp_JobWait;</span><br><span class="line">				</span><br><span class="line">				Time temp_ProcessTime = p-&gt;ProcessTime;</span><br><span class="line">				p-&gt;ProcessTime = q-&gt;ProcessTime;</span><br><span class="line">				q-&gt;ProcessTime = temp_ProcessTime;</span><br><span class="line">				</span><br><span class="line">				int temp_ProcessWait = p-&gt;ProcessWait;</span><br><span class="line">				p-&gt;ProcessWait = q-&gt;ProcessWait;</span><br><span class="line">				q-&gt;ProcessWait = temp_ProcessWait;</span><br><span class="line">				</span><br><span class="line">				Time temp_finish = p-&gt;finish;</span><br><span class="line">				p-&gt;finish = q-&gt;finish;</span><br><span class="line">				q-&gt;finish = temp_finish;</span><br><span class="line">				</span><br><span class="line">				int temp_zz = p-&gt;zz;</span><br><span class="line">				p-&gt;zz = q-&gt;zz;</span><br><span class="line">				q-&gt;zz = temp_zz;</span><br><span class="line">				</span><br><span class="line">				float temp_zzxs = p-&gt;zzxs;</span><br><span class="line">				p-&gt;zzxs = q-&gt;zzxs;</span><br><span class="line">				q-&gt;zzxs = temp_zzxs;</span><br><span class="line">				</span><br><span class="line">				int temp_finished = p-&gt;finished;</span><br><span class="line">				p-&gt;finished = q-&gt;finished;</span><br><span class="line">				q-&gt;finished = temp_finished;</span><br><span class="line">				</span><br><span class="line">				float temp_response = p-&gt;response;</span><br><span class="line">				p-&gt;response = q-&gt;response;</span><br><span class="line">				q-&gt;response = temp_response;</span><br><span class="line">			&#125;</span><br><span class="line">			p = p-&gt;next;</span><br><span class="line">			q = q-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		end = p;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// è°ƒåº¦è¿‡ç¨‹ (æ’åºåæŒ‰é¡ºåºå¤„ç†)</span><br><span class="line">	p = head;</span><br><span class="line">	Time current_time = &#123;8, 0&#125;; // Start time at 8:00</span><br><span class="line">	</span><br><span class="line">	while (p != NULL) &#123;</span><br><span class="line">		// Adjust current time if job hasn&#x27;t arrived yet</span><br><span class="line">		if (time_diff(current_time, p-&gt;arrive) &lt; 0) &#123;</span><br><span class="line">			current_time = p-&gt;arrive;</span><br><span class="line">		&#125;</span><br><span class="line">		// Job scheduling time is the current time</span><br><span class="line">		p-&gt;JobTime = current_time;</span><br><span class="line">		p-&gt;JobWait = time_diff(current_time, p-&gt;arrive);</span><br><span class="line">		</span><br><span class="line">		// Process scheduling time (same as job scheduling in FCFS)</span><br><span class="line">		p-&gt;ProcessTime = current_time;</span><br><span class="line">		p-&gt;ProcessWait = 0;</span><br><span class="line">		</span><br><span class="line">		// Completion time = current time + execution time</span><br><span class="line">		p-&gt;finish.hour = current_time.hour + (current_time.min + p-&gt;zx) / 60;</span><br><span class="line">		p-&gt;finish.min = (current_time.min + p-&gt;zx) % 60;</span><br><span class="line">		</span><br><span class="line">		// Update current time to completion time</span><br><span class="line">		current_time = p-&gt;finish;</span><br><span class="line">		</span><br><span class="line">		// Turnaround time = completion time - arrival time</span><br><span class="line">		p-&gt;zz = time_diff(p-&gt;finish, p-&gt;arrive);</span><br><span class="line">		</span><br><span class="line">		// Weighted turnaround time = turnaround time / execution time</span><br><span class="line">		p-&gt;zzxs = (float)p-&gt;zz / p-&gt;zx;</span><br><span class="line">		</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•</span><br><span class="line">void SJF(node* head) &#123;</span><br><span class="line">	Time current_time = &#123;8, 0&#125;; // å¼€å§‹æ—¶é—´ä¸º8:00</span><br><span class="line">	while (1) &#123;</span><br><span class="line">		// æ‰¾åˆ°å·²åˆ°è¾¾çš„æœªå®Œæˆä½œä¸šä¸­æ‰§è¡Œæ—¶é—´æœ€çŸ­çš„</span><br><span class="line">		node* shortest = NULL;</span><br><span class="line">		node* temp = head;</span><br><span class="line">		int min_zx = 9999;</span><br><span class="line">		</span><br><span class="line">		while (temp != NULL) &#123;</span><br><span class="line">			if (!temp-&gt;finished &amp;&amp; time_diff(current_time, temp-&gt;arrive) &gt;= 0) &#123;</span><br><span class="line">				if (temp-&gt;zx &lt; min_zx) &#123;</span><br><span class="line">					min_zx = temp-&gt;zx;</span><br><span class="line">					shortest = temp;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			temp = temp-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (shortest != NULL) &#123;</span><br><span class="line">			shortest-&gt;JobTime = current_time;</span><br><span class="line">			shortest-&gt;JobWait = time_diff(current_time, shortest-&gt;arrive);</span><br><span class="line">			shortest-&gt;ProcessTime = current_time;</span><br><span class="line">			shortest-&gt;ProcessWait = 0;</span><br><span class="line">			</span><br><span class="line">			// è®¡ç®—å®Œæˆæ—¶é—´</span><br><span class="line">			shortest-&gt;finish.hour = current_time.hour + (current_time.min + shortest-&gt;zx) / 60;</span><br><span class="line">			shortest-&gt;finish.min = (current_time.min + shortest-&gt;zx) % 60;</span><br><span class="line">			</span><br><span class="line">			// æ›´æ–°å½“å‰æ—¶é—´</span><br><span class="line">			current_time = shortest-&gt;finish;</span><br><span class="line">			</span><br><span class="line">			// è®¡ç®—å‘¨è½¬æ—¶é—´</span><br><span class="line">			shortest-&gt;zz = time_diff(shortest-&gt;finish, shortest-&gt;arrive);</span><br><span class="line">			</span><br><span class="line">			// è®¡ç®—å¸¦æƒå‘¨è½¬æ—¶é—´</span><br><span class="line">			shortest-&gt;zzxs = (float)shortest-&gt;zz / shortest-&gt;zx;</span><br><span class="line">			</span><br><span class="line">			shortest-&gt;finished = 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			// æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä½œä¸šéœ€è¦å¤„ç†</span><br><span class="line">			temp = head;</span><br><span class="line">			int all_finished = 1;</span><br><span class="line">			while (temp != NULL) &#123;</span><br><span class="line">				if (!temp-&gt;finished) &#123;</span><br><span class="line">					all_finished = 0;</span><br><span class="line">					// å°†å½“å‰æ—¶é—´ç§»åŠ¨åˆ°å‰©ä½™ä½œä¸šä¸­æœ€æ—©çš„åˆ°è¾¾æ—¶é—´</span><br><span class="line">					if (time_diff(current_time, temp-&gt;arrive) &lt; 0) &#123;</span><br><span class="line">						if (current_time.hour * 60 + current_time.min &gt; temp-&gt;arrive.hour * 60 + temp-&gt;arrive.min) &#123;</span><br><span class="line">							current_time = temp-&gt;arrive;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				temp = temp-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			if (all_finished) break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é«˜å“åº”æ¯”ä¼˜å…ˆï¼ˆHRRFï¼‰è°ƒåº¦ç®—æ³•</span><br><span class="line">void HRRF(node* head) &#123;</span><br><span class="line">	Time current_time = &#123;8, 0&#125;; // å¼€å§‹æ—¶é—´ä¸º8:00</span><br><span class="line">	while (1) &#123;</span><br><span class="line">		// è®¡ç®—æ‰€æœ‰å·²åˆ°è¾¾ä½œä¸šçš„å“åº”æ¯”</span><br><span class="line">		node* temp = head;</span><br><span class="line">		while (temp != NULL) &#123;</span><br><span class="line">			if (!temp-&gt;finished &amp;&amp; time_diff(current_time, temp-&gt;arrive) &gt;= 0) &#123;</span><br><span class="line">				int wait_time = time_diff(current_time, temp-&gt;arrive);</span><br><span class="line">				temp-&gt;response = 1.0 + (float)wait_time / temp-&gt;zx;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				temp-&gt;response = 0.0;</span><br><span class="line">			&#125;</span><br><span class="line">			temp = temp-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// æ‰¾åˆ°å“åº”æ¯”æœ€é«˜çš„ä½œä¸š</span><br><span class="line">		node* highest = NULL;</span><br><span class="line">		float max_response = -1.0;</span><br><span class="line">		temp = head;</span><br><span class="line">		</span><br><span class="line">		while (temp != NULL) &#123;</span><br><span class="line">			if (!temp-&gt;finished &amp;&amp; temp-&gt;response &gt; max_response) &#123;</span><br><span class="line">				max_response = temp-&gt;response;</span><br><span class="line">				highest = temp;</span><br><span class="line">			&#125;</span><br><span class="line">			temp = temp-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (highest != NULL) &#123;</span><br><span class="line">			highest-&gt;JobTime = current_time;</span><br><span class="line">			highest-&gt;JobWait = time_diff(current_time, highest-&gt;arrive);</span><br><span class="line">			highest-&gt;ProcessTime = current_time;</span><br><span class="line">			highest-&gt;ProcessWait = 0;</span><br><span class="line">			</span><br><span class="line">			// è®¡ç®—å®Œæˆæ—¶é—´</span><br><span class="line">			highest-&gt;finish.hour = current_time.hour + (current_time.min + highest-&gt;zx) / 60;</span><br><span class="line">			highest-&gt;finish.min = (current_time.min + highest-&gt;zx) % 60;</span><br><span class="line">			</span><br><span class="line">			// æ›´æ–°å½“å‰æ—¶é—´</span><br><span class="line">			current_time = highest-&gt;finish;</span><br><span class="line">			</span><br><span class="line">			// è®¡ç®—å‘¨è½¬æ—¶é—´</span><br><span class="line">			highest-&gt;zz = time_diff(highest-&gt;finish, highest-&gt;arrive);</span><br><span class="line">			</span><br><span class="line">			// è®¡ç®—å¸¦æƒå‘¨è½¬æ—¶é—´</span><br><span class="line">			highest-&gt;zzxs = (float)highest-&gt;zz / highest-&gt;zx;</span><br><span class="line">			</span><br><span class="line">			highest-&gt;finished = 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			// æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä½œä¸šéœ€è¦å¤„ç†</span><br><span class="line">			temp = head;</span><br><span class="line">			int all_finished = 1;</span><br><span class="line">			while (temp != NULL) &#123;</span><br><span class="line">				if (!temp-&gt;finished) &#123;</span><br><span class="line">					all_finished = 0;</span><br><span class="line">					// å°†å½“å‰æ—¶é—´ç§»åŠ¨åˆ°å‰©ä½™ä½œä¸šä¸­æœ€æ—©çš„åˆ°è¾¾æ—¶é—´</span><br><span class="line">					if (time_diff(current_time, temp-&gt;arrive) &lt; 0) &#123;</span><br><span class="line">						if (current_time.hour * 60 + current_time.min &gt; temp-&gt;arrive.hour * 60 + temp-&gt;arrive.min) &#123;</span><br><span class="line">							current_time = temp-&gt;arrive;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				temp = temp-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			if (all_finished) break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ‰“å°ç»“æœçš„å‡½æ•°</span><br><span class="line">void print_results(node* head, char* algorithm) &#123;</span><br><span class="line">	printf(&quot;\næ¨¡æ‹Ÿä½œä¸š%sè°ƒåº¦è¿‡ç¨‹è¾“å‡ºç»“æœï¼š\n&quot;, algorithm);</span><br><span class="line">	printf(&quot;åå­—    å…¥äº•æ—¶é—´    è¿è¡Œæ—¶é—´(åˆ†é’Ÿ)    ä½œä¸šè°ƒåº¦æ—¶é—´    ä½œä¸šè°ƒåº¦ç­‰å¾…æ—¶é—´    è¿›ç¨‹è°ƒåº¦æ—¶é—´    è¿›ç¨‹è°ƒåº¦ç­‰å¾…æ—¶é—´    å®Œæˆæ—¶é—´    å‘¨è½¬æ—¶é—´    å¸¦æƒå‘¨è½¬ç³»æ•°:\n&quot;);</span><br><span class="line">	</span><br><span class="line">	node* p = head;</span><br><span class="line">	float avg_zz = 0, avg_zzxs = 0;</span><br><span class="line">	int count = 0;</span><br><span class="line">	</span><br><span class="line">	while (p != NULL) &#123;</span><br><span class="line">		printf(&quot;%s\t%02d:%02d\t    %-3d(åˆ†é’Ÿ)         %02d:%02d\t      %-3d(åˆ†é’Ÿ)\t\t  %02d:%02d           %-3d(åˆ†é’Ÿ)           %02d:%02d       %-3d(åˆ†é’Ÿ)   %.4f(ç³»æ•°)\n&quot;,</span><br><span class="line">			p-&gt;name, p-&gt;arrive.hour, p-&gt;arrive.min, p-&gt;zx,</span><br><span class="line">			p-&gt;JobTime.hour, p-&gt;JobTime.min, p-&gt;JobWait,</span><br><span class="line">			p-&gt;ProcessTime.hour, p-&gt;ProcessTime.min, p-&gt;ProcessWait,</span><br><span class="line">			p-&gt;finish.hour, p-&gt;finish.min, p-&gt;zz, p-&gt;zzxs);</span><br><span class="line">		avg_zz += p-&gt;zz;</span><br><span class="line">		avg_zzxs += p-&gt;zzxs;</span><br><span class="line">		count++;</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;ç³»ç»Ÿå¹³å‡å‘¨è½¬æ—¶é—´ä¸º: %.2f\n&quot;, avg_zz / count);</span><br><span class="line">	printf(&quot;ç³»ç»Ÿå¸¦æƒå¹³å‡å‘¨è½¬æ—¶é—´ä¸º: %.4f\n&quot;, avg_zzxs / count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é‡ç½®ä½œä¸šå®Œæˆæ ‡å¿—ï¼Œç”¨äºä¸‹ä¸€æ¬¡è°ƒåº¦</span><br><span class="line">void reset_jobs(node* head) &#123;</span><br><span class="line">	node* p = head;</span><br><span class="line">	while (p != NULL) &#123;</span><br><span class="line">		p-&gt;finished = 0;</span><br><span class="line">		p-&gt;response = 0.0;</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	int algorithm, num_jobs;</span><br><span class="line">	char name[20];</span><br><span class="line">	int arrive_hour, arrive_min, zx;</span><br><span class="line">    printf(&quot;è¯·è¾“å…¥æ“ä½œ(1:å¼€å§‹è°ƒåº¦;0:ç»“æŸä½œä¸š): &quot;);</span><br><span class="line">		</span><br><span class="line">	int choice;</span><br><span class="line">	if (scanf(&quot;%d&quot;, &amp;choice) != 1 || choice &lt; 0 || choice &gt; 1) &#123;</span><br><span class="line">		printf(&quot;è¾“å…¥æ— æ•ˆ!\n&quot;);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	if (choice == 0) &#123;</span><br><span class="line">		printf(&quot;æ„Ÿè°¢ä½¿ç”¨ï¼Œå†è§ï¼\n&quot;);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	while (1) &#123;</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥è¦åˆ›å»ºçš„ä½œä¸šæ•°é‡: &quot;);</span><br><span class="line">		if (scanf(&quot;%d&quot;, &amp;num_jobs) != 1 || num_jobs &lt;= 0) &#123;</span><br><span class="line">			printf(&quot;è¾“å…¥æ— æ•ˆï¼Œè¯·è¾“å…¥å¤§äº0çš„æ•°å­—\n&quot;);</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">        printf(&quot;è¯·è¾“å…¥ä½œä¸šä¿¡æ¯ï¼š\n&quot;);</span><br><span class="line">		printf(&quot;ä½œä¸šå å…¥äº•æ—¶é—´ æ‰§è¡Œæ—¶é—´(åˆ†é’Ÿ)\n&quot;);</span><br><span class="line">		</span><br><span class="line">		// åˆ›å»ºä½œä¸šé“¾è¡¨</span><br><span class="line">		node* head = NULL;</span><br><span class="line">		node* tail = NULL;</span><br><span class="line">		</span><br><span class="line">		for (int i = 0; i &lt; num_jobs; i++) &#123;</span><br><span class="line">			if (scanf(&quot;%s %d:%d %d&quot;, name, &amp;arrive_hour, &amp;arrive_min, &amp;zx) != 4) &#123;</span><br><span class="line">				printf(&quot;è¾“å…¥æ ¼å¼é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥\n&quot;);</span><br><span class="line">				i--;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			// éªŒè¯è¾“å…¥çš„æ—¶é—´æ˜¯å¦æœ‰æ•ˆ</span><br><span class="line">			if (arrive_hour &lt; 0 || arrive_hour &gt; 23 || arrive_min &lt; 0 || arrive_min &gt; 59) &#123;</span><br><span class="line">				printf(&quot;æ—¶é—´æ ¼å¼æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥\n&quot;);</span><br><span class="line">				i--;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			// éªŒè¯æ‰§è¡Œæ—¶é—´æ˜¯å¦æœ‰æ•ˆ</span><br><span class="line">			if (zx &lt;= 0) &#123;</span><br><span class="line">				printf(&quot;æ‰§è¡Œæ—¶é—´å¿…é¡»å¤§äº0ï¼Œè¯·é‡æ–°è¾“å…¥\n&quot;);</span><br><span class="line">				i--;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			node* new_node = create_node(name, arrive_hour, arrive_min, zx);</span><br><span class="line">			if (head == NULL) &#123;</span><br><span class="line">				head = new_node;</span><br><span class="line">				tail = new_node;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				tail-&gt;next = new_node;</span><br><span class="line">				tail = new_node;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		printf(&quot;\n***************ä½œä¸šç®¡ç†***************\n&quot;);</span><br><span class="line">		printf(&quot;        1. å…ˆæ¥å…ˆæœåŠ¡ (FCFS)\n&quot;);</span><br><span class="line">		printf(&quot;        2. çŸ­ä½œä¸šä¼˜å…ˆ (SJF)\n&quot;);</span><br><span class="line">		printf(&quot;        3. é«˜å“åº”æ¯”ä¼˜å…ˆ (HRRF)\n&quot;);</span><br><span class="line">        printf(&quot;        0. é€€å‡º\n&quot;);</span><br><span class="line">		printf(&quot;è¯·é€‰æ‹©è¦è¿›è¡Œçš„æ“ä½œå·: &quot;);</span><br><span class="line">		</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;algorithm);</span><br><span class="line">		switch(algorithm)&#123;</span><br><span class="line">            case 1:</span><br><span class="line">                FCFS(head);</span><br><span class="line">                print_results(head, &quot;å…ˆæ¥å…ˆæœåŠ¡ (FCFS)&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                SJF(head);</span><br><span class="line">                print_results(head, &quot;çŸ­ä½œä¸šä¼˜å…ˆ (SJF)&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                HRRF(head);</span><br><span class="line">			    print_results(head, &quot;é«˜å“åº”æ¯”ä¼˜å…ˆ (HRRF)&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                printf(&quot;è¾“å…¥æ— æ•ˆ!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		// é‡Šæ”¾å†…å­˜</span><br><span class="line">		node* temp;</span><br><span class="line">		while (head != NULL) &#123;</span><br><span class="line">			temp = head;</span><br><span class="line">			head = head-&gt;next;</span><br><span class="line">			free(temp);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">        printf(&quot;========================================================================================================\n&quot;);</span><br><span class="line">		printf(&quot;æ˜¯å¦ç»§ç»­è¿›è¡Œè°ƒåº¦å®éªŒï¼Œå¼€å§‹å®éªŒï¼š1ï¼Œé€€å‡ºå®éªŒï¼š-1:&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;choice);</span><br><span class="line">        if(choice!=1) break;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·»åŠ èŠ‚</title>
    <url>/posts/8809/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="æ·»åŠ èŠ‚ï¼š"><a href="#æ·»åŠ èŠ‚ï¼š" class="headerlink" title="æ·»åŠ èŠ‚ï¼š"></a>æ·»åŠ èŠ‚ï¼š</h1><p>åˆ›å»ºæ–°èŠ‚ï¼š</p>
<ol>
<li>åˆ†é…æ–°ç©ºé—´</li>
<li>åŠ èŠ‚è¡¨ï¼Œéœ€è¦80å­—èŠ‚ç©ºé—´ï¼ˆ40å­—èŠ‚èŠ‚è¡¨ï¼Œ40å­—èŠ‚ç©ºèŠ‚è¡¨ï¼‰</li>
<li>ä¿®æ”¹æ–‡ä»¶å¤´ä¸­NumberOfSectionsï¼Œå¢åŠ å¯é€‰å¤´sizeofimage</li>
<li>å¡«å……èŠ‚è¡¨å†…å®¹</li>
</ol>
<p>æ³¨æ„ï¼šèŠ‚è¡¨ä¸­çš„VirtualSizeæ˜¯å†…å­˜å¯¹é½å‰çš„å¤§å°ï¼Œåœ¨æ·»åŠ èŠ‚æ—¶ï¼Œæ–°èŠ‚çš„å†…å­˜èµ·å§‹åç§»åº”è¯¥æ˜¯æœ€åä¸€ä¸ªèŠ‚çš„RVA+(ï¼ˆVirtualSize&#x2F;å†…å­˜å¯¹é½ï¼‰+1)*å†…å­˜å¯¹é½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">int new_section(int new_size)&#123;  // åˆ›å»ºæ–°èŠ‚ï¼Œå‚æ•°ï¼šæ–°èŠ‚å¤§å°ï¼Œè¿”å›å€¼ï¼šæ˜¯å¦æˆåŠŸåˆ›å»º</span><br><span class="line">    // åˆ¤æ–­æ˜¯å¦èƒ½åŠ èŠ‚è¡¨:</span><br><span class="line">    if(oheader-&gt;SizeOfHeaders-(dos-&gt;e_lfanew+4+sizeof(IMAGE_FILE_HEADER)+fheader-&gt;SizeOfOptionalHeader+fheader-&gt;NumberOfSections*sizeof(IMAGE_SECTION_HEADER))&lt;=80)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;ç©ºé—´ä¸è¶³ä»¥åˆ›å»ºèŠ‚è¡¨\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int index = fheader-&gt;NumberOfSections;</span><br><span class="line">    strcpy(sheader[index].Name,&quot;new&quot;);</span><br><span class="line">    sheader[index].Misc.VirtualSize = new_size;</span><br><span class="line">    sheader[index].VirtualAddress = sheader[index-1].VirtualAddress + ((sheader[index-1].Misc.VirtualSize)/oheader-&gt;SectionAlignment+1)*oheader-&gt;SectionAlignment;</span><br><span class="line">    sheader[index].PointerToRawData = sheader[index-1].PointerToRawData + sheader[index-1].SizeOfRawData;</span><br><span class="line">    sheader[index].SizeOfRawData = new_size;</span><br><span class="line">    sheader[index].Characteristics = 0xE00000A0;  // å¯è¯»å¯å†™å¯æ‰§è¡Œ</span><br><span class="line">    sheader[index].PointerToRelocations = sheader[index-1].PointerToRelocations;</span><br><span class="line">    sheader[index].PointerToLinenumbers = sheader[index-1].PointerToLinenumbers;</span><br><span class="line">    sheader[index].NumberOfRelocations = sheader[index-1].NumberOfRelocations;</span><br><span class="line">    sheader[index].NumberOfLinenumbers = sheader[index-1].NumberOfLinenumbers;</span><br><span class="line">    fheader-&gt;NumberOfSections++;</span><br><span class="line">    oheader-&gt;SizeOfImage+=oheader-&gt;SectionAlignment;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int new_size = 0x1000;  // å®šä¹‰æ–°èŠ‚å¤§å°</span><br><span class="line">    const char* pe_path = &quot;dlltest.dll&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    int fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize+new_size);   // å¤šåˆ†é…0x1000ç”¨ä½œæ–°èŠ‚</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *buffer=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)buffer;</span><br><span class="line">    if(dos-&gt;e_magic!=0x5A4D) &#123;printf(&quot;ä¸æ˜¯PEæ–‡ä»¶!!\n&quot;);free(file_buf);;return 0;&#125;</span><br><span class="line">    buffer+=dos-&gt;e_lfanew;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    if(*(DWORD*)buffer!=0x4550) &#123;printf(&quot;ä¸æ˜¯PEæ–‡ä»¶!!\n&quot;);free(file_buf);;return 0;&#125;</span><br><span class="line">    buffer+=4;</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)buffer;</span><br><span class="line">    buffer+=sizeof(IMAGE_FILE_HEADER);      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)buffer;</span><br><span class="line">    buffer += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)buffer;</span><br><span class="line">    if(!new_section(new_size))&#123;free(file_buf);return 0;&#125;</span><br><span class="line">    // å†™å…¥æ–°æ–‡ä»¶ä¸­</span><br><span class="line">    FILE *new_file = fopen(&quot;new.dll&quot;,&quot;wb&quot;);</span><br><span class="line">    if (!new_file) &#123;</span><br><span class="line">        perror(&quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥&quot;);</span><br><span class="line">        free(file_buf);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    int written=fwrite(file_buf,sizeof(unsigned char),fsize+new_size,new_file);</span><br><span class="line">    if(written!=fsize+new_size)&#123;</span><br><span class="line">        perror(&quot;å†™å…¥é”™è¯¯&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(new_file);</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PE</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¥šæ…§æ¯2024wp</title>
    <url>/posts/64455/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h2 id="go-bytes"><a href="#go-bytes" class="headerlink" title="go_bytes"></a>go_bytes</h2><p>ç¬¬ä¸€æ®µåŠ å¯†ä»£ç ï¼š</p>
<img src="/posts/64455/image-20241220172142353.png" class="" title="image-20241220172142353">

<p>ç¬¬äºŒæ®µåŠ å¯†ä»£ç ï¼š</p>
<img src="/posts/64455/image-20241220172212964.png" class="" title="image-20241220172212964">

<p>ä¸»è¦é€»è¾‘å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int i;unsigned char v5[40];</span><br><span class="line">    unsigned int data[]=&#123;0x22b9,0xc9f8,0x8c89,0xff18,0x1439,0x4e0a,0x2a8b,0x7cb,0xbdeb,0xfaab,</span><br><span class="line">                0x3ffb,0x784b,0x9f1e,0x4feb,0x4d0b,0xd08e,0x38bb,0xcbae,0xd2ce,0x913e,</span><br><span class="line">                0xa6b,0xf03b,0x507b,0x398b,0x93de,0x3cce,0x459e,0x4abe,0x553e,0x316e,</span><br><span class="line">                0x33be,0x42fe,0xcece,0x4dde,0x982b,0xa31b,0x802e,0x12ee,0xf67a,0xeb79&#125;;</span><br><span class="line">    scanf(&quot;%s&quot;,v5);</span><br><span class="line">    for(i=0;i&lt;39;i++)</span><br><span class="line">      v5[i]=(v5[i+1]&gt;&gt;4)|(v5[i]*16);</span><br><span class="line">    v5[39]=(v5[0]&gt;&gt;4)|(v5[39]&lt;&lt;4);</span><br><span class="line">    int j;int main_tmp=0xDEAD;</span><br><span class="line">    for(j=0;j&lt;40;j++)&#123;</span><br><span class="line">        main_tmp=(unsigned __int16)(291 * main_tmp + 1110);</span><br><span class="line">          if(data[j]!=(main_tmp^v5[j]))&#123;</span><br><span class="line">              printf(&quot;wrong!&quot;);</span><br><span class="line">              break;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	printf(&quot;right!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿™ä¸ªmain_tmpæ•°ç»„æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿è¡Œå¾—åˆ°ã€‚ä¸»è¦è¿˜æ˜¯å¯¹ç¬¬ä¸€æ®µåŠ å¯†çš„é€†å‘ï¼š</p>
<p>ç¬¬ä¸€æ®µåŠ å¯†ä¸»è¦é€»è¾‘æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// v5[38]=v5[38]ä½4ä½+v5[39]é«˜4ä½</span><br><span class="line">// v5[37]=v5[37]ä½4ä½+v5[38]é«˜4ä½</span><br><span class="line">// Â·Â·Â·Â·Â·Â·</span><br><span class="line">// v5[0]=v5[0]ä½4ä½+v5[1]é«˜4ä½</span><br><span class="line">// v5[39]=v5[39]ä½4ä½+v5[0]é«˜4ä½</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯v5[38]çš„åŸé«˜4ä½åœ¨v5[37]çš„ä½4ä½ï¼ŒåŸä½å››ä½åœ¨å…¶é«˜å››ä½é‡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚å†™è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int main_tmp[]=&#123;0x22fd,0xc9ed,0x8cbd,0xff2d,0x147d,0x4e6d,0x2a3d,0x7ad,0xbdfd,0xfaed,</span><br><span class="line">                    0x3fbd,0x782d,0x9f7d,0x4f6d,0x4d3d,0xd0ad,0x38fd,0xcbed,0xd2bd,0x912d,</span><br><span class="line">                    0xa7d,0xf06d,0x503d,0x39ad,0x93fd,0x3ced,0x45bd,0x4a2d,0x557d,0x316d,</span><br><span class="line">                    0x333d,0x42ad,0xcefd,0x4ded,0x98bd,0xa32d,0x807d,0x126d,0xf63d,0xebad&#125;;</span><br><span class="line">    int i,j;</span><br><span class="line">    unsigned int data[]=&#123;0x22b9,0xc9f8,0x8c89,0xff18,0x1439,0x4e0a,0x2a8b,0x7cb,0xbdeb,0xfaab,</span><br><span class="line">                0x3ffb,0x784b,0x9f1e,0x4feb,0x4d0b,0xd08e,0x38bb,0xcbae,0xd2ce,0x913e,</span><br><span class="line">                0xa6b,0xf03b,0x507b,0x398b,0x93de,0x3cce,0x459e,0x4abe,0x553e,0x316e,</span><br><span class="line">                0x33be,0x42fe,0xcece,0x4dde,0x982b,0xa31b,0x802e,0x12ee,0xf67a,0xeb79&#125;;</span><br><span class="line">    for(i=0;i&lt;40;i++)</span><br><span class="line">        data[i]^=main_tmp[i];</span><br><span class="line">    unsigned char flag[40];</span><br><span class="line">    for(i=1;i&lt;40;i++)&#123;</span><br><span class="line">        flag[i]=(data[i]&gt;&gt;4)|(data[i-1]&lt;&lt;4);</span><br><span class="line">    &#125;</span><br><span class="line">    flag[0]=(data[0]&gt;&gt;4)|(data[39]&lt;&lt;4);</span><br><span class="line">    for(i=0;i&lt;40;i++)&#123;</span><br><span class="line">        printf(&quot;%c&quot;,flag[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   //DASCTF&#123;faddff8cb4d711edbb2294085339ce84&#125;</span><br></pre></td></tr></table></figure>

<h2 id="bouquet"><a href="#bouquet" class="headerlink" title="bouquet"></a>bouquet</h2><p>é¢˜ç›®æè¿°:</p>
<p><code>ç®€å•çš„èŠ±æŒ‡ä»¤å»é™¤ï¼ŒäºŒå‰æ ‘çš„ä¸­åºã€ååºã€å±‚æ¬¡éå†ä»£ç çš„è¯†åˆ«</code></p>
<p>æ•°æ®ç»“æ„è¿˜åœ¨è¿½æˆ‘ğŸ¤£ã€‚</p>
<p>å…ˆå»ä¸ªèŠ±æŒ‡ä»¤ï¼š</p>
<img src="/posts/64455/image-20241220173902805.png" class="" title="image-20241220173902805">

<p>é‡æ–°é€‰å®šï¼ŒæŒ‰Pæ„é€ å‡½æ•°ï¼Œåç¼–è¯‘ï¼š</p>
<img src="/posts/64455/image-20241220174051218.png" class="" title="image-20241220174051218">

<p>ä¸€å¼€å§‹æ²¡çœ‹é¢˜ç›®æè¿°ï¼Œæ²¡çœ‹æ‡‚è¿™æ˜¯å¹²ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åè¿›åˆ¤æ–­å‡½æ•°çœ‹åˆ°äº†é€’å½’å°±è§‰å¾—æœ‰ç‚¹å¯ç–‘ï¼Œå»çœ‹äº†ä¸€ä¸‹æè¿°æ‰å‘ç°æ˜¯äºŒå‰æ ‘ã€‚ä¸Šé¢è¿™ä¸€æ®µæ˜¯å»ºæ ‘ã€‚</p>
<img src="/posts/64455/image-20241220174323830.png" class="" title="image-20241220174323830">

<p>å»ºå®Œæ ‘ä¹‹åæœ‰ä¸Šé¢ä¸¤ä¸ªåˆ¤æ–­å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ä¸­åºéå†ï¼Œä¸€ä¸ªæ˜¯ååºéå†ï¼š</p>
<img src="/posts/64455/image-20241220174442323.png" class="" title="image-20241220174442323">

<img src="/posts/64455/image-20241220174500667.png" class="" title="image-20241220174500667">

<p>äºæ˜¯ï¼Œä¸»è¦é€»è¾‘å°±æµ®ç°å‡ºæ¥äº†ï¼š</p>
<p>è¾“å…¥çš„flagè¿›è¡ŒäºŒå‰æ ‘å»ºæ ‘ï¼Œç„¶åè¿›å…¥ç¬¬ä¸€ä¸ªå‡½æ•°åˆ¤æ–­ä¸­åºéå†åºåˆ—æ˜¯å¦ä¸ºâ€œja7Cws_A3daTd4qDo8}F_Sd{aâ€ï¼Œä¹‹åè¿›å…¥ç¬¬äºŒä¸ªå‡½æ•°åˆ¤æ–­ååºéå†åºåˆ—æ˜¯å¦ä¸ºâ€œj7aw_sC3addq4TAo}8_Fda{SDâ€ã€‚å±‚æ¬¡éå†ç»“æœå°±æ˜¯flagã€‚</p>
<p>å†™ä»£ç æ±‚ä¸­åºéå†åŠååºéå†æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from collections import deque</span><br><span class="line"></span><br><span class="line">class TreeNode:</span><br><span class="line">    def __init__(self, value=&#x27;&#x27;):</span><br><span class="line">        self.value = value</span><br><span class="line">        self.left = None</span><br><span class="line">        self.right = None</span><br><span class="line"></span><br><span class="line">def build_tree(inorder, postorder):</span><br><span class="line">    if not inorder or not postorder:</span><br><span class="line">        return None</span><br><span class="line">    </span><br><span class="line">    root_value = postorder.pop()</span><br><span class="line">    root = TreeNode(root_value)</span><br><span class="line">    </span><br><span class="line">    root_index = inorder.index(root_value)</span><br><span class="line">    </span><br><span class="line">    root.right = build_tree(inorder[root_index + 1:], postorder)</span><br><span class="line">    root.left = build_tree(inorder[:root_index], postorder)</span><br><span class="line">    </span><br><span class="line">    return root</span><br><span class="line"></span><br><span class="line">def preorder_traversal(root):</span><br><span class="line">    if root is None:</span><br><span class="line">        return &quot;&quot;</span><br><span class="line">    return root.value + preorder_traversal(root.left) + preorder_traversal(root.right)</span><br><span class="line"></span><br><span class="line">def print_tree_structure(root):</span><br><span class="line">    if root is None:</span><br><span class="line">        return &quot;None&quot;</span><br><span class="line">    return f&quot;(&#123;root.value&#125;, &#123;print_tree_structure(root.left)&#125;, &#123;print_tree_structure(root.right)&#125;)&quot;</span><br><span class="line"></span><br><span class="line"># å±‚æ¬¡éå†å‡½æ•°</span><br><span class="line">def level_order_traversal(root):</span><br><span class="line">    if root is None:</span><br><span class="line">        return &quot;&quot;</span><br><span class="line">    </span><br><span class="line">    result = []</span><br><span class="line">    queue = deque([root])</span><br><span class="line">    </span><br><span class="line">    while queue:</span><br><span class="line">        node = queue.popleft()</span><br><span class="line">        result.append(node.value)</span><br><span class="line">        </span><br><span class="line">        if node.left:</span><br><span class="line">            queue.append(node.left)</span><br><span class="line">        if node.right:</span><br><span class="line">            queue.append(node.right)</span><br><span class="line">    </span><br><span class="line">    return &quot; &quot;.join(result)</span><br><span class="line"></span><br><span class="line"># ç»™å®šçš„ä¸­åºå’Œååºéå†ç»“æœ</span><br><span class="line">inorder = &quot;ja7Cws_A3daTd4qDo8&#125;F_Sd&#123;a&quot;</span><br><span class="line">postorder = list(&quot;j7aw_sC3addq4TAo&#125;8_Fda&#123;SD&quot;)</span><br><span class="line"></span><br><span class="line"># æ„å»ºäºŒå‰æ ‘</span><br><span class="line">root = build_tree(list(inorder), postorder)</span><br><span class="line"></span><br><span class="line"># è¾“å‡ºæ ‘çš„å‰åºéå†ç»“æœ</span><br><span class="line">preorder_result = preorder_traversal(root)</span><br><span class="line">print(f&quot;å‰åºéå†ç»“æœ: &#123;preorder_result&#125;&quot;)</span><br><span class="line"></span><br><span class="line"># è¾“å‡ºæ ‘çš„å±‚æ¬¡éå†ç»“æœ</span><br><span class="line">level_order_result = level_order_traversal(root)</span><br><span class="line">print(f&quot;å±‚æ¬¡éå†ç»“æœ: &#123;level_order_result&#125;&quot;)</span><br><span class="line"></span><br><span class="line"># è¾“å‡ºæ ‘çš„ç»“æ„</span><br><span class="line">tree_structure = print_tree_structure(root)</span><br><span class="line">print(f&quot;æ ‘çš„ç»“æ„: &#123;tree_structure&#125;&quot;)</span><br><span class="line"></span><br><span class="line"># å±‚æ¬¡éå†ç»“æœ: DASCTF&#123;asd48_daj7w_3adqo&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#define num 26</span><br><span class="line">char mid[] = &quot;ja7Cws_A3daTd4qDo8&#125;F_Sd&#123;a&quot;;</span><br><span class="line">char post[] = &quot;j7aw_sC3addq4TAo&#125;8_Fda&#123;SD&quot;;</span><br><span class="line">// ç›®æ ‡ï¼šç»™å‡ºä¸­åºéå†å’Œååºéå†åºåˆ—ï¼Œæ±‚å‡ºå®Œå…¨äºŒå‰æ ‘ç»“æ„ï¼ˆæ‰“å°å‡ºå±‚æ¬¡éå†åºåˆ—ï¼‰</span><br><span class="line">typedef struct tree</span><br><span class="line">&#123;</span><br><span class="line">	char c;</span><br><span class="line">	struct tree *left,*right;</span><br><span class="line">&#125;tree;</span><br><span class="line">tree *creat(int ms,int me,int ps,int pe)&#123;   // åæ¨æ ‘çš„ç»“æ„</span><br><span class="line">	if(ms&gt;me||ps&gt;pe) return NULL;</span><br><span class="line">	tree *t=(tree  *)malloc(sizeof(tree));</span><br><span class="line">	char charAt=post[pe];</span><br><span class="line">	int i;</span><br><span class="line">	for(i=ms;i&lt;=me&amp;&amp;mid[i]!=charAt;i++) &#123;&#125;</span><br><span class="line">	t-&gt;c=charAt;</span><br><span class="line">	t-&gt;left=creat(ms,i-1,ps, ps + i - ms - 1);</span><br><span class="line">	t-&gt;right=creat(i+1,me, ps + i - ms,pe-1);</span><br><span class="line">	return t;</span><br><span class="line">&#125;</span><br><span class="line">void pre_travel(tree *t)&#123;    // å‰åºéå†</span><br><span class="line">	if(t==NULL) return;</span><br><span class="line">	printf(&quot;%c&quot;,t-&gt;c);</span><br><span class="line">	pre_travel(t-&gt;left);</span><br><span class="line">	pre_travel(t-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line">// å±‚æ¬¡éå†</span><br><span class="line">typedef struct q&#123;  // åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">	tree *c[num];</span><br><span class="line">	int r,f;</span><br><span class="line">&#125;queue;</span><br><span class="line">void init(queue *q)&#123;   //åˆå§‹åŒ–é˜Ÿåˆ—</span><br><span class="line">	q-&gt;r=q-&gt;f=0;</span><br><span class="line">&#125;</span><br><span class="line">void enqueue(queue *q,tree *t) &#123; // å…¥é˜Ÿ</span><br><span class="line">	if((q-&gt;f+1)%num==q-&gt;r) &#123;printf(&quot;é˜Ÿæ»¡ï¼\n&quot;);return;&#125;</span><br><span class="line">	q-&gt;c[q-&gt;f]=t;</span><br><span class="line">	q-&gt;f=(q-&gt;f+1)%num;</span><br><span class="line">&#125;</span><br><span class="line">tree *dequeue(queue *q) &#123;  // å‡ºé˜Ÿ</span><br><span class="line">	if(q-&gt;f==q-&gt;r) &#123;printf(&quot;é˜Ÿç©ºï¼\n&quot;);return NULL;&#125;</span><br><span class="line">	tree *temp=q-&gt;c[q-&gt;r];</span><br><span class="line">	q-&gt;r=(q-&gt;r+1)%num;</span><br><span class="line">	return temp;</span><br><span class="line">&#125;</span><br><span class="line">void level_travel(tree *t)&#123;  //  å±‚æ¬¡éå†</span><br><span class="line">	if(t==NULL) return;</span><br><span class="line">	queue *q=(queue *)malloc(sizeof(queue));</span><br><span class="line">	tree *temp;</span><br><span class="line">	init(q);</span><br><span class="line">	enqueue(q,t);</span><br><span class="line">	while(q-&gt;f!=q-&gt;r)&#123;</span><br><span class="line">		temp=dequeue(q);</span><br><span class="line">		printf(&quot;%c&quot;,temp-&gt;c);</span><br><span class="line">		if(temp-&gt;left!=NULL) enqueue(q,temp-&gt;left);</span><br><span class="line">		if(temp-&gt;right!=NULL) enqueue(q,temp-&gt;right);</span><br><span class="line">	&#125;</span><br><span class="line">	free(q);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	tree *t=creat(0,strlen(mid)-1,0,strlen(post)-1);</span><br><span class="line">	// pre_travel(t);</span><br><span class="line">	level_travel(t);</span><br><span class="line">&#125;</span><br><span class="line">//å±‚æ¬¡éå†ç»“æœ: DASCTF&#123;asd48_daj7w_3adqo&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¯å¢ƒå˜é‡</title>
    <url>/posts/31372/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h1 id="å¼•å­ï¼š"><a href="#å¼•å­ï¼š" class="headerlink" title="å¼•å­ï¼š"></a>å¼•å­ï¼š</h1><p>å‰å‡ å¤©åœ¨ä½¿ç”¨z3æ—¶ï¼Œå‘ç°æ²¡åŠæ³•è°ƒç”¨Intå‡½æ•°å’ŒBitvecå‡½æ•°ï¼Œäº†è§£äº†ä¸€ä¸‹æ‰çŸ¥é“ancondaé»˜è®¤çš„pipå®‰è£…çš„é»˜è®¤åŒ…æ˜¯ä½ç‰ˆæœ¬z3ï¼Œæ²¡æœ‰åŒ…å«è¿™ä¸¤å‡½æ•°ã€‚äºæ˜¯æˆ‘å°è¯•åˆ é™¤z3ï¼Œé‡æ–°ä¸‹ä¸€ä¸ªé«˜ç‰ˆæœ¬çš„ï¼ˆz3-sloverï¼‰ï¼Œä½†æ˜¯å‘ç°pipæ— æ³•ä½¿ç”¨ã€‚æ•´äº†åŠå¤©æ‰å‘ç°æ˜¯ä¸€ä¸ªæœˆå‰æŠŠpython.exeåå­—æ”¹äº†ï¼ˆå› ä¸ºç”µè„‘ä¸Špythonç‰ˆæœ¬æ¯”è¾ƒå¤šï¼Œä¸ºäº†åˆ‡æ¢æ–¹ä¾¿ï¼Œæˆ‘å°±æŠŠè§£é‡Šå™¨åå­—åŠ ä¸Šäº†ç‰ˆæœ¬å·ï¼‰ï¼Œä½†æ˜¯æœ‰ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„äº‹ï¼Œå°±æ˜¯pythonä½¿ç”¨å®Œå…¨æ­£å¸¸ï¼Œå°±æ˜¯pipç”¨ä¸äº†ï¼Œçœ‹æ¥ä¸æ˜¯ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯äº†ã€‚ç»è¿‡æŸ¥è¯¢æ‰çŸ¥é“ï¼Œç”±äºè§£é‡Šå™¨çš„åå­—æ”¹äº†ï¼Œå¯¼è‡´pipé…ç½®æ–‡ä»¶conda-script.pyå‡ºç°é”™è¯¯ï¼Œæ— æ³•æ‰¾åˆ°è§£é‡Šå™¨ï¼Œå¯¼è‡´ç³»ç»Ÿæ— æ³•æ­£ç¡®è°ƒç”¨è§£é‡Šå™¨æ‰§è¡Œè„šæœ¬ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸Šé¦–è¡ŒåŠ ä¸Šä¸€å¥ä¿®æ”¹åçš„è§£é‡Šå™¨è·¯å¾„å°±è¡Œã€‚ä½†æ˜¯è¿™ä¹Ÿå¼•å‡ºäº†æˆ‘çš„ç–‘é—®ï¼Œç¯å¢ƒå˜é‡æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬å¤§å¤šæ•°æ—¶å€™é…ç½®ç¯å¢ƒå˜é‡éƒ½åœ¨Pathå¤„é…ç½®ï¼Œè€Œä¸æ˜¯å…¶ä»–ï¼Ÿ</p>
<h1 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h1><p>ä¸åŒçš„ç¯å¢ƒå˜é‡ä½œç”¨ä¸ä¸€æ ·ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ç¯å¢ƒå˜é‡éƒ½æ˜¯ä¸ºäº†æ˜¯å¸®åŠ©ç³»ç»Ÿå¿«é€Ÿå®šä½æ–‡ä»¶ï¼Œä¸ç”¨è¾“å…¥å®Œæ•´è·¯å¾„ã€‚ä»¥ä¸‹åˆ—å‡ºå¸¸è§çš„ç¯å¢ƒå˜é‡ã€‚</p>
<h2 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h2><p>ä½œä¸ºæœ€å¸¸ç”¨çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨å¤§éƒ¨åˆ†ç¯å¢ƒé…ç½®æ—¶éƒ½ä¼šç”¨åˆ°å®ƒï¼Œæ— è®ºæ˜¯é…ç½®pythonã€javaè¿˜æ˜¯å…¶ä»–ç¯å¢ƒã€‚Pathå˜é‡çš„ä¸»è¦ä½œç”¨å°±æ˜¯å¸®åŠ©ç³»ç»Ÿå¿«é€Ÿæ‰¾åˆ°.exeæ–‡ä»¶ã€‚å½“ä½ åœ¨cmdé‡Œé¢è¾“å…¥pythonæ—¶ï¼Œç³»ç»Ÿä¼šä¸€æ¡ä¸€æ¡éå†pathé‡Œé¢è·¯å¾„ï¼Œåœ¨æ¯ä¸€ä¸ªè·¯å¾„é‡Œé¢å¯»æ‰¾åŒåexeæ–‡ä»¶ï¼Œå¦‚python.exeæ–‡ä»¶æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒåexeæ–‡ä»¶æ—¶å°±ä¼šè¿è¡Œå®ƒã€‚ç”±äºå®ƒæ˜¯æŒ‰pathé‡Œé¢ä»ä¸Šå¾€ä¸‹æŸ¥æ‰¾ï¼Œæ‰€ä»¥åœ¨ä¸Šé¢çš„è·¯å¾„ä¼šä¼˜å…ˆè¢«æ‰¾åˆ°ã€‚</p>
<p><strong>å®éªŒï¼šéªŒè¯pathæŸ¥æ‰¾é¡ºåº</strong></p>
<p>è¿™é‡Œåˆ›å»ºä¸¤ä¸ªåŒåexeæ–‡ä»¶ï¼Œåˆ†åˆ«æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸‹ï¼Œè¿è¡Œè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªä¼šè¾“å‡º1ï¼Œä¸€ä¸ªä¼šè¾“å‡º2ã€‚æ¥ä¸‹æ¥æŠŠä»–ä»¬æ”¾åœ¨ç³»ç»Ÿå˜é‡çš„pathé‡Œé¢ï¼Œ1åœ¨å‰ï¼Œ2åœ¨åï¼Œå†åœ¨ç»ˆç«¯è¾“å…¥æ–‡ä»¶åï¼Œçœ‹å“ªä¸ªæ–‡ä»¶è¢«æ‰“å¼€ï¼š</p>
<img src="/posts/31372/image-20250414235452359.png" class="" title="image-20250414235452359">

<p>ç»“æœå¾ˆæ˜æ˜¾ï¼Œæ˜¯åœ¨å‰é¢çš„1èµ·ä½œç”¨äº†ã€‚ä¸ºäº†å½¢æˆå¯¹ç…§ï¼Œæˆ‘æŠŠè¿™ä¸¤æ¡è·¯å¾„é¡ºåºæ¢ä¸€ä¸‹å†è¯•è¯•ï¼š</p>
<img src="/posts/31372/image-20250414235747259.png" class="" title="image-20250414235747259">

<p>å‘ç°é¡ºåºæ¢åæ˜¯2è¢«æ‰“å¼€ã€‚è‡³æ­¤ï¼Œå¯ä»¥å¾—åˆ°ï¼šåœ¨pathè¶Šå‰çš„è·¯å¾„è¶Šæ˜¯ä¼˜å…ˆã€‚å¦‚æœæœ‰å¤šä¸ªç‰ˆæœ¬çš„pythonï¼ˆæˆ–å…¶ä»–ï¼‰ï¼Œå¦‚æœæƒ³è¦è¾“å…¥pythonåè¿è¡ŒæŸä¸ªç‰ˆæœ¬ï¼Œé‚£å°±æŠŠè¿™ä¸ªç‰ˆæœ¬çš„è·¯å¾„æ”¾å‰é¢ã€‚</p>
<p><strong>å®éªŒï¼šéªŒè¯æ–‡ä»¶æŸ¥æ‰¾ä¼˜å…ˆæ€§</strong></p>
<p>å¦‚æœä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œé¢æœ‰ä¸€ä¸ªexeæ–‡ä»¶ï¼Œå³test.exeï¼Œè€Œpathé‡Œé¢ä¹Ÿæœ‰ä¸€æ¡è·¯å¾„é‡Œé¢åŒ…å«test.exeï¼ˆä¸æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œå¦‚æœæˆ‘åœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œé¢æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥testï¼Œé‚£ä¹ˆç©¶ç«Ÿæ˜¯å“ªä¸ªexeæ–‡ä»¶ä¼šè¢«æ‰“å¼€å‘¢?</p>
<p>æ–‡ä»¶å¤¹path1é‡Œé¢æ”¾äº†ä¸€ä¸ªtest.exeï¼Œå®ƒè¿è¡Œä¼šè¾“å‡º1ã€‚æ–‡ä»¶å¤¹path2é‡Œé¢æ”¾äº†å¦ä¸€ä¸ªtest.exeï¼Œè¿è¡Œä¼šè¾“å‡º2ã€‚æŠŠpath1è·¯å¾„æ”¾è¿›pathé‡Œé¢ï¼Œåœ¨æ–‡ä»¶å¤¹path2é‡Œé¢æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥testï¼š</p>
<p>æ–¹å¼ä¸€ï¼šå³é”®èœå•çš„â€œåœ¨ç»ˆç«¯ä¸­æ‰“å¼€</p>
<img src="/posts/31372/image-20250415003415489.png" class="" title="image-20250415003415489">

<p>æ–¹å¼äºŒï¼šæ–‡ä»¶åœ°å€æ è¾“å…¥cmd</p>
<img src="/posts/31372/image-20250415003519150.png" class="" title="image-20250415003519150">

<p>ä¸¤ç§ä¸åŒæ–¹å¼æ‰“å¼€ç»ˆç«¯ï¼Œå¾—åˆ°çš„ç»“æœå®Œå…¨ä¸ä¸€æ ·!!!!!!!!!</p>
<p>ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œå‘ç°ï¼Œä¸€ä¸ªæ˜¯cmdï¼Œä¸€ä¸ªæ˜¯powershellã€‚æœ¬æ¥ä»¥ä¸ºè¿™ä¸¤ä¸ªä¸œè¥¿æ˜¯ä¸€æ ·çš„ï¼Œç»“æœå‘ç°å…¶å®å¹¶ä¸ä¸€æ ·ã€‚</p>
<p><strong>CMD</strong>ï¼šæºè‡ª1981å¹´çš„MS-DOSç³»ç»Ÿï¼Œä¸»è¦ç”¨äºæ‰§è¡ŒåŸºç¡€å‘½ä»¤å’Œæ‰¹å¤„ç†è„šæœ¬ï¼ˆ.batï¼‰ã€‚å®ƒç»§æ‰¿ä¼ ç»Ÿçš„å‘½ä»¤è¡Œæ“ä½œï¼Œå…¼å®¹æ€§é«˜ä½†åŠŸèƒ½æœ‰é™</p>
<p><strong>PowerShell</strong>ï¼š2006å¹´ç”±å¾®è½¯æ¨å‡ºï¼ŒåŸºäº.NET Frameworkå¼€å‘ï¼Œç›®æ ‡æ˜¯æˆä¸ºé¢å‘å¯¹è±¡ã€æ”¯æŒè‡ªåŠ¨åŒ–çš„é«˜çº§è„šæœ¬è¯­è¨€å’Œç³»ç»Ÿç®¡ç†å·¥å…·ã€‚Windows 11å·²å°†å…¶è®¾ä¸ºé»˜è®¤å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<p>ç°åœ¨å¾®è½¯æ­£åœ¨ç€æ‰‹äºç”¨powershellå–ä»£cmdã€‚</p>
<p>ç”±äºé¼ æ ‡å³é”®é»˜è®¤æ‰“å¼€çš„æ˜¯powershellï¼Œè€Œåœ¨åœ°å€æ è¾“å…¥cmdæ‰“å¼€çš„æ˜¯cmdï¼Œè¿™ä¸¤ç§å‘½ä»¤è¡Œä½¿ç”¨æ–¹å¼ä¸åŒ:</p>
<p>cmdï¼šè¾“å…¥æ–‡ä»¶åä¼šè‡ªå·±æŸ¥æ‰¾æœ¬ç›®å½•</p>
<p>powershowï¼šç›´æ¥è¾“å…¥æ–‡ä»¶åä¼šè¯†åˆ«é”™è¯¯ï¼Œå¿…é¡»åœ¨æ–‡ä»¶åå‰åŠ å‰ç¼€ï¼Œå¦‚â€.\testâ€ï¼Œè¿™æ ·è¾“å…¥å°±æ˜¯æŒ‡å®šå…¶åœ¨æœ¬ç›®å½•æŸ¥æ‰¾ã€‚è¿™é‡Œå¾—åˆ°1æ˜¯å› ä¸ºç›´æ¥è¾“å…¥æ–‡ä»¶åä¸æ»¡è¶³å®ƒçš„è¯­æ³•ï¼Œä½†æ˜¯æ»¡è¶³pathçš„è¯­æ³•ï¼Œäºæ˜¯æ‰§è¡Œpathé‡Œé¢çš„æ–‡ä»¶ã€‚</p>
<p>äºæ˜¯ä¸¤ç§æ–¹å¼å¾—åˆ°äº†ä¸ä¸€æ ·çš„ç»“æœã€‚</p>
<p><strong>å®éªŒï¼šæ¢ç©¶ç”¨æˆ·å˜é‡çš„pathä¸ç³»ç»Ÿå˜é‡çš„pathä¼˜å…ˆçº§</strong></p>
<p>ç”¨æˆ·å˜é‡çš„pathé‡Œé¢åŠ å…¥1çš„è·¯å¾„ï¼Œç³»ç»Ÿå˜é‡çš„pathé‡Œé¢åŠ å…¥2çš„è·¯å¾„ï¼Œåœ¨ç»ˆç«¯è¾“å…¥testï¼š</p>
<img src="/posts/31372/image-20250415082909230.png" class="" title="image-20250415082909230">

<p>å¾—åˆ°ç³»ç»Ÿå˜é‡path&gt;ç”¨æˆ·å˜é‡path</p>
<h2 id="å…¶ä»–å˜é‡"><a href="#å…¶ä»–å˜é‡" class="headerlink" title="å…¶ä»–å˜é‡"></a>å…¶ä»–å˜é‡</h2><p>å½“æˆ‘ä»¬åœ¨ç»ˆç«¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œç³»ç»Ÿæ€ä¹ˆçŸ¥é“æˆ‘ä»¬è¾“å…¥çš„æ˜¯åœ¨å“ªä¸ªç³»ç»Ÿå˜é‡ï¼ˆæˆ–ç¯å¢ƒå˜é‡ï¼‰é‡Œé¢çš„å‘¢ï¼Ÿä¼šä¸ä¼šæ˜¯éå†æ‰€æœ‰å˜é‡ï¼Œç›´åˆ°æ‰¾åˆ°exeæ–‡ä»¶å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯å¦å®šã€‚å…¶ä»–å˜é‡çš„ä½œç”¨å¹¶ä¸æ˜¯åƒpathä¸“é—¨ç”¨æ¥æŸ¥æ‰¾exeæ–‡ä»¶ï¼Œè€Œæ˜¯åƒä¸€ä¸ªæ›¿æ¢ã€‚ä¾‹å¦‚æˆ‘åŠ ä¸€æ¡å˜é‡ï¼š</p>
<img src="/posts/31372/image-20250415090957352.png" class="" title="image-20250415090957352">

<p>é‚£ä¹ˆä¹‹åï¼Œå°±å¯ä»¥ç”¨MYTESTï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰æ¥ä»£æŒ‡ï¼ˆæ›¿æ¢ï¼‰è¿™æ¡è·¯å¾„ã€‚å…¶ä»–å˜é‡çš„ç”¨æ³•å’Œpathä¸ä¸€æ ·ï¼Œä»–ä»¬å¿…é¡»è¦æ˜¾ç¤ºåœ°è°ƒç”¨ï¼Œå³:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%å˜é‡å%</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ç›´æ¥åœ¨cmdé‡Œé¢è¾“å…¥mytestï¼Œç³»ç»Ÿä¼šæŠŠå®ƒä½œä¸ºæŒ‡ä»¤åœ¨pathé‡Œé¢è¿›è¡Œæœç´¢ï¼Œæ²¡æœ‰æ‰¾åˆ°pathé‡Œé¢ç§°ä¸º</p>
<p>mytest.exeçš„æ–‡ä»¶ï¼Œç„¶åå°±ä¼šæŠ¥é”™ï¼š</p>
<img src="/posts/31372/image-20250415091116006.png" class="" title="image-20250415091116006">

<p>å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æŒ‡æˆ‘è¾“å…¥%mytest%å°±èƒ½ç›´æ¥è¿è¡Œé‡Œé¢çš„test.exeï¼Œå› ä¸ºåœ¨ç»ˆç«¯é‡Œé¢è¾“å…¥%mytest%åï¼Œç”±äºæ˜¯æ˜¾å¼è°ƒç”¨ï¼Œç³»ç»Ÿä¸ä¼šæŠŠä»–è¯†åˆ«ä¸ºå‘½ä»¤ï¼Œè€Œæ˜¯ä»ç¬¬ä¸€æ¡ç³»ç»Ÿå˜é‡å¼€å§‹æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŒåçš„ç³»ç»Ÿå˜é‡ï¼Œå³ä¹‹å‰åˆ›å»ºçš„MYTESTï¼Œç„¶åç”¨MYTESTé‡Œé¢çš„å€¼æ›¿æ¢ï¼Œæ‰€ä»¥ï¼Œå®é™…ä¸Šå°±ç­‰åŒäºæˆ‘åœ¨ç»ˆç«¯è¾“å…¥C:\Users\tzs\Desktop\path2ï¼Œè¿™æ ·æ›¿æ¢ä¹‹åï¼Œç³»ç»Ÿåˆä¼šæŠŠå®ƒè¯†åˆ«ä¸ºå‘½ä»¤ï¼Œç„¶åæŠ¥é”™:</p>
<img src="/posts/31372/image-20250415091824371.png" class="" title="image-20250415091824371">

<p>æ­£ç¡®çš„åšæ³•æ˜¯è¾“å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œå³%mytest%\testï¼Œè¿™æ ·ç­‰åŒäºC:\Users\tzs\Desktop\path2\testï¼Œç³»ç»Ÿå°±ä¼šæŸ¥æ‰¾åˆ°test.exeï¼Œç„¶åè¿è¡Œ:</p>
<img src="/posts/31372/image-20250415092043978.png" class="" title="image-20250415092043978">
]]></content>
      <tags>
        <tag>å…¶ä»–</tag>
      </tags>
  </entry>
  <entry>
    <title>ç§»åŠ¨å¯¼å‡ºè¡¨ã€é‡å®šä½è¡¨</title>
    <url>/posts/56776/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="ç§»åŠ¨é‡å®šä½è¡¨ï¼š"><a href="#ç§»åŠ¨é‡å®šä½è¡¨ï¼š" class="headerlink" title="ç§»åŠ¨é‡å®šä½è¡¨ï¼š"></a>ç§»åŠ¨é‡å®šä½è¡¨ï¼š</h1><p>ä¸»è¦æ€è·¯ï¼š</p>
<ol>
<li>å…ˆéå†å‡ºé‡å®šä½è¡¨å¤§å°</li>
<li>å¤åˆ¶æ•´ä¸ªé‡å®šä½è¡¨ï¼ˆæ³¨æ„ï¼šæœ€åçš„é‚£ä¸ªç©ºè¡¨ä¹Ÿè¦å¤åˆ¶ï¼‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">int num=0;           //èŠ‚æ•°é‡</span><br><span class="line">int header_size=0;   // PEå¤´å¤§å°</span><br><span class="line">int base=0;          // åŸºå€</span><br><span class="line">int fsize=0,image_size=0; // æ–‡ä»¶å¤§å°ï¼›æ–‡ä»¶æ˜ å°„çš„å†…å­˜å¤§å°</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">	DWORD foa=0;</span><br><span class="line">    if(rva&lt;=header_size) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    if(rva&lt;sheader[0].VirtualAddress) &#123;</span><br><span class="line">        printf(&quot;æ²¡æœ‰å¯¹åº”çš„foa!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i &gt;= num) &#123;</span><br><span class="line">        printf(&quot;RVAè¶…å‡ºèŒƒå›´!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">	return foa;</span><br><span class="line">&#125;</span><br><span class="line">void new_section()&#123;  // åˆ›å»ºæ–°èŠ‚</span><br><span class="line">    int index = fheader-&gt;NumberOfSections;</span><br><span class="line">    strcpy(sheader[index].Name,&quot;new&quot;);</span><br><span class="line">    sheader[index].Misc.VirtualSize = oheader-&gt;SectionAlignment;</span><br><span class="line">    sheader[index].VirtualAddress = sheader[index-1].VirtualAddress + ((sheader[index-1].Misc.VirtualSize)/oheader-&gt;SectionAlignment+1)*oheader-&gt;SectionAlignment;</span><br><span class="line">    sheader[index].PointerToRawData = sheader[index-1].PointerToRawData + sheader[index-1].SizeOfRawData;</span><br><span class="line">    sheader[index].SizeOfRawData = 0x1000;</span><br><span class="line">    sheader[index].Characteristics = sheader[index-1].Characteristics;</span><br><span class="line">    sheader[index].PointerToRelocations = sheader[index-1].PointerToRelocations;</span><br><span class="line">    sheader[index].PointerToLinenumbers = sheader[index-1].PointerToLinenumbers;</span><br><span class="line">    sheader[index].NumberOfRelocations = sheader[index-1].NumberOfRelocations;</span><br><span class="line">    sheader[index].NumberOfLinenumbers = sheader[index-1].NumberOfLinenumbers;</span><br><span class="line">    fheader-&gt;NumberOfSections++;</span><br><span class="line">    oheader-&gt;SizeOfImage+=oheader-&gt;SectionAlignment;</span><br><span class="line">&#125;</span><br><span class="line">int relocation_size(unsigned char *location)&#123;</span><br><span class="line">    IMAGE_BASE_RELOCATION* relocation=(IMAGE_BASE_RELOCATION*)location;</span><br><span class="line">    if(relocation-&gt;SizeOfBlock==0) return 8;  // æœ€åä¸€ä¸ªç©ºè¡¨å 8ä¸ªå­—èŠ‚</span><br><span class="line">    location += relocation-&gt;SizeOfBlock;</span><br><span class="line">    return relocation-&gt;SizeOfBlock+relocation_size(location);</span><br><span class="line">&#125;</span><br><span class="line">void move_relocation(unsigned char *location,unsigned char *section)&#123;  // ç§»åŠ¨é‡å®šä½è¡¨</span><br><span class="line">    int size = relocation_size(location);</span><br><span class="line">    memcpy(section,location,size);</span><br><span class="line">    IMAGE_BASE_RELOCATION* relocation=(IMAGE_BASE_RELOCATION*)location;</span><br><span class="line">    oheader-&gt;DataDirectory[5].VirtualAddress = sheader[fheader-&gt;NumberOfSections-1].VirtualAddress;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    // if(argc != 2) &#123;</span><br><span class="line">    //     printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">    //     return 1;</span><br><span class="line">    // &#125;</span><br><span class="line">    const char* pe_path = &quot;dlltest.dll&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize+0x1000);   // å¤šåˆ†é…0x1000ç”¨ä½œæ–°èŠ‚</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *offset=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)offset;</span><br><span class="line">    offset+=dos-&gt;e_lfanew+4;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)offset;</span><br><span class="line">    num = fheader-&gt;NumberOfSections;</span><br><span class="line">    offset+=20;      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)offset;</span><br><span class="line">    header_size=oheader-&gt;SizeOfHeaders;</span><br><span class="line">    base=oheader-&gt;ImageBase;</span><br><span class="line">    image_size = oheader-&gt;SizeOfImage;</span><br><span class="line">    offset += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    int size = num * sizeof(IMAGE_SECTION_HEADER);</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)offset;</span><br><span class="line">    new_section();</span><br><span class="line">    DWORD redelocation_rva = oheader-&gt;DataDirectory[5].VirtualAddress;</span><br><span class="line">	DWORD relocation_foa = RVA_to_FOA(redelocation_rva);</span><br><span class="line">	if(relocation_foa == 0) &#123;</span><br><span class="line">		printf(&quot;é‡å®šä½è¡¨RVAè½¬æ¢å¤±è´¥\n&quot;);</span><br><span class="line">		free(file_buf);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">    move_relocation(file_buf+relocation_foa,file_buf+sheader[fheader-&gt;NumberOfSections-1].PointerToRawData);</span><br><span class="line">    FILE *new_file = fopen(&quot;new.dll&quot;,&quot;wb&quot;);</span><br><span class="line">    if (!new_file) &#123;</span><br><span class="line">        perror(&quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥&quot;);</span><br><span class="line">        free(file_buf);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    int written=fwrite(file_buf,sizeof(unsigned char),fsize+0x1000,new_file);</span><br><span class="line">    if(written!=fsize+0x1000)&#123;</span><br><span class="line">        perror(&quot;å†™å…¥é”™è¯¯&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(new_file);</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ç§»åŠ¨å¯¼å‡ºè¡¨"><a href="#ç§»åŠ¨å¯¼å‡ºè¡¨" class="headerlink" title="ç§»åŠ¨å¯¼å‡ºè¡¨"></a>ç§»åŠ¨å¯¼å‡ºè¡¨</h1><p>ä¸»è¦æ€è·¯</p>
<ol>
<li>ç§»åŠ¨å¯¼å‡ºè¡¨ç»“æ„ä½“ï¼ˆè¦æŠŠdllåå­—ä¹Ÿç§»å‡ºï¼‰</li>
<li>ç§»åŠ¨ä¸‰å¼ è¡¨ï¼ˆåå­—è¡¨ä¸­åå­—ä¹Ÿè¦ç§»å‡ºï¼‰</li>
<li>ä¿®æ”¹å¯é€‰å¤´é‡Œå¯¼å‡ºè¡¨RVA</li>
<li>ä¿®æ­£å¯¼å‡ºè¡¨æˆå‘˜ï¼ˆåŒ…æ‹¬ä¸‰å¼ è¡¨ä½ç½®ï¼‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">IMAGE_EXPORT_DIRECTORY* export;</span><br><span class="line">int num=0;           //èŠ‚æ•°é‡</span><br><span class="line">int header_size=0;   // PEå¤´å¤§å°</span><br><span class="line">int base=0;          // åŸºå€</span><br><span class="line">int fsize=0,image_size=0; // æ–‡ä»¶å¤§å°ï¼›æ–‡ä»¶æ˜ å°„çš„å†…å­˜å¤§å°</span><br><span class="line">DWORD FOA_to_RVA(DWORD foa)&#123;</span><br><span class="line">    DWORD rva=0;</span><br><span class="line">    if(foa&lt;=header_size) &#123;</span><br><span class="line">        rva = foa;</span><br><span class="line">        return rva;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        if(foa&gt;=sheader[i].PointerToRawData&amp;&amp;foa&lt;(sheader[i].PointerToRawData+sheader[i].SizeOfRawData))</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=foa-sheader[i].PointerToRawData;</span><br><span class="line">    rva = sheader[i].VirtualAddress + offset;</span><br><span class="line">    return rva;</span><br><span class="line">&#125;</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">	DWORD foa=0;</span><br><span class="line">    if(rva&lt;=header_size) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    if(rva&lt;sheader[0].VirtualAddress) &#123;</span><br><span class="line">        printf(&quot;æ²¡æœ‰å¯¹åº”çš„foa!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i &gt;= num) &#123;</span><br><span class="line">        printf(&quot;RVAè¶…å‡ºèŒƒå›´!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">	return foa;</span><br><span class="line">&#125;</span><br><span class="line">void new_section()&#123;  // åˆ›å»ºæ–°èŠ‚</span><br><span class="line">    int index = fheader-&gt;NumberOfSections;</span><br><span class="line">    strcpy(sheader[index].Name,&quot;newsection&quot;);</span><br><span class="line">    sheader[index].Misc.VirtualSize = oheader-&gt;SectionAlignment;</span><br><span class="line">    sheader[index].VirtualAddress = sheader[index-1].VirtualAddress + ((sheader[index-1].Misc.VirtualSize)/oheader-&gt;SectionAlignment+1)*oheader-&gt;SectionAlignment;</span><br><span class="line">    sheader[index].PointerToRawData = sheader[index-1].PointerToRawData + sheader[index-1].SizeOfRawData;</span><br><span class="line">    sheader[index].SizeOfRawData = 0x1000;</span><br><span class="line">    sheader[index].Characteristics = sheader[index-1].Characteristics;</span><br><span class="line">    sheader[index].PointerToRelocations = sheader[index-1].PointerToRelocations;</span><br><span class="line">    sheader[index].PointerToLinenumbers = sheader[index-1].PointerToLinenumbers;</span><br><span class="line">    sheader[index].NumberOfRelocations = sheader[index-1].NumberOfRelocations;</span><br><span class="line">    sheader[index].NumberOfLinenumbers = sheader[index-1].NumberOfLinenumbers;</span><br><span class="line">    fheader-&gt;NumberOfSections++;</span><br><span class="line">    oheader-&gt;SizeOfImage+=oheader-&gt;SectionAlignment;</span><br><span class="line">&#125;</span><br><span class="line">DWORD move_export_struct(DWORD offset,DWORD export_foa,unsigned char *file_buf)&#123;</span><br><span class="line">    int size = sizeof(IMAGE_EXPORT_DIRECTORY);</span><br><span class="line">    memcpy(offset+file_buf,(unsigned char *)(export_foa+file_buf),size);</span><br><span class="line">    oheader-&gt;DataDirectory[0].VirtualAddress = sheader[fheader-&gt;NumberOfSections-1].VirtualAddress;</span><br><span class="line">    offset += size;</span><br><span class="line">    char *s = (char *)(RVA_to_FOA(export-&gt;Name)+file_buf);   // ç§»åŠ¨dllåå­—</span><br><span class="line">    strcpy((char *)(offset+file_buf),s);</span><br><span class="line">    export-&gt;Name = FOA_to_RVA(offset);</span><br><span class="line">    offset += strlen(s)+1;</span><br><span class="line">    return offset;</span><br><span class="line">&#125;</span><br><span class="line">DWORD mov_table(DWORD offset,unsigned char *file_buf)&#123;</span><br><span class="line">    DWORD* NameTable=(DWORD*)(RVA_to_FOA(export-&gt;AddressOfNames)+file_buf);</span><br><span class="line">	unsigned char* OrdinalTable=RVA_to_FOA(export-&gt;AddressOfNameOrdinals)+file_buf;</span><br><span class="line">	unsigned char* AddressTable=RVA_to_FOA(export-&gt;AddressOfFunctions)+file_buf;</span><br><span class="line">    // ç§»åœ°å€è¡¨</span><br><span class="line">    int size = 4*(export-&gt;NumberOfFunctions);</span><br><span class="line">    memcpy(offset+file_buf,AddressTable,size);</span><br><span class="line">    export-&gt;AddressOfFunctions = FOA_to_RVA(offset);</span><br><span class="line">    offset += size;</span><br><span class="line">    // ç§»åºå·è¡¨</span><br><span class="line">    size = 2*(export-&gt;NumberOfNames);</span><br><span class="line">    memcpy(offset+file_buf,OrdinalTable,size);</span><br><span class="line">    export-&gt;AddressOfNameOrdinals = FOA_to_RVA(offset);</span><br><span class="line">    offset += size;</span><br><span class="line">    // ç§»åç§°è¡¨</span><br><span class="line">    int i = 0,len = 0;</span><br><span class="line">    size = 4*(export-&gt;NumberOfNames);</span><br><span class="line">    char * s=NULL;</span><br><span class="line">    DWORD *data =(DWORD*)malloc(size);</span><br><span class="line">    for(i=0;i&lt;export-&gt;NumberOfNames;i++)&#123;</span><br><span class="line">        s = (char*)(RVA_to_FOA(NameTable[i])+file_buf);</span><br><span class="line">        len = strlen(s);</span><br><span class="line">        strcpy(file_buf+offset,s);</span><br><span class="line">        data[i] = FOA_to_RVA(offset);</span><br><span class="line">        offset+=len+1;  // ç»“å°¾ä¸º&#x27;\0&#x27;ï¼Œæ•…è¦åŠ 1</span><br><span class="line">    &#125;</span><br><span class="line">    memcpy(file_buf+offset,(unsigned char *)data,size);</span><br><span class="line">    export-&gt;AddressOfNames = FOA_to_RVA(offset);</span><br><span class="line">    free(data);</span><br><span class="line">    offset += size;</span><br><span class="line">    return offset;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    // if(argc != 2) &#123;</span><br><span class="line">    //     printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">    //     return 1;</span><br><span class="line">    // &#125;</span><br><span class="line">    const char* pe_path = &quot;dlltest.dll&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize+0x1000);   // å¤šåˆ†é…0x1000ç”¨ä½œæ–°èŠ‚</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *buffer=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)buffer;</span><br><span class="line">    buffer+=dos-&gt;e_lfanew+4;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)buffer;</span><br><span class="line">    num = fheader-&gt;NumberOfSections;</span><br><span class="line">    buffer+=20;      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)buffer;</span><br><span class="line">    header_size=oheader-&gt;SizeOfHeaders;</span><br><span class="line">    base=oheader-&gt;ImageBase;</span><br><span class="line">    image_size = oheader-&gt;SizeOfImage;</span><br><span class="line">    buffer += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    int size = num * sizeof(IMAGE_SECTION_HEADER);</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)buffer;</span><br><span class="line">    new_section();</span><br><span class="line">    DWORD new_foa = sheader[fheader-&gt;NumberOfSections-1].PointerToRawData; // æ–°èŠ‚çš„foa</span><br><span class="line">    DWORD offset=new_foa;</span><br><span class="line">    DWORD export_rva = oheader-&gt;DataDirectory[0].VirtualAddress;</span><br><span class="line">	DWORD export_foa = RVA_to_FOA(export_rva);</span><br><span class="line">	if(export_foa == 0) &#123;</span><br><span class="line">		printf(&quot;å¯¼å‡ºè¡¨RVAè½¬æ¢å¤±è´¥\n&quot;);</span><br><span class="line">		free(file_buf);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">    export = (IMAGE_EXPORT_DIRECTORY*)(new_foa+file_buf);</span><br><span class="line">    offset = move_export_struct(offset,export_foa,file_buf);</span><br><span class="line">    offset = mov_table(offset,file_buf);</span><br><span class="line">    FILE *new_file = fopen(&quot;new.dll&quot;,&quot;wb&quot;);</span><br><span class="line">    if (!new_file) &#123;</span><br><span class="line">        perror(&quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥&quot;);</span><br><span class="line">        free(file_buf);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    int written=fwrite(file_buf,sizeof(unsigned char),fsize+0x1000,new_file);</span><br><span class="line">    if(written!=fsize+0x1000)&#123;</span><br><span class="line">        perror(&quot;å†™å…¥é”™è¯¯&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(new_file);</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PE</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç½‘</title>
    <url>/posts/51165/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="ä¸€ã€æ¦‚è®º"><a href="#ä¸€ã€æ¦‚è®º" class="headerlink" title="ä¸€ã€æ¦‚è®º"></a>ä¸€ã€æ¦‚è®º</h1><hr>
<h1 id="äºŒã€ç‰©ç†å±‚"><a href="#äºŒã€ç‰©ç†å±‚" class="headerlink" title="äºŒã€ç‰©ç†å±‚"></a>äºŒã€ç‰©ç†å±‚</h1><hr>
<h1 id="ä¸‰ã€æ•°æ®é“¾è·¯å±‚"><a href="#ä¸‰ã€æ•°æ®é“¾è·¯å±‚" class="headerlink" title="ä¸‰ã€æ•°æ®é“¾è·¯å±‚"></a>ä¸‰ã€æ•°æ®é“¾è·¯å±‚</h1><p>ä»¥ä¸‹å…³äºä»¥å¤ªç½‘çš„æè¿°,æ­£ç¡®çš„æ˜¯( C)</p>
<ul>
<li>A. ä»¥å¤ªç½‘æä¾›å·®é”™æ£€æµ‹å’Œå·®é”™çº æ­£çš„æœºåˆ¶</li>
<li>B. ä»¥å¤ªç½‘æä¾›ç¢°æ’æ£€æµ‹æœºåˆ¶</li>
<li>C. ä»¥å¤ªç½‘æä¾›æµé‡æ§åˆ¶æœºåˆ¶</li>
<li>D. ä»¥å¤ªç½‘æä¾›æ‹¥å¡æ§åˆ¶æœºåˆ¶</li>
</ul>
<p>ç­”æ¡ˆï¼šBã€‚ä¼ ç»ŸåŠåŒå·¥ä»¥å¤ªç½‘ï¼ˆä½¿ç”¨CSMA&#x2F;CDçš„ï¼‰ï¼Œ<strong>æ— æµé‡æ§åˆ¶æœºåˆ¶</strong>ï¼Œå†²çªæ—¶ä¾é éšæœºé€€é¿é‡ä¼ ï¼Œæµé‡æ§åˆ¶ç”±ä¸Šå±‚ï¼ˆå¦‚TCPï¼‰å®ç°ã€‚</p>
<p><strong>DTEï¼ˆç»ˆç«¯è®¾å¤‡ï¼‰ï¼š</strong>Data Terminal Equipmentï¼Œè´Ÿè´£ç”Ÿæˆã€å¤„ç†æˆ–æ¶ˆè´¹æ•°æ®ï¼ˆå¦‚å‘é€HTTPè¯·æ±‚ã€è¿è¡Œåº”ç”¨ç¨‹åºï¼‰</p>
<p>æ³¨æ„ï¼šè·¯ç”±å™¨ä¹Ÿæ˜¯DTEï¼Œå› ä¸ºè·¯ç”±å™¨ä¹Ÿä¼šç”ŸæˆæŠ¥æ–‡ï¼ˆå¦‚å‘é€è·¯ç”±åè®®æŠ¥æ–‡ï¼šOSPFã€BGPï¼‰ï¼Œæˆ–å“åº”ç®¡ç†è¯·æ±‚ï¼ˆå¦‚å›å¤ICMP Pingï¼‰ï¼Œè¿™ç¬¦åˆDTEâ€œç”Ÿæˆæ•°æ®â€çš„ç‰¹æ€§ã€‚</p>
<p><strong>DCEï¼ˆæ•°æ®é€šä¿¡è®¾å¤‡ï¼‰</strong>ï¼šData Communication Deviceï¼Œè´Ÿè´£è½¬å‘æˆ–ä¸­ç»§æ•°æ®ã€‚ï¼ˆç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚ï¼‰</p>
<ul>
<li>æä¾›æ—¶é’ŸåŒæ­¥ï¼ˆå¦‚è°ƒåˆ¶è§£è°ƒå™¨æ§åˆ¶é€šä¿¡æ—¶åºï¼‰ã€‚</li>
<li>ä¿¡å·æ ¼å¼è½¬æ¢ï¼ˆå¦‚å°†æ•°å­—ä¿¡å·è½¬ä¸ºæ¨¡æ‹Ÿä¿¡å·ï¼‰ã€‚</li>
<li>å•çº¯è½¬å‘æ•°æ®ï¼ˆå¦‚äº¤æ¢æœºåŸºäºMACåœ°å€è½¬å‘å¸§ï¼‰ã€‚</li>
</ul>
<p>ç‰¹ä¾‹ï¼šSOHOè·¯ç”±å™¨çš„internetæ¥å£æ˜¯DTEï¼ŒLANæ¥å£æ˜¯DCEã€‚</p>
<table>
<thead>
<tr>
<th>DTEè®¾å¤‡</th>
<th>DTEè®¾å¤‡</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸»æœºã€è·¯ç”±å™¨ã€æœåŠ¡å™¨</td>
<td>äº¤æ¢æœºã€é›†çº¿å™¨ã€ç½‘æ¡¥ã€ä¸­ç»§å™¨</td>
</tr>
</tbody></table>
<p>å¯ä»¥è®¤ä¸ºï¼š<strong>ç‰©ç†å±‚ä¸æ•°æ®é“¾è·¯å±‚è®¾å¤‡é€šå¸¸å±äºDCE</strong>ï¼Œè€Œ<strong>ç½‘ç»œå±‚åŠä»¥ä¸Šè®¾å¤‡é€šå¸¸å±äºDTE</strong>ã€‚</p>
<p>ç›¸åŒç±»å‹è®¾å¤‡ä¹‹é—´ä½¿ç”¨äº¤å‰çº¿ï¼Œä¸åŒç±»å‹è®¾å¤‡ä¹‹é—´ä½¿ç”¨ç›´é€šçº¿ã€‚</p>
<table>
<thead>
<tr>
<th align="center"><strong>ç‰¹æ€§</strong></th>
<th align="center"><strong>åŸºå¸¦ä¼ è¾“ (Baseband)</strong></th>
<th align="center"><strong>å®½å¸¦ä¼ è¾“ (Broadband)</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>ä¿¡å·ç±»å‹</strong></td>
<td align="center">æ•°å­—ä¿¡å·ï¼ˆç›´æ¥0&#x2F;1è„‰å†²ï¼‰</td>
<td align="center">æ¨¡æ‹Ÿä¿¡å·ï¼ˆè°ƒåˆ¶åé«˜é¢‘è½½æ³¢ï¼‰</td>
</tr>
<tr>
<td align="center"><strong>ä¿¡é“å¤ç”¨</strong></td>
<td align="center">âŒ æ— å¤ç”¨ï¼Œç‹¬å ä¿¡é“</td>
<td align="center">âœ… é¢‘åˆ†å¤ç”¨ï¼ˆFDMï¼‰ï¼Œå¤šè·¯ä¿¡å·å¹¶è¡Œ</td>
</tr>
<tr>
<td align="center"><strong>ä¼ è¾“è·ç¦»</strong></td>
<td align="center">çŸ­ï¼ˆ&lt;500ç±³ï¼‰</td>
<td align="center">é•¿ï¼ˆå¯è¾¾20å…¬é‡Œ+ï¼‰</td>
</tr>
<tr>
<td align="center"><strong>å…¸å‹é€Ÿç‡</strong></td>
<td align="center">10 Mbps ~ 10 Gbpsï¼ˆå—è·ç¦»é™åˆ¶ï¼‰</td>
<td align="center">50 Mbps ~ 1 Gbpsï¼ˆå¤šä¸šåŠ¡å…±äº«æ€»å¸¦å®½ï¼‰</td>
</tr>
<tr>
<td align="center"><strong>è®¾å¤‡éœ€æ±‚</strong></td>
<td align="center">ç½‘å¡ã€äº¤æ¢æœº</td>
<td align="center">è°ƒåˆ¶è§£è°ƒå™¨ã€æ”¾å¤§å™¨ã€åˆ†é¢‘å™¨</td>
</tr>
<tr>
<td align="center"><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td align="center">çŸ­è·ç¦»æ•°å­—é€šä¿¡ï¼ˆå¦‚å±€åŸŸç½‘ï¼‰</td>
<td align="center">é•¿è·ç¦»å¤šä¸šåŠ¡èåˆï¼ˆå¦‚ç”µè§†+äº’è”ç½‘ï¼‰</td>
</tr>
<tr>
<td align="center"><strong>ä»£è¡¨æŠ€æœ¯</strong></td>
<td align="center">10Base-Tä»¥å¤ªç½‘ã€USB</td>
<td align="center">DOCSIS 3.1ï¼ˆæœ‰çº¿å®½å¸¦ï¼‰ã€CATV</td>
</tr>
</tbody></table>
<hr>
<h1 id="å››ã€ç½‘ç»œå±‚"><a href="#å››ã€ç½‘ç»œå±‚" class="headerlink" title="å››ã€ç½‘ç»œå±‚"></a>å››ã€ç½‘ç»œå±‚</h1><p><strong>å­ç½‘æ©ç ä¸å¯ç”¨ä½æ•°çš„å…³ç³»ï¼š</strong><br>å¦‚æœå‰8-nä½ä¸º1ï¼Œånä½ä¸º0çš„æ©ç åè¿›åˆ¶è¡¨ç¤ºä¸º<br>$$<br>2^8-2^n&#x3D;256-2^n<br>$$<br>å¦‚ä¸€ä¸ª192.168.1.0&#x2F;24æŠ½å‡º5ä½åˆ’åˆ†å­ç½‘ï¼Œåˆ™å…¶å­ç½‘æ©ç ç¬¬4éƒ¨åˆ†ä¸º1111 1000 &#x3D; 256 - 8 &#x3D; 248ï¼Œå­ç½‘æ©ç ä¸º255.255.255.248</p>
<p><strong>å·²çŸ¥IPã€æ©ç å¿«é€Ÿæ±‚ç½‘ç»œå·ã€ä¸»æœºå·</strong></p>
<p>ä¾‹é¢˜ï¼šå› ç‰¹ç½‘ä¸ŠæŸä¸»æœºçš„IPåœ°å€ä¸º128.200.68.101ï¼Œå­ç½‘æ©ç ä¸º255.255.255.240ï¼Œè¯¥åœ°å€çš„ä¸»æœºå·ä¸ºï¼Ÿ</p>
<p>æ³•ä¸€ï¼šæ©ç 240ï¼Œ256-240&#x3D;16&#x3D;2^4ï¼Œä¹Ÿå°±æ˜¯å‰4ä¸ºä¸ºç½‘ç»œå·ï¼Œ101-&gt;0110 0101ï¼Œæ•…å…¶ç½‘ç»œå·ä¸º0110 0000å³96ï¼Œä¸»æœºå·ä¸º101-96&#x3D;5ï¼›</p>
<p>æ³•äºŒï¼šæ©ç 240ï¼Œ256-240&#x3D;16ï¼Œ101%16&#x3D;5ï¼Œä¸»æœºå·5ã€‚101&#x2F;16&#x3D;6ï¼ˆå­ç½‘å·ï¼‰ï¼Œç½‘ç»œå·ä¸º16*6&#x3D;96ã€‚</p>
<p>æ³•äºŒçš„åŸç†ï¼šæ±‚101çš„ç½‘ç»œå·å°±ç­‰äºæ±‚å…¶å‰4ä½ï¼Œ101&gt;&gt;4&#x3D;0000 0110ï¼ˆ6ï¼‰ï¼Œ6&lt;&lt;4&#x3D;0110 0000(96)ï¼Œå³ç§»4ä½ç­‰äºæ•´é™¤16ã€‚</p>
<p>åŒæ—¶è¯¥ç½‘ç»œï¼šç½‘ç»œåœ°å€ä¸º128.200.68.96ï¼Œå¯ç”¨ä¸»æœºæ•°ä¸º256-240-2&#x3D;14ï¼ŒèŒƒå›´ä¸º128.200.68.97~128.200.68.110</p>
<p>ç°å°†ä¸€ä¸ªIPç½‘ç»œåˆ’åˆ†ä¸º3ä¸ªå­ç½‘ï¼Œè‹¥å…¶ä¸­ä¸€ä¸ªå­ç½‘æ˜¯192.168.9.128&#x2F;26ï¼Œåˆ™ä¸‹åˆ—ç½‘ç»œä¸­ï¼Œä¸å¯èƒ½æ˜¯å¦å¤–ä¸¤ä¸ªå­ç½‘ä¹‹ä¸€çš„æ˜¯ï¼ˆ  D  ï¼‰ã€‚ </p>
<p>Aã€192.168.9.0&#x2F;25			Bã€192.168.9.192&#x2F;26</p>
<p>Cã€192.168.9.192&#x2F;27		Dã€192.168.9.0&#x2F;26</p>
<p>å°†ä¸€ä¸ªç½‘ç»œåˆ’åˆ†ä¸º3ä¸ªå­ç½‘ï¼Œè¦æ»¡è¶³ä¸€ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>3ä¸ªå­ç½‘äº’ä¸åŒ…å«</li>
<li>3ä¸ªå­ç½‘å¯å®Œå…¨è¦†ç›–åŸç½‘ç»œ</li>
</ul>
<p>åŸç½‘ç»œæœªçŸ¥ï¼Œç”±äº192.168.9.128å±äºCç±»ç½‘ç»œï¼Œæš‚å®šåŸç½‘ç»œä¸º&#x2F;24ï¼Œåˆ™&#x2F;26è¯´æ˜å€Ÿäº†ä¸¤ä½ï¼Œ128ä»£è¡¨10.00 0000ï¼Œå‰ä¸¤ä½æ˜¯10ã€‚</p>
<p>åˆ†æAé€‰é¡¹ï¼š192.168.9.0&#x2F;25 ä»£è¡¨0.000 0000ï¼Œç›¸å½“äºåŒ…å«00å’Œ01ï¼Œåªéœ€ä¸€ä¸ª11å³å¯å®Œæˆè¦†ç›–</p>
<p>åˆ†æBé€‰é¡¹ï¼š192.168.9.192&#x2F;26ä»£è¡¨11.00 0000ï¼Œç›¸å½“äº11ï¼Œåˆšå¥½ä¸Aäº’è¡¥å¯å®Œæˆè¦†ç›–</p>
<p>åˆ†æCé€‰é¡¹ï¼š192.168.9.192&#x2F;27ä»£è¡¨110.0 0000ï¼Œå¦‚æœåŸç½‘ç»œä¸º&#x2F;25ï¼Œé‚£ä¹ˆCä»£è¡¨10ï¼Œ192.168.9.128&#x2F;26ä»£è¡¨0ï¼ˆ00ä¸01ç»“åˆï¼‰ï¼Œåªéœ€ä¸€ä¸ª					  11ï¼Œå³192.168.9.128&#x2F;27</p>
<p>åˆ†æDé€‰é¡¹ï¼š192.168.9.0&#x2F;26ä»£è¡¨00ï¼Œè‡³å°‘è¿˜éœ€è¦11å’Œ01æ‰å¯å®Œå…¨è¦†ç›–ï¼Œè€Œ11å’Œ01ä¸å¯èšåˆï¼Œæ‰€ä»¥ä¸å¯èƒ½ä½¿ç”¨3ä¸ªå­ç½‘æ¥åˆ’åˆ†ï¼ŒDé”™è¯¯</p>
<p> åœ¨ç»™ä¸»æœºè®¾ç½®å…¬ç½‘ IP åœ°å€æ—¶,ä¸‹é¢å››ä¸ªé€‰é¡¹å“ªä¸€ä¸ªèƒ½ä½¿ç”¨ ( A )</p>
<p>Aã€29.9.255.15		Bã€192.5.91.255</p>
<p>Cã€127.21.19.109		Dã€220.103.256.56 (é”™è¯¯åŸå› ï¼š256&gt;255)</p>
<p>ä¸€ä¸ªIPæ•°æ®æŠ¥æ€»é•¿åº¦ä¸º4200å­—èŠ‚(åŒ…å«å›ºå®šé•¿åº¦çš„é¦–éƒ¨)ã€‚ç°åœ¨éœ€è¦ç»è¿‡æŸç‰©ç†ç½‘ç»œä¼ é€,ä½†æ˜¯è¯¥ç½‘ç»œçš„MTU&#x3D;1000å­—èŠ‚ã€‚åˆ™è¯¥æ•°æ®æŠ¥è¢«åˆ†ç‰‡åæœ€åä¸€ä¸ªåˆ†ç‰‡é¦–éƒ¨ä¸­çš„ç‰‡åç§»å­—æ®µçš„å€¼(ç”¨åè¿›åˆ¶è¡¨ç¤º)æ˜¯ï¼ˆ B ï¼‰</p>
<p>Aã€500 	Bã€488</p>
<p>Cã€125	 Dã€122</p>
<p>ipæ•°æ®æŠ¥æ•°æ®é•¿åº¦ä¸º4200-20&#x3D;4180</p>
<p>æ–°æ•°æ®æŠ¥é•¿åº¦ä¸º1000-20&#x3D;980ï¼Œä½†ç‰‡åç§»ä»¥8ä¸ºå•ä½ï¼Œæ•…æ•°æ®æŠ¥é•¿åº¦è¦ä¸º8çš„å€æ•°ï¼Œå‘ä¸‹å–976</p>
<p>[4280&#x2F;976]&#x3D;5ï¼Œ5ä¸ªåˆ†ç»„</p>
<p>ä¸€ä¸ªåˆ†ç»„ç‰‡åç§»ä¸º976&#x2F;8&#x3D;122ï¼Œæ•…4ä¸ªåˆ†ç»„ç‰‡åç§»ä¸º488</p>
<p>è·¯ç”±è¡¨ä¸è½¬å‘è¡¨çš„åŒºåˆ«ï¼š</p>
<table>
<thead>
<tr>
<th><strong>å¯¹æ¯”ç»´åº¦</strong></th>
<th><strong>è·¯ç”±è¡¨ (RIB)</strong></th>
<th><strong>è½¬å‘è¡¨ (FIB)</strong></th>
<th><strong>é‚»æ¥è¡¨ (Adjacency Table)</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ ¸å¿ƒä½œç”¨</strong></td>
<td>å­˜å‚¨<strong>æ‰€æœ‰å·²çŸ¥è·¯ç”±</strong></td>
<td>å­˜å‚¨<strong>è·¯ç”±çš„æœ€ä¼˜è·¯å¾„</strong></td>
<td>å­˜å‚¨<strong>ä¸‹ä¸€è·³ä¸MACçš„æ˜ å°„å…³ç³»</strong></td>
</tr>
<tr>
<td><strong>å·¥ä½œå±‚é¢</strong></td>
<td>æ§åˆ¶å±‚é¢ï¼ˆè½¯ä»¶å†³ç­–ï¼‰</td>
<td>è½¬å‘å±‚é¢ï¼ˆç¡¬ä»¶æ‰§è¡Œï¼‰</td>
<td>æ•°æ®é“¾è·¯å±‚ï¼ˆL2å°è£…ï¼‰</td>
</tr>
<tr>
<td><strong>æ ¸å¿ƒå†…å®¹</strong></td>
<td>ç›®æ ‡ç½‘ç»œ+æ©ç ã€ä¸‹ä¸€è·³IPã€ç®¡ç†è·ç¦»ã€åº¦é‡å€¼ã€è·¯ç”±æ¥æº</td>
<td>ç›®æ ‡ç½‘ç»œ+æ©ç ã€<strong>å‡ºæ¥å£</strong>ã€ä¸‹ä¸€è·³IPã€<strong>é‚»æ¥è¡¨æŒ‡é’ˆ</strong></td>
<td><strong>ä¸‹ä¸€è·³IP</strong>ã€<strong>å‡ºæ¥å£</strong>ã€<strong>ç›®æ ‡MACåœ°å€</strong></td>
</tr>
<tr>
<td><strong>ç”Ÿæˆæ–¹å¼</strong></td>
<td>è·¯ç”±åè®®ã€é™æ€é…ç½®ã€ç›´è¿ç½‘ç»œ</td>
<td>ä»è·¯ç”±è¡¨<strong>æå–æœ€ä¼˜è·¯å¾„</strong>ä¼˜åŒ–ç”Ÿæˆ</td>
<td>ARPï¼ˆIPv4ï¼‰ã€æ‰‹åŠ¨é…ç½®</td>
</tr>
<tr>
<td><strong>æ›´æ–°é¢‘ç‡</strong></td>
<td>è¾ƒé«˜ï¼ˆè·¯ç”±å˜åŒ–æ—¶æ›´æ–°ï¼‰</td>
<td>è¾ƒä½ï¼ˆè·¯ç”±è¡¨æœ€ä¼˜è·¯å¾„å˜åŒ–æ—¶ï¼‰</td>
<td>æœ€ä½ï¼ˆARPç¼“å­˜è¶…æ—¶â€”â€”20minã€é“¾è·¯çŠ¶æ€å˜åŒ–ï¼‰</td>
</tr>
<tr>
<td><strong>æ€§èƒ½è¦æ±‚</strong></td>
<td>ä¸­ï¼ˆCPUå¤„ç†ï¼‰</td>
<td><strong>æé«˜</strong>ï¼ˆç¡¬ä»¶TCAM&#x2F;ASICçº¿é€ŸæŸ¥æ‰¾ï¼‰</td>
<td>é«˜ï¼ˆéœ€ä¸FIBååŒå¿«é€Ÿå°è£…ï¼‰</td>
</tr>
<tr>
<td><strong>å­˜å‚¨ä½ç½®</strong></td>
<td>æ§åˆ¶å¤„ç†å™¨å†…å­˜</td>
<td>ä¸“ç”¨ç¡¬ä»¶ï¼ˆTCAM&#x2F;ASICï¼‰</td>
<td>ç¡¬ä»¶æˆ–é«˜é€Ÿå†…å­˜</td>
</tr>
<tr>
<td><strong>å…³é”®å†³ç­–</strong></td>
<td><strong>â€œæ•°æ®åŒ…åº”è¯¥å»å“ªï¼Ÿâ€</strong>ï¼ˆé€‰æ‹©è·¯å¾„ï¼‰</td>
<td><strong>â€œä»å“ªä¸ªæ¥å£å‘å‡ºï¼Ÿâ€</strong>ï¼ˆæ‰§è¡Œè½¬å‘ï¼‰</td>
<td><strong>â€œå¦‚ä½•å°è£…æ•°æ®å¸§ï¼Ÿâ€</strong>ï¼ˆè§£å†³L2å¯»å€ï¼‰</td>
</tr>
<tr>
<td><strong>ç±»æ¯”</strong></td>
<td>ä¸–ç•Œåœ°å›¾ï¼ˆå«æ‰€æœ‰è·¯çº¿ï¼‰</td>
<td>å¯¼èˆªè·¯çº¿ï¼ˆæœ€ä¼˜è·¯å¾„æŒ‡å¼•ï¼‰</td>
<td>æœ¬åœ°é€šè®¯å½•ï¼ˆä¸‹ä¸€è·³è”ç³»æ–¹å¼ï¼‰</td>
</tr>
</tbody></table>
<p>è·¯ç”±ç®—æ³•åˆ›å»ºè·¯ç”±è¡¨-&gt;è·¯ç”±è¡¨ä¸­æŒ‘å‡ºåˆ°å„ç½‘ç»œæœ€ä¼˜çš„è·¯å¾„ç»„æˆè½¬å‘è¡¨</p>
<p>åˆ†ç»„åˆ°è¾¾-&gt;æ ¹æ®è½¬å‘è¡¨æ‰¾ä¸‹ä¸€è·³å’Œæ¥å£-&gt;é‚»æ¥è¡¨å°†ä¸‹ä¸€æ¡IPè½¬æ¢ä¸ºMACåœ°å€-&gt;å‘åŒ…</p>
<table>
<thead>
<tr>
<th><strong>ç»´åº¦</strong></th>
<th><strong>RIP</strong></th>
<th><strong>OSPF</strong></th>
<th><strong>BGP</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç®—æ³•</strong></td>
<td><strong>è·ç¦»å‘é‡</strong></td>
<td><strong>é“¾è·¯çŠ¶æ€</strong></td>
<td><strong>è·¯å¾„å‘é‡</strong></td>
</tr>
<tr>
<td><strong>åè®®ç±»å‹</strong></td>
<td>IGPï¼ˆå†…éƒ¨ç½‘å…³åè®®ï¼‰</td>
<td>IGPï¼ˆå†…éƒ¨ç½‘å…³åè®®ï¼‰</td>
<td>EGPï¼ˆå¤–éƒ¨ç½‘å…³åè®®ï¼‰</td>
</tr>
<tr>
<td><strong>åè®®å±‚çº§</strong></td>
<td><strong>åº”ç”¨å±‚ï¼ˆUDP 520 ç«¯å£ï¼‰</strong></td>
<td><strong>ç½‘ç»œå±‚ï¼ˆIP åè®®å· 89ï¼‰</strong></td>
<td><strong>åº”ç”¨å±‚ï¼ˆTCP 179 ç«¯å£ï¼‰</strong></td>
</tr>
<tr>
<td><strong>è®¾è®¡ç›®æ ‡</strong></td>
<td>å°å‹ç½‘ç»œç®€å•è·¯ç”±</td>
<td>å¤§å‹ç½‘ç»œå¿«é€Ÿæ”¶æ•›ä¸åˆ†å±‚è®¾è®¡</td>
<td>è·¨è‡ªæ²»ç³»ç»Ÿï¼ˆASï¼‰çš„ç­–ç•¥è·¯ç”±</td>
</tr>
<tr>
<td><strong>åº¦é‡æ ‡å‡†</strong></td>
<td>è·³æ•°ï¼Œæœ€å¤§ 15 è·³</td>
<td>é“¾è·¯å¼€é”€</td>
<td>AS è·¯å¾„é•¿åº¦ã€æ”¿æ²»ç­‰å±æ€§</td>
</tr>
<tr>
<td><strong>æ›´æ–°æœºåˆ¶</strong></td>
<td>æ¯ 30 ç§’å‘é‚»å±…å‘é€å®Œæ•´è·¯ç”±è¡¨</td>
<td>è§¦å‘æ›´æ–°ï¼ˆæ‹“æ‰‘å˜åŒ–æ—¶æ´ªæ³› LSAï¼‰</td>
<td>è§¦å‘æ›´æ–° + å¢é‡æ›´æ–°</td>
</tr>
<tr>
<td><strong>æ”¶æ•›é€Ÿåº¦</strong></td>
<td>æ…¢ï¼ˆåˆ†é’Ÿçº§ï¼‰</td>
<td>å¿«ï¼ˆç§’çº§ï¼‰</td>
<td>ææ…¢ï¼ˆåˆ†é’Ÿåˆ°å°æ—¶çº§ï¼‰</td>
</tr>
<tr>
<td><strong>é˜²ç¯æœºåˆ¶</strong></td>
<td>è·³æ•°é™åˆ¶</td>
<td>SPF ç®—æ³•ï¼ˆåŸºäºæ‹“æ‰‘çš„æ— ç¯è®¡ç®—ï¼‰</td>
<td>AS_PATH å±æ€§ï¼ˆä¸¢å¼ƒå«è‡ªèº« AS çš„è·¯ç”±ï¼‰</td>
</tr>
<tr>
<td><strong>ç½‘ç»œè§„æ¨¡æ”¯æŒ</strong></td>
<td>æå°ï¼ˆâ‰¤15 è·³ï¼‰</td>
<td>å¤§ï¼ˆé€šè¿‡åŒºåŸŸåˆ’åˆ†æ‰©å±•ï¼‰</td>
<td>æå¤§ï¼ˆäº’è”ç½‘çº§è·¯ç”±è¡¨ï¼‰</td>
</tr>
<tr>
<td><strong>é…ç½®å¤æ‚åº¦</strong></td>
<td>ç®€å•ï¼ˆæ— éœ€æ‹“æ‰‘è§„åˆ’ï¼‰</td>
<td>å¤æ‚ï¼ˆéœ€è®¾è®¡åŒºåŸŸã€DR&#x2F;BDRï¼‰</td>
<td>æå¤æ‚ï¼ˆç­–ç•¥å®šåˆ¶ã€é‚»å±…ç®¡ç†ï¼‰</td>
</tr>
<tr>
<td><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td>
<td>å°å‹ä¼ä¸šåˆ†æ”¯ã€ä¸´æ—¶ç½‘ç»œ</td>
<td>ä¼ä¸šå†…ç½‘ã€æ•°æ®ä¸­å¿ƒå†…éƒ¨</td>
<td>ISP äº’è”ã€è·¨å›½ä¼ä¸šè·¨ AS è·¯ç”±</td>
</tr>
</tbody></table>
<p>OSPFä¸­è·¯ç”±å™¨è·å¾—çš„è·¯ç”±ä¿¡æ¯æ˜¯ï¼šæœ¬åŒºåŸŸå®Œæ•´æ‹“æ‰‘å›¾ + å…¶ä»–åŒºåŸŸè·¯ç”±æ‘˜è¦ï¼Œç”±äºOSPFä½¿ç”¨ç»„æ’­åœ°å€ï¼Œæ•…å…¶æ´ªæ³›åªåœ¨åŒºåŸŸå†…ã€‚</p>
<p>35.(å•é€‰é¢˜)OSPFåè®®å¯ä»¥æœ‰æ•ˆçš„è§£å†³è·¯ç”±è‡ªç¯çš„é—®é¢˜,ä¸‹é¢å“ªä¸€æ¡æ— æ³•è§£é‡Šè¿™ä¸€ç‚¹()<br>Aã€OSPFæ”¯æŒè·¯ç”±éªŒè¯         		 Bã€OSPFä½¿ç”¨é“¾è·¯çŠ¶æ€è·¯ç”±ç®—æ³•<br>Cã€OSPFä½¿ç”¨äº†éª¨å¹²åŒºåŸŸ	  		Dã€å½“å…¶ä»–åŒºåŸŸæ— æ³•å’Œéª¨å¹²åŒºåŸŸç‰©ç†ç›´è¿æ˜¯ï¼ŒOSPFå¯ä»¥ä½¿ç”¨è™šè¿æ¥</p>
<p>Aï¼šè·¯ç”±éªŒè¯æ˜¯é€šè¿‡å¯†ç æˆ–å¯†é’¥éªŒè¯è·¯ç”±æ›´æ–°çš„æ¥æºï¼Œé˜²æ­¢æ¶æ„è·¯ç”±ï¼Œä¸é˜²ç¯æ— å…³</p>
<p>Bï¼šæ¯ä¸ªè·¯ç”±å™¨ç»´æŠ¤æ•´ä¸ªç½‘ç»œçš„é“¾è·¯çŠ¶æ€æ•°æ®åº“ï¼Œå¹¶ç‹¬ç«‹è®¡ç®—æœ€çŸ­è·¯å¾„æ ‘ï¼Œç¡®ä¿è·¯å¾„æ— ç¯</p>
<p>Cï¼šæ‰€æœ‰å…¶ä»–åŒºåŸŸå¿…é¡»ç›´æ¥æˆ–é—´æ¥è¿æ¥åˆ°éª¨å¹²åŒºåŸŸã€‚åˆ†å±‚ç»“æ„é¿å…åŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨é—´å½¢æˆç¯è·¯</p>
<p>Dï¼šä¸Cç›¸åŒï¼Œåˆ†å±‚ç»“æ„é¿å…åŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨é—´å½¢æˆç¯è·¯</p>
<hr>
<h1 id="äº”ã€ä¼ è¾“å±‚"><a href="#äº”ã€ä¼ è¾“å±‚" class="headerlink" title="äº”ã€ä¼ è¾“å±‚"></a>äº”ã€ä¼ è¾“å±‚</h1><hr>
<h1 id="å…­ã€åº”ç”¨å±‚"><a href="#å…­ã€åº”ç”¨å±‚" class="headerlink" title="å…­ã€åº”ç”¨å±‚"></a>å…­ã€åº”ç”¨å±‚</h1><hr>
<h1 id="å®éªŒï¼š"><a href="#å®éªŒï¼š" class="headerlink" title="å®éªŒï¼š"></a>å®éªŒï¼š</h1><p>DHCPä¸­ç»§ä»£ç†ï¼ˆè®©è·¯ç”±å™¨å°†å¤–éƒ¨å¹¿æ’­åŒ…è½¬å‘åˆ°æœåŠ¡å™¨ï¼‰ï¼šip helper-address +æœåŠ¡å™¨ip</p>
<p>DNSå®éªŒä¸­ï¼š</p>
<ul>
<li>åŸŸå	A-record	ip</li>
<li>åŸŸå	NS-record	æƒå¨åŸŸåæœåŠ¡å™¨</li>
<li>åˆ«å	C-NAME	åŸåŸŸå</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>èœ€é“å±±wp</title>
    <url>/posts/46980/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h2 id="Map-Maze"><a href="#Map-Maze" class="headerlink" title="Map_Maze"></a>Map_Maze</h2><p>éå¸¸å¥½çš„ä¸€é“è¿·å®«é¢˜ï¼Œå‡»ç¢äº†æˆ‘å¯¹æŒ‡é’ˆçš„è‡ªä¿¡~~</p>
<p>ä¸»å‡½æ•°ï¼š</p>
<img src="/posts/46980/image-20241203205913912.png" class="" title="image-20241203205913912">

<p>ä½†æ˜¯å»ºå›¾å‡½æ•°å’Œåˆ¤æ–­å‡½æ•°æå…¶æŠ½è±¡ã€‚å»ºå›¾å‡½æ•°å…ˆæˆªå–ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __cdecl create_map(_DWORD *a1, _DWORD *a2)</span><br><span class="line">&#123;</span><br><span class="line">  for ( i = 0; i &lt; 15; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    for ( j = 0; j &lt; 15; ++j )</span><br><span class="line">      v5[15 * i + j] = sub_401080(0);   //å…ˆåˆ†é…255ä¸ªç©ºé—´ï¼ˆä¸è¿ç»­çš„ï¼‰ï¼Œåœ°å€ä½œä¸ºæ•°ç»„v5çš„å…ƒç´ ï¼ˆå®é™…è¶Šç•Œåˆ°äº†v6ï¼‰</span><br><span class="line">  &#125;</span><br><span class="line">  for ( k = 1; k &lt; 15; ++k )</span><br><span class="line">    *(_DWORD *)v5[k] = 1;        //è¿™é‡Œçš„èµ‹å€¼æ˜¯å–v5[i]çš„å€¼è½¬åŒ–ä¸ºæŒ‡é’ˆï¼Œå°†æŒ‡é’ˆæŒ‡å‘çš„åœ°å€èµ‹å€¼ä¸º1ï¼ˆæˆ–0ï¼‰</span><br><span class="line">  for ( m = 9; m &lt; 15; ++m )</span><br><span class="line">    *(_DWORD *)v5[m + 15] = 1;</span><br><span class="line">    ......      //çœç•¥äº†ä¸­é—´çš„èµ‹å€¼ç¯èŠ‚</span><br><span class="line">    ......</span><br><span class="line">  for ( i27 = 13; i27 &lt; 15; ++i27 )</span><br><span class="line">    *(_DWORD *)v6[i27 + 90] = 1;</span><br><span class="line">  for ( i28 = 0; i28 &lt; 12; ++i28 )</span><br><span class="line">    *(_DWORD *)v6[i28 + 105] = 1;</span><br><span class="line">  for ( i29 = 0; i29 &lt; 15; ++i29 )     //è¿™ä¸ªåŒå¾ªç¯æ˜¯é‡å¤´æˆï¼š</span><br><span class="line">  &#123;</span><br><span class="line">    for ( i30 = 0; i30 &lt; 15; ++i30 )     </span><br><span class="line">    &#123;     //ä¸ºäº†æ–¹ä¾¿è¡¨ç¤ºï¼Œæˆ‘å°†*v5[15 * i29 + i30]å†™ä¸ºa[],ä¹Ÿå°±æ˜¯æŒ‡é’ˆaç­‰äºv5å¯¹åº”ä¸‹æ ‡çš„å…ƒç´ è½¬åŒ–ä¸ºçš„æŒ‡é’ˆ</span><br><span class="line">      if ( i29 &gt; 0 )    //i29&gt;0ï¼Œè¯´æ˜ä¸åœ¨ç¬¬ä¸€è¡Œï¼Œæ„å‘³ç€ä¸Šæ–¹å…ƒç´ å­˜åœ¨</span><br><span class="line">        *(_DWORD *)(v5[15 * i29 + i30] + 4) = v5[15 * i29 - 15 + i30];  //å°†ä¸Šæ–¹å…ƒç´ çš„åœ°å€èµ‹å€¼ç»™a[1]</span><br><span class="line">      if ( i29 &lt; 14 )   //ä¸åœ¨æœ€åä¸€è¡Œï¼Œå³ä¸‹æ–¹å…ƒç´ å­˜åœ¨</span><br><span class="line">        *(_DWORD *)(v5[15 * i29 + i30] + 8) = v5[15 * i29 + 15 + i30];  //å°†ä¸‹æ–¹å…ƒç´ çš„åœ°å€èµ‹å€¼ç»™a[2]</span><br><span class="line">      if ( i30 &gt; 0 )</span><br><span class="line">        *(_DWORD *)(v5[15 * i29 + i30] + 12) = v5[15 * i29 - 1 + i30];  //å°†å·¦æ–¹å…ƒç´ çš„åœ°å€èµ‹å€¼ç»™a[3]</span><br><span class="line">      if ( i30 &lt; 14 )</span><br><span class="line">        *(_DWORD *)(v5[15 * i29 + i30] + 16) = v5[15 * i29 + 1 + i30];  //å°†å³æ–¹å…ƒç´ çš„åœ°å€èµ‹å€¼ç»™a[4]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;       //ä¸‹é¢æ˜¯å®šä¹‰èµ·ç‚¹å’Œç»ˆç‚¹</span><br><span class="line">  v2 = (_DWORD *)v5[0];      //å…ˆå–å‡ºv5ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè½¬åŒ–ä¸ºåœ°å€èµ‹å€¼ç»™v2</span><br><span class="line">  *a1 = *(_DWORD *)v5[0];    //a1æ˜¯èµ·ç‚¹ï¼Œå°†V5ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘çš„å€¼ä¼ ç»™a1æŒ‡å‘çš„åœ°å€ï¼ˆä¼ çš„æ˜¯1æˆ–0ï¼‰</span><br><span class="line">  a1[1] = v2[1];     		 //å°†v2[1]ï¼ˆå¯¹åº”å‰é¢åŒå¾ªç¯èµ‹å€¼çš„ä¸Šæ–¹å…ƒç´ ï¼‰èµ‹å€¼ç»™a1[1]</span><br><span class="line">  a1[2] = v2[2];			 //å°†v2[2]ï¼ˆå¯¹åº”å‰é¢åŒå¾ªç¯èµ‹å€¼çš„ä¸‹æ–¹å…ƒç´ ï¼‰èµ‹å€¼ç»™a1[2]</span><br><span class="line">  a1[3] = v2[3];			 //å°†v2[3]ï¼ˆå¯¹åº”å‰é¢åŒå¾ªç¯èµ‹å€¼çš„å·¦æ–¹å…ƒç´ ï¼‰èµ‹å€¼ç»™a1[3]</span><br><span class="line">  a1[4] = v2[4];			 //å°†v2[4]ï¼ˆå¯¹åº”å‰é¢åŒå¾ªç¯èµ‹å€¼çš„å³æ–¹å…ƒç´ ï¼‰èµ‹å€¼ç»™a1[4]</span><br><span class="line">  v3 = v7;		//ä¸‹é¢å°±æ˜¯å®šä¹‰ç»ˆç‚¹äº†ï¼Œé€»è¾‘ä¸å®šä¹‰èµ·ç‚¹ç›¸åŒ</span><br><span class="line">  *a2 = *v7;</span><br><span class="line">  a2[1] = v3[1];</span><br><span class="line">  a2[2] = v3[2];</span><br><span class="line">  a2[3] = v3[3];</span><br><span class="line">  result = v3[4];</span><br><span class="line">  a2[4] = result;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>a[0]å¤„å­˜çš„æ˜¯v5[i]æŒ‡å‘çš„åœ°å€çš„å€¼ï¼ˆ0æˆ–1ï¼‰ï¼Œa[1]~a[4]æ­£å¸¸æƒ…å†µå¡«çš„éƒ½æ˜¯åœ°å€ï¼Œå¦‚æœä¸Šä¸‹å·¦å³å¯¹åº”çš„åœ°æ–¹ï¼ˆåœ°å›¾v5é‡Œé¢ï¼‰ä¸å­˜åœ¨å€¼çš„è¯å°±ä¸ç”¨å¡«å…¥åœ°å€</p>
<p>![å±å¹•æˆªå›¾ 2024-12-03 222145](.&#x2F;èœ€é“å±±wp&#x2F;å±å¹•æˆªå›¾ 2024-12-03 222145.png)</p>
<p>åˆ¤æ–­å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">char __cdecl judge_path(_DWORD *a1, _DWORD *a2, int a3)  //a1æ˜¯ä½ç½®ï¼Œa2æ˜¯ç»ˆç‚¹ï¼Œa3æ˜¯è¾“å…¥</span><br><span class="line">&#123;</span><br><span class="line">  for ( i = 0; *(_BYTE *)(i + a3); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( *(_BYTE *)(i + a3) == &#x27;U&#x27; &amp;&amp; a1[1] &amp;&amp; !*(_DWORD *)a1[1] )   //è¾“å…¥&quot;U&quot;ä¸”ä¸Šæ–¹å…ƒç´ å­˜åœ¨</span><br><span class="line">    &#123;</span><br><span class="line">      a1 = (_DWORD *)a1[1];     //a1[1]å­˜çš„æ˜¯å…¶ä¸Šæ–¹çš„åœ°å€</span><br><span class="line">    &#125;</span><br><span class="line">    else if ( *(_BYTE *)(i + a3) == &#x27;D&#x27; &amp;&amp; a1[2] &amp;&amp; !*(_DWORD *)a1[2] )   //&quot;D&quot;åˆ™å–å…¶ä¸‹æ–¹çš„åœ°å€</span><br><span class="line">    &#123;</span><br><span class="line">      a1 = (_DWORD *)a1[2];   </span><br><span class="line">    &#125;</span><br><span class="line">    else if ( *(_BYTE *)(i + a3) == &#x27;L&#x27; &amp;&amp; a1[3] &amp;&amp; !*(_DWORD *)a1[3] )</span><br><span class="line">    &#123;</span><br><span class="line">      a1 = (_DWORD *)a1[3];     //a1[3]å­˜çš„æ˜¯å…¶å·¦æ–¹çš„åœ°å€</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      if ( *(_BYTE *)(i + a3) != &#x27;R&#x27; || !a1[4] || *(_DWORD *)a1[4] )</span><br><span class="line">        return 0;</span><br><span class="line">      a1 = (_DWORD *)a1[4];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  result = (char)a2;</span><br><span class="line">  if ( a1[2] == a2[2] )    //ä¸‹é¢æ˜¯åˆ¤æ–­å…¶ä¸Šä¸‹å·¦å³çš„å€¼æ˜¯å¦å¯¹çš„ä¸Šï¼Œå¦‚æœå¯¹çš„ä¸Šï¼Œè¿™è¿”å›1</span><br><span class="line">  &#123;</span><br><span class="line">    result = (char)a2;</span><br><span class="line">    if ( a1[1] == a2[1] )</span><br><span class="line">    &#123;</span><br><span class="line">      result = (char)a2;</span><br><span class="line">      if ( a1[3] == a2[3] )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (char)a2;</span><br><span class="line">        if ( a1[4] == a2[4] )</span><br><span class="line">          return 1;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥çœŸæ­£çš„åœ°å›¾å°±æ˜¯v5[i]æŒ‡å‘çš„ä½ç½®æ±‡æˆçš„ä¸€å¼ 15x15çš„åœ°å›¾ï¼Œç”±0å’Œ1æ„æˆã€‚</p>
<p>æ€ä¹ˆæå–å‡ºåœ°å›¾æ¥å‘¢ï¼Ÿå¯ä»¥æŠŠä¼ªä»£ç å¤åˆ¶ä¿®æ”¹å†è¿è¡Œä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">int main()&#123;</span><br><span class="line">  int i28; // [esp+384h] [ebp-A0h]</span><br><span class="line">  int i27; // [esp+388h] [ebp-9Ch]</span><br><span class="line">  int i26; // [esp+38Ch] [ebp-98h]</span><br><span class="line">  int i25; // [esp+390h] [ebp-94h]</span><br><span class="line">  int i24; // [esp+394h] [ebp-90h]</span><br><span class="line">  int i23; // [esp+398h] [ebp-8Ch]</span><br><span class="line">  int i22; // [esp+39Ch] [ebp-88h]</span><br><span class="line">  int i21; // [esp+3A0h] [ebp-84h]</span><br><span class="line">  int i20; // [esp+3A4h] [ebp-80h]</span><br><span class="line">  int i19; // [esp+3A8h] [ebp-7Ch]</span><br><span class="line">  int i18; // [esp+3ACh] [ebp-78h]</span><br><span class="line">  int i17; // [esp+3B0h] [ebp-74h]</span><br><span class="line">  int i16; // [esp+3B4h] [ebp-70h]</span><br><span class="line">  int i15; // [esp+3B8h] [ebp-6Ch]</span><br><span class="line">  int i14; // [esp+3BCh] [ebp-68h]</span><br><span class="line">  int i13; // [esp+3C0h] [ebp-64h]</span><br><span class="line">  int i12; // [esp+3C4h] [ebp-60h]</span><br><span class="line">  int i11; // [esp+3C8h] [ebp-5Ch]</span><br><span class="line">  int i10; // [esp+3CCh] [ebp-58h]</span><br><span class="line">  int i9; // [esp+3D0h] [ebp-54h]</span><br><span class="line">  int i8; // [esp+3D4h] [ebp-50h]</span><br><span class="line">  int i7; // [esp+3D8h] [ebp-4Ch]</span><br><span class="line">  int i6; // [esp+3DCh] [ebp-48h]</span><br><span class="line">  int i5; // [esp+3E0h] [ebp-44h]</span><br><span class="line">  int i4; // [esp+3E4h] [ebp-40h]</span><br><span class="line">  int i3; // [esp+3E8h] [ebp-3Ch]</span><br><span class="line">  int i2; // [esp+3ECh] [ebp-38h]</span><br><span class="line">  int i1; // [esp+3F0h] [ebp-34h]</span><br><span class="line">  int nn; // [esp+3F4h] [ebp-30h]</span><br><span class="line">  int mm; // [esp+3F8h] [ebp-2Ch]</span><br><span class="line">  int kk; // [esp+3FCh] [ebp-28h]</span><br><span class="line">  int jj; // [esp+400h] [ebp-24h]</span><br><span class="line">  int ii; // [esp+404h] [ebp-20h]</span><br><span class="line">  int n; // [esp+408h] [ebp-1Ch]</span><br><span class="line">  int m; // [esp+40Ch] [ebp-18h]</span><br><span class="line">  int k; // [esp+410h] [ebp-14h]</span><br><span class="line">  int j; // [esp+414h] [ebp-10h]</span><br><span class="line">  int i; // [esp+418h] [ebp-Ch]</span><br><span class="line">  int i30; // [esp+41Ch] [ebp-8h]</span><br><span class="line">  int i29; // [esp+420h] [ebp-4h]</span><br><span class="line">    int maze[225]=&#123;0&#125;;</span><br><span class="line">    int *v5=maze;</span><br><span class="line">    int *v6=maze+105;</span><br><span class="line">  for ( k = 1; k &lt; 15; ++k )</span><br><span class="line">    v5[k] = 1;</span><br><span class="line">  for ( m = 9; m &lt; 15; ++m )</span><br><span class="line">    v5[m + 15] = 1;</span><br><span class="line">  for ( n = 0; n &lt; 2; ++n )</span><br><span class="line">    v5[n + 30] = 1;</span><br><span class="line">  for ( ii = 3; ii &lt; 8; ++ii )</span><br><span class="line">    v5[ii + 30] = 1;</span><br><span class="line">  for ( jj = 9; jj &lt; 15; ++jj )</span><br><span class="line">    v5[jj + 30] = 1;</span><br><span class="line">  for ( kk = 0; kk &lt; 2; ++kk )</span><br><span class="line">    v5[kk + 45] = 1;</span><br><span class="line">  for ( mm = 3; mm &lt; 8; ++mm )</span><br><span class="line">    v5[mm + 45] = 1;</span><br><span class="line">  for ( nn = 12; nn &lt; 15; ++nn )</span><br><span class="line">    v5[nn + 45] = 1;</span><br><span class="line">  for ( i1 = 0; i1 &lt; 2; ++i1 )</span><br><span class="line">    v5[i1 + 60] = 1;</span><br><span class="line">  for ( i2 = 7; i2 &lt; 10; ++i2 )</span><br><span class="line">    v5[i2 + 60] = 0;</span><br><span class="line">  v5[67] = 1;</span><br><span class="line">  for ( i3 = 11; i3 &lt; 15; ++i3 )</span><br><span class="line">    v5[i3 + 60] = 1;</span><br><span class="line">  for ( i4 = 0; i4 &lt; 2; ++i4 )</span><br><span class="line">    v5[i4 + 75] = 1;</span><br><span class="line">  for ( i5 = 3; i5 &lt; 6; ++i5 )</span><br><span class="line">    v5[i5 + 75] = 1;</span><br><span class="line">  for ( i6 = 11; i6 &lt; 15; ++i6 )</span><br><span class="line">    v5[i6 + 75] = 1;</span><br><span class="line">  for ( i7 = 0; i7 &lt; 2; ++i7 )</span><br><span class="line">    v5[i7 + 90] = 1;</span><br><span class="line">  v5[92] = 0;</span><br><span class="line">  for ( i8 = 3; i8 &lt; 6; ++i8 )</span><br><span class="line">    v5[i8 + 90] = 1;</span><br><span class="line">  for ( i9 = 7; i9 &lt; 10; ++i9 )</span><br><span class="line">    v5[i9 + 90] = 1;</span><br><span class="line">  for ( i10 = 11; i10 &lt; 15; ++i10 )</span><br><span class="line">    v5[i10 + 90] = 1;</span><br><span class="line">  v6[0] = 1;</span><br><span class="line">  v6[1] = 0;</span><br><span class="line">  v6[2] = 0;</span><br><span class="line">  v6[3] = 1;</span><br><span class="line">  for ( i11 = 4; i11 &lt; 6; ++i11 )</span><br><span class="line">    v6[i11] = 1;</span><br><span class="line">  for ( i12 = 7; i12 &lt; 10; ++i12 )</span><br><span class="line">    v6[i12] = 1;</span><br><span class="line">  for ( i13 = 11; i13 &lt; 15; ++i13 )</span><br><span class="line">    v6[i13] = 1;</span><br><span class="line">  for ( i14 = 0; i14 &lt; 2; ++i14 )</span><br><span class="line">    v6[i14 + 15] = 1;</span><br><span class="line">  for ( i15 = 7; i15 &lt; 10; ++i15 )</span><br><span class="line">    v6[i15 + 15] = 1;</span><br><span class="line">  for ( i16 = 11; i16 &lt; 15; ++i16 )</span><br><span class="line">    v6[i16 + 15] = 1;</span><br><span class="line">  for ( i17 = 0; i17 &lt; 6; ++i17 )</span><br><span class="line">    v6[i17 + 30] = 1;</span><br><span class="line">  for ( i18 = 7; i18 &lt; 10; ++i18 )</span><br><span class="line">    v6[i18 + 30] = 1;</span><br><span class="line">  for ( i19 = 11; i19 &lt; 15; ++i19 )</span><br><span class="line">    v6[i19 + 30] = 1;</span><br><span class="line">  for ( i20 = 0; i20 &lt; 6; ++i20 )</span><br><span class="line">    v6[i20 + 45] = 1;</span><br><span class="line">  for ( i21 = 11; i21 &lt; 15; ++i21 )</span><br><span class="line">    v6[i21 + 45] = 1;</span><br><span class="line">  for ( i22 = 0; i22 &lt; 9; ++i22 )</span><br><span class="line">    v6[i22 + 60] = 1;</span><br><span class="line">  for ( i23 = 13; i23 &lt; 15; ++i23 )</span><br><span class="line">    v6[i23 + 60] = 1;</span><br><span class="line">  for ( i24 = 0; i24 &lt; 9; ++i24 )</span><br><span class="line">    v6[i24 + 75] = 1;</span><br><span class="line">  v6[84] = 0;</span><br><span class="line">  v6[85] = 1;</span><br><span class="line">  v6[86] = 1;</span><br><span class="line">  v6[87] = 0;</span><br><span class="line">  for ( i25 = 13; i25 &lt; 15; ++i25 )</span><br><span class="line">    v6[i25 + 75] = 1;</span><br><span class="line">  for ( i26 = 0; i26 &lt; 9; ++i26 )</span><br><span class="line">    v6[i26 + 90] = 1;</span><br><span class="line">  v6[99] = 0;</span><br><span class="line">  v6[100] = 1;</span><br><span class="line">  v6[101] = 1;</span><br><span class="line">  v6[102] = 0;</span><br><span class="line">  for ( i27 = 13; i27 &lt; 15; ++i27 )</span><br><span class="line">    v6[i27 + 90] = 1;</span><br><span class="line">  for ( i28 = 0; i28 &lt; 12; ++i28 )</span><br><span class="line">    v6[i28 + 105] = 1;</span><br><span class="line">  for(i=0;i&lt;15;i++)&#123;</span><br><span class="line">    for(j=0;j&lt;15;j++)&#123;</span><br><span class="line">        if(maze[i*15+j]==0) printf(&quot;  &quot;);   //è¿™é‡Œä¸æ‰“å°0å’Œ1æ˜¯ä¸ºäº†è®©æ‰“å°å‡ºåœ°å›¾æ›´å¥½çœ‹</span><br><span class="line">        else printf(&quot;o &quot;,maze[i*15+j]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  o o o o o o o o o o o o o o </span><br><span class="line">                  o o o o o o</span><br><span class="line">o o   o o o o o   o o o o o o</span><br><span class="line">o o   o o o o o         o o o</span><br><span class="line">o o           o       o o o o</span><br><span class="line">o o   o o o           o o o o</span><br><span class="line">o o   o o o   o o o   o o o o</span><br><span class="line">o     o o o   o o o   o o o o</span><br><span class="line">o o           o o o   o o o o</span><br><span class="line">o o o o o o   o o o   o o o o</span><br><span class="line">o o o o o o           o o o o</span><br><span class="line">o o o o o o o o o         o o</span><br><span class="line">o o o o o o o o o   o o   o o</span><br><span class="line">o o o o o o o o o   o o   o o</span><br><span class="line">o o o o o o o o o o o o</span><br></pre></td></tr></table></figure>

<p>è·¯å¾„ï¼šDRRDDDDDDDRRRRDDRRRDRRRDDDRR</p>
<p>md5ç»“æœï¼š1979869e0c4ef6c542e54ae5c48f63ec</p>
<p>flagï¼šLZSDS{1979869e0c4ef6c542e54ae5c48f63ec}</p>
]]></content>
      <categories>
        <category>wp</category>
      </categories>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>è°ƒç”¨.exeçˆ†ç ´</title>
    <url>/posts/64193/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h3 id="å¼•å…¥ï¼š"><a href="#å¼•å…¥ï¼š" class="headerlink" title="å¼•å…¥ï¼š"></a>å¼•å…¥ï¼š</h3><p>CISCNçš„ä¸€ä¸ªé¢˜åŒ…å«ä¸€ä¸ª.exeæ–‡ä»¶ï¼ˆåŠ å¯†ï¼‰å’Œä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆå­˜æ”¾å¯†æ–‡ï¼‰ï¼Œç”±äº.exeæ–‡ä»¶é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœç›´æ¥è¿›è¡Œé€†å‘æ¥æ¨å‡ºflagçš„è¯ï¼Œæ¯”è¾ƒéš¾ï¼Œäºæ˜¯å¯ä»¥ç”¨pythonçš„subprocessæ¨¡å—æ¥è°ƒç”¨.exeæ–‡ä»¶è¿›è¡Œé€ä¸ªå­—ç¬¦çˆ†ç ´ã€‚</p>
<p>.exeæ–‡ä»¶ä¸»è¦ä½œç”¨ï¼šæ¯æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿›è¡ŒåŠ å¯†ï¼ŒåŠ å¯†åä¼šä¸æ–‡æœ¬æ–‡ä»¶çš„å¯†æ–‡ç›¸ç­‰</p>
<h3 id="ä½¿ç”¨æ–¹æ³•ï¼š"><a href="#ä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a>ä½¿ç”¨æ–¹æ³•ï¼š</h3><p>ä½¿ç”¨<code>subprocess.run()</code> è°ƒç”¨<code>.exe</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">result = subprocess.run([&#x27;A&#x27;, &#x27;B&#x27;], capture_output=True, text=True)</span><br><span class="line">A: æ–‡ä»¶åœ°å€</span><br><span class="line">B: éœ€è¦ä¼ å…¥å‡½æ•°çš„å‚æ•°</span><br><span class="line">capture_output=True: æ•è·è¾“å‡º</span><br><span class="line">text=True: ç¡®ä¿è¾“å‡ºä»¥å­—ç¬¦ä¸²å½¢å¼è€Œä¸æ˜¯å­—èŠ‚å½¢å¼è¿”å›</span><br><span class="line">è¿”å›å€¼: CompletedProcesså®ä¾‹</span><br></pre></td></tr></table></figure>

<p><code>CompletedProcess</code> å®ä¾‹æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">args: ä¼ é€’ç»™ run() çš„å‚æ•°ï¼ˆé€šå¸¸æ˜¯å‘½ä»¤å’Œå‚æ•°åˆ—è¡¨ï¼‰ï¼Œä»¥ä¾›å‚è€ƒã€‚</span><br><span class="line">returncode: å­è¿›ç¨‹é€€å‡ºæ—¶çš„çŠ¶æ€ç ã€‚é€šå¸¸ï¼ŒæˆåŠŸæ‰§è¡Œçš„å‘½ä»¤ä¼šè¿”å› 0ï¼Œè€Œéé›¶å€¼è¡¨ç¤ºå‘ç”Ÿäº†é”™è¯¯ã€‚</span><br><span class="line">stdout: å¦‚æœæŒ‡å®šäº† capture_output=True æˆ– stdout=PIPEï¼Œåˆ™åŒ…å«æ ‡å‡†è¾“å‡ºçš„æ•°æ®ï¼›å¦åˆ™ä¸º Noneã€‚</span><br><span class="line">text: å¦‚æœ text=Trueï¼Œé‚£ä¹ˆ stdout å°†æ˜¯å­—ç¬¦ä¸²ï¼›å¦åˆ™ï¼Œå®ƒå°†æ˜¯å­—èŠ‚å¯¹è±¡ã€‚</span><br><span class="line">stderr: ç±»ä¼¼äº stdoutï¼Œä½†æ˜¯åŒ…å«äº†æ ‡å‡†é”™è¯¯æµçš„æ•°æ®ã€‚</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­stdoutåŒ…å«äº†è¾“å‡ºæµï¼Œå¯ä»¥ä½¿ç”¨result.stdoutè·å–è¾“å‡ºæµ</p>
<p>è„šæœ¬ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import subprocess</span><br><span class="line">import string</span><br><span class="line">table = string.printable   # å¯æ‰“å°å­—ç¬¦è¡¨</span><br><span class="line">data = [&quot;23&quot;, &quot;29&quot;, &quot;1e&quot;, &quot;24&quot;, &quot;38&quot;,</span><br><span class="line">       &quot;0e&quot;, &quot;15&quot;, &quot;20&quot;, &quot;37&quot;, &quot;0e&quot;,</span><br><span class="line">       &quot;05&quot;, &quot;20&quot;, &quot;00&quot;, &quot;0e&quot;, &quot;37&quot;,</span><br><span class="line">       &quot;12&quot;, &quot;1d&quot;, &quot;0f&quot;, &quot;24&quot;, &quot;01&quot;, &quot;01&quot;, &quot;39&quot;]   # å¯†æ–‡</span><br><span class="line"></span><br><span class="line">flag = &#x27;flag&#123;&#x27;    # å·²çŸ¥çš„å‰ç¼€</span><br><span class="line">index = 5</span><br><span class="line">while index&lt;len(data):</span><br><span class="line">    if index == 14:     # è¿™æ˜¯æç¤ºç»™çš„</span><br><span class="line">        flag += &#x27;4&#x27;</span><br><span class="line">        index += 1</span><br><span class="line">        continue</span><br><span class="line"></span><br><span class="line">    for char in table:</span><br><span class="line">        temp = flag + char</span><br><span class="line">        result = subprocess.run([&quot;C:/Users/tzs/Desktop/bin/re.exe&quot;,temp],capture_output=True, text=True)</span><br><span class="line">        out_put = result.stdout   # è¿™é‡Œå¾—åˆ°ä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="line">        out_list = [out_put[i:i+2] for i in range(0,len(out_put),2)]         # æŠŠæ¯ä¸¤ä¸ªå­—ç¬¦æ‹†æˆä¸€ä¸ªåå…­è¿›åˆ¶æ•°</span><br><span class="line">        if out_list[index] == data[index]: </span><br><span class="line">            flag += char</span><br><span class="line">            index += 1</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Reverse</tag>
      </tags>
  </entry>
  <entry>
    <title>é‡å®šä½è¡¨</title>
    <url>/posts/42580/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="é‡å®šä½è¡¨"><a href="#é‡å®šä½è¡¨" class="headerlink" title="é‡å®šä½è¡¨"></a>é‡å®šä½è¡¨</h1><h2 id="æ¦‚è¿°ï¼š"><a href="#æ¦‚è¿°ï¼š" class="headerlink" title="æ¦‚è¿°ï¼š"></a>æ¦‚è¿°ï¼š</h2><p>â€‹	åœ¨optionalå¤´é‡Œé¢æœ‰ImageBaseï¼Œä¸€èˆ¬è€Œè¨€ï¼Œæ¨¡å—åœ¨è£…å…¥å†…å­˜ä¸­æ—¶ä¼šä¼˜å…ˆè£…å…¥è¯¥åœ°å€ã€‚ä¸€èˆ¬exeæ–‡ä»¶ä¸­è¿™ä¸ªæˆå‘˜çš„å€¼ä¸º0x00400000ï¼Œè€Œdllä¸­è¿™ä¸ªæˆå‘˜çš„å€¼ä¸€èˆ¬ä¸º0x10000000ï¼ˆé€‰æ‹©å¤§åœ°å€æ˜¯ä¸ºäº†å°½é‡ä¸ä¸exeå†²çªï¼‰ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ä¸€ä¸ªexeæ–‡ä»¶ä¼šè°ƒç”¨è®¸å¤šä¸ªdllæ–‡ä»¶ï¼Œè¿™äº›dllæ–‡ä»¶çš„ImageBaseå€¼æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤ï¼Œå…¶ä»–æœªæŠ¢åˆ°è¯¥åœ°å€çš„æ¨¡å—å®é™…ä¸Šè£…å…¥çš„åœ°å€å¹¶ä¸æ˜¯ImageBaseã€‚</p>
<p>â€‹	åœ¨æ¨¡å—ä¸­éƒ¨åˆ†æŒ‡ä»¤ä¸­å¯èƒ½ä¼šå‡ºç°ä¸€äº›åœ°å€ï¼Œç”±äºç¼–è¯‘æ—¶æ¨¡å—å¹¶æœªè£…å…¥å†…å­˜ä¸­ï¼Œä¸çŸ¥é“å®é™…åŸºå€æ˜¯ä»€ä¹ˆï¼Œå› æ­¤ç¼–è¯‘å™¨ä¼šä½¿ç”¨ImageBaseå½“ä½œåŸºå€ï¼Œè®¡ç®—å‡ºç»å¯¹åœ°å€ã€‚ä¸€æ—¦æ¨¡å—å®é™…è£…å…¥åœ°å€ä¸æ˜¯ImageBaseï¼Œé‚£ä¹ˆè¿™äº›ç»å¯¹åœ°å€éƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ¨¡å—è£…å…¥æ—¶å¯¹æ¨¡å—ä¸­çš„ç»å¯¹åœ°å€è¿›è¡Œä¿®æ­£ï¼Œé‡å®šä½è¡¨å°±åˆ—å‡ºäº†æ¨¡å—å“ªäº›ä½ç½®æœ‰éœ€è¦ä¿®æ­£çš„ç»å¯¹åœ°å€ã€‚</p>
<p>â€‹	ç”±äºexeä¸€èˆ¬æ˜¯ç¬¬ä¸€ä¸ªè£…å…¥å†…å­˜çš„æ¨¡å—ï¼Œå…·æœ‰ä¼˜å…ˆé€‰æ‹©æƒï¼Œä¸€èˆ¬éƒ½ä¼šè£…å…¥åˆ°ImageBaseå¤„ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡å®šä½è¡¨ï¼Œè€Œdllä½œä¸ºè¢«è°ƒç”¨æ–¹å¸¸å¸¸éœ€è¦é‡å®šä½è¡¨ã€‚</p>
<p>æ³¨ï¼šé‡å®šä½è¡¨ä¸­è®°è½½çš„æ˜¯åŒ…å«ç»å¯¹åœ°å€çš„æŒ‡ä»¤çš„ä½ç½®ï¼Œæ˜¯RVAï¼Œè€Œä¸æ˜¯å®é™…ç»å¯¹åœ°å€ã€‚å½“è½½å…¥æ¨¡å—æ—¶ï¼ŒåŠ è½½å™¨ä¼šè¯»å–é‡å®šä½è¡¨ä¸­çš„åœ°å€ï¼Œå–å‡ºè¯¥åœ°å€å¼€å§‹çš„4ä¸ªå­—èŠ‚ç»„æˆä¸€ä¸ªç»å¯¹åœ°å€ï¼Œè®¡ç®—è¯¥ç»å¯¹åœ°å€åœ°å€ä¸ImageBaseç›¸å‡å¾—åˆ°RVAï¼Œå†å°†RVAä¸çœŸæ­£çš„åŸºå€ç›¸åŠ å¾—åˆ°çœŸæ­£çš„VAï¼Œæ›¿æ¢åŸç»å¯¹åœ°å€ã€‚</p>
<h2 id="ç»“æ„ï¼š"><a href="#ç»“æ„ï¼š" class="headerlink" title="ç»“æ„ï¼š"></a>ç»“æ„ï¼š</h2><p>â€‹	åœ¨IMAGE_OPTIONAL_HEADERçš„æˆå‘˜DataDirectory[]çš„ç¬¬6ä¸ªç»“æ„ä½“ä¸­ï¼Œè®°è½½é‡å®šä½è¡¨çš„ä½ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct IMAGE_DATA_DIRECTORY&#123;</span><br><span class="line">  DWORD  VirtualAddress; RVAï¼Œé‡å®šä½è¡¨çš„ä½ç½®</span><br><span class="line">  DWORD  Size;</span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, * PIMAGE_DATA_DIRECTORY;</span><br></pre></td></tr></table></figure>

<p>â€‹	é‡å®šä½è¡¨ç”±å¤šä¸ªIMAGE_BASE_RELOCATION ç»“æ„+æ•°æ®ç»„æˆï¼Œç”±ä¸€ä¸ªå…¨ä¸ºé›¶çš„IMAGE_BASE_RELOCATION ç»“æ„ä½“ç»“æŸã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_BASE_RELOCATION &#123;</span><br><span class="line"> </span><br><span class="line">  DWORD  VirtualAddress; //è®°å½•å†…å­˜é¡µçš„åŸºå€RVA </span><br><span class="line">  DWORD  SizeOfBlock;  //å½“å‰é‡å®šä½å—ç»“æ„çš„å¤§å°ã€‚è¿™ä¸ªå€¼å‡8å°±æ˜¯TypeOffsetæ•°ç»„çš„å¤§å°</span><br><span class="line"> </span><br><span class="line">&#125; IMAGE_BASE_RELOCATION;</span><br><span class="line">typedef IMAGE_BASE_RELOCATION UNALIGNED * PIMAGE_BASE_RELOCATION;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸‹å›¾ï¼š</p>
.png)

<p>â€‹	è¿™æ ·çš„ç»“æ„ä½¿é‡å®šä½è¡¨å æ®çš„ç©ºé—´å¤§å¹…ç¼©å°ã€‚ä¾‹å¦‚è‹¥è¦ä¿®æ”¹çš„åœ°å€çš„RVAä¸º1034ã€1045ã€1056ã€1077ï¼Œå¦‚æœæ¯ä¸€ä¸ªåœ°å€éƒ½å•ç‹¬å­˜å‚¨ï¼Œä¸€ä¸ªåœ°å€å 4ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆéœ€è¦å æ®16ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œè€Œå¦‚æœæŠŠ1000ä½œä¸ºä¸€é¡µï¼Œå°†åŒä¸€é¡µçš„æ•°æ®å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå†è®°å½•ä¸‹è¿™ä¸€é¡µçš„èµ·å§‹åœ°å€ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªåœ°å€å°±ä¸å†éœ€è¦4å­—èŠ‚ã€‚ä¸€ä¸ªé¡µå¤§å°ä¸º0x1000å³ä¸º2çš„12æ¬¡æ–¹ï¼Œæ•…åªéœ€è¦12æ¯”ç‰¹å°±èƒ½å®Œæˆå¯¹è¯¥é¡µçš„å¯»å€ï¼Œä¸ºäº†å¯¹é½ï¼Œéœ€è¦è¡¥4ä¸ªæ¯”ç‰¹ï¼Œå› æ­¤ä¸€ä¸ªåœ°å€å æ®2ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥ï¼Œé‡å®šä½è¡¨ä¸­ä¸€ä¸ªå—é‡ŒIMAGE_BASE_RELOCATIONä¸­çš„VirtualAddressè¡¨ç¤ºæ­¤å—çš„åŸºå€ï¼ŒSizeOfBlockæŒ‡ç¤ºæ­¤å—çš„æ€»å¤§å°ï¼Œåé¢è·Ÿç€çš„æ•°æ®æ¯ä¸¤ä¸ªå­—èŠ‚ä¸ºä¸€ç»„ï¼Œå12ä½è¡¨ç¤ºåç§»ã€‚ç”±äºå¯¹é½ï¼Œä¸€ä¸ªå—çš„é•¿åº¦é™åˆ¶ä¸º4çš„å€æ•°ï¼Œäºæ˜¯å½“ä¸€ä¸ªå—å­˜å‚¨å¥‡æ•°ä¸ªåœ°å€æ—¶ï¼Œéœ€è¦è¡¥2ä¸ªå­—èŠ‚çš„0ï¼Œä¸ºäº†ä¸å®é™…éœ€è¦ä¿®æ”¹çš„åœ°å€ä½œåŒºåˆ†ï¼Œå¯ç”¨æœªä½¿ç”¨çš„å‰4ä½ä¸ºå±æ€§ï¼Œè‹¥å€¼ä¸º3ï¼ˆå³0011ï¼‰ï¼Œåˆ™ä»£è¡¨æ˜¯éœ€è¦ä¿®æ”¹çš„åœ°å€ï¼›è‹¥å€¼ä¸º0ï¼Œå³æ˜¯å¡«å……çš„æ•°æ®ã€‚</p>
<h1 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h1><h2 id="ä¸€ã€æ‰“å°é‡å®šä½è¡¨ä¸­æ‰€æœ‰ä¿¡æ¯"><a href="#ä¸€ã€æ‰“å°é‡å®šä½è¡¨ä¸­æ‰€æœ‰ä¿¡æ¯" class="headerlink" title="ä¸€ã€æ‰“å°é‡å®šä½è¡¨ä¸­æ‰€æœ‰ä¿¡æ¯"></a>ä¸€ã€æ‰“å°é‡å®šä½è¡¨ä¸­æ‰€æœ‰ä¿¡æ¯</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">int num=0;           //èŠ‚æ•°é‡</span><br><span class="line">int header_size=0;   // PEå¤´å¤§å°</span><br><span class="line">int base=0;          // åŸºå€</span><br><span class="line">int fsize=0,image_size=0; // æ–‡ä»¶å¤§å°ï¼›æ–‡ä»¶æ˜ å°„çš„å†…å­˜å¤§å°</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">	DWORD foa=0;</span><br><span class="line">    if(rva&lt;=header_size) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    if(rva&lt;sheader[0].VirtualAddress) &#123;</span><br><span class="line">        printf(&quot;æ²¡æœ‰å¯¹åº”çš„foa!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i &gt;= num) &#123;</span><br><span class="line">        printf(&quot;RVAè¶…å‡ºèŒƒå›´!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">	return foa;</span><br><span class="line">&#125;</span><br><span class="line">void print_relocation(unsigned char *location)&#123;  // å…³é”®å‡½æ•°ï¼Œæ‰“å°é‡å®šä½è¡¨æ‰€æœ‰å†…å®¹</span><br><span class="line">    IMAGE_BASE_RELOCATION* relocation=(IMAGE_BASE_RELOCATION*)location;</span><br><span class="line">    if(relocation-&gt;SizeOfBlock==0) return;</span><br><span class="line">    DWORD base = relocation-&gt;VirtualAddress;</span><br><span class="line">    DWORD rva = 0,foa = 0;</span><br><span class="line">    WORD* address = (WORD*)(location+8);</span><br><span class="line">    int num = (relocation-&gt;SizeOfBlock-8)/2;</span><br><span class="line">    int i=0,Characteristics=0;</span><br><span class="line">    printf(&quot;é‡å®šä½è¡¨VirtualAddress:%#010x     size:%#010x\n&quot;,base,relocation-&gt;SizeOfBlock);</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        Characteristics = (int)(address[i]&gt;&gt;12);</span><br><span class="line">        rva = base + (address[i]&amp;0x0fff);</span><br><span class="line">        printf(&quot;RVA:%#010x    FOA:%#010x    Characteristics:%d\n&quot;,rva,RVA_to_FOA(rva),Characteristics);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n\n&quot;);</span><br><span class="line">    print_relocation(location+relocation-&gt;SizeOfBlock);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    // if(argc != 2) &#123;</span><br><span class="line">    //     printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">    //     return 1;</span><br><span class="line">    // &#125;</span><br><span class="line">    const char* pe_path = &quot;dlltest.dll&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize);</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *offset=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)offset;</span><br><span class="line">    offset+=dos-&gt;e_lfanew+4;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)offset;</span><br><span class="line">    num = fheader-&gt;NumberOfSections;</span><br><span class="line">    offset+=20;      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)offset;</span><br><span class="line">    header_size=oheader-&gt;SizeOfHeaders;</span><br><span class="line">    base=oheader-&gt;ImageBase;</span><br><span class="line">    image_size = oheader-&gt;SizeOfImage;</span><br><span class="line">    offset += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    int size = num * sizeof(IMAGE_SECTION_HEADER);</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)offset;</span><br><span class="line">	DWORD redelocation_rva = oheader-&gt;DataDirectory[5].VirtualAddress;</span><br><span class="line">	DWORD relocation_foa = RVA_to_FOA(redelocation_rva);</span><br><span class="line">	if(relocation_foa == 0) &#123;</span><br><span class="line">		printf(&quot;é‡å®šä½è¡¨RVAè½¬æ¢å¤±è´¥\n&quot;);</span><br><span class="line">		free(file_buf);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	print_relocation(file_buf + relocation_foa);</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€æ¨¡æ‹Ÿé‡å®šä½è¿‡ç¨‹"><a href="#äºŒã€æ¨¡æ‹Ÿé‡å®šä½è¿‡ç¨‹" class="headerlink" title="äºŒã€æ¨¡æ‹Ÿé‡å®šä½è¿‡ç¨‹"></a>äºŒã€æ¨¡æ‹Ÿé‡å®šä½è¿‡ç¨‹</h2><p>ç›®æ ‡ï¼šå°†Imagebaseæ”¹ä¸º20000000ï¼Œç„¶åè¿›è¡Œé‡å®šä½ï¼Œä¿®æ”¹åçš„dllè¦èƒ½å¤Ÿä½¿ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#define newbase 0x20000000</span><br><span class="line">IMAGE_DOS_HEADER* dos;</span><br><span class="line">IMAGE_FILE_HEADER* fheader;</span><br><span class="line">IMAGE_OPTIONAL_HEADER32* oheader;</span><br><span class="line">IMAGE_SECTION_HEADER* sheader;</span><br><span class="line">int num=0;           //èŠ‚æ•°é‡</span><br><span class="line">int header_size=0;   // PEå¤´å¤§å°</span><br><span class="line">int base=0;          // åŸºå€</span><br><span class="line">int fsize=0,image_size=0; // æ–‡ä»¶å¤§å°ï¼›æ–‡ä»¶æ˜ å°„çš„å†…å­˜å¤§å°</span><br><span class="line">DWORD RVA_to_FOA(DWORD rva)&#123;</span><br><span class="line">	DWORD foa=0;</span><br><span class="line">    if(rva&lt;=header_size) &#123;</span><br><span class="line">        foa = rva;</span><br><span class="line">        return foa;</span><br><span class="line">    &#125;</span><br><span class="line">    if(rva&lt;sheader[0].VirtualAddress) &#123;</span><br><span class="line">        printf(&quot;æ²¡æœ‰å¯¹åº”çš„foa!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        if(rva&gt;=sheader[i].VirtualAddress&amp;&amp;rva&lt;(sheader[i].VirtualAddress+sheader[i].Misc.VirtualSize))</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(i &gt;= num) &#123;</span><br><span class="line">        printf(&quot;RVAè¶…å‡ºèŒƒå›´!!!\n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    int offset=rva-sheader[i].VirtualAddress;</span><br><span class="line">    foa=sheader[i].PointerToRawData+offset;</span><br><span class="line">	return foa;</span><br><span class="line">&#125;</span><br><span class="line">void relocate(unsigned char *location,unsigned char *file_buf)&#123;</span><br><span class="line">    IMAGE_BASE_RELOCATION* relocation=(IMAGE_BASE_RELOCATION*)location;</span><br><span class="line">    if(relocation-&gt;SizeOfBlock==0) return;</span><br><span class="line">    DWORD base = relocation-&gt;VirtualAddress;</span><br><span class="line">    DWORD rva = 0,foa = 0;</span><br><span class="line">    WORD* address = (WORD*)(location+8);</span><br><span class="line">    int num = (relocation-&gt;SizeOfBlock-8)/2;</span><br><span class="line">    int i=0,Characteristics=0;</span><br><span class="line">    DWORD data=0;</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        Characteristics = (int)(address[i]&gt;&gt;12);</span><br><span class="line">        if(Characteristics == 3)&#123;</span><br><span class="line">            rva = base + (address[i]&amp;0x0fff);</span><br><span class="line">            foa = RVA_to_FOA(rva);</span><br><span class="line">            data = *(DWORD*)(file_buf+foa);</span><br><span class="line">            data = data - oheader-&gt;ImageBase + newbase;</span><br><span class="line">            *(DWORD*)(file_buf+foa) = data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    relocate(location+relocation-&gt;SizeOfBlock,file_buf);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    // if(argc != 2) &#123;</span><br><span class="line">    //     printf(&quot;ç”¨æ³•: %s &lt;PEæ–‡ä»¶è·¯å¾„&gt;\n&quot;, argv[0]);</span><br><span class="line">    //     return 1;</span><br><span class="line">    // &#125;</span><br><span class="line">    const char* pe_path = &quot;dlltest.dll&quot;;</span><br><span class="line">    FILE* pf=fopen(pe_path,&quot;rb&quot;);</span><br><span class="line">    if(!pf) &#123;printf(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼ï¼\n&quot;);return 0;&#125;</span><br><span class="line">    fseek(pf, 0, SEEK_END);</span><br><span class="line">    fsize=ftell(pf);    </span><br><span class="line">    fseek(pf, 0, SEEK_SET); </span><br><span class="line">    unsigned char* file_buf=(unsigned char *)malloc(fsize);</span><br><span class="line">    fread(file_buf,1,fsize,pf);</span><br><span class="line">    fclose(pf);</span><br><span class="line">    unsigned char *offset=file_buf;</span><br><span class="line">    dos=(IMAGE_DOS_HEADER*)offset;</span><br><span class="line">    offset+=dos-&gt;e_lfanew+4;  // å®šä½æ–‡ä»¶å¤´</span><br><span class="line">    fheader=(IMAGE_FILE_HEADER*)offset;</span><br><span class="line">    num = fheader-&gt;NumberOfSections;</span><br><span class="line">    offset+=20;      // å®šä½å¯é€‰å¤´</span><br><span class="line">    oheader = (IMAGE_OPTIONAL_HEADER32*)offset;</span><br><span class="line">    header_size=oheader-&gt;SizeOfHeaders;</span><br><span class="line">    base=oheader-&gt;ImageBase;</span><br><span class="line">    image_size = oheader-&gt;SizeOfImage;</span><br><span class="line">    offset += sizeof(IMAGE_OPTIONAL_HEADER32);   // å®šä½èŠ‚è¡¨</span><br><span class="line">    int size = num * sizeof(IMAGE_SECTION_HEADER);</span><br><span class="line">    sheader = (IMAGE_SECTION_HEADER*)offset;</span><br><span class="line">	DWORD redelocation_rva = oheader-&gt;DataDirectory[5].VirtualAddress;</span><br><span class="line">	DWORD relocation_foa = RVA_to_FOA(redelocation_rva);</span><br><span class="line">	if(relocation_foa == 0) &#123;</span><br><span class="line">		printf(&quot;é‡å®šä½è¡¨RVAè½¬æ¢å¤±è´¥\n&quot;);</span><br><span class="line">		free(file_buf);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	relocate(file_buf + relocation_foa,file_buf);</span><br><span class="line">    oheader-&gt;ImageBase = newbase;</span><br><span class="line">    FILE *new_file = fopen(&quot;new.dll&quot;,&quot;wb&quot;);</span><br><span class="line">    if (!new_file) &#123;</span><br><span class="line">        perror(&quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥&quot;);</span><br><span class="line">        free(file_buf);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    int written=fwrite(file_buf,sizeof(unsigned char),fsize,new_file);</span><br><span class="line">    if(written!=fsize)&#123;</span><br><span class="line">        perror(&quot;å†™å…¥é”™è¯¯&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(new_file);</span><br><span class="line">    free(file_buf);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PE</tag>
      </tags>
  </entry>
</search>
