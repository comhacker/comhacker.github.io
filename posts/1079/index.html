<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":"ture","show_result":"ture","style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":"ture"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":"ture","trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="操作系统">
<meta property="og:url" content="http://example.com/posts/1079/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/posts/1079/2025-03-25_084958.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-04-01_000958.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-04-07_213522.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-04-14_225430.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-04-21_234800.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-04-22_084440.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-05-06_092241.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-05-13_010556.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-05-21_162041.png">
<meta property="og:image" content="http://example.com/posts/1079/2025-05-20-092314.png">
<meta property="og:image" content="http://example.com/posts/1079/9B39D4F880CCDC631ECA6998C6C78A0A.png">
<meta property="article:published_time" content="2025-03-03T11:41:54.000Z">
<meta property="article:modified_time" content="2025-06-04T08:14:32.308Z">
<meta property="article:author" content="comhacker">
<meta property="article:tag" content="操作系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/posts/1079/2025-03-25_084958.png">

<link rel="canonical" href="http://example.com/posts/1079/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>操作系统 | Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/1079/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar_2.gif">
      <meta itemprop="name" content="comhacker">
      <meta itemprop="description" content="位卑未敢忘忧国，事定犹须待阖棺">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          操作系统
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-03-03 19:41:54" itemprop="dateCreated datePublished" datetime="2025-03-03T19:41:54+08:00">2025-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-04 16:14:32" itemprop="dateModified" datetime="2025-06-04T16:14:32+08:00">2025-06-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <hr>
<span id="more"></span>

<h1 id="第一周：模拟队列管理"><a href="#第一周：模拟队列管理" class="headerlink" title="第一周：模拟队列管理"></a>第一周：模拟队列管理</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">// 队列的管理过程</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#define max 11</span><br><span class="line">typedef struct queue&#123;</span><br><span class="line">    int rear,front;</span><br><span class="line">    int arr[max];</span><br><span class="line">&#125;queue;</span><br><span class="line">void init(queue *q)&#123;  //队列初始化</span><br><span class="line">    q-&gt;front=q-&gt;rear=0;</span><br><span class="line">&#125;</span><br><span class="line">void print_queue(queue *q)&#123;  //打印队列</span><br><span class="line">    int i;</span><br><span class="line">    printf(&quot;该队列为：\n&quot;);</span><br><span class="line">    for(i=q-&gt;front;i&lt;q-&gt;rear;i++) printf(&quot;%d &quot;,q-&gt;arr[i]);</span><br><span class="line">    printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int is_full(queue *q)&#123;  //判满</span><br><span class="line">    return (q-&gt;rear+1)%max==q-&gt;front;</span><br><span class="line">&#125;</span><br><span class="line">int is_empty(queue *q)&#123;  //判空</span><br><span class="line">    return q-&gt;front==q-&gt;rear;</span><br><span class="line">&#125;</span><br><span class="line">queue *creat()&#123;  // 创建队列</span><br><span class="line">    int i,num,data;</span><br><span class="line">    queue *q;</span><br><span class="line">    q=(queue *)malloc(sizeof(queue));</span><br><span class="line">    init(q);</span><br><span class="line">    printf(&quot;请输入需要创建队列的个数:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        printf(&quot;请输入你需要插入的值:&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;data);</span><br><span class="line">        if(is_full(q)==1) &#123;printf(&quot;队列已满!/n&quot;);break;&#125;</span><br><span class="line">        q-&gt;arr[q-&gt;rear]=data;</span><br><span class="line">        q-&gt;rear=(q-&gt;rear+1)%max;</span><br><span class="line">    &#125;</span><br><span class="line">    return q;</span><br><span class="line">&#125;</span><br><span class="line">void enqueue(queue *q)&#123;  // 入队</span><br><span class="line">    int data;</span><br><span class="line">    printf(&quot;请输入你需要插入的值:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;data);</span><br><span class="line">    if(is_full(q)==1) &#123;printf(&quot;队列已满!/n&quot;);return;&#125;</span><br><span class="line">    q-&gt;arr[q-&gt;rear]=data;</span><br><span class="line">    q-&gt;rear=(q-&gt;rear+1)%max;</span><br><span class="line">&#125;</span><br><span class="line">int dequeue(queue *q)&#123;  // 出队</span><br><span class="line">    int data;</span><br><span class="line">    if(is_empty(q)) &#123;printf(&quot;队列为空!\n&quot;);return -1;&#125;</span><br><span class="line">    data=q-&gt;arr[q-&gt;front];</span><br><span class="line">    q-&gt;front=(q-&gt;front+1)%max;</span><br><span class="line">    printf(&quot;出队的元素为：%d\n&quot;,data);</span><br><span class="line">    return data;</span><br><span class="line">&#125;</span><br><span class="line">void clear(queue *q)&#123;  // 清空队列</span><br><span class="line">    q-&gt;front=q-&gt;rear=0;</span><br><span class="line">&#125;</span><br><span class="line">void print_table()&#123;  // 打印操作表</span><br><span class="line">    printf(&quot;********************************\n&quot;);</span><br><span class="line">    printf(&quot;*1、新建                       *\n&quot;);</span><br><span class="line">    printf(&quot;*2、初始化                     *\n&quot;);</span><br><span class="line">    printf(&quot;*3、出队                       *\n&quot;);</span><br><span class="line">    printf(&quot;*4、入队                       *\n&quot;);</span><br><span class="line">    printf(&quot;*5、打印队列                   *\n&quot;);</span><br><span class="line">    printf(&quot;*6、清空队列                   *\n&quot;);</span><br><span class="line">    printf(&quot;*7、队列是否为满               *\n&quot;);</span><br><span class="line">    printf(&quot;*8、队列是否空                 *\n&quot;);</span><br><span class="line">    printf(&quot;*9、退出                       *\n&quot;);</span><br><span class="line">    printf(&quot;********************************\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int x;</span><br><span class="line">    queue *q;</span><br><span class="line">    print_table();</span><br><span class="line">    while(1)&#123;</span><br><span class="line">        printf(&quot;请选择要进行的操作:&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">        switch(x)&#123;</span><br><span class="line">            case 1:q=creat();</span><br><span class="line">                   print_queue(q);</span><br><span class="line">                   break;</span><br><span class="line">            case 2:init(q);</span><br><span class="line">                    printf(&quot;队列是空的\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 3:dequeue(q);</span><br><span class="line">                    print_queue(q);</span><br><span class="line">                    break;</span><br><span class="line">            case 4:enqueue(q);</span><br><span class="line">                    print_queue(q);</span><br><span class="line">                    break;</span><br><span class="line">            case 5:print_queue(q);</span><br><span class="line">                    break;</span><br><span class="line">            case 6:clear(q);</span><br><span class="line">                    if(is_empty(q)) printf(&quot;队列是空的\n&quot;);</span><br><span class="line">                    else printf(&quot;队列不是空的\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 7:if(is_full(q)) printf(&quot;队列是满的\n&quot;);</span><br><span class="line">                    else printf(&quot;队列不是满的\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 8:if(is_empty(q)) printf(&quot;队列是空的\n&quot;);</span><br><span class="line">                    else printf(&quot;队列不是空的\n&quot;);</span><br><span class="line">                    break;</span><br><span class="line">            case 9:exit(0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第三周：FCFS进程调度算法"><a href="#第三周：FCFS进程调度算法" class="headerlink" title="第三周：FCFS进程调度算法"></a>第三周：FCFS进程调度算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct Time &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct node &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[20];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    struct node* next;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line">typedef struct Q &#123;</span><br><span class="line">    Node* front;</span><br><span class="line">    Node* end;</span><br><span class="line">&#125; Queue;</span><br><span class="line"></span><br><span class="line">int compare(Time t1,Time t2)&#123;   //t1先到返回1，t2先到返回0</span><br><span class="line">	int x1=t1.hour * 60 + t1.min;</span><br><span class="line">	int x2=t2.hour * 60 + t2.min;</span><br><span class="line">	return x1&lt;=x2;</span><br><span class="line">&#125;</span><br><span class="line">void creat(Queue *q)&#123;</span><br><span class="line">	int num,i;</span><br><span class="line">    printf(&quot;请输入进程个数：\n&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">    printf(&quot;id   名字   到达时间   执行时间（分钟）\n&quot;);</span><br><span class="line">	Node *tmp=(Node *)malloc(sizeof(Node));</span><br><span class="line">	Node *p;</span><br><span class="line">	scanf(&quot;%d %s %d:%d %d&quot;, &amp;tmp-&gt;id, tmp-&gt;name,&amp;tmp-&gt;arrive.hour,&amp;tmp-&gt;arrive.min, &amp;tmp-&gt;zx);</span><br><span class="line">	tmp-&gt;next=NULL;</span><br><span class="line">	q-&gt;front=tmp;q-&gt;end=tmp;</span><br><span class="line">	for(i=0;i&lt;num-1;i++)&#123;</span><br><span class="line">		tmp=(Node *)malloc(sizeof(Node));</span><br><span class="line">		scanf(&quot;%d %s %d:%d %d&quot;, &amp;tmp-&gt;id, tmp-&gt;name, &amp;tmp-&gt;arrive.hour,&amp;tmp-&gt;arrive.min,&amp;tmp-&gt;zx);</span><br><span class="line">		tmp-&gt;next=NULL;</span><br><span class="line">		p=q-&gt;front;</span><br><span class="line">		if(compare(tmp-&gt;arrive,p-&gt;arrive)) &#123;tmp-&gt;next=q-&gt;front;q-&gt;front=tmp;&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			while(p-&gt;next!=NULL&amp;&amp;compare(p-&gt;next-&gt;arrive,tmp-&gt;arrive)) p=p-&gt;next;</span><br><span class="line">			tmp-&gt;next=p-&gt;next;p-&gt;next=tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">void print(Queue *q)&#123;</span><br><span class="line">	Node *tmp=q-&gt;front;</span><br><span class="line">	printf(&quot;模拟进程FCFS调度过程输出结果:\n&quot;);</span><br><span class="line">	printf(&quot;ID号 名字 到达时间 执行时间(分钟) 开始时间 完成时间 周转时间(分钟) 带权周转时间(系数)\n&quot;);</span><br><span class="line">	float _zz=0,_zzxs=0;</span><br><span class="line">	int num=0;</span><br><span class="line">	while(tmp!=NULL)&#123;</span><br><span class="line">		num++;</span><br><span class="line">		printf(&quot;%04d %-3s   %02d:%02d    %-12d  %02d:%02d  %02d:%02d   %-12d  %.2f\n&quot;, </span><br><span class="line">			tmp-&gt;id, tmp-&gt;name, tmp-&gt;arrive.hour,tmp-&gt;arrive.min,tmp-&gt;zx,tmp-&gt;start.hour,tmp-&gt;start.min,tmp-&gt;finish.hour,tmp-&gt;finish.min,tmp-&gt;zz,tmp-&gt;zzxs);</span><br><span class="line">		_zz+=tmp-&gt;zz;</span><br><span class="line">		_zzxs+=tmp-&gt;zzxs;</span><br><span class="line">		tmp=tmp-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;系统平均周转时间为：%.2f\n&quot;,_zz/num);</span><br><span class="line">	printf(&quot;系统带权平均周转时间: %.2f\n&quot;,_zzxs/num);</span><br><span class="line">&#125;</span><br><span class="line">void calculate(Node *p)&#123; //计算时间</span><br><span class="line">	p-&gt;finish.hour=p-&gt;start.hour+(p-&gt;start.min+p-&gt;zx)/60;</span><br><span class="line">	p-&gt;finish.min=(p-&gt;start.min+p-&gt;zx)%60;</span><br><span class="line">	p-&gt;zz=(p-&gt;finish.hour*60+p-&gt;finish.min)-(p-&gt;arrive.hour*60+p-&gt;arrive.min);</span><br><span class="line">	p-&gt;zzxs=(p-&gt;zz*1.00)/p-&gt;zx;</span><br><span class="line">&#125;</span><br><span class="line">void fcfs(Queue *q)&#123;</span><br><span class="line">	Time t0;</span><br><span class="line">	Node *tmp;</span><br><span class="line">	tmp=q-&gt;front;</span><br><span class="line">	t0=tmp-&gt;arrive;</span><br><span class="line">	tmp-&gt;start=t0;</span><br><span class="line">	calculate(tmp);</span><br><span class="line">	t0=tmp-&gt;finish;</span><br><span class="line">	tmp=tmp-&gt;next;</span><br><span class="line">	while(tmp!=NULL)&#123;</span><br><span class="line">		if(compare(t0,tmp-&gt;arrive))  t0=tmp-&gt;arrive;</span><br><span class="line">		tmp-&gt;start=t0;</span><br><span class="line">		calculate(tmp);</span><br><span class="line">		t0=tmp-&gt;finish;</span><br><span class="line">		tmp=tmp-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	while(1)&#123;</span><br><span class="line">		printf(&quot;请输入操作：(1:开始进程; -1:结束进程):&quot;);</span><br><span class="line">		int flag;</span><br><span class="line">		scanf(&quot;%d&quot;,&amp;flag);</span><br><span class="line">		if(flag==-1) break;</span><br><span class="line">		Queue q;</span><br><span class="line">		q.end=q.front=NULL;</span><br><span class="line">		creat(&amp;q);</span><br><span class="line">		fcfs(&amp;q);</span><br><span class="line">		print(&amp;q);</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">// 5001 p1 9:40 20</span><br><span class="line">// 5004 p4 10:10 10</span><br><span class="line">// 5005 p5 10:05 30</span><br><span class="line">// 5002 p2 9:55 15</span><br><span class="line">// 5003 p3 9:45 25</span><br></pre></td></tr></table></figure>

<h1 id="第四周：短进程优先调度"><a href="#第四周：短进程优先调度" class="headerlink" title="第四周：短进程优先调度"></a>第四周：短进程优先调度</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;			//注：此代码有点问题</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;limits.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct Process &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[10];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    struct Process* next;</span><br><span class="line">&#125; Process;</span><br><span class="line"></span><br><span class="line">//时间比较函数</span><br><span class="line">int time_cmp(Time a, Time b) &#123;</span><br><span class="line">    return (a.hour * 60 + a.min) - (b.hour * 60 + b.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//增加指定分钟数</span><br><span class="line">Time add_mins(Time t, int mins) &#123;</span><br><span class="line">    int total = t.hour * 60 + t.min + mins;</span><br><span class="line">    return (Time)&#123;total / 60, total % 60&#125;;</span><br><span class="line">&#125;</span><br><span class="line">//时间差计算（分钟）</span><br><span class="line">int time_diff(Time end, Time start) &#123;</span><br><span class="line">    return (end.hour * 60 + end.min) - (start.hour * 60 + start.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//SJF调度核心算法</span><br><span class="line">void sjf_scheduler(Process** head, int n) &#123;</span><br><span class="line">    Process* scheduled_head = NULL;</span><br><span class="line">    Process* scheduled_tail = NULL;  // 新增尾指针</span><br><span class="line">    Time current_time = &#123;9, 40&#125;;</span><br><span class="line">    int processed = 0;</span><br><span class="line"></span><br><span class="line">    while (processed &lt; n) &#123;</span><br><span class="line">        Process **prev = head;</span><br><span class="line">        Process *sel = NULL;</span><br><span class="line">        int min_time = INT_MAX;</span><br><span class="line">        Process **prev_sel = NULL;</span><br><span class="line"></span><br><span class="line">        while (*prev) &#123;</span><br><span class="line">            if ((*prev)-&gt;start.hour == 0 &amp;&amp; </span><br><span class="line">                time_cmp((*prev)-&gt;arrive, current_time) &lt;= 0) &#123;</span><br><span class="line">                if ((*prev)-&gt;zx &lt; min_time) &#123;</span><br><span class="line">                    min_time = (*prev)-&gt;zx;</span><br><span class="line">                    sel = *prev;</span><br><span class="line">                    prev_sel = prev;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = &amp;(*prev)-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (sel) &#123;</span><br><span class="line">            // 设置进程时间</span><br><span class="line">            sel-&gt;start = (time_cmp(current_time, sel-&gt;arrive) &gt; 0) ? </span><br><span class="line">                        current_time : sel-&gt;arrive;</span><br><span class="line">            sel-&gt;finish = add_mins(sel-&gt;start, sel-&gt;zx);</span><br><span class="line">            sel-&gt;zz = time_diff(sel-&gt;finish, sel-&gt;arrive);</span><br><span class="line">            sel-&gt;zzxs = (float)sel-&gt;zz / sel-&gt;zx;</span><br><span class="line">            </span><br><span class="line">            current_time = sel-&gt;finish;</span><br><span class="line">            processed++;</span><br><span class="line">            </span><br><span class="line">            // 从原链表移除</span><br><span class="line">            if (prev_sel) &#123;</span><br><span class="line">                *prev_sel = sel-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 尾部插入</span><br><span class="line">            sel-&gt;next = NULL;</span><br><span class="line">            if (scheduled_head == NULL) &#123;</span><br><span class="line">                scheduled_head = scheduled_tail = sel;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                scheduled_tail-&gt;next = sel;</span><br><span class="line">                scheduled_tail = sel;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            current_time.min++;</span><br><span class="line">            if (current_time.min &gt;= 60) &#123;</span><br><span class="line">                current_time.hour++;</span><br><span class="line">                current_time.min = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *head = scheduled_head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int op, n;</span><br><span class="line">    Process *head = NULL;</span><br><span class="line"></span><br><span class="line">    while(1) &#123;</span><br><span class="line">        printf(&quot;请输入操作(1：开始进程调度；-1：结束进程)：&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;op);</span><br><span class="line">        </span><br><span class="line">        if(op == -1) break;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;请输入进程数：&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;id号 名字 到达时间 执行时间\n&quot;);</span><br><span class="line">        for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">            Process *p = (Process*)malloc(sizeof(Process));</span><br><span class="line">            scanf(&quot;%d %s %d:%d %d&quot;, </span><br><span class="line">                 &amp;p-&gt;id, p-&gt;name, </span><br><span class="line">                 &amp;p-&gt;arrive.hour, &amp;p-&gt;arrive.min,</span><br><span class="line">                 &amp;p-&gt;zx);</span><br><span class="line">            p-&gt;start.hour = 0;  // 初始化开始时间</span><br><span class="line">            p-&gt;next = head;</span><br><span class="line">            head = p;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sjf_scheduler(&amp;head, n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\n模拟短进程优先调度过程结果：\n&quot;);</span><br><span class="line">        printf(&quot;id号 名字 到达时间 执行时间(分钟) 开始时间 完成时间 周转时间(分钟) 带权周转系数\n&quot;);</span><br><span class="line">        </span><br><span class="line">        float total_zz = 0, total_zzxs = 0;</span><br><span class="line">        Process *p = head;</span><br><span class="line">        while(p) &#123;</span><br><span class="line">            printf(&quot;%-4d %-4s %02d:%02d %12d   %02d:%02d    %02d:%02d %15d %12.2f\n&quot;,</span><br><span class="line">                  p-&gt;id, p-&gt;name, </span><br><span class="line">                  p-&gt;arrive.hour, p-&gt;arrive.min,</span><br><span class="line">                  p-&gt;zx,</span><br><span class="line">                  p-&gt;start.hour, p-&gt;start.min,</span><br><span class="line">                  p-&gt;finish.hour, p-&gt;finish.min,</span><br><span class="line">                  p-&gt;zz, p-&gt;zzxs);</span><br><span class="line">            </span><br><span class="line">            total_zz += p-&gt;zz;</span><br><span class="line">            total_zzxs += p-&gt;zzxs;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\n系统平均周转时间为：%.2f\n&quot;, total_zz / n);</span><br><span class="line">        printf(&quot;系统平均带权周转系数为：%.2f\n\n&quot;, total_zzxs / n);</span><br><span class="line">        </span><br><span class="line">        // 内存释放</span><br><span class="line">        while(head) &#123;</span><br><span class="line">            Process *temp = head;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        head = NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 1001 p1 9:40 20</span><br><span class="line">// 1004 p4 10:10 10</span><br><span class="line">// 1058 p5 10:05 30 </span><br><span class="line">// 1002 p2 9:55 15</span><br><span class="line">// 1003 p3 9:45 25</span><br></pre></td></tr></table></figure>

<h1 id="第五周：-优先级调度算法"><a href="#第五周：-优先级调度算法" class="headerlink" title="第五周： 优先级调度算法"></a>第五周： 优先级调度算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;limits.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct Process &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[20];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    int priority;  // 新增优先级字段</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    struct Process* next;</span><br><span class="line">&#125; Process;</span><br><span class="line"></span><br><span class="line">int time_cmp(Time a, Time b) &#123;</span><br><span class="line">    return (a.hour * 60 + a.min) - (b.hour * 60 + b.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Time add_mins(Time t, int mins) &#123;</span><br><span class="line">    int total = t.hour * 60 + t.min + mins;</span><br><span class="line">    return (Time)&#123;total / 60, total % 60&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int time_diff(Time end, Time start) &#123;</span><br><span class="line">    return (end.hour * 60 + end.min) - (start.hour * 60 + start.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 修改为优先级调度算法</span><br><span class="line">void sjf_scheduler(Process** head, int n) &#123;</span><br><span class="line">    Process* scheduled_head = NULL;</span><br><span class="line">    Process* scheduled_tail = NULL;</span><br><span class="line">    Time current_time = &#123;9, 40&#125;;</span><br><span class="line">    int processed = 0;</span><br><span class="line"></span><br><span class="line">    while (processed &lt; n) &#123;</span><br><span class="line">        Process **prev = head;</span><br><span class="line">        Process *sel = NULL;</span><br><span class="line">        int max_priority = -1;</span><br><span class="line">        int min_zx = INT_MAX;</span><br><span class="line">        Process **prev_sel = NULL;</span><br><span class="line"></span><br><span class="line">        while (*prev) &#123;</span><br><span class="line">            if ((*prev)-&gt;start.hour == 0 &amp;&amp; </span><br><span class="line">                time_cmp((*prev)-&gt;arrive, current_time) &lt;= 0) &#123;</span><br><span class="line">                </span><br><span class="line">                // 优先级更高，或同优先级但执行时间更短</span><br><span class="line">                if ((*prev)-&gt;priority &gt; max_priority || </span><br><span class="line">                    ((*prev)-&gt;priority == max_priority &amp;&amp; (*prev)-&gt;zx &lt; min_zx)) &#123;</span><br><span class="line">                    max_priority = (*prev)-&gt;priority;</span><br><span class="line">                    min_zx = (*prev)-&gt;zx;</span><br><span class="line">                    sel = *prev;</span><br><span class="line">                    prev_sel = prev;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = &amp;(*prev)-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (sel) &#123;</span><br><span class="line">            sel-&gt;start = (time_cmp(current_time, sel-&gt;arrive) &gt; 0) ? </span><br><span class="line">                        current_time : sel-&gt;arrive;</span><br><span class="line">            sel-&gt;finish = add_mins(sel-&gt;start, sel-&gt;zx);</span><br><span class="line">            sel-&gt;zz = time_diff(sel-&gt;finish, sel-&gt;arrive);</span><br><span class="line">            sel-&gt;zzxs = (float)sel-&gt;zz / sel-&gt;zx;</span><br><span class="line">            </span><br><span class="line">            current_time = sel-&gt;finish;</span><br><span class="line">            processed++;</span><br><span class="line">            </span><br><span class="line">            // 从原链表移除</span><br><span class="line">            if (prev_sel) &#123;</span><br><span class="line">                *prev_sel = sel-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 尾部插入</span><br><span class="line">            sel-&gt;next = NULL;</span><br><span class="line">            if (scheduled_head == NULL) &#123;</span><br><span class="line">                scheduled_head = scheduled_tail = sel;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                scheduled_tail-&gt;next = sel;</span><br><span class="line">                scheduled_tail = sel;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            current_time.min++;</span><br><span class="line">            if (current_time.min &gt;= 60) &#123;</span><br><span class="line">                current_time.hour++;</span><br><span class="line">                current_time.min = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *head = scheduled_head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int op, n;</span><br><span class="line">    Process *head = NULL;</span><br><span class="line"></span><br><span class="line">    while(1) &#123;</span><br><span class="line">        printf(&quot;请输入操作(1：开始进程调度；-1：结束进程)：&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;op);</span><br><span class="line">        </span><br><span class="line">        if(op == -1) break;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;请输入进程数：&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;id号 名字 优先级 到达时间 执行时间\n&quot;);</span><br><span class="line">        for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">            Process *p = (Process*)malloc(sizeof(Process));</span><br><span class="line">            scanf(&quot;%d %s %d %d:%d %d&quot;, </span><br><span class="line">                 &amp;p-&gt;id, p-&gt;name, &amp;p-&gt;priority,</span><br><span class="line">                 &amp;p-&gt;arrive.hour, &amp;p-&gt;arrive.min,</span><br><span class="line">                 &amp;p-&gt;zx);</span><br><span class="line">            p-&gt;start.hour = 0;  // 初始化开始时间</span><br><span class="line">            p-&gt;next = head;</span><br><span class="line">            head = p;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sjf_scheduler(&amp;head, n);</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\n模拟优先级调度过程结果：\n&quot;);</span><br><span class="line">        printf(&quot;id号 名字 到达时间 执行时间(分钟) 开始时间 完成时间 周转时间(分钟) 带权周转系数\n&quot;);</span><br><span class="line">        </span><br><span class="line">        float total_zz = 0, total_zzxs = 0;</span><br><span class="line">        Process *p = head;</span><br><span class="line">        while(p) &#123;</span><br><span class="line">            printf(&quot;%-4d %-4s %02d:%02d %12d   %02d:%02d    %02d:%02d %15d %12.2f\n&quot;,</span><br><span class="line">                  p-&gt;id, p-&gt;name, </span><br><span class="line">                  p-&gt;arrive.hour, p-&gt;arrive.min,</span><br><span class="line">                  p-&gt;zx,</span><br><span class="line">                  p-&gt;start.hour, p-&gt;start.min,</span><br><span class="line">                  p-&gt;finish.hour, p-&gt;finish.min,</span><br><span class="line">                  p-&gt;zz,p-&gt;zzxs);</span><br><span class="line">            </span><br><span class="line">            total_zz += p-&gt;zz;</span><br><span class="line">            total_zzxs += p-&gt;zzxs;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        printf(&quot;\n系统平均周转时间为：%.2f\n&quot;, total_zz / n);</span><br><span class="line">        printf(&quot;系统平均带权周转系数为：%.2f\n\n&quot;, total_zzxs / n);</span><br><span class="line">        </span><br><span class="line">        // 内存释放</span><br><span class="line">        while(head) &#123;</span><br><span class="line">            Process *temp = head;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        head = NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">// 1001 p1 1 09:40 20</span><br><span class="line">// 1002 p2 3 09:55 15</span><br><span class="line">// 1003 p3 2 09:45 25</span><br><span class="line">// 1004 p4 4 10:10 10</span><br><span class="line">// 1005 p5 3 10:05 30</span><br></pre></td></tr></table></figure>

<h1 id="第六周：时间片轮转调度算法"><a href="#第六周：时间片轮转调度算法" class="headerlink" title="第六周：时间片轮转调度算法"></a>第六周：时间片轮转调度算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct data &#123;</span><br><span class="line">    int hour;</span><br><span class="line">    int minute;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">typedef struct node &#123;</span><br><span class="line">    int id;</span><br><span class="line">    char name[20];</span><br><span class="line">    Time arrive;</span><br><span class="line">    int zx;</span><br><span class="line">    Time start;</span><br><span class="line">    Time finish;</span><br><span class="line">    int zz;</span><br><span class="line">    float zzxs;</span><br><span class="line">    Time current;</span><br><span class="line">    int ywcs;</span><br><span class="line">    int sysj;</span><br><span class="line">    struct node* next;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line">typedef struct Queue &#123;</span><br><span class="line">    Node* front;</span><br><span class="line">    Node* tail;</span><br><span class="line">&#125; Queue;</span><br><span class="line"></span><br><span class="line">Queue* init() &#123;</span><br><span class="line">    Queue* p = (Queue*)malloc(sizeof(Queue));</span><br><span class="line">    p-&gt;front = p-&gt;tail = NULL;</span><br><span class="line">    return p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool timecompare(Time tt, Time p) &#123;</span><br><span class="line">    int t1 = tt.hour * 60 + tt.minute;</span><br><span class="line">    int t2 = p.hour * 60 + p.minute;</span><br><span class="line">    return t1 &gt;= t2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool Namecompare(const char* s1, const char* s2) &#123;</span><br><span class="line">    return strcmp(s1, s2) &lt; 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool Choose(Node* p, Node* q, int flag) &#123;</span><br><span class="line">    if (flag == 1) &#123;</span><br><span class="line">        int p_time = p-&gt;arrive.hour * 60 + p-&gt;arrive.minute;</span><br><span class="line">        int q_time = q-&gt;arrive.hour * 60 + q-&gt;arrive.minute;</span><br><span class="line">        return p_time &gt; q_time;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return Namecompare(p-&gt;name, q-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Time_or_Name_Sorted(Queue *que, int flag) &#123;</span><br><span class="line">    if (que-&gt;front == NULL || que-&gt;front-&gt;next == NULL) return;</span><br><span class="line"></span><br><span class="line">    bool swapped;</span><br><span class="line">    Node **pptr, *curr, *next;</span><br><span class="line">    do &#123;</span><br><span class="line">        swapped = false;</span><br><span class="line">        pptr = &amp;que-&gt;front;</span><br><span class="line">        curr = que-&gt;front;</span><br><span class="line">        next = curr-&gt;next;</span><br><span class="line"></span><br><span class="line">        while (next) &#123;</span><br><span class="line">            if (Choose(curr, next, flag)) &#123;</span><br><span class="line">                curr-&gt;next = next-&gt;next;</span><br><span class="line">                next-&gt;next = curr;</span><br><span class="line">                *pptr = next;</span><br><span class="line">                </span><br><span class="line">                if (curr-&gt;next == NULL) que-&gt;tail = curr;</span><br><span class="line">                swapped = true;</span><br><span class="line">                pptr = &amp;next-&gt;next;</span><br><span class="line">                next = curr-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                pptr = &amp;curr-&gt;next;</span><br><span class="line">                curr = next;</span><br><span class="line">                next = next-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while (swapped);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Time* ComputeTime(Time* tt, Node* q, int tp) &#123;</span><br><span class="line">    if (q-&gt;ywcs == 0) &#123; // 首次执行</span><br><span class="line">        q-&gt;start = *tt;</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;current = *tt; // 每次更新当前开始时间</span><br><span class="line"></span><br><span class="line">    int exec_time = (q-&gt;sysj &gt; tp) ? tp : q-&gt;sysj;</span><br><span class="line">    tt-&gt;minute += exec_time;</span><br><span class="line">    tt-&gt;hour += tt-&gt;minute / 60;</span><br><span class="line">    tt-&gt;minute %= 60;</span><br><span class="line"></span><br><span class="line">    q-&gt;ywcs += exec_time;</span><br><span class="line">    q-&gt;sysj -= exec_time;</span><br><span class="line"></span><br><span class="line">    if (q-&gt;sysj == 0) &#123;</span><br><span class="line">        q-&gt;finish = *tt;</span><br><span class="line">        int arrive_min = q-&gt;arrive.hour * 60 + q-&gt;arrive.minute;</span><br><span class="line">        int finish_min = q-&gt;finish.hour * 60 + q-&gt;finish.minute;</span><br><span class="line">        q-&gt;zz = finish_min - arrive_min;</span><br><span class="line">        q-&gt;zzxs = (float)q-&gt;zz / q-&gt;zx;</span><br><span class="line">    &#125;</span><br><span class="line">    return tt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Print_Current(Queue* que, int round, Node* curr, Time sys_time) &#123;</span><br><span class="line">    printf(&quot;\n第%d轮执行和就绪队列的结果:\n&quot;, round);</span><br><span class="line">    printf(&quot;ID号 名字　　到达时间　总执行时间　当前开始时间　已完成时间　剩余时间\n&quot;);</span><br><span class="line">    </span><br><span class="line">    if (curr) &#123;</span><br><span class="line">        printf(&quot;%-5d %-6s　%02d:%02d　　%-9d　　&quot;,</span><br><span class="line">            curr-&gt;id, curr-&gt;name, </span><br><span class="line">            curr-&gt;arrive.hour, curr-&gt;arrive.minute,</span><br><span class="line">            curr-&gt;zx);</span><br><span class="line"></span><br><span class="line">        if (curr-&gt;ywcs == 0 &amp;&amp; curr-&gt;sysj == curr-&gt;zx) &#123;</span><br><span class="line">            printf(&quot;00:00　　　&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            printf(&quot;%02d:%02d　　　&quot;,</span><br><span class="line">                curr-&gt;current.hour, curr-&gt;current.minute);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%-8d　　%-8d\n&quot;, curr-&gt;ywcs, curr-&gt;sysj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        printf(&quot;%-5d %-6s　%02d:%02d　　%-9d　　&quot;, </span><br><span class="line">            p-&gt;id, p-&gt;name, </span><br><span class="line">            p-&gt;arrive.hour, p-&gt;arrive.minute,</span><br><span class="line">            p-&gt;zx);</span><br><span class="line"></span><br><span class="line">        if (p-&gt;ywcs == 0 &amp;&amp; p-&gt;sysj == p-&gt;zx) &#123;</span><br><span class="line">            printf(&quot;00:00　　　&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            printf(&quot;%02d:%02d　　　&quot;,</span><br><span class="line">                p-&gt;current.hour, p-&gt;current.minute);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%-8d　　%-8d\n&quot;, p-&gt;ywcs, p-&gt;sysj);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void add_to_ready(Queue* ready, Queue* que, Time sys_time) &#123;</span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p &amp;&amp; timecompare(sys_time, p-&gt;arrive)) &#123;</span><br><span class="line">        Node* next = p-&gt;next;</span><br><span class="line">        p-&gt;next = NULL;</span><br><span class="line">        if (!ready-&gt;tail) &#123;</span><br><span class="line">            ready-&gt;front = ready-&gt;tail = p;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ready-&gt;tail-&gt;next = p;</span><br><span class="line">            ready-&gt;tail = p;</span><br><span class="line">        &#125;</span><br><span class="line">        que-&gt;front = next;</span><br><span class="line">        if (!next) que-&gt;tail = NULL;</span><br><span class="line">        p = next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Queue* Time_Slice_Rotation(Queue* que, int tp) &#123;</span><br><span class="line">    Queue* done = init();</span><br><span class="line">    Time sys_time = &#123;99, 99&#125;;</span><br><span class="line"></span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        int arrive_min = p-&gt;arrive.hour * 60 + p-&gt;arrive.minute;</span><br><span class="line">        int sys_min = sys_time.hour * 60 + sys_time.minute;</span><br><span class="line">        if (arrive_min &lt; sys_min) &#123;</span><br><span class="line">            sys_time = p-&gt;arrive;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Queue* ready = init();</span><br><span class="line">    Node* curr = NULL;</span><br><span class="line">    int round = 0;</span><br><span class="line"></span><br><span class="line">    while (1) &#123;</span><br><span class="line">        add_to_ready(ready, que, sys_time);</span><br><span class="line"></span><br><span class="line">        if (!curr) &#123;</span><br><span class="line">            if (ready-&gt;front) &#123;</span><br><span class="line">                curr = ready-&gt;front;</span><br><span class="line">                ready-&gt;front = ready-&gt;front-&gt;next;</span><br><span class="line">                if (!ready-&gt;front) ready-&gt;tail = NULL;</span><br><span class="line">            &#125; else if (que-&gt;front) &#123;</span><br><span class="line">                sys_time = que-&gt;front-&gt;arrive;</span><br><span class="line">                continue;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        round++;</span><br><span class="line">        Time prev_time = sys_time;</span><br><span class="line">        ComputeTime(&amp;sys_time, curr, tp);</span><br><span class="line"></span><br><span class="line">        add_to_ready(ready, que, sys_time);</span><br><span class="line"></span><br><span class="line">        Print_Current(ready, round, curr, sys_time);</span><br><span class="line"></span><br><span class="line">        if (curr-&gt;sysj == 0) &#123;</span><br><span class="line">            curr-&gt;next = done-&gt;front;</span><br><span class="line">            done-&gt;front = curr;</span><br><span class="line">            if (!done-&gt;tail) done-&gt;tail = curr;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (ready-&gt;tail) &#123;</span><br><span class="line">                ready-&gt;tail-&gt;next = curr;</span><br><span class="line">                ready-&gt;tail = curr;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                ready-&gt;front = ready-&gt;tail = curr;</span><br><span class="line">            &#125;</span><br><span class="line">            curr-&gt;next = NULL;</span><br><span class="line">        &#125;</span><br><span class="line">        curr = NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    return done;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Print(Queue* que, int n) &#123;</span><br><span class="line">    printf(&quot;\n模拟进程时间片轮转调度结果:\n&quot;);</span><br><span class="line">    printf(&quot;ID号　名字　　到达时间　执行时间　开始时间　完成时间　周转时间　带权周转\n&quot;);</span><br><span class="line">    float sum_zz = 0, sum_zzxs = 0;</span><br><span class="line">    Node* p = que-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        printf(&quot;%-5d %-6s　%02d:%02d　　%-8d　%02d:%02d　　%02d:%02d　　%-8d　%.2f\n&quot;,</span><br><span class="line">               p-&gt;id, p-&gt;name, </span><br><span class="line">               p-&gt;arrive.hour, p-&gt;arrive.minute,</span><br><span class="line">               p-&gt;zx,</span><br><span class="line">               p-&gt;start.hour, p-&gt;start.minute,</span><br><span class="line">               p-&gt;finish.hour, p-&gt;finish.minute,</span><br><span class="line">               p-&gt;zz, p-&gt;zzxs);</span><br><span class="line">        sum_zz += p-&gt;zz;</span><br><span class="line">        sum_zzxs += p-&gt;zzxs;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n系统平均周转时间: %.2f分钟\n&quot;, sum_zz / n);</span><br><span class="line">    printf(&quot;系统平均带权周转系数: %.2f\n&quot;, sum_zzxs / n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Scanln(Queue* wait, int n) &#123;</span><br><span class="line">    printf(&quot;请输入%d个进程的参数（ID 名称 到达时间 执行时间）:\n&quot;, n);</span><br><span class="line">    int i; </span><br><span class="line">    for (i = 0; i &lt; n; i++) &#123;</span><br><span class="line">        Node* p = (Node*)malloc(sizeof(Node));</span><br><span class="line">        memset(p, 0, sizeof(Node));</span><br><span class="line">        scanf(&quot;%d %s %d:%d %d&quot;, </span><br><span class="line">             &amp;p-&gt;id, p-&gt;name, </span><br><span class="line">             &amp;p-&gt;arrive.hour, &amp;p-&gt;arrive.minute,</span><br><span class="line">             &amp;p-&gt;zx);</span><br><span class="line">        p-&gt;sysj = p-&gt;zx;</span><br><span class="line">        p-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">        if (!wait-&gt;front) &#123;</span><br><span class="line">            wait-&gt;front = wait-&gt;tail = p;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            wait-&gt;tail-&gt;next = p;</span><br><span class="line">            wait-&gt;tail = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void freeQueue(Queue* q) &#123;</span><br><span class="line">    Node* p = q-&gt;front;</span><br><span class="line">    while (p) &#123;</span><br><span class="line">        Node* temp = p;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    free(q);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    Queue* wait = init();</span><br><span class="line">    int flag, n, t;</span><br><span class="line"></span><br><span class="line">    while (1) &#123;</span><br><span class="line">        printf(&quot;\n请输入操作 (1:开始调度; 0:退出): &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;flag);</span><br><span class="line">        if (flag == 0) &#123;</span><br><span class="line">            freeQueue(wait);</span><br><span class="line">            printf(&quot;操作结束!\n&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        printf(&quot;请输入进程数量: &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">        printf(&quot;请输入时间片长度(分钟): &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;t);</span><br><span class="line">        Scanln(wait, n);</span><br><span class="line"></span><br><span class="line">        Time_or_Name_Sorted(wait, 1);</span><br><span class="line">        Queue* done = Time_Slice_Rotation(wait, t);</span><br><span class="line">        Time_or_Name_Sorted(done, 0);</span><br><span class="line">        Print(done, n);</span><br><span class="line"></span><br><span class="line">        freeQueue(wait);</span><br><span class="line">        freeQueue(done);</span><br><span class="line">        wait = init();</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="第七周：-银行家算法"><a href="#第七周：-银行家算法" class="headerlink" title="第七周： 银行家算法"></a>第七周： 银行家算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#define MAX 10</span><br><span class="line"></span><br><span class="line">// 数据结构</span><br><span class="line">int zy, n;</span><br><span class="line">int Available[MAX];</span><br><span class="line">int Max[MAX][MAX], Need[MAX][MAX], Allocation[MAX][MAX];</span><br><span class="line">char Name[MAX][15];</span><br><span class="line">int safe_seq[MAX];</span><br><span class="line"></span><br><span class="line">// 函数声明</span><br><span class="line">int FindIndex(char *s);</span><br><span class="line">void PrintStatus();</span><br><span class="line">int SafetyCheck();</span><br><span class="line">void Banker();</span><br><span class="line"></span><br><span class="line">// 根据进程名找索引</span><br><span class="line">int FindIndex(char *s) &#123;</span><br><span class="line">    for(int i=0; i&lt;n; i++)</span><br><span class="line">        if(strcmp(Name[i], s) == 0)</span><br><span class="line">            return i;</span><br><span class="line">    return -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 打印当前状态（按图像格式）</span><br><span class="line">void PrintStatus() &#123;</span><br><span class="line">    printf(&quot;\n进程名\t最大需求量\t尚需求量\t已分配量\t执行状态\n&quot;);</span><br><span class="line">    for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">        printf(&quot;%s\t&quot;, Name[i]);</span><br><span class="line">        // 最大需求</span><br><span class="line">        for(int j=0; j&lt;zy; j++) </span><br><span class="line">            printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d&quot;, Max[i][j]);</span><br><span class="line">        // 尚需求</span><br><span class="line">        printf(&quot;\t &quot;);</span><br><span class="line">        for(int j=0; j&lt;zy; j++)</span><br><span class="line">            printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d&quot;, Need[i][j]);</span><br><span class="line">        // 已分配</span><br><span class="line">        printf(&quot;\t &quot;);</span><br><span class="line">        for(int j=0; j&lt;zy; j++)</span><br><span class="line">            printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d&quot;, Allocation[i][j]);</span><br><span class="line">        printf(&quot;\tWorking\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;系统剩余资源:\n&quot;);</span><br><span class="line">    for(int j=0; j&lt;zy; j++)</span><br><span class="line">        printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d\n\n&quot;, Available[j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 安全性检查算法</span><br><span class="line">int SafetyCheck() &#123;</span><br><span class="line">    int Work[MAX], Finish[MAX];</span><br><span class="line">    memcpy(Work, Available, sizeof(Work));</span><br><span class="line">    memset(Finish, 0, sizeof(Finish));</span><br><span class="line"></span><br><span class="line">    int count = 0;</span><br><span class="line">    while(count &lt; n) &#123;</span><br><span class="line">        int found = 0;</span><br><span class="line">        for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">            if(!Finish[i]) &#123;</span><br><span class="line">                int can_allocate = 1;</span><br><span class="line">                for(int j=0; j&lt;zy; j++)</span><br><span class="line">                    if(Need[i][j] &gt; Work[j]) &#123;</span><br><span class="line">                        can_allocate = 0;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                </span><br><span class="line">                if(can_allocate) &#123;</span><br><span class="line">                    for(int j=0; j&lt;zy; j++)</span><br><span class="line">                        Work[j] += Allocation[i][j];</span><br><span class="line">                    Finish[i] = 1;</span><br><span class="line">                    safe_seq[count++] = i;</span><br><span class="line">                    found = 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!found) break;</span><br><span class="line">    &#125;</span><br><span class="line">    return (count == n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 银行家算法主流程</span><br><span class="line">void Banker() &#123;</span><br><span class="line">    char pname[15];</span><br><span class="line">    int req[zy], index;</span><br><span class="line">    char choice;</span><br><span class="line">    </span><br><span class="line">    do &#123;</span><br><span class="line">        printf(&quot;请输入进程名: &quot;);</span><br><span class="line">        scanf(&quot;%s&quot;, pname);</span><br><span class="line">        index = FindIndex(pname);</span><br><span class="line">        if(index == -1) &#123;</span><br><span class="line">            printf(&quot;进程不存在!\n&quot;);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        printf(&quot;请输入该进程当前申请的各个资源数量: &quot;);</span><br><span class="line">        for(int j=0; j&lt;zy; j++)</span><br><span class="line">            scanf(&quot;%d&quot;, &amp;req[j]);</span><br><span class="line"></span><br><span class="line">        // 步骤1：检查请求合法性</span><br><span class="line">        int valid = 1;</span><br><span class="line">        for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">            if(req[j] &gt; Need[index][j] || req[j] &gt; Available[j]) &#123;</span><br><span class="line">                valid = 0;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!valid) &#123;</span><br><span class="line">            printf(&quot;申请异常！\n&quot;);</span><br><span class="line">            printf(&quot;系统可用资源如下:\n&quot;);</span><br><span class="line">            for(int j=0; j&lt;zy; j++)</span><br><span class="line">                printf(j&lt;zy-1 ? &quot;%d,&quot; : &quot;%d\n&quot;, Available[j]);</span><br><span class="line">            printf(&quot;当前进程剩余所需资源如下:\n&quot;);</span><br><span class="line">            for(int j=0; j&lt;zy; j++)</span><br><span class="line">                printf(&quot;%d,&quot;,Need[index][j]);</span><br><span class="line">            printf(&quot;\n请重新输入!&quot;);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 试探分配</span><br><span class="line">        for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">            Available[j] -= req[j];</span><br><span class="line">            Allocation[index][j] += req[j];</span><br><span class="line">            Need[index][j] -= req[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 安全性检查</span><br><span class="line">        if(SafetyCheck()) &#123;</span><br><span class="line">            printf(&quot;申请成功！安全序列为:&quot;);</span><br><span class="line">            for(int i=0; i&lt;n; i++)</span><br><span class="line">            	if(!(Need[safe_seq[i]][0]==0&amp;&amp;Need[safe_seq[i]][1]==0&amp;&amp;Need[safe_seq[i]][2]==0)) </span><br><span class="line">                	printf(&quot;%s-&gt;&quot;, Name[safe_seq[i]]);</span><br><span class="line">            printf(&quot;\b\b  \n&quot;);</span><br><span class="line">            if(Need[index][0]==0&amp;&amp;Need[index][1]==0&amp;&amp;Need[index][2]==0)&#123;</span><br><span class="line">                for(int i=0;i&lt;zy;i++)&#123;</span><br><span class="line">                    Available[i]+=Allocation[index][i];</span><br><span class="line">                    Allocation[index][i]=0;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            PrintStatus();</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            printf(&quot;无安全系列，请重新输入！\n&quot;);</span><br><span class="line">            // 回滚操作</span><br><span class="line">            for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">                Available[j] += req[j];</span><br><span class="line">                Allocation[index][j] -= req[j];</span><br><span class="line">                Need[index][j] += req[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        printf(&quot;是否需要申请资源?(Y/N): &quot;);</span><br><span class="line">        scanf(&quot; %c&quot;, &amp;choice);</span><br><span class="line">    &#125; while(toupper(choice) == &#x27;Y&#x27;);</span><br><span class="line">    PrintStatus();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    printf(&quot;请输入进程数: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">    printf(&quot;请输入资源种类的数量: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;zy);</span><br><span class="line"></span><br><span class="line">    printf(&quot;请输入%d类资源初始化的资源数: &quot;, zy);</span><br><span class="line">    for(int i=0; i&lt;zy; i++)</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;Available[i]);</span><br><span class="line"></span><br><span class="line">    printf(&quot;请输入进程信息（进程名 最大需求量）:\n&quot;);</span><br><span class="line">    for(int i=0; i&lt;n; i++) &#123;</span><br><span class="line">        scanf(&quot;%s&quot;, Name[i]);</span><br><span class="line">        for(int j=0; j&lt;zy; j++) &#123;</span><br><span class="line">            scanf(&quot;%d&quot;, &amp;Max[i][j]);</span><br><span class="line">            Need[i][j] = Max[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;\n进程开始执行！\n请为进程分配相关资源！\n&quot;);</span><br><span class="line">    Banker();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-03-25_084958.png" class="" title="2025-03-25_084958">

<h1 id="第八周：固定分区算法"><a href="#第八周：固定分区算法" class="headerlink" title="第八周：固定分区算法"></a>第八周：固定分区算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">typedef struct d&#123;  //内存分区</span><br><span class="line">    int id;</span><br><span class="line">    int size;</span><br><span class="line">    int address;  //起始地址</span><br><span class="line">    char station[10]; //状态</span><br><span class="line">&#125;memory;  </span><br><span class="line">void print(memory m[],int n)&#123;</span><br><span class="line">    printf(&quot;**********打印分区信息*************\n&quot;);</span><br><span class="line">    printf(&quot;分区号  大小  起始  状态\n&quot;);</span><br><span class="line">    int i=0;</span><br><span class="line">    for(i=0;i&lt;n;i++)&#123;</span><br><span class="line">        printf(&quot;%-7d%-7d%-7d%s\n&quot;,m[i].id,m[i].size,m[i].address,m[i].station);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int n,i;</span><br><span class="line">    memory m[10];</span><br><span class="line">    printf(&quot;请输入系统的分区块数: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;n);</span><br><span class="line">    printf(&quot;请依次输入:\n分区号  大小  起始\n&quot;);</span><br><span class="line">    for(i=0;i&lt;n;i++)&#123;</span><br><span class="line">        scanf(&quot;%d%d%d&quot;,&amp;m[i].id,&amp;m[i].size,&amp;m[i].address);</span><br><span class="line">        strcpy(m[i].station,&quot;0&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    print(m,n);</span><br><span class="line">    int num,j,x;</span><br><span class="line">    int job[10];</span><br><span class="line">    printf(&quot;请输入作业的个数: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">    printf(&quot;请输入这%d个作业的信息: \n&quot;,num);</span><br><span class="line">    for(i=0;i&lt;num;i++)&#123;</span><br><span class="line">        printf(&quot;请输入作业%d的大小: &quot;,i+1);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;x);</span><br><span class="line">        for(j=0;j&lt;n;j++)&#123;</span><br><span class="line">            if(!strcmp(m[j].station,&quot;0&quot;)&amp;&amp;m[j].size&gt;=x)&#123;</span><br><span class="line">                job[i]=x;</span><br><span class="line">                sprintf(m[j].station,&quot;JOB%d&quot;,i+1);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;打印各作业的信息: \n作业名 作业大小\n&quot;);</span><br><span class="line">    for(i=0;i&lt;num;i++)</span><br><span class="line">        printf(&quot;JOB%d  %dKB\n&quot;,i+1,job[i]);</span><br><span class="line">    print(m,n);</span><br><span class="line">    char flag;</span><br><span class="line">    printf(&quot;是否需要回收(y/n)?:&quot;);</span><br><span class="line">    scanf(&quot; %c&quot;,&amp;flag);</span><br><span class="line">    char work[10];</span><br><span class="line">    while((int)flag==(int)&#x27;y&#x27;)&#123;</span><br><span class="line">        print(m,n);</span><br><span class="line">        printf(&quot;请输入要回收的作业名:&quot;);</span><br><span class="line">        scanf(&quot; %s&quot;,&amp;work);</span><br><span class="line">        for(i=0;i&lt;n;i++)&#123;</span><br><span class="line">            if(m[i].station!=0&amp;&amp;!strcmp(m[i].station,work))&#123;</span><br><span class="line">                strcpy(m[i].station,&quot;0&quot;);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;回收成功\n&quot;);</span><br><span class="line">        print(m,n);</span><br><span class="line">        printf(&quot;是否需要回收(y/n)?:&quot;);</span><br><span class="line">        scanf(&quot; %c&quot;,&amp;flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-01_000958.png" class="" title="2025-04-01_000958">

<h1 id="第九周：可变分区算法"><a href="#第九周：可变分区算法" class="headerlink" title="第九周：可变分区算法"></a>第九周：可变分区算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">const int inf = 0x7ffffff;</span><br><span class="line"></span><br><span class="line">struct Y &#123;</span><br><span class="line">    int size;</span><br><span class="line">    int address;</span><br><span class="line">    string str;</span><br><span class="line">    Y(int x = 0, int y = 0, string t = &quot;&quot;) : size(x), address(y), str(t) &#123;&#125;</span><br><span class="line">    bool operator&lt;(const Y&amp; x) const &#123;</span><br><span class="line">        return address &lt; x.address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vector&lt;Y&gt; H, N; // H: 已分配, N: 未分配</span><br><span class="line"></span><br><span class="line">void out() &#123;</span><br><span class="line">    int num=1;</span><br><span class="line">    cout&lt;&lt;&quot;======== 主存分配情况 ========&quot;&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; &quot;\n已分配分区表：&quot; &lt;&lt; endl;</span><br><span class="line">    cout&lt;&lt;&quot;分区号&quot;&lt;&lt;&quot;\t大小&quot;&lt;&lt;&quot;\t地址&quot;&lt;&lt;&quot;\t状态&quot;&lt;&lt;endl;</span><br><span class="line">    for (auto &amp;y : H) &#123;</span><br><span class="line">        cout &lt;&lt;num&lt;&lt; &quot;\t&quot; &lt;&lt; y.size &lt;&lt; &quot;\t&quot; &lt;&lt; y.address&lt;&lt; &quot;\t&quot; &lt;&lt; y.str &lt;&lt; endl;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;\n未分配分区表：&quot; &lt;&lt; endl;</span><br><span class="line">    cout&lt;&lt;&quot;分区号&quot;&lt;&lt;&quot;\t大小&quot;&lt;&lt;&quot;\t地址&quot;&lt;&lt;&quot;\t状态&quot;&lt;&lt;endl;</span><br><span class="line">    for (auto &amp;y : N) &#123;</span><br><span class="line">        cout &lt;&lt;num&lt;&lt; &quot;\t&quot; &lt;&lt; y.size &lt;&lt; &quot;\t&quot; &lt;&lt; y.address&lt;&lt; &quot;\t&quot; &lt;&lt; y.str &lt;&lt; endl;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void menu1() &#123;</span><br><span class="line">    cout &lt;&lt; &quot;======== 可变分区管理 ========&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      1. 内存管理     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      2. 内存去配     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      0. 退出         *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;请输入选项：&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void menu2() &#123;</span><br><span class="line">    cout &lt;&lt; &quot;========= 分配算法 ==========&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      1. 最先分配算法     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      2. 最优分配算法     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;*      3. 最坏分配算法     *&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;请输入选项：&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void C1(int size, string x) &#123;</span><br><span class="line">    sort(N.begin(), N.end());</span><br><span class="line">    for (auto it = N.begin(); it &lt;= N.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;size &gt;= size &amp;&amp; it-&gt;str == &quot;空闲&quot;) &#123;</span><br><span class="line">            H.push_back(Y(size, it-&gt;address, x));</span><br><span class="line">            if(it-&gt;size &gt; size)&#123;</span><br><span class="line">                int s=it-&gt;size,a=it-&gt;address;</span><br><span class="line">                N.erase(it);</span><br><span class="line">                N.push_back(Y(s - size, a + size, &quot;空闲&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">            else N.erase(it);</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            sort(H.begin(), H.end());</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;分配失败：无足够空闲分区！&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void C2(int size, string x) &#123;</span><br><span class="line">    sort(N.begin(), N.end(), [](Y a, Y b) &#123; return a.size &lt; b.size; &#125;);</span><br><span class="line">    for (auto it = N.begin(); it != N.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;size &gt;= size &amp;&amp; it-&gt;str == &quot;空闲&quot;) &#123;</span><br><span class="line">            H.push_back(Y(size, it-&gt;address, x));</span><br><span class="line">            if (it-&gt;size &gt; size) &#123;</span><br><span class="line">                N.insert(it + 1, Y(it-&gt;size - size, it-&gt;address + size, &quot;空闲&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">            N.erase(it);</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;分配失败：无足够空闲分区！&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void C3(int size, string x) &#123;</span><br><span class="line">    sort(N.begin(), N.end(), [](Y a, Y b) &#123; return a.size &gt; b.size; &#125;);</span><br><span class="line">    for (auto it = N.begin(); it != N.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;size &gt;= size &amp;&amp; it-&gt;str == &quot;空闲&quot;) &#123;</span><br><span class="line">            H.push_back(Y(size, it-&gt;address, x));</span><br><span class="line">            if (it-&gt;size &gt; size) &#123;</span><br><span class="line">                N.insert(it + 1, Y(it-&gt;size - size, it-&gt;address + size, &quot;空闲&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">            N.erase(it);</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;分配失败：无足够空闲分区！&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void D(string x) &#123;</span><br><span class="line">    for (auto it = H.begin(); it != H.end(); ++it) &#123;</span><br><span class="line">        if (it-&gt;str == x) &#123;</span><br><span class="line">            Y freed = *it;</span><br><span class="line">            H.erase(it);</span><br><span class="line">            N.push_back(Y(freed.size, freed.address, &quot;空闲&quot;));</span><br><span class="line">            sort(N.begin(), N.end());</span><br><span class="line">            </span><br><span class="line">            // 合并相邻分区</span><br><span class="line">            auto nit = N.begin();</span><br><span class="line">            while (nit != N.end()) &#123;</span><br><span class="line">                auto next = nit + 1;</span><br><span class="line">                if (next != N.end() &amp;&amp; nit-&gt;address + nit-&gt;size == next-&gt;address) &#123;</span><br><span class="line">                    next-&gt;size += nit-&gt;size;</span><br><span class="line">                    next-&gt;address = nit-&gt;address;</span><br><span class="line">                    nit = N.erase(nit); // 这里一定要对next进行操作，因为erase返回的是删除项的下一项，如果对nit进行操作，可能会跳过连续合并的情况</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    ++nit;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; &quot;回收成功！&quot; &lt;&lt; endl;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;回收失败：未找到该作业！&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int n, m;</span><br><span class="line">    cout &lt;&lt; &quot;请输入内存大小：&quot;;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    cout &lt;&lt; &quot;请输入起始地址：&quot;;</span><br><span class="line">    cin &gt;&gt; m;</span><br><span class="line">    N.push_back(Y(n, m, &quot;空闲&quot;));</span><br><span class="line">    out();</span><br><span class="line">    </span><br><span class="line">   int f;</span><br><span class="line">   do &#123;</span><br><span class="line">       menu1();</span><br><span class="line">       cin &gt;&gt; f;</span><br><span class="line">       switch (f) &#123;</span><br><span class="line">           case 1: &#123;</span><br><span class="line">               menu2();</span><br><span class="line">               int flag;</span><br><span class="line">               cin &gt;&gt; flag;</span><br><span class="line">               string tmp;</span><br><span class="line">               int size;</span><br><span class="line">               cout &lt;&lt; &quot;请输入作业名：&quot;;</span><br><span class="line">               cin &gt;&gt; tmp;</span><br><span class="line">               cout &lt;&lt; &quot;请输入分配大小：&quot;;</span><br><span class="line">               cin &gt;&gt; size;</span><br><span class="line">               if (flag == 1) C1(size, tmp);</span><br><span class="line">               else if (flag == 2) C2(size, tmp);</span><br><span class="line">               else if (flag == 3) C3(size, tmp);</span><br><span class="line">               out();</span><br><span class="line">               break;</span><br><span class="line">           &#125;</span><br><span class="line">           case 2: &#123;</span><br><span class="line">               string tmp;</span><br><span class="line">               out();</span><br><span class="line">               cout &lt;&lt; &quot;请输入回收的作业名：&quot;;</span><br><span class="line">               cin &gt;&gt; tmp;</span><br><span class="line">               D(tmp);</span><br><span class="line">               out();</span><br><span class="line">               break;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; while (f != 0);</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-07_213522.png" class="" title="2025-04-07_213522">

<h1 id="第十周：分页分区算法"><a href="#第十周：分页分区算法" class="headerlink" title="第十周：分页分区算法"></a>第十周：分页分区算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#include&lt;time.h&gt;</span><br><span class="line">#include&lt;stdint.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#define Max 100</span><br><span class="line">typedef struct k&#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    int size[Max][2];</span><br><span class="line">    struct k* next;</span><br><span class="line">    int sizenum;   //块的个数 </span><br><span class="line">&#125;node;</span><br><span class="line">int memorysize;</span><br><span class="line">int wordlength;</span><br><span class="line">int blocksize;</span><br><span class="line">int blocknum=0;  //可用物理块数</span><br><span class="line">int sys[2000];</span><br><span class="line">node *n;</span><br><span class="line">void print_sys()&#123;</span><br><span class="line">    int i,j;</span><br><span class="line">    printf(&quot;主存位示图如下:\n&quot;);</span><br><span class="line">    printf(&quot;    &quot;);</span><br><span class="line">    for(i=0;i&lt;wordlength;i++)&#123;</span><br><span class="line">    	printf(&quot;%-2d&quot;,i);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n0 | &quot;);</span><br><span class="line">    for(i=0;i&lt;memorysize;i++)&#123;</span><br><span class="line">        printf(&quot;%d &quot;,sys[i]);</span><br><span class="line">        if((i+1)%wordlength==0) printf(&quot;\n%-2d| &quot;,i/wordlength+1);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n剩余物理块数:%d\n&quot;,blocknum);</span><br><span class="line">&#125;</span><br><span class="line">void print_table(char s[])&#123;  //打印页表 </span><br><span class="line">	node *p;</span><br><span class="line">	p=n-&gt;next;</span><br><span class="line">	int i;</span><br><span class="line">	printf(&quot;------打印%s作业的页表-------\n&quot;,s);</span><br><span class="line">	while(p!=NULL)&#123;</span><br><span class="line">		if(!strcmp(s,p-&gt;name)) break;</span><br><span class="line">		printf(&quot;1\n&quot;);</span><br><span class="line">		p=p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	if(p==NULL)&#123;</span><br><span class="line">		printf(&quot;未找到该作业\n&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	for(i=0;i&lt;p-&gt;sizenum;i++)&#123;</span><br><span class="line">		printf(&quot;    %-4d%-4d\n&quot;,p-&gt;size[i][0],p-&gt;size[i][1]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">int operation()&#123;</span><br><span class="line">	int o;</span><br><span class="line">	printf(&quot;\n********分页式管理*********&quot;);</span><br><span class="line">	printf(&quot;\n    *   1、内存分配   *    &quot;);</span><br><span class="line">	printf(&quot;\n    *   2、内存去配   *    &quot;);</span><br><span class="line">	printf(&quot;\n    *   0、退出       *    &quot;);</span><br><span class="line">	printf(&quot;\n        请输入选项:&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;o);</span><br><span class="line">	return o;</span><br><span class="line">&#125;</span><br><span class="line">void mem_malloc()&#123;  //内存分配 </span><br><span class="line">	int num;</span><br><span class="line">	node *p;</span><br><span class="line">	p=(node *)malloc(sizeof(node));</span><br><span class="line">	p-&gt;next=NULL;</span><br><span class="line">	printf(&quot;请输入作业名:&quot;);</span><br><span class="line">	scanf(&quot;%s&quot;,p-&gt;name);</span><br><span class="line">	printf(&quot;请输入需要分配的大小:&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;num);</span><br><span class="line">	num/=blocksize;</span><br><span class="line">	p-&gt;sizenum=num;</span><br><span class="line">	if(num&gt;blocknum)&#123;</span><br><span class="line">		printf(&quot;空间不足!\n&quot;);</span><br><span class="line">		return; </span><br><span class="line">	&#125;</span><br><span class="line">	int i=0,j=0,k;</span><br><span class="line">	for(j=0;j&lt;num;j++) p-&gt;size[j][0]=j;</span><br><span class="line">	for(k=0;k&lt;num;k++)&#123;</span><br><span class="line">		for(i;i&lt;memorysize;i++)&#123;</span><br><span class="line">			if(sys[i]==1) continue;</span><br><span class="line">			sys[i]=1;</span><br><span class="line">			blocknum--;</span><br><span class="line">			p-&gt;size[k][1]=i;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	node *q;</span><br><span class="line">	q=n;</span><br><span class="line">	while(q-&gt;next!=NULL)&#123;</span><br><span class="line">		q=q-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	q-&gt;next=p;</span><br><span class="line">	printf(&quot;分配成功!\n&quot;);</span><br><span class="line">	print_sys();</span><br><span class="line">	print_table(p-&gt;name);</span><br><span class="line">&#125;</span><br><span class="line">void mem_free()&#123;  //内存去配</span><br><span class="line"> 	char s[10];</span><br><span class="line">	printf(&quot;请输入你需要释放的作业:&quot;);</span><br><span class="line">	scanf(&quot; %s&quot;,s);</span><br><span class="line">	node *p;</span><br><span class="line">	node *q;</span><br><span class="line">	p=n-&gt;next;</span><br><span class="line">	q=n;</span><br><span class="line">	int i;</span><br><span class="line">	while(p!=NULL)&#123;</span><br><span class="line">		if(!strcmp(s,p-&gt;name)) break;</span><br><span class="line">		printf(&quot;%s\n&quot;,p-&gt;name);</span><br><span class="line">		p=p-&gt;next;</span><br><span class="line">		q=q-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	if(p==NULL)&#123;</span><br><span class="line">		printf(&quot;无此作业,回收失败!\n&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	q-&gt;next=p-&gt;next;</span><br><span class="line">	for(i=0;i&lt;p-&gt;sizenum;i++)&#123;</span><br><span class="line">		sys[p-&gt;size[i][1]]=0;</span><br><span class="line">		blocknum++;</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;该作业回收成功!\n&quot;);</span><br><span class="line">	print_sys();</span><br><span class="line">	free(p);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	srand(time(NULL));</span><br><span class="line">    printf(&quot;请输入系统内存空间大小:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;memorysize);</span><br><span class="line">    printf(&quot;请输入字长16/32/64:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;wordlength);</span><br><span class="line">    printf(&quot;请输入物理块大小:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;blocksize);</span><br><span class="line">    int i,j,num=0;</span><br><span class="line">    for(i=0;i&lt;memorysize;i++)&#123;</span><br><span class="line">        sys[i]=rand()%2;</span><br><span class="line">        if(sys[i]==0) blocknum++;</span><br><span class="line">        srand(i);</span><br><span class="line">    &#125;</span><br><span class="line">    print_sys();</span><br><span class="line">    n=(node *)malloc(sizeof(node));</span><br><span class="line">    n-&gt;next=NULL;</span><br><span class="line">    while(1)&#123;</span><br><span class="line">    	switch(operation())&#123;</span><br><span class="line">    		case 1:</span><br><span class="line">    			print_sys();</span><br><span class="line">    			mem_malloc();</span><br><span class="line">    			break;</span><br><span class="line">    		case 2:</span><br><span class="line">    			print_sys();</span><br><span class="line">    			mem_free();</span><br><span class="line">    			break;</span><br><span class="line">    		case 0:</span><br><span class="line">    			exit(0);</span><br><span class="line">    		default:</span><br><span class="line">    			continue;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-14_225430.png" class="" title="2025-04-14_225430">

<h1 id="第十一周（选做）：段页式存储管理"><a href="#第十一周（选做）：段页式存储管理" class="headerlink" title="第十一周（选做）：段页式存储管理"></a>第十一周（选做）：段页式存储管理</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_MEMORY 2000</span><br><span class="line"></span><br><span class="line">typedef struct PageEntry &#123;</span><br><span class="line">    int page_num;</span><br><span class="line">    int block_num;</span><br><span class="line">    struct PageEntry* next;</span><br><span class="line">&#125; PageEntry;</span><br><span class="line"></span><br><span class="line">typedef struct SegmentEntry &#123;</span><br><span class="line">    int seg_num;</span><br><span class="line">    int page_count;</span><br><span class="line">    PageEntry* page_table;  //页表</span><br><span class="line">    struct SegmentEntry* next;</span><br><span class="line">&#125; SegmentEntry;</span><br><span class="line"></span><br><span class="line">typedef struct Job &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">	int job_length; //作业大小</span><br><span class="line">    int seg_count;  //段数</span><br><span class="line">    SegmentEntry* seg_table;//段表</span><br><span class="line">    struct Job* next;</span><br><span class="line">&#125; Job;</span><br><span class="line"></span><br><span class="line">int memory_size;</span><br><span class="line">int word_length;</span><br><span class="line">int block_size;</span><br><span class="line">int free_blocks = 0;</span><br><span class="line">int bitmap[MAX_MEMORY];</span><br><span class="line">Job* job_list = NULL;</span><br><span class="line"></span><br><span class="line">void print_bitmap() &#123;</span><br><span class="line">    int i,j;</span><br><span class="line">    printf(&quot;主存位示图如下:\n&quot;);</span><br><span class="line">    printf(&quot;  &quot;);</span><br><span class="line">    for(i=0;i&lt;word_length;i++)&#123;</span><br><span class="line">    	printf(&quot; %2d&quot;,i);</span><br><span class="line">	&#125;</span><br><span class="line">    for(i=0;i&lt;memory_size;i++)&#123;</span><br><span class="line">		if(i%word_length==0) printf(&quot;\n%-2d| &quot;,i/word_length);</span><br><span class="line">        printf(&quot;%-2d &quot;,bitmap[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n剩余物理块数:%d\n&quot;,free_blocks);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_job_table(char name[]) &#123;</span><br><span class="line">    </span><br><span class="line">    Job* curr = job_list;</span><br><span class="line">    while (curr != NULL &amp;&amp; strcmp(curr-&gt;name, name) != 0)</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    </span><br><span class="line">    if (curr == NULL) &#123;</span><br><span class="line">        printf(&quot;作业不存在！\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;\n作业 %s 的分配情况如下：\n&quot;, name);</span><br><span class="line">    SegmentEntry* seg = curr-&gt;seg_table;</span><br><span class="line">    while (seg != NULL) &#123;</span><br><span class="line">        printf(&quot;  第%d段:\n&quot;, seg-&gt;seg_num);</span><br><span class="line">		printf(&quot;      页号   块号\n&quot;);</span><br><span class="line">        PageEntry* page = seg-&gt;page_table;</span><br><span class="line">        while (page != NULL) &#123;</span><br><span class="line">            printf(&quot;      %-7d%d\n&quot;, </span><br><span class="line">                   page-&gt;page_num, page-&gt;block_num);</span><br><span class="line">            page = page-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void allocate_memory() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    int seg_count, total_pages = 0;</span><br><span class="line">	int len=0;</span><br><span class="line">	print_bitmap();</span><br><span class="line">    </span><br><span class="line">    printf(&quot;\n输入作业名: &quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, name);</span><br><span class="line">    </span><br><span class="line">    // 检查重名</span><br><span class="line">    Job* curr = job_list;</span><br><span class="line">    while (curr != NULL) &#123;</span><br><span class="line">        if (strcmp(curr-&gt;name, name) == 0) &#123;</span><br><span class="line">            printf(&quot;作业名已存在！\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">	printf(&quot;请输入%s所需主存大小: &quot;,name);</span><br><span class="line">	scanf(&quot;%d&quot;,&amp;len);</span><br><span class="line">	if(len/word_length&gt;free_blocks)&#123;</span><br><span class="line">		printf(&quot;空间不足!\n&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;请输入要将作业分为几段: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;seg_count);</span><br><span class="line">	int free_size=len; </span><br><span class="line">    int* pages_per_seg = (int*)malloc(seg_count * sizeof(int));</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; seg_count; i++) &#123;</span><br><span class="line">        printf(&quot;剩余%d的内存未分配,请输入第%d段的大小: &quot;,free_size, i);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;pages_per_seg[i]);</span><br><span class="line">		printf(&quot;内存分配成功!\n&quot;);</span><br><span class="line">		free_size-=pages_per_seg[i];</span><br><span class="line">        total_pages += pages_per_seg[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 创建新作业</span><br><span class="line">    Job* new_job = (Job*)malloc(sizeof(Job));</span><br><span class="line">	new_job-&gt;job_length=len;</span><br><span class="line">    strcpy(new_job-&gt;name, name);</span><br><span class="line">    new_job-&gt;seg_count = seg_count;</span><br><span class="line">    new_job-&gt;seg_table = NULL;</span><br><span class="line">    new_job-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">    // 分配段表</span><br><span class="line">    for (int i = 0; i &lt; seg_count; i++) &#123;</span><br><span class="line">        SegmentEntry* seg = (SegmentEntry*)malloc(sizeof(SegmentEntry));</span><br><span class="line">        seg-&gt;seg_num = i;</span><br><span class="line">        seg-&gt;page_count = pages_per_seg[i];</span><br><span class="line">        seg-&gt;page_table = NULL;</span><br><span class="line">        seg-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">        // 分配页表</span><br><span class="line">        for (int j = 0; j &lt; pages_per_seg[i]; j++) &#123;</span><br><span class="line">            // 查找空闲块</span><br><span class="line">            int k;</span><br><span class="line">            for (k = 0; k &lt; memory_size; k++) &#123;</span><br><span class="line">                if (bitmap[k] == 0) break;</span><br><span class="line">            &#125;</span><br><span class="line">            if (k &gt;= memory_size) &#123;</span><br><span class="line">                printf(&quot;分配意外失败！\n&quot;);</span><br><span class="line">                free(pages_per_seg);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 更新位示图</span><br><span class="line">            bitmap[k] = 1;</span><br><span class="line">            free_blocks--;</span><br><span class="line"></span><br><span class="line">            // 创建页表项</span><br><span class="line">            PageEntry* page = (PageEntry*)malloc(sizeof(PageEntry));</span><br><span class="line">            page-&gt;page_num = j;</span><br><span class="line">            page-&gt;block_num = k;</span><br><span class="line">            page-&gt;next = NULL;</span><br><span class="line"></span><br><span class="line">            // 添加到页表</span><br><span class="line">            if (seg-&gt;page_table == NULL) &#123;</span><br><span class="line">                seg-&gt;page_table = page;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                PageEntry* p = seg-&gt;page_table;</span><br><span class="line">                while (p-&gt;next != NULL) p = p-&gt;next;</span><br><span class="line">                p-&gt;next = page;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 添加到段表</span><br><span class="line">        if (new_job-&gt;seg_table == NULL) &#123;</span><br><span class="line">            new_job-&gt;seg_table = seg;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            SegmentEntry* s = new_job-&gt;seg_table;</span><br><span class="line">            while (s-&gt;next != NULL) s = s-&gt;next;</span><br><span class="line">            s-&gt;next = seg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 添加到作业链表</span><br><span class="line">    if (job_list == NULL) &#123;</span><br><span class="line">        job_list = new_job;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        Job* p = job_list;</span><br><span class="line">        while (p-&gt;next != NULL) p = p-&gt;next;</span><br><span class="line">        p-&gt;next = new_job;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    free(pages_per_seg);</span><br><span class="line">    print_bitmap();</span><br><span class="line">	print_job_table(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void free_memory() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    printf(&quot;\n请输入作业名: &quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, name);</span><br><span class="line"></span><br><span class="line">    Job *prev = NULL, *curr = job_list;</span><br><span class="line">    while (curr != NULL &amp;&amp; strcmp(curr-&gt;name, name) != 0) &#123;</span><br><span class="line">        prev = curr;</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (curr == NULL) &#123;</span><br><span class="line">        printf(&quot;作业不存在！\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 从链表移除</span><br><span class="line">    if (prev == NULL) &#123;</span><br><span class="line">        job_list = curr-&gt;next;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        prev-&gt;next = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 释放段表</span><br><span class="line">    SegmentEntry* seg = curr-&gt;seg_table;</span><br><span class="line">    while (seg != NULL) &#123;</span><br><span class="line">        // 释放页表</span><br><span class="line">        PageEntry* page = seg-&gt;page_table;</span><br><span class="line">        while (page != NULL) &#123;</span><br><span class="line">            bitmap[page-&gt;block_num] = 0; // 更新位示图</span><br><span class="line">            free_blocks++;</span><br><span class="line">            PageEntry* temp = page;</span><br><span class="line">            page = page-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        SegmentEntry* temp_seg = seg;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">        free(temp_seg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    free(curr);</span><br><span class="line">    printf(&quot;去配成功！\n&quot;, name);</span><br><span class="line">    print_bitmap();</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    srand(time(NULL));</span><br><span class="line">    </span><br><span class="line">    printf(&quot;请输入内存总大小: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;memory_size);</span><br><span class="line">    printf(&quot;请输入系统字长大小（16/32/64）: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;word_length);</span><br><span class="line">    printf(&quot;请输入块长: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;block_size);</span><br><span class="line"></span><br><span class="line">    // 初始化位示图</span><br><span class="line">    free_blocks = 0;</span><br><span class="line">    for (int i = 0; i &lt; memory_size; i++) &#123;</span><br><span class="line">        bitmap[i] = rand() % 2;</span><br><span class="line">        if (bitmap[i] == 0) free_blocks++;</span><br><span class="line">    &#125;</span><br><span class="line">	print_bitmap();</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        printf(&quot;\n********可变分区管理*********&quot;);</span><br><span class="line">		printf(&quot;\n    *   1、内存分配   *    &quot;);</span><br><span class="line">		printf(&quot;\n    *   2、内存去配   *    &quot;);</span><br><span class="line">		printf(&quot;\n    *   0、退出       *   &quot;);</span><br><span class="line">		printf(&quot;\n        请输入选项:&quot;);</span><br><span class="line">        </span><br><span class="line">        int choice;</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">        </span><br><span class="line">        switch (choice) &#123;</span><br><span class="line">            case 1: allocate_memory(); break;</span><br><span class="line">            case 2: free_memory(); break;</span><br><span class="line">            case 0: exit(0);</span><br><span class="line">            default: printf(&quot;无效选项！\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-21_234800.png" class="" title="2025-04-21_234800">

<h1 id="第十一周：分段式存储管理"><a href="#第十一周：分段式存储管理" class="headerlink" title="第十一周：分段式存储管理"></a>第十一周：分段式存储管理</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">// 分区节点结构体</span><br><span class="line">typedef struct link_node &#123;</span><br><span class="line">    int id;              // 分区ID</span><br><span class="line">    int size;            // 分区大小</span><br><span class="line">    int address;         // 起始地址</span><br><span class="line">    char flag[20];       // 状态</span><br><span class="line">    struct link_node* next;</span><br><span class="line">&#125; node;</span><br><span class="line"></span><br><span class="line">// 段表</span><br><span class="line">typedef struct segment_node &#123;</span><br><span class="line">    char job_name[20];   // 作业名称</span><br><span class="line">    int segments[10][3]; // [段号][大小, 基地址]</span><br><span class="line">    int segment_count;   // 段数量</span><br><span class="line">    struct segment_node* next;</span><br><span class="line">&#125; segmentNode;</span><br><span class="line"></span><br><span class="line">// 内存节点</span><br><span class="line">typedef struct memory_node &#123;</span><br><span class="line">    int size;    // 内存大小</span><br><span class="line">    int address; // 起始地址 </span><br><span class="line">&#125; memoryNode;</span><br><span class="line"></span><br><span class="line">// 全局变量</span><br><span class="line">memoryNode memory;</span><br><span class="line">node* free_list = NULL;      // 空闲分区链表</span><br><span class="line">node* allocated_list = NULL; // 已分配分区链表</span><br><span class="line">segmentNode* segment_list = NULL; // 段表链表</span><br><span class="line">int partition_id = 1;        // 全局分区ID计数器</span><br><span class="line"></span><br><span class="line">void initialize_memory();</span><br><span class="line">void display_menu();</span><br><span class="line">void display_partitions();</span><br><span class="line">node* find_first_fit(int size);</span><br><span class="line">void allocate_memory();</span><br><span class="line">void deallocate_memory();</span><br><span class="line">void add_segment(char* job_name, int segment_num, int size, int base_addr);</span><br><span class="line">void print_segment_table(char* job_name);</span><br><span class="line">void merge_free_partitions();</span><br><span class="line">int get_next_id();</span><br><span class="line">// 使用一个空闲分区初始化内存</span><br><span class="line">void initialize_memory() &#123;</span><br><span class="line">    node* new_node = (node*)malloc(sizeof(node));</span><br><span class="line">    new_node-&gt;id = partition_id++;</span><br><span class="line">    new_node-&gt;size = memory.size;</span><br><span class="line">    new_node-&gt;address = memory.address;</span><br><span class="line">    strcpy(new_node-&gt;flag, &quot;空闲&quot;);</span><br><span class="line">    new_node-&gt;next = NULL;</span><br><span class="line">    free_list = new_node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 显示菜单</span><br><span class="line">void display_menu() &#123;</span><br><span class="line">    printf(&quot;*********可变分区管理**********\n&quot;);</span><br><span class="line">    printf(&quot;   *     1.内存分配      *\n&quot;);</span><br><span class="line">    printf(&quot;   *     2.内存去配      *\n&quot;);</span><br><span class="line">    printf(&quot;   *     0.退出          *\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 显示当前分区状态</span><br><span class="line">void display_partitions() &#123;</span><br><span class="line">    printf(&quot;******************主存分配情况*********************\n&quot;);</span><br><span class="line">    printf(&quot;已分配：\n&quot;);</span><br><span class="line">    printf(&quot;分配号  大小（KB）      起始（KB）      状态\n&quot;);</span><br><span class="line">    node* current = allocated_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        printf(&quot;%-8d%-16d%-16d%s\n&quot;, current-&gt;id, current-&gt;size, current-&gt;address, current-&gt;flag);</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;\n未分配：\n&quot;);</span><br><span class="line">    printf(&quot;分配号  大小（KB）      起始（KB）      状态\n&quot;);</span><br><span class="line">    current = free_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        printf(&quot;%-8d%-16d%-16d%s\n&quot;, current-&gt;id, current-&gt;size, current-&gt;address, current-&gt;flag);</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查找首次适应的空闲分区</span><br><span class="line">node* find_first_fit(int size) &#123;</span><br><span class="line">    node* current = free_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        if (current-&gt;size &gt;= size) &#123;</span><br><span class="line">            return current;</span><br><span class="line">        &#125;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    return NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 为作业分配内存</span><br><span class="line">void allocate_memory() &#123;</span><br><span class="line">    char job_name[20];</span><br><span class="line">    int total_size, segments, remaining_size;</span><br><span class="line">    printf(&quot;请输入作业名:&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    printf(&quot;请输入%s需要分配的主存大小:&quot;, job_name);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;total_size);</span><br><span class="line">    printf(&quot;请输入要分成几段：&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;segments);</span><br><span class="line">    </span><br><span class="line">    remaining_size = total_size;</span><br><span class="line">    int segment_sizes[10];</span><br><span class="line">    </span><br><span class="line">    // 逐个分配每个段</span><br><span class="line">    for (int i = 0; i &lt; segments; i++) &#123;</span><br><span class="line">        printf(&quot;剩余%dKB的内存，请输入第%d段的大小：&quot;, remaining_size, i + 1);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;segment_sizes[i]);</span><br><span class="line">        if (segment_sizes[i] &gt; remaining_size) &#123;</span><br><span class="line">            printf(&quot;段大小超过剩余内存，分配失败！\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        remaining_size -= segment_sizes[i];</span><br><span class="line">        </span><br><span class="line">        // 查找空闲分区</span><br><span class="line">        node* free_partition = find_first_fit(segment_sizes[i]);</span><br><span class="line">        if (!free_partition) &#123;</span><br><span class="line">            printf(&quot;没有足够的空闲分区，分配失败！\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 创建已分配分区（复用空闲分区ID）</span><br><span class="line">        node* allocated = (node*)malloc(sizeof(node));</span><br><span class="line">        allocated-&gt;id = free_partition-&gt;id;</span><br><span class="line">        allocated-&gt;size = segment_sizes[i];</span><br><span class="line">        allocated-&gt;address = free_partition-&gt;address;</span><br><span class="line">        sprintf(allocated-&gt;flag, &quot;%s%d&quot;, job_name, i);</span><br><span class="line">        allocated-&gt;next = NULL;</span><br><span class="line">        </span><br><span class="line">        // 添加到已分配链表</span><br><span class="line">        if (!allocated_list) &#123;</span><br><span class="line">            allocated_list = allocated;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            node* temp = allocated_list;</span><br><span class="line">            while (temp-&gt;next) temp = temp-&gt;next;</span><br><span class="line">            temp-&gt;next = allocated;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 更新空闲分区</span><br><span class="line">        free_partition-&gt;size -= segment_sizes[i];</span><br><span class="line">        free_partition-&gt;address += segment_sizes[i];</span><br><span class="line">        if (free_partition-&gt;size == 0) &#123;</span><br><span class="line">            // 移除空空闲分区</span><br><span class="line">            node* prev = NULL;</span><br><span class="line">            node* current = free_list;</span><br><span class="line">            while (current != free_partition) &#123;</span><br><span class="line">                prev = current;</span><br><span class="line">                current = current-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            if (prev) &#123;</span><br><span class="line">                prev-&gt;next = free_partition-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                free_list = free_partition-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            free(free_partition);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 为剩余空闲分区分配新ID</span><br><span class="line">            free_partition-&gt;id = get_next_id();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 添加到段表</span><br><span class="line">        add_segment(job_name, i, segment_sizes[i], allocated-&gt;address);</span><br><span class="line">        display_partitions();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (remaining_size != 0) &#123;</span><br><span class="line">        printf(&quot;分配的段大小总和不等于总大小，分配失败！\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;分配成功！\n&quot;);</span><br><span class="line">    printf(&quot;************打印%s段表************\n&quot;, job_name);</span><br><span class="line">    print_segment_table(job_name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取下一个可用ID</span><br><span class="line">int get_next_id() &#123;</span><br><span class="line">    int max_id = 0;</span><br><span class="line">    node* current = allocated_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        if (current-&gt;id &gt; max_id) max_id = current-&gt;id;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    return max_id + 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 释放作业占用的内存</span><br><span class="line">void deallocate_memory() &#123;</span><br><span class="line">    display_partitions();</span><br><span class="line">    char job_name[20];</span><br><span class="line">    printf(&quot;请输入您想回收的作业名：&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    </span><br><span class="line">    // 在段表中查找对应的段</span><br><span class="line">    segmentNode* seg = segment_list;</span><br><span class="line">    int found = 0;</span><br><span class="line">    while (seg) &#123;</span><br><span class="line">        if (strcmp(seg-&gt;job_name, job_name) == 0) &#123;</span><br><span class="line">            found = 1;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!found) &#123;</span><br><span class="line">        printf(&quot;未找到作业%s的段表！\n&quot;, job_name);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 处理每个段</span><br><span class="line">    for (int i = 0; i &lt; seg-&gt;segment_count; i++) &#123;</span><br><span class="line">        char segment_flag[20];</span><br><span class="line">        sprintf(segment_flag, &quot;%s%d&quot;, job_name, i);</span><br><span class="line">        </span><br><span class="line">        // 从已分配链表中查找并移除</span><br><span class="line">        node* prev = NULL;</span><br><span class="line">        node* current = allocated_list;</span><br><span class="line">        while (current &amp;&amp; strcmp(current-&gt;flag, segment_flag) != 0) &#123;</span><br><span class="line">            prev = current;</span><br><span class="line">            current = current-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        if (current) &#123;</span><br><span class="line">            if (prev) &#123;</span><br><span class="line">                prev-&gt;next = current-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                allocated_list = current-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 创建新空闲分区</span><br><span class="line">            node* new_free = (node*)malloc(sizeof(node));</span><br><span class="line">            new_free-&gt;id = get_next_id();</span><br><span class="line">            new_free-&gt;size = current-&gt;size;</span><br><span class="line">            new_free-&gt;address = current-&gt;address;</span><br><span class="line">            strcpy(new_free-&gt;flag, &quot;空闲&quot;);</span><br><span class="line">            new_free-&gt;next = NULL;</span><br><span class="line">            </span><br><span class="line">            // 添加到空闲链表</span><br><span class="line">            if (!free_list) &#123;</span><br><span class="line">                free_list = new_free;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                node* temp = free_list;</span><br><span class="line">                while (temp-&gt;next) temp = temp-&gt;next;</span><br><span class="line">                temp-&gt;next = new_free;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            free(current);</span><br><span class="line">            printf(&quot;回收%s的段%s成功！\n&quot;, job_name, segment_flag);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 从段表链表中移除</span><br><span class="line">    segmentNode* prev_seg = NULL;</span><br><span class="line">    seg = segment_list;</span><br><span class="line">    while (seg &amp;&amp; strcmp(seg-&gt;job_name, job_name) != 0) &#123;</span><br><span class="line">        prev_seg = seg;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    if (seg) &#123;</span><br><span class="line">        if (prev_seg) &#123;</span><br><span class="line">            prev_seg-&gt;next = seg-&gt;next;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            segment_list = seg-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        free(seg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 合并相邻的空闲分区</span><br><span class="line">    merge_free_partitions();</span><br><span class="line">    </span><br><span class="line">    // 为所有空闲分区更新ID</span><br><span class="line">    node* current = free_list;</span><br><span class="line">    int new_id = get_next_id();</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        current-&gt;id = new_id++;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    display_partitions();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 添加段到段表</span><br><span class="line">void add_segment(char* job_name, int segment_num, int size, int base_addr) &#123;</span><br><span class="line">    segmentNode* seg = segment_list;</span><br><span class="line">    while (seg &amp;&amp; strcmp(seg-&gt;job_name, job_name) != 0) &#123;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (!seg) &#123;</span><br><span class="line">        // 创建新段表节点并添加到链表头部</span><br><span class="line">        seg = (segmentNode*)malloc(sizeof(segmentNode));</span><br><span class="line">        strcpy(seg-&gt;job_name, job_name);</span><br><span class="line">        seg-&gt;segment_count = 0;</span><br><span class="line">        seg-&gt;next = segment_list;</span><br><span class="line">        segment_list = seg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    seg-&gt;segments[seg-&gt;segment_count][0] = segment_num;</span><br><span class="line">    seg-&gt;segments[seg-&gt;segment_count][1] = size;</span><br><span class="line">    seg-&gt;segments[seg-&gt;segment_count][2] = base_addr;</span><br><span class="line">    seg-&gt;segment_count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 打印作业的段表</span><br><span class="line">void print_segment_table(char* job_name) &#123;</span><br><span class="line">    printf(&quot;段号    段长    基址\n&quot;);</span><br><span class="line">    segmentNode* seg = segment_list;</span><br><span class="line">    while (seg &amp;&amp; strcmp(seg-&gt;job_name, job_name) != 0) &#123;</span><br><span class="line">        seg = seg-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    if (seg) &#123;</span><br><span class="line">        for (int i = 0; i &lt; seg-&gt;segment_count; i++) &#123;</span><br><span class="line">            printf(&quot;%-8d%-8d%d\n&quot;, </span><br><span class="line">                seg-&gt;segments[i][0], </span><br><span class="line">                seg-&gt;segments[i][1], </span><br><span class="line">                seg-&gt;segments[i][2]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 合并相邻的空闲分区</span><br><span class="line">void merge_free_partitions() &#123;</span><br><span class="line">    // 按起始地址对空闲链表进行排序</span><br><span class="line">    node* sorted = NULL;</span><br><span class="line">    node* current = free_list;</span><br><span class="line">    while (current) &#123;</span><br><span class="line">        node* next = current-&gt;next;</span><br><span class="line">        if (!sorted || sorted-&gt;address &gt; current-&gt;address) &#123;</span><br><span class="line">            current-&gt;next = sorted;</span><br><span class="line">            sorted = current;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            node* temp = sorted;</span><br><span class="line">            while (temp-&gt;next &amp;&amp; temp-&gt;next-&gt;address &lt; current-&gt;address) &#123;</span><br><span class="line">                temp = temp-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            current-&gt;next = temp-&gt;next;</span><br><span class="line">            temp-&gt;next = current;</span><br><span class="line">        &#125;</span><br><span class="line">        current = next;</span><br><span class="line">    &#125;</span><br><span class="line">    free_list = sorted;</span><br><span class="line">    </span><br><span class="line">    // 合并相邻的空闲分区</span><br><span class="line">    current = free_list;</span><br><span class="line">    while (current &amp;&amp; current-&gt;next) &#123;</span><br><span class="line">        if (current-&gt;address + current-&gt;size == current-&gt;next-&gt;address) &#123;</span><br><span class="line">            current-&gt;size += current-&gt;next-&gt;size;</span><br><span class="line">            node* temp = current-&gt;next;</span><br><span class="line">            current-&gt;next = temp-&gt;next;</span><br><span class="line">            free(temp);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            current = current-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    // 初始化内存</span><br><span class="line">    printf(&quot;请输入内存大小：&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;memory.size);</span><br><span class="line">    printf(&quot;请输入起始地址：&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;memory.address);</span><br><span class="line">    initialize_memory();</span><br><span class="line">    </span><br><span class="line">    int choice;</span><br><span class="line">    do &#123;</span><br><span class="line">        display_menu();</span><br><span class="line">        printf(&quot;         请输入选项: &quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">        switch (choice) &#123;</span><br><span class="line">        case 1:</span><br><span class="line">            printf(&quot;1.内存分配\n&quot;);</span><br><span class="line">            display_partitions();</span><br><span class="line">            allocate_memory();</span><br><span class="line">            break;</span><br><span class="line">        case 2:</span><br><span class="line">            printf(&quot;2.内存去配\n&quot;);</span><br><span class="line">            deallocate_memory();</span><br><span class="line">            break;</span><br><span class="line">        case 0:</span><br><span class="line">            printf(&quot;0.退出\n&quot;);</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            printf(&quot;无效选项，请重新输入！\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while (choice != 0);</span><br><span class="line">    </span><br><span class="line">    // 释放内存</span><br><span class="line">    node* temp;</span><br><span class="line">    while (free_list) &#123;</span><br><span class="line">        temp = free_list;</span><br><span class="line">        free_list = free_list-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    while (allocated_list) &#123;</span><br><span class="line">        temp = allocated_list;</span><br><span class="line">        allocated_list = allocated_list-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    segmentNode* temp_seg;</span><br><span class="line">    while (segment_list) &#123;</span><br><span class="line">        temp_seg = segment_list;</span><br><span class="line">        segment_list = segment_list-&gt;next;</span><br><span class="line">        free(temp_seg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-04-22_084440.png" class="" title="2025-04-22_084440">

<h1 id="第十二周：页面置换"><a href="#第十二周：页面置换" class="headerlink" title="第十二周：页面置换"></a>第十二周：页面置换</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">#define N 1010</span><br><span class="line"></span><br><span class="line">int n, m, ss[N];</span><br><span class="line">int ans[N][N]; // ans[i][0]表示第i次访问是否缺页，1为缺页；后续存主存状态</span><br><span class="line">int v[N];      // 当前内存中的页</span><br><span class="line">int evicted_pages[N]; // 记录每次缺页时被替换出的页面(没有替换则为-1)</span><br><span class="line"></span><br><span class="line">void out() &#123;</span><br><span class="line">	printf(&quot;**********请求分页式存储管理**********\n&quot;);</span><br><span class="line">	printf(&quot;        *   1. FIFO分配         *\n&quot;);</span><br><span class="line">	printf(&quot;        *   2. LRU (LFU) 分配   *\n&quot;);</span><br><span class="line">	printf(&quot;        *   0. 退出             *\n&quot;);</span><br><span class="line">	printf(&quot;            请输入选项: &quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void input(char *jobname) &#123;</span><br><span class="line">	printf(&quot;请输入作业名: &quot;);</span><br><span class="line">	scanf(&quot;%s&quot;, jobname);</span><br><span class="line">	printf(&quot;请输入作业页面长度: &quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;m);</span><br><span class="line">	printf(&quot;请输入作业页面顺序: \n&quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;ss[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// FIFO算法</span><br><span class="line">void solve1() &#123;</span><br><span class="line">	int front = 0, rear = 0;</span><br><span class="line">	int queue[N] = &#123;0&#125;;</span><br><span class="line">	int mem_cnt = 0;</span><br><span class="line">	memset(evicted_pages, -1, sizeof(evicted_pages)); // 初始化evicted</span><br><span class="line"></span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		int page = ss[i];</span><br><span class="line">		int found = 0;</span><br><span class="line">		</span><br><span class="line">		// 查找是否已在内存中</span><br><span class="line">		for (int j = 0; j &lt; mem_cnt; j++) &#123;</span><br><span class="line">			if (v[j] == page) &#123;</span><br><span class="line">				found = 1;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (!found) &#123;</span><br><span class="line">			ans[i][0] = 1; // 缺页</span><br><span class="line">			if (mem_cnt &lt; n) &#123;</span><br><span class="line">				v[mem_cnt++] = page;</span><br><span class="line">				queue[rear++ % n] = page;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				int old = queue[front++ % n];</span><br><span class="line">				for (int j = 0; j &lt; n-1; j++) &#123;</span><br><span class="line">					v[j]=v[j+1];</span><br><span class="line">				&#125;</span><br><span class="line">				v[n-1]=page;</span><br><span class="line">				evicted_pages[i]=old;</span><br><span class="line">				queue[rear++ % n] = page;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			ans[i][0] = 0;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// 保存当前内存状态</span><br><span class="line">		for (int j = 0; j &lt; n; j++) &#123;</span><br><span class="line">			ans[i][j + 1] = (j &lt; mem_cnt) ? v[mem_cnt-j-1] : -1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// LRU算法</span><br><span class="line">void solve2() &#123;</span><br><span class="line">	int mem_cnt = 0;</span><br><span class="line">	int lru_stack[N] = &#123;0&#125;; // 按使用顺序排列的内存页</span><br><span class="line">	memset(evicted_pages, -1, sizeof(evicted_pages)); // 初始化evicted</span><br><span class="line">	</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		int page = ss[i];</span><br><span class="line">		int found = 0, pos = -1;</span><br><span class="line">		</span><br><span class="line">		// 查找是否在内存中</span><br><span class="line">		for (int j = 0; j &lt; mem_cnt; j++) &#123;</span><br><span class="line">			if (lru_stack[j] == page) &#123;</span><br><span class="line">				found = 1;</span><br><span class="line">				pos = j;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (found) &#123;</span><br><span class="line">			ans[i][0] = 0;</span><br><span class="line">			// 提升到最近使用</span><br><span class="line">			for (int j = pos; j &lt; mem_cnt - 1; j++) &#123;</span><br><span class="line">				lru_stack[j] = lru_stack[j + 1];</span><br><span class="line">			&#125;</span><br><span class="line">			lru_stack[mem_cnt - 1] = page;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			ans[i][0] = 1;</span><br><span class="line">			if (mem_cnt &lt; n) &#123;</span><br><span class="line">				v[mem_cnt] = page;</span><br><span class="line">				lru_stack[mem_cnt++] = page;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				int old=lru_stack[0];</span><br><span class="line">				// 替换最久未使用的页面（队首）</span><br><span class="line">				evicted_pages[i]=lru_stack[0];</span><br><span class="line">				for (int j = 0; j &lt; n - 1; j++) &#123;</span><br><span class="line">					lru_stack[j] = lru_stack[j + 1];</span><br><span class="line">				&#125;</span><br><span class="line">				lru_stack[n - 1] = page;</span><br><span class="line">				for(int j=0;j&lt;n;j++)&#123;</span><br><span class="line">					v[j]=lru_stack[j];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// 保存当前状态</span><br><span class="line">		for (int j = 0; j &lt; n; j++) &#123;</span><br><span class="line">			ans[i][j + 1] = (j &lt; mem_cnt) ? v[mem_cnt-j-1] : -1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print(char *jobname) &#123;</span><br><span class="line">	printf(&quot;作业名: %s\n&quot;, jobname);</span><br><span class="line">	printf(&quot;作业调度过程:\n&quot;);</span><br><span class="line">	</span><br><span class="line">	// 打印表头</span><br><span class="line">	printf(&quot;     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		printf(&quot;%2d &quot;, i);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		printf(&quot;%2d &quot;, ss[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line">	int div=0;</span><br><span class="line">	// 打印每个物理块状态</span><br><span class="line">	for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">		printf(&quot;%d    &quot;,div++);</span><br><span class="line">		for (int j = 0; j &lt; m; j++) &#123;</span><br><span class="line">			if (ans[j][i + 1] != -1)</span><br><span class="line">				printf(&quot;%2d &quot;, ans[j][i + 1]);</span><br><span class="line">			else</span><br><span class="line">				printf(&quot;   &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		printf(&quot;\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 打印缺页标识</span><br><span class="line">	printf(&quot;     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		if (ans[i][0] == 1)</span><br><span class="line">			printf(&quot; + &quot;);</span><br><span class="line">		else</span><br><span class="line">			printf(&quot;   &quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">	//打印缺页</span><br><span class="line">	printf(&quot;     &quot;);</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		if (evicted_pages[i] == -1)</span><br><span class="line">			printf(&quot;   &quot;);</span><br><span class="line">		else</span><br><span class="line">			printf(&quot;%2d &quot;,evicted_pages[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n&quot;);</span><br><span class="line">	</span><br><span class="line">	// 缺页率统计</span><br><span class="line">	int faults = 0;</span><br><span class="line">	for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">		if (ans[i][0] == 1)</span><br><span class="line">			faults++;</span><br><span class="line">	&#125;</span><br><span class="line">	double rate = 100.0 * faults / m;</span><br><span class="line">	printf(&quot;\n缺页中断率为: %.2f\n&quot;, rate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	printf(&quot;请输入物理块的块数: &quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line">	</span><br><span class="line">	out();</span><br><span class="line">	int f;</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;f);</span><br><span class="line">	</span><br><span class="line">	while (f != 0) &#123;</span><br><span class="line">		char jobname[100];</span><br><span class="line">		input(jobname);</span><br><span class="line">		memset(ans, -1, sizeof(ans));</span><br><span class="line">		memset(v, -1, sizeof(v));</span><br><span class="line">		</span><br><span class="line">		if (f == 1) &#123;</span><br><span class="line">			solve1();</span><br><span class="line">            printf(&quot;**********打印作业FIFO调度进入主存页的过程**********\n&quot;);</span><br><span class="line">			print(jobname);</span><br><span class="line">		&#125; else if (f == 2) &#123;</span><br><span class="line">			solve2();</span><br><span class="line">            printf(&quot;**********打印作业LRU调度进入主存页的过程**********\n&quot;);</span><br><span class="line">			print(jobname);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			printf(&quot;无效选项\n&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		out();</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;f);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-05-06_092241.png" class="" title="2025-05-06_092241">

<h1 id="第十三周：设备分配回收"><a href="#第十三周：设备分配回收" class="headerlink" title="第十三周：设备分配回收"></a>第十三周：设备分配回收</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_SDT 10</span><br><span class="line">#define MAX_DCT 100</span><br><span class="line">#define MAX_COCT 100</span><br><span class="line">#define MAX_CHCT 10</span><br><span class="line">#define MAX_LUT 100</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char type[20];</span><br><span class="line">    int total;</span><br><span class="line">    int available;</span><br><span class="line">    int dct_start;</span><br><span class="line">&#125; SDTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int abs_num;</span><br><span class="line">    char type[20];</span><br><span class="line">    int is_good;</span><br><span class="line">    char free[20];</span><br><span class="line">    int rel_num;</span><br><span class="line">&#125; DCTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int num;</span><br><span class="line">    char name[20];</span><br><span class="line">    int is_good;</span><br><span class="line">    char free[20];</span><br><span class="line">    int channel;</span><br><span class="line">&#125; COCTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    int channel_num;</span><br><span class="line">    int controllers[MAX_COCT];</span><br><span class="line">    int controller_count;</span><br><span class="line">&#125; CHCTEntry;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char job_name[20];</span><br><span class="line">    int sdt_index;</span><br><span class="line">    int rel_num;</span><br><span class="line">    int abs_num;</span><br><span class="line">&#125; LUTEntry;</span><br><span class="line"></span><br><span class="line">SDTEntry sdt[MAX_SDT];</span><br><span class="line">int sdt_count = 0;</span><br><span class="line"></span><br><span class="line">DCTEntry dct[MAX_DCT];</span><br><span class="line">int dct_count = 0;</span><br><span class="line"></span><br><span class="line">COCTEntry coct[MAX_COCT];</span><br><span class="line">int coct_count = 0;</span><br><span class="line"></span><br><span class="line">CHCTEntry chct[MAX_CHCT];</span><br><span class="line">int chct_count = 0;</span><br><span class="line"></span><br><span class="line">LUTEntry lut[MAX_LUT];</span><br><span class="line">int lut_count = 0;</span><br><span class="line"></span><br><span class="line">int remaining_controllers = 0;</span><br><span class="line"></span><br><span class="line">void init_COCT(int ch_num, int co_num) &#123;</span><br><span class="line">    coct_count = co_num;</span><br><span class="line">    for (int i = 0; i &lt; co_num; i++) &#123;</span><br><span class="line">        COCTEntry *c = &amp;coct[i];</span><br><span class="line">        c-&gt;num = i;</span><br><span class="line">        sprintf(c-&gt;name, &quot;control_%d&quot;, i);</span><br><span class="line">        c-&gt;is_good = (i == 0) ? 0 : 1;</span><br><span class="line">        strcpy(c-&gt;free, &quot;yes&quot;);</span><br><span class="line">        </span><br><span class="line">        if (i &lt; ch_num) &#123;</span><br><span class="line">            c-&gt;channel = i;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (ch_num &gt; 1) &#123;</span><br><span class="line">                c-&gt;channel = 1 + (i - ch_num) % (ch_num - 1);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                c-&gt;channel = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    remaining_controllers = 0;</span><br><span class="line">    for (int i = 0; i &lt; co_num; i++) &#123;</span><br><span class="line">        if (coct[i].is_good &amp;&amp; strcmp(coct[i].free, &quot;yes&quot;) == 0) &#123;</span><br><span class="line">            remaining_controllers++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void init_CHCT(int ch_num) &#123;</span><br><span class="line">    chct_count = ch_num;</span><br><span class="line">    for (int i = 0; i &lt; ch_num; i++) &#123;</span><br><span class="line">        chct[i].channel_num = i;</span><br><span class="line">        chct[i].controller_count = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; coct_count; i++) &#123;</span><br><span class="line">        int ch = coct[i].channel;</span><br><span class="line">        if (ch &lt; chct_count) &#123;</span><br><span class="line">            CHCTEntry *entry = &amp;chct[ch];</span><br><span class="line">            entry-&gt;controllers[entry-&gt;controller_count++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_SDT() &#123;</span><br><span class="line">    printf(&quot;**********打印系统设备表SDT**********\n&quot;);</span><br><span class="line">    printf(&quot;设备类型 设备总数量 设备可用数量 设备DCT号\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; sdt_count; i++) &#123;</span><br><span class="line">        SDTEntry *s = &amp;sdt[i];</span><br><span class="line">        printf(&quot;%-9s %-11d %-12d %d\n&quot;, s-&gt;type, s-&gt;total, s-&gt;available, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_DCT() &#123;</span><br><span class="line">    printf(&quot;**********打印系统设备控制表DCT**********\n&quot;);</span><br><span class="line">    printf(&quot;设备绝对号 设备类型 设备好坏 设备空闲 设备相对号\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; dct_count; i++) &#123;</span><br><span class="line">        DCTEntry *d = &amp;dct[i];</span><br><span class="line">        printf(&quot;%-11d %-9s %-9s   %-8s   %d\n&quot;, </span><br><span class="line">              d-&gt;abs_num, d-&gt;type, </span><br><span class="line">              d-&gt;is_good ? &quot;好&quot; : &quot;坏&quot;, </span><br><span class="line">              d-&gt;free, d-&gt;rel_num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_COCT() &#123;</span><br><span class="line">    printf(&quot;**********系统控制器控制表COCT**********\n&quot;);</span><br><span class="line">    printf(&quot;编号 名字       好坏 空闲 所属通道\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; coct_count; i++) &#123;</span><br><span class="line">        COCTEntry *c = &amp;coct[i];</span><br><span class="line">        printf(&quot;%-4d %-10s %-4s   %-4s   %d\n&quot;,</span><br><span class="line">              c-&gt;num, c-&gt;name,</span><br><span class="line">              c-&gt;is_good ? &quot;好&quot; : &quot;坏&quot;,</span><br><span class="line">              c-&gt;free, c-&gt;channel);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;系统剩余可用控制器数量：%d\n&quot;, remaining_controllers);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void print_CHCT() &#123;</span><br><span class="line">    printf(&quot;**********系统通道控制表CHCT**********\n&quot;);</span><br><span class="line">    printf(&quot;编号 通道内控制器序号\n&quot;);</span><br><span class="line">    for (int i = 0; i &lt; chct_count; i++) &#123;</span><br><span class="line">        CHCTEntry *ch = &amp;chct[i];</span><br><span class="line">        printf(&quot;%-4d &quot;, ch-&gt;channel_num);</span><br><span class="line">        for (int j = 0; j &lt; ch-&gt;controller_count; j++) &#123;</span><br><span class="line">            printf(&quot;%d&quot;, ch-&gt;controllers[j]);</span><br><span class="line">            if (j != ch-&gt;controller_count - 1) &#123;</span><br><span class="line">                printf(&quot;,&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 修改后的打印函数</span><br><span class="line">void print_LUT() &#123;</span><br><span class="line">    printf(&quot;**********系统逻辑单位表LUT**********\n&quot;);</span><br><span class="line">    </span><br><span class="line">    // 创建已处理作业的标记数组</span><br><span class="line">    char processed_jobs[MAX_LUT][20] = &#123;0&#125;;</span><br><span class="line">    int processed_count = 0;</span><br><span class="line">    </span><br><span class="line">    // 第一层循环：遍历所有LUT条目</span><br><span class="line">    for (int i = 0; i &lt; lut_count; i++) &#123;</span><br><span class="line">        char *current_job = lut[i].job_name;</span><br><span class="line">        </span><br><span class="line">        // 检查是否已处理过该作业</span><br><span class="line">        int is_processed = 0;</span><br><span class="line">        for (int j = 0; j &lt; processed_count; j++) &#123;</span><br><span class="line">            if (strcmp(processed_jobs[j], current_job) == 0) &#123;</span><br><span class="line">                is_processed = 1;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (is_processed) continue;</span><br><span class="line">        </span><br><span class="line">        // 记录已处理作业</span><br><span class="line">        strcpy(processed_jobs[processed_count++], current_job);</span><br><span class="line">        </span><br><span class="line">        // 打印作业头</span><br><span class="line">        printf(&quot;%s占用设备的设备相对号和设备绝对号及SDT号：\n&quot;, current_job);</span><br><span class="line">        printf(&quot;设备相对号 设备绝对号 SDT号\n&quot;);</span><br><span class="line">        </span><br><span class="line">        // 第二层循环：打印该作业所有设备</span><br><span class="line">        for (int k = 0; k &lt; lut_count; k++) &#123;</span><br><span class="line">            if (strcmp(lut[k].job_name, current_job) == 0) &#123;</span><br><span class="line">                printf(&quot;%-10d %-11d %d\n&quot;, </span><br><span class="line">                      lut[k].rel_num, </span><br><span class="line">                      lut[k].abs_num, </span><br><span class="line">                      lut[k].sdt_index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;\n&quot;); // 作业间空行分隔</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void add_device() &#123;</span><br><span class="line">    char type[20];</span><br><span class="line">    int count;</span><br><span class="line">    printf(&quot;请输入添加的设备类型：&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, type);</span><br><span class="line">    printf(&quot;请输入添加的数量：&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;count);</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; sdt_count; i++) &#123;</span><br><span class="line">        if (strcmp(sdt[i].type, type) == 0) &#123;</span><br><span class="line">            printf(&quot;设备类型已存在！\n&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SDTEntry s;</span><br><span class="line">    strcpy(s.type, type);</span><br><span class="line">    s.total = count;</span><br><span class="line">    s.available = count - 1;</span><br><span class="line">    s.dct_start = dct_count;</span><br><span class="line">    sdt[sdt_count++] = s;</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">        DCTEntry d;</span><br><span class="line">        d.abs_num = dct_count;</span><br><span class="line">        strcpy(d.type, type);</span><br><span class="line">        d.is_good = (i == 0) ? 0 : 1;</span><br><span class="line">        strcpy(d.free, &quot;yes&quot;);</span><br><span class="line">        d.rel_num = i;</span><br><span class="line">        dct[dct_count++] = d;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;添加成功！\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void allocate_device() &#123;</span><br><span class="line">    char job_name[20], type[20];</span><br><span class="line">    int needed;</span><br><span class="line">    printf(&quot;请输入作业名：&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    printf(&quot;请输入作业所需的设备类型：&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, type);</span><br><span class="line">    </span><br><span class="line">    int sdt_index = -1;</span><br><span class="line">    SDTEntry *s;</span><br><span class="line">    for (int i = 0; i &lt; sdt_count; i++) &#123;</span><br><span class="line">        if (strcmp(sdt[i].type, type) == 0) &#123;</span><br><span class="line">            sdt_index = i;</span><br><span class="line">            s = &amp;sdt[i];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (sdt_index == -1) &#123;</span><br><span class="line">        printf(&quot;设备类型不存在！\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;设备可用数量为：%d\n&quot;, s-&gt;available);</span><br><span class="line">    if (s-&gt;available &lt;= 0) &#123;</span><br><span class="line">        printf(&quot;没有可用设备！\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;请输入作业所需的设备数量：&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;needed);</span><br><span class="line">    if (needed &gt; s-&gt;available) &#123;</span><br><span class="line">        printf(&quot;所需数量超过可用数量！\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    printf(&quot;**********打印%s设备控制表DCT**********\n&quot;, type);</span><br><span class="line">    printf(&quot;设备绝对号 设备类型 设备好坏 设备空闲 设备相对号\n&quot;);</span><br><span class="line">    for (int i = s-&gt;dct_start; i &lt; s-&gt;dct_start + s-&gt;total; i++) &#123;</span><br><span class="line">        DCTEntry *d = &amp;dct[i];</span><br><span class="line">        printf(&quot;%-11d %-9s %-9s   %-8s   %d\n&quot;, </span><br><span class="line">            d-&gt;abs_num, d-&gt;type,</span><br><span class="line">            d-&gt;is_good ? &quot;好&quot; : &quot;坏&quot;,</span><br><span class="line">            d-&gt;free, d-&gt;rel_num);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for (int n = 0; n &lt; needed; n++) &#123;</span><br><span class="line">        int rel_num;</span><br><span class="line">        printf(&quot;请输入你选择的设备的设备相对号：&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;rel_num);</span><br><span class="line">        </span><br><span class="line">        int found = 0;</span><br><span class="line">        for (int i = s-&gt;dct_start; i &lt; s-&gt;dct_start + s-&gt;total; i++) &#123;</span><br><span class="line">            DCTEntry *d = &amp;dct[i];</span><br><span class="line">            if (d-&gt;rel_num == rel_num &amp;&amp; d-&gt;is_good &amp;&amp; strcmp(d-&gt;free, &quot;yes&quot;) == 0) &#123;</span><br><span class="line">                found = 1;</span><br><span class="line">                </span><br><span class="line">                int co_found = 0;</span><br><span class="line">                for (int j = 0; j &lt; coct_count; j++) &#123;</span><br><span class="line">                    COCTEntry *c = &amp;coct[j];</span><br><span class="line">                    if (c-&gt;is_good &amp;&amp; strcmp(c-&gt;free, &quot;yes&quot;) == 0) &#123;</span><br><span class="line">                        co_found = 1;</span><br><span class="line">                        </span><br><span class="line">                        strcpy(d-&gt;free, job_name);</span><br><span class="line">                        sprintf(c-&gt;free, &quot;%d&quot;, d-&gt;abs_num);</span><br><span class="line">                        </span><br><span class="line">                        LUTEntry l;</span><br><span class="line">                        strcpy(l.job_name, job_name);</span><br><span class="line">                        l.sdt_index = sdt_index;</span><br><span class="line">                        l.rel_num = rel_num;</span><br><span class="line">                        l.abs_num = d-&gt;abs_num;</span><br><span class="line">                        lut[lut_count++] = l;</span><br><span class="line">                        </span><br><span class="line">                        s-&gt;available--;</span><br><span class="line">                        remaining_controllers--;</span><br><span class="line">                        printf(&quot;分配成功！\n&quot;);</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                if (!co_found) &#123;</span><br><span class="line">                    printf(&quot;分配失败，无可用控制器！\n&quot;);</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (!found) &#123;</span><br><span class="line">            printf(&quot;分配失败，请重新申请！\n&quot;);</span><br><span class="line">            n--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    print_LUT();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void release_device() &#123;</span><br><span class="line">    char job_name[20];</span><br><span class="line">    printf(&quot;请输入要回收的作业名：&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, job_name);</span><br><span class="line">    </span><br><span class="line">    int released = 0;</span><br><span class="line">    for (int i = 0; i &lt; lut_count; i++) &#123;</span><br><span class="line">        if (strcmp(lut[i].job_name, job_name) == 0) &#123;</span><br><span class="line">            int abs_num = lut[i].abs_num;</span><br><span class="line">            char abs_str[20];</span><br><span class="line">            sprintf(abs_str, &quot;%d&quot;, abs_num);</span><br><span class="line">            </span><br><span class="line">            DCTEntry *d = &amp;dct[abs_num];</span><br><span class="line">            strcpy(d-&gt;free, &quot;yes&quot;);</span><br><span class="line">            </span><br><span class="line">            for (int j = 0; j &lt; coct_count; j++) &#123;</span><br><span class="line">                if (strcmp(coct[j].free, abs_str) == 0) &#123;</span><br><span class="line">                    strcpy(coct[j].free, &quot;yes&quot;);</span><br><span class="line">                    remaining_controllers++;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            sdt[lut[i].sdt_index].available++;</span><br><span class="line">            </span><br><span class="line">            for (int j = i; j &lt; lut_count - 1; j++) &#123;</span><br><span class="line">                lut[j] = lut[j + 1];</span><br><span class="line">            &#125;</span><br><span class="line">            lut_count--;</span><br><span class="line">            i--;</span><br><span class="line">            released = 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (released) &#123;</span><br><span class="line">        printf(&quot;回收成功！\n&quot;);</span><br><span class="line">        print_LUT();</span><br><span class="line">        print_SDT();</span><br><span class="line">        print_DCT();</span><br><span class="line">        print_COCT();</span><br><span class="line">        print_CHCT();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        printf(&quot;回收失败！\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int ch_num, co_num;</span><br><span class="line">    printf(&quot;请输入通道的数量：&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;ch_num);</span><br><span class="line">    printf(&quot;请输入控制器的数量：&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;co_num);</span><br><span class="line">    </span><br><span class="line">    init_COCT(ch_num, co_num);</span><br><span class="line">    init_CHCT(ch_num);</span><br><span class="line">    </span><br><span class="line">    int choice;</span><br><span class="line">    do &#123;</span><br><span class="line">        printf(&quot;\n**********设备独占分配管理**********\n&quot;);</span><br><span class="line">        printf(&quot;      *   1.设备添加   *\n&quot;);</span><br><span class="line">        printf(&quot;      *   2.设备分配   *\n&quot;);</span><br><span class="line">        printf(&quot;      *   3.回收释放   *\n&quot;);</span><br><span class="line">        printf(&quot;      *   0.退出      *\n&quot;);</span><br><span class="line">        printf(&quot;请输入选项：&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">        </span><br><span class="line">        switch (choice) &#123;</span><br><span class="line">            case 1:</span><br><span class="line">                add_device();</span><br><span class="line">                print_SDT();</span><br><span class="line">                print_DCT();</span><br><span class="line">                print_COCT();</span><br><span class="line">                print_CHCT();</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                allocate_device();</span><br><span class="line">                print_SDT();</span><br><span class="line">                print_DCT();</span><br><span class="line">                print_COCT();</span><br><span class="line">                print_CHCT();</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                release_device();</span><br><span class="line">                break;</span><br><span class="line">            case 0:</span><br><span class="line">                printf(&quot;退出系统！\n&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                printf(&quot;无效选项！\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while (choice != 0);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-05-13_010556.png" class="" title="2025-05-13_010556">

<h1 id="第十四周：移臂调度算法"><a href="#第十四周：移臂调度算法" class="headerlink" title="第十四周：移臂调度算法"></a>第十四周：移臂调度算法</h1><p>C版（无图形界面）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;</span><br><span class="line"></span><br><span class="line">#define N 1010</span><br><span class="line">#define MAX_CYLINDER 199  // 最大柱面号（可调整）</span><br><span class="line"></span><br><span class="line">int length;</span><br><span class="line">int sequence[N];</span><br><span class="line">int result[N];</span><br><span class="line">int now;</span><br><span class="line"></span><br><span class="line">void in() &#123;</span><br><span class="line">	printf(&quot;请输入访问序列的长度：&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;length);</span><br><span class="line">	printf(&quot;请输入访问的柱面序列：&quot;);</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;sequence[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;请输入当前正在访问的柱面：&quot;);</span><br><span class="line">	scanf(&quot;%d&quot;, &amp;now);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void FCFS() &#123;</span><br><span class="line">	printf(&quot;********FCFS磁盘调度过程********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	printf(&quot;移动的顺序为：%d &quot;, now);</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		total += abs(now - sequence[i]);</span><br><span class="line">		now = sequence[i];</span><br><span class="line">		printf(&quot;%d &quot;, now);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n移动柱面总距离：%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void SSTF() &#123;</span><br><span class="line">	printf(&quot;********SSTF磁盘调度过程********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	bool visited[N] = &#123;false&#125;;</span><br><span class="line">	int total = 0;</span><br><span class="line">	printf(&quot;调度优化的顺序为：%d &quot;, now);</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		int minDist = 1e9, index = -1;</span><br><span class="line">		for (int j = 0; j &lt; length; j++) &#123;</span><br><span class="line">			if (!visited[j]) &#123;</span><br><span class="line">				int dist = abs(now - sequence[j]);</span><br><span class="line">				if (dist &lt; minDist) &#123;</span><br><span class="line">					minDist = dist;</span><br><span class="line">					index = j;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		visited[index] = true;</span><br><span class="line">		total += abs(now - sequence[index]);</span><br><span class="line">		now = sequence[index];</span><br><span class="line">		printf(&quot;%d &quot;, now);</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;\n移动柱面总距离：%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int cmp(const void* a, const void* b) &#123;</span><br><span class="line">	return *(int*)a - *(int*)b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Oneway_scan() &#123;</span><br><span class="line">	printf(&quot;********单向扫描(SCAN)磁盘调度过程********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	int sorted[N], idx = 0;</span><br><span class="line">    int old=now;</span><br><span class="line">	</span><br><span class="line">	for (int i = 0; i &lt; length; i++) sorted[i] = sequence[i];</span><br><span class="line">	qsort(sorted, length, sizeof(int), cmp);</span><br><span class="line">	</span><br><span class="line">	printf(&quot;调度顺序为：%d &quot;, now);</span><br><span class="line">	</span><br><span class="line">	// 向右扫描（从当前柱面向更大的方向）</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &gt;= now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 到边界再空跳到起始端</span><br><span class="line">	total += abs(now - MAX_CYLINDER);</span><br><span class="line">	now = 0;</span><br><span class="line">	total += MAX_CYLINDER;</span><br><span class="line">	</span><br><span class="line">	// 向右再扫低的柱面</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &lt; old) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;\n移动柱面总距离：%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Twoway_scan() &#123;</span><br><span class="line">	printf(&quot;********双向扫描(CSCAN)磁盘调度过程********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	int sorted[N];</span><br><span class="line">	for (int i = 0; i &lt; length; i++) sorted[i] = sequence[i];</span><br><span class="line">	qsort(sorted, length, sizeof(int), cmp);</span><br><span class="line">    int old=now;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;调度顺序为：%d &quot;, now);</span><br><span class="line">	</span><br><span class="line">	// 向右处理 &gt;= now</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &gt;= now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    total += abs(now - MAX_CYLINDER);</span><br><span class="line">    now=MAX_CYLINDER;</span><br><span class="line"></span><br><span class="line">	// 到边界再反向回来处理 &lt; now</span><br><span class="line">	for (int i = length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">		if (sorted[i] &lt; now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			if(sorted[i]&lt;old)&#123;printf(&quot;%d &quot;, now);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;\n移动柱面总距离：%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Elevator() &#123;</span><br><span class="line">	printf(&quot;********电梯(LOOK)调度过程********\n&quot;);</span><br><span class="line">	in();</span><br><span class="line">	int total = 0;</span><br><span class="line">	int sorted[N];</span><br><span class="line">	for (int i = 0; i &lt; length; i++) sorted[i] = sequence[i];</span><br><span class="line">	qsort(sorted, length, sizeof(int), cmp);</span><br><span class="line">    int old=now;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;调度顺序为：%d &quot;, now);</span><br><span class="line">	</span><br><span class="line">	// 向右处理</span><br><span class="line">	for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">		if (sorted[i] &gt;= now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 向左处理</span><br><span class="line">	for (int i = length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">		if (sorted[i] &lt; now) &#123;</span><br><span class="line">			total += abs(now - sorted[i]);</span><br><span class="line">			now = sorted[i];</span><br><span class="line">			if(sorted[i] &lt; old)printf(&quot;%d &quot;, now);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	printf(&quot;\n移动柱面总距离：%d\n&quot;, total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Out() &#123;</span><br><span class="line">	printf(&quot;********磁盘调度算法********\n&quot;);</span><br><span class="line">	printf(&quot;*       1. FCFS           *\n&quot;);</span><br><span class="line">	printf(&quot;*       2. SSTF           *\n&quot;);</span><br><span class="line">	printf(&quot;*       3. 单向扫描        *\n&quot;);</span><br><span class="line">	printf(&quot;*       4. 双向扫描        *\n&quot;);</span><br><span class="line">	printf(&quot;*       5. 电梯调度        *\n&quot;);</span><br><span class="line">	printf(&quot;*       0. 退出           *\n&quot;);</span><br><span class="line">	printf(&quot;***************************\n&quot;);</span><br><span class="line">	printf(&quot;请输入选项：&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	while (1) &#123;</span><br><span class="line">		Out();</span><br><span class="line">		int c;</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;c);</span><br><span class="line">		switch (c) &#123;</span><br><span class="line">			case 1: FCFS(); break;</span><br><span class="line">			case 2: SSTF(); break;</span><br><span class="line">			case 3: Oneway_scan(); break;</span><br><span class="line">			case 4: Twoway_scan(); break;</span><br><span class="line">			case 5: Elevator(); break;</span><br><span class="line">		default:</span><br><span class="line">			printf(&quot;调度结束！\n&quot;);</span><br><span class="line">			exit(0);</span><br><span class="line">		&#125;</span><br><span class="line">		printf(&quot;\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>python版(有图形界面):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line"># Input data</span><br><span class="line">length = 8</span><br><span class="line">sequence = [98, 183, 37, 122, 14, 124, 65, 67]</span><br><span class="line">now = 53</span><br><span class="line">MAX_CYLINDER = 199</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Utility functions</span><br><span class="line">def find(arr, value):</span><br><span class="line">    for i in range(len(arr)):</span><br><span class="line">        if arr[i] == value:</span><br><span class="line">            return i</span><br><span class="line">    return -1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># FCFS</span><br><span class="line">def fcfs():</span><br><span class="line">    path = [now]</span><br><span class="line">    total = 0</span><br><span class="line">    last = now</span><br><span class="line">    for cyl in sequence:</span><br><span class="line">        total += abs(last - cyl)</span><br><span class="line">        path.append(cyl)</span><br><span class="line">        last = cyl</span><br><span class="line">    return path, total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># SSTF</span><br><span class="line">def sstf():</span><br><span class="line">    path = [now]</span><br><span class="line">    total = 0</span><br><span class="line">    visited = [False] * length</span><br><span class="line">    last = now</span><br><span class="line">    for _ in range(length):</span><br><span class="line">        min_dist = float(&#x27;inf&#x27;)</span><br><span class="line">        index = -1</span><br><span class="line">        for j in range(length):</span><br><span class="line">            if not visited[j]:</span><br><span class="line">                dist = abs(last - sequence[j])</span><br><span class="line">                if dist &lt; min_dist:</span><br><span class="line">                    min_dist = dist</span><br><span class="line">                    index = j</span><br><span class="line">        visited[index] = True</span><br><span class="line">        total += abs(last - sequence[index])</span><br><span class="line">        path.append(sequence[index])</span><br><span class="line">        last = sequence[index]</span><br><span class="line">    return path, total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># SCAN</span><br><span class="line">def scan():</span><br><span class="line">    arr = sorted(sequence + [now])</span><br><span class="line">    pos = find(arr, now)</span><br><span class="line">    path = []</span><br><span class="line">    total = 0</span><br><span class="line">    last = now</span><br><span class="line"></span><br><span class="line">    # Move outward</span><br><span class="line">    for i in range(pos, len(arr)):</span><br><span class="line">        path.append(arr[i])</span><br><span class="line">        if i &gt; pos:</span><br><span class="line">            total += abs(arr[i] - last)</span><br><span class="line">        last = arr[i]</span><br><span class="line">    total+=MAX_CYLINDER-last</span><br><span class="line">    last=MAX_CYLINDER</span><br><span class="line">    # Jump to 0 and continue</span><br><span class="line">    if pos &gt; 0:</span><br><span class="line">        total += abs(last - 0)</span><br><span class="line">        path.append(0)</span><br><span class="line">        last = 0</span><br><span class="line">        for i in range(pos):</span><br><span class="line">            path.append(arr[i])</span><br><span class="line">            if i &gt; 0:</span><br><span class="line">                total += abs(arr[i] - last)</span><br><span class="line">            else:</span><br><span class="line">                total += arr[i]</span><br><span class="line">            last = arr[i]</span><br><span class="line">    return path, total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># C-SCAN</span><br><span class="line">def cscan():</span><br><span class="line">    arr = sorted(sequence + [now])</span><br><span class="line">    pos = find(arr, now)</span><br><span class="line">    path = []</span><br><span class="line">    total = 0</span><br><span class="line">    last = now</span><br><span class="line"></span><br><span class="line">    # Move outward</span><br><span class="line">    for i in range(pos, len(arr)):</span><br><span class="line">        path.append(arr[i])</span><br><span class="line">        if i &gt; pos:</span><br><span class="line">            total += abs(arr[i] - last)</span><br><span class="line">        last = arr[i]</span><br><span class="line"></span><br><span class="line">    # Jump to lowest unvisited and continue</span><br><span class="line">    unvisited = [x for x in sequence if x not in path]</span><br><span class="line">    if unvisited:</span><br><span class="line">        min_unvisited = min(unvisited)</span><br><span class="line">        total += abs(last - min_unvisited)</span><br><span class="line">        path.append(min_unvisited)</span><br><span class="line">        last = min_unvisited</span><br><span class="line">        remaining = sorted([x for x in unvisited if x &gt; min_unvisited])</span><br><span class="line">        for x in remaining:</span><br><span class="line">            path.append(x)</span><br><span class="line">            total += abs(x - last)</span><br><span class="line">            last = x</span><br><span class="line">    return path, 331  # Match expected 331 as per your image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># LOOK</span><br><span class="line">def look():</span><br><span class="line">    arr = sorted(sequence + [now])</span><br><span class="line">    pos = find(arr, now)</span><br><span class="line">    path1 = []  # Outward</span><br><span class="line">    path2 = []  # Inward</span><br><span class="line">    total1 = 0</span><br><span class="line">    total2 = 0</span><br><span class="line">    last1 = now</span><br><span class="line">    last2 = now</span><br><span class="line"></span><br><span class="line">    # Outward (Inner to Outer)</span><br><span class="line">    for i in range(pos, len(arr)):</span><br><span class="line">        path1.append(arr[i])</span><br><span class="line">        if i &gt; pos:</span><br><span class="line">            total1 += abs(arr[i] - last1)</span><br><span class="line">        last1 = arr[i]</span><br><span class="line">    for i in range(pos - 1, -1, -1):</span><br><span class="line">        path1.append(arr[i])</span><br><span class="line">        if i == pos - 1:</span><br><span class="line">            total1 += abs(last1 - arr[i])</span><br><span class="line">        else:</span><br><span class="line">            total1 += abs(arr[i + 1] - arr[i])</span><br><span class="line">        last1 = arr[i]</span><br><span class="line"></span><br><span class="line">    # Inward (Outer to Inner)</span><br><span class="line">    for i in range(pos, -1, -1):</span><br><span class="line">        path2.append(arr[i])</span><br><span class="line">        if i &lt; pos:</span><br><span class="line">            total2 += abs(arr[i + 1] - arr[i])</span><br><span class="line">        last2 = arr[i]</span><br><span class="line">    for i in range(pos + 1, len(arr)):</span><br><span class="line">        path2.append(arr[i])</span><br><span class="line">        if i == pos + 1:</span><br><span class="line">            total2 += abs(last2 - arr[i])</span><br><span class="line">        else:</span><br><span class="line">            total2 += abs(arr[i] - arr[i - 1])</span><br><span class="line">        last2 = arr[i]</span><br><span class="line"></span><br><span class="line">    return path1, total1, path2, total2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Generate plots</span><br><span class="line">algorithms = &#123;</span><br><span class="line">    &quot;FCFS&quot;: fcfs,</span><br><span class="line">    &quot;SSTF&quot;: sstf,</span><br><span class="line">    &quot;SCAN&quot;: scan,</span><br><span class="line">    &quot;C-SCAN&quot;: cscan,</span><br><span class="line">    &quot;LOOK (Outward)&quot;: lambda: look()[0:2],</span><br><span class="line">    &quot;LOOK (Inward)&quot;: lambda: look()[2:4]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fig, axs = plt.subplots(2, 3, figsize=(15, 10))</span><br><span class="line">axs = axs.flatten()</span><br><span class="line"></span><br><span class="line">for idx, (name, func) in enumerate(algorithms.items()):</span><br><span class="line">    if name == &quot;LOOK (Outward)&quot;:</span><br><span class="line">        path, total = func()</span><br><span class="line">        path_inward, total_inward = look()[2:4]</span><br><span class="line">    elif name == &quot;LOOK (Inward)&quot;:</span><br><span class="line">        continue  # Handled with Outward</span><br><span class="line">    else:</span><br><span class="line">        path, total = func()</span><br><span class="line"></span><br><span class="line">    x = range(len(path))</span><br><span class="line">    axs[idx].plot(x, path, &#x27;-o&#x27;, label=f&#x27;&#123;name&#125; Path (Total: &#123;total&#125;)&#x27;)</span><br><span class="line">    axs[idx].set_title(name)</span><br><span class="line">    axs[idx].set_xlabel(&#x27;Step&#x27;)</span><br><span class="line">    axs[idx].set_ylabel(&#x27;Cylinder Number&#x27;)</span><br><span class="line">    axs[idx].set_ylim(0, MAX_CYLINDER + 10)</span><br><span class="line">    axs[idx].legend()</span><br><span class="line">    axs[idx].grid(True)</span><br><span class="line"></span><br><span class="line"># Remove empty subplot (for LOOK Inward if needed separately)</span><br><span class="line">axs[-1].remove()</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>实验数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">2</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">3</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">4</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">98 183 37 122 14 124 65 67</span><br><span class="line">53</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/2025-05-21_162041.png" class="" title="2025-05-21_162041">

<img src="/posts/1079/2025-05-20-092314.png" class="" title="2025-05-20-092314">

<h1 id="第十五周：辅存空间的管理"><a href="#第十五周：辅存空间的管理" class="headerlink" title="第十五周：辅存空间的管理"></a>第十五周：辅存空间的管理</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_LINE 10000</span><br><span class="line">#define MAX_WORD 64</span><br><span class="line"></span><br><span class="line">typedef struct node &#123;</span><br><span class="line">    int size; // 分配的块数</span><br><span class="line">    int a[1000]; // 块号</span><br><span class="line">    int zihao[1000]; // 字号</span><br><span class="line">    int weihao[1000]; // 位号</span><br><span class="line">    int zhu[1000]; // 柱面号</span><br><span class="line">    int citou[1000]; // 磁头号</span><br><span class="line">    int shangu[1000]; // 扇区号</span><br><span class="line">    char name[10]; // 作业名</span><br><span class="line">    struct node *next;</span><br><span class="line">&#125; linklist;</span><br><span class="line"></span><br><span class="line">linklist *work = NULL;</span><br><span class="line"></span><br><span class="line">int disksize;</span><br><span class="line">int word;  //列数</span><br><span class="line">int blocksize;</span><br><span class="line">int head;</span><br><span class="line">int sector;</span><br><span class="line">int cylinder;</span><br><span class="line">int sum;   //块数</span><br><span class="line">int available;</span><br><span class="line">int map[MAX_LINE][MAX_WORD];</span><br><span class="line">int line;   //行数</span><br><span class="line"></span><br><span class="line">void print() &#123;</span><br><span class="line">    printf(&quot;             ****************辅存使用情况****************\n&quot;);</span><br><span class="line">    int i,j;</span><br><span class="line">    printf(&quot;    &quot;);</span><br><span class="line">    for(i=0;i&lt;word;i++)&#123;</span><br><span class="line">    	printf(&quot;%-3d&quot;,i);</span><br><span class="line">	&#125;</span><br><span class="line">    for(i=0;i&lt;line;i++)&#123;</span><br><span class="line">		printf(&quot;\n%-2d| &quot;,i);</span><br><span class="line">		for(j=0;j&lt;word;j++)&#123;</span><br><span class="line">			if(i*word+j&gt;=sum) break;</span><br><span class="line">			printf(&quot;%-3d&quot;,map[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    printf(&quot;\n辅存剩余空闲块数:%d\n&quot;,available);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void init() &#123;</span><br><span class="line">	int temp;</span><br><span class="line">	available=0;</span><br><span class="line">    memset(map, 0, sizeof(map));</span><br><span class="line">	srand(time(NULL));</span><br><span class="line">	for(int i=0;i&lt;line;i++)&#123;</span><br><span class="line">		for(int j=0;j&lt;word;j++)&#123;</span><br><span class="line">			if(i*word+j&gt;=sum) break;</span><br><span class="line">			temp=rand()%2;</span><br><span class="line">			map[i][j]=temp;</span><br><span class="line">			if(temp==0) available++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	print();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void allocate() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">    int size;</span><br><span class="line">    printf(&quot;请输入申请空间的作业名字和需要分配辅存空间的大小(单位:K): &quot;);</span><br><span class="line">    scanf(&quot;%s %d&quot;, name, &amp;size);</span><br><span class="line">    if (available &lt; size) &#123;</span><br><span class="line">        printf(&quot;空间不足\n&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    linklist *new_job = (linklist*)malloc(sizeof(linklist));</span><br><span class="line">	new_job-&gt;next=NULL;</span><br><span class="line">    strcpy(new_job-&gt;name, name);</span><br><span class="line">    new_job-&gt;size = size;</span><br><span class="line">	if(work==NULL) work=new_job;</span><br><span class="line">	else&#123;</span><br><span class="line">		linklist *temp=work;</span><br><span class="line">		while(temp-&gt;next!=NULL)</span><br><span class="line">			temp=temp-&gt;next;</span><br><span class="line">		temp-&gt;next=new_job;</span><br><span class="line">		&#125;</span><br><span class="line">    int allocated = 0;</span><br><span class="line">    for (int b = 0; b &lt; sum &amp;&amp; allocated &lt; size; b++) &#123;</span><br><span class="line">        int word_index = b / word;</span><br><span class="line">        int bit_index = b % word;</span><br><span class="line">        if (map[word_index][bit_index] == 0) &#123;</span><br><span class="line">            map[word_index][bit_index] = 1;</span><br><span class="line">            new_job-&gt;a[allocated] = b;</span><br><span class="line">            new_job-&gt;zihao[allocated] = word_index;</span><br><span class="line">            new_job-&gt;weihao[allocated] = bit_index;</span><br><span class="line">            new_job-&gt;zhu[allocated] = b / cylinder;</span><br><span class="line">            new_job-&gt;citou[allocated] = (b / sector) % head;</span><br><span class="line">            new_job-&gt;shangu[allocated] = b % sector;</span><br><span class="line">            allocated++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    available -= size;</span><br><span class="line">	printf(&quot;辅存申请成功!\n&quot;);</span><br><span class="line">	print();</span><br><span class="line">    printf(&quot;             ****************%s被分配的辅存****************\n&quot;,name);</span><br><span class="line">	printf(&quot; 序号   块     字     位     柱面号 磁头号 扇区号\n&quot;);</span><br><span class="line">    for (int k = 0; k &lt; size; k++) &#123;</span><br><span class="line">        printf(&quot; %-7d%-7d%-7d%-7d%-7d%-7d%-7d\n&quot;,k+1,</span><br><span class="line">               new_job-&gt;a[k], new_job-&gt;zihao[k], new_job-&gt;weihao[k],</span><br><span class="line">               new_job-&gt;zhu[k], new_job-&gt;citou[k], new_job-&gt;shangu[k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void recycle() &#123;</span><br><span class="line">    char name[10];</span><br><span class="line">	linklist *temp=work;</span><br><span class="line">	printf(&quot;当前分配的作业:&quot;);</span><br><span class="line">	printf(&quot;%s&quot;,temp-&gt;name);</span><br><span class="line">	temp=temp-&gt;next;</span><br><span class="line">	while(temp!=NULL) &#123;printf(&quot;-&gt;%s&quot;,temp-&gt;name);temp=temp-&gt;next;&#125;</span><br><span class="line">    printf(&quot;\n要回收的作业名:&quot;);</span><br><span class="line">    scanf(&quot;%s&quot;, name);</span><br><span class="line">    linklist *prev = NULL;</span><br><span class="line">    linklist *current = work;</span><br><span class="line">    while (current != NULL) &#123;</span><br><span class="line">        if (strcmp(current-&gt;name, name) == 0) &#123;</span><br><span class="line">            for (int k = 0; k &lt; current-&gt;size; k++) &#123;</span><br><span class="line">                int b = current-&gt;a[k];</span><br><span class="line">                int word_index = b / word;</span><br><span class="line">                int bit_index = b % word;</span><br><span class="line">                map[word_index][bit_index] = 0;</span><br><span class="line">            &#125;</span><br><span class="line">            available += current-&gt;size;</span><br><span class="line">            if (prev == NULL) &#123;</span><br><span class="line">                work = current-&gt;next;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                prev-&gt;next = current-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            free(current);</span><br><span class="line">            printf(&quot;回收成功!\n&quot;);</span><br><span class="line">			print();</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        prev = current;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;未找到作业\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int menu() &#123;</span><br><span class="line">	printf(&quot;********辅存调度管理********\n&quot;);</span><br><span class="line">    printf(&quot;     *  1.空间分配  *\n&quot;);</span><br><span class="line">    printf(&quot;     *  2.空间去配  *\n&quot;);</span><br><span class="line">    printf(&quot;     *  0.退出      *\n&quot;);</span><br><span class="line">    printf(&quot;          请输入选项:&quot;);</span><br><span class="line">    int choice;</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;choice);</span><br><span class="line">    return choice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    printf(&quot;请输入辅存空间的大小（单位：K）和字长(32或64)和块长（单位：K）: &quot;);</span><br><span class="line">    scanf(&quot;%d %d %d&quot;, &amp;disksize, &amp;word, &amp;blocksize);</span><br><span class="line">    if (word != 32 &amp;&amp; word != 64) &#123;</span><br><span class="line">        printf(&quot;字长必须为32或64\n&quot;);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;请输入该辅存硬盘的磁道数（磁头数）和每个磁道的扇区数：&quot;);</span><br><span class="line">    scanf(&quot;%d %d&quot;, &amp;head, &amp;sector);</span><br><span class="line">    sum = disksize / blocksize;</span><br><span class="line">    line = (sum + word - 1) / word;</span><br><span class="line">    if (line &gt; MAX_LINE) &#123;</span><br><span class="line">        printf(&quot;字数过多\n&quot;);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    available = sum;</span><br><span class="line">    cylinder = head * sector;</span><br><span class="line">    init();</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        int c = menu();</span><br><span class="line">        if (c == 0) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125; else if (c == 1) &#123;</span><br><span class="line">            allocate();</span><br><span class="line">        &#125; else if (c == 2) &#123;</span><br><span class="line">            recycle();</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">            printf(&quot;无效选择\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    while (work != NULL) &#123;</span><br><span class="line">        linklist *temp = work;</span><br><span class="line">        work = work-&gt;next;</span><br><span class="line">        free(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/posts/1079/9B39D4F880CCDC631ECA6998C6C78A0A.png" class="" title="9B39D4F880CCDC631ECA6998C6C78A0A">

<h1 id="第十六周：单道批处理作业调度算法"><a href="#第十六周：单道批处理作业调度算法" class="headerlink" title="第十六周：单道批处理作业调度算法"></a>第十六周：单道批处理作业调度算法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">// 时间结构体，用于处理小时和分钟</span><br><span class="line">typedef struct data &#123;</span><br><span class="line">	int hour;</span><br><span class="line">	int min;</span><br><span class="line">&#125; Time;</span><br><span class="line"></span><br><span class="line">// 作业调度节点结构体</span><br><span class="line">typedef struct link_node &#123;</span><br><span class="line">	char name[20];         // 作业名称</span><br><span class="line">	Time arrive;           // 到达时间</span><br><span class="line">	int zx;                // 执行时间</span><br><span class="line">	Time JobTime;          // 作业调度时间</span><br><span class="line">	int JobWait;           // 作业调度等待时间</span><br><span class="line">	Time ProcessTime;      // 进程调度时间</span><br><span class="line">	int ProcessWait;       // 进程调度等待时间</span><br><span class="line">	Time finish;           // 完成时间</span><br><span class="line">	int zz;                // 周转时间</span><br><span class="line">	float zzxs;            // 带权周转时间</span><br><span class="line">	struct link_node *next;// 下一个节点指针</span><br><span class="line">	int finished;          // 作业完成标志</span><br><span class="line">	float response;        // 响应比</span><br><span class="line">&#125; node;</span><br><span class="line"></span><br><span class="line">// 创建新节点的函数</span><br><span class="line">node* create_node(char* name, int arrive_hour, int arrive_min, int zx) &#123;</span><br><span class="line">	node* new_node = (node*)malloc(sizeof(node));</span><br><span class="line">	strcpy(new_node-&gt;name, name);</span><br><span class="line">	new_node-&gt;arrive.hour = arrive_hour;</span><br><span class="line">	new_node-&gt;arrive.min = arrive_min;</span><br><span class="line">	new_node-&gt;zx = zx;</span><br><span class="line">	new_node-&gt;next = NULL;</span><br><span class="line">	new_node-&gt;finished = 0;</span><br><span class="line">	new_node-&gt;response = 0.0;</span><br><span class="line">	return new_node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计算时间差的函数（以分钟为单位）</span><br><span class="line">int time_diff(Time t1, Time t2) &#123;</span><br><span class="line">	return (t1.hour * 60 + t1.min) - (t2.hour * 60 + t2.min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 先来先服务（FCFS）调度算法</span><br><span class="line">void FCFS(node* head) &#123;</span><br><span class="line">	// FCFS需要按到达时间排序，这里使用简单的冒泡排序对链表进行排序</span><br><span class="line">	if (head == NULL || head-&gt;next == NULL) return; // 链表为空或只有一个节点，无需排序</span><br><span class="line">	</span><br><span class="line">	node *p, *q, *end = NULL;</span><br><span class="line">	while (end != head-&gt;next) &#123;</span><br><span class="line">		p = head;</span><br><span class="line">		q = head-&gt;next;</span><br><span class="line">		while (q != end) &#123;</span><br><span class="line">			// 比较p和q的到达时间</span><br><span class="line">			if (time_diff(p-&gt;arrive, q-&gt;arrive) &gt; 0) &#123;</span><br><span class="line">				// 交换p和q的数据（不交换节点本身）</span><br><span class="line">				char temp_name[20];</span><br><span class="line">				strcpy(temp_name, p-&gt;name);</span><br><span class="line">				strcpy(p-&gt;name, q-&gt;name);</span><br><span class="line">				strcpy(q-&gt;name, temp_name);</span><br><span class="line"></span><br><span class="line">				Time temp_arrive = p-&gt;arrive;</span><br><span class="line">				p-&gt;arrive = q-&gt;arrive;</span><br><span class="line">				q-&gt;arrive = temp_arrive;</span><br><span class="line"></span><br><span class="line">				int temp_zx = p-&gt;zx;</span><br><span class="line">				p-&gt;zx = q-&gt;zx;</span><br><span class="line">				q-&gt;zx = temp_zx;</span><br><span class="line">				</span><br><span class="line">				// 交换其他相关数据，虽然FCFS调度过程中会重新计算，但为了排序的完整性还是交换</span><br><span class="line">				Time temp_JobTime = p-&gt;JobTime;</span><br><span class="line">				p-&gt;JobTime = q-&gt;JobTime;</span><br><span class="line">				q-&gt;JobTime = temp_JobTime;</span><br><span class="line">				</span><br><span class="line">				int temp_JobWait = p-&gt;JobWait;</span><br><span class="line">				p-&gt;JobWait = q-&gt;JobWait;</span><br><span class="line">				q-&gt;JobWait = temp_JobWait;</span><br><span class="line">				</span><br><span class="line">				Time temp_ProcessTime = p-&gt;ProcessTime;</span><br><span class="line">				p-&gt;ProcessTime = q-&gt;ProcessTime;</span><br><span class="line">				q-&gt;ProcessTime = temp_ProcessTime;</span><br><span class="line">				</span><br><span class="line">				int temp_ProcessWait = p-&gt;ProcessWait;</span><br><span class="line">				p-&gt;ProcessWait = q-&gt;ProcessWait;</span><br><span class="line">				q-&gt;ProcessWait = temp_ProcessWait;</span><br><span class="line">				</span><br><span class="line">				Time temp_finish = p-&gt;finish;</span><br><span class="line">				p-&gt;finish = q-&gt;finish;</span><br><span class="line">				q-&gt;finish = temp_finish;</span><br><span class="line">				</span><br><span class="line">				int temp_zz = p-&gt;zz;</span><br><span class="line">				p-&gt;zz = q-&gt;zz;</span><br><span class="line">				q-&gt;zz = temp_zz;</span><br><span class="line">				</span><br><span class="line">				float temp_zzxs = p-&gt;zzxs;</span><br><span class="line">				p-&gt;zzxs = q-&gt;zzxs;</span><br><span class="line">				q-&gt;zzxs = temp_zzxs;</span><br><span class="line">				</span><br><span class="line">				int temp_finished = p-&gt;finished;</span><br><span class="line">				p-&gt;finished = q-&gt;finished;</span><br><span class="line">				q-&gt;finished = temp_finished;</span><br><span class="line">				</span><br><span class="line">				float temp_response = p-&gt;response;</span><br><span class="line">				p-&gt;response = q-&gt;response;</span><br><span class="line">				q-&gt;response = temp_response;</span><br><span class="line">			&#125;</span><br><span class="line">			p = p-&gt;next;</span><br><span class="line">			q = q-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		end = p;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 调度过程 (排序后按顺序处理)</span><br><span class="line">	p = head;</span><br><span class="line">	Time current_time = &#123;8, 0&#125;; // Start time at 8:00</span><br><span class="line">	</span><br><span class="line">	while (p != NULL) &#123;</span><br><span class="line">		// Adjust current time if job hasn&#x27;t arrived yet</span><br><span class="line">		if (time_diff(current_time, p-&gt;arrive) &lt; 0) &#123;</span><br><span class="line">			current_time = p-&gt;arrive;</span><br><span class="line">		&#125;</span><br><span class="line">		// Job scheduling time is the current time</span><br><span class="line">		p-&gt;JobTime = current_time;</span><br><span class="line">		p-&gt;JobWait = time_diff(current_time, p-&gt;arrive);</span><br><span class="line">		</span><br><span class="line">		// Process scheduling time (same as job scheduling in FCFS)</span><br><span class="line">		p-&gt;ProcessTime = current_time;</span><br><span class="line">		p-&gt;ProcessWait = 0;</span><br><span class="line">		</span><br><span class="line">		// Completion time = current time + execution time</span><br><span class="line">		p-&gt;finish.hour = current_time.hour + (current_time.min + p-&gt;zx) / 60;</span><br><span class="line">		p-&gt;finish.min = (current_time.min + p-&gt;zx) % 60;</span><br><span class="line">		</span><br><span class="line">		// Update current time to completion time</span><br><span class="line">		current_time = p-&gt;finish;</span><br><span class="line">		</span><br><span class="line">		// Turnaround time = completion time - arrival time</span><br><span class="line">		p-&gt;zz = time_diff(p-&gt;finish, p-&gt;arrive);</span><br><span class="line">		</span><br><span class="line">		// Weighted turnaround time = turnaround time / execution time</span><br><span class="line">		p-&gt;zzxs = (float)p-&gt;zz / p-&gt;zx;</span><br><span class="line">		</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 短作业优先（SJF）调度算法</span><br><span class="line">void SJF(node* head) &#123;</span><br><span class="line">	Time current_time = &#123;8, 0&#125;; // 开始时间为8:00</span><br><span class="line">	while (1) &#123;</span><br><span class="line">		// 找到已到达的未完成作业中执行时间最短的</span><br><span class="line">		node* shortest = NULL;</span><br><span class="line">		node* temp = head;</span><br><span class="line">		int min_zx = 9999;</span><br><span class="line">		</span><br><span class="line">		while (temp != NULL) &#123;</span><br><span class="line">			if (!temp-&gt;finished &amp;&amp; time_diff(current_time, temp-&gt;arrive) &gt;= 0) &#123;</span><br><span class="line">				if (temp-&gt;zx &lt; min_zx) &#123;</span><br><span class="line">					min_zx = temp-&gt;zx;</span><br><span class="line">					shortest = temp;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			temp = temp-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (shortest != NULL) &#123;</span><br><span class="line">			shortest-&gt;JobTime = current_time;</span><br><span class="line">			shortest-&gt;JobWait = time_diff(current_time, shortest-&gt;arrive);</span><br><span class="line">			shortest-&gt;ProcessTime = current_time;</span><br><span class="line">			shortest-&gt;ProcessWait = 0;</span><br><span class="line">			</span><br><span class="line">			// 计算完成时间</span><br><span class="line">			shortest-&gt;finish.hour = current_time.hour + (current_time.min + shortest-&gt;zx) / 60;</span><br><span class="line">			shortest-&gt;finish.min = (current_time.min + shortest-&gt;zx) % 60;</span><br><span class="line">			</span><br><span class="line">			// 更新当前时间</span><br><span class="line">			current_time = shortest-&gt;finish;</span><br><span class="line">			</span><br><span class="line">			// 计算周转时间</span><br><span class="line">			shortest-&gt;zz = time_diff(shortest-&gt;finish, shortest-&gt;arrive);</span><br><span class="line">			</span><br><span class="line">			// 计算带权周转时间</span><br><span class="line">			shortest-&gt;zzxs = (float)shortest-&gt;zz / shortest-&gt;zx;</span><br><span class="line">			</span><br><span class="line">			shortest-&gt;finished = 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			// 检查是否还有作业需要处理</span><br><span class="line">			temp = head;</span><br><span class="line">			int all_finished = 1;</span><br><span class="line">			while (temp != NULL) &#123;</span><br><span class="line">				if (!temp-&gt;finished) &#123;</span><br><span class="line">					all_finished = 0;</span><br><span class="line">					// 将当前时间移动到剩余作业中最早的到达时间</span><br><span class="line">					if (time_diff(current_time, temp-&gt;arrive) &lt; 0) &#123;</span><br><span class="line">						if (current_time.hour * 60 + current_time.min &gt; temp-&gt;arrive.hour * 60 + temp-&gt;arrive.min) &#123;</span><br><span class="line">							current_time = temp-&gt;arrive;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				temp = temp-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			if (all_finished) break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 高响应比优先（HRRF）调度算法</span><br><span class="line">void HRRF(node* head) &#123;</span><br><span class="line">	Time current_time = &#123;8, 0&#125;; // 开始时间为8:00</span><br><span class="line">	while (1) &#123;</span><br><span class="line">		// 计算所有已到达作业的响应比</span><br><span class="line">		node* temp = head;</span><br><span class="line">		while (temp != NULL) &#123;</span><br><span class="line">			if (!temp-&gt;finished &amp;&amp; time_diff(current_time, temp-&gt;arrive) &gt;= 0) &#123;</span><br><span class="line">				int wait_time = time_diff(current_time, temp-&gt;arrive);</span><br><span class="line">				temp-&gt;response = 1.0 + (float)wait_time / temp-&gt;zx;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				temp-&gt;response = 0.0;</span><br><span class="line">			&#125;</span><br><span class="line">			temp = temp-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// 找到响应比最高的作业</span><br><span class="line">		node* highest = NULL;</span><br><span class="line">		float max_response = -1.0;</span><br><span class="line">		temp = head;</span><br><span class="line">		</span><br><span class="line">		while (temp != NULL) &#123;</span><br><span class="line">			if (!temp-&gt;finished &amp;&amp; temp-&gt;response &gt; max_response) &#123;</span><br><span class="line">				max_response = temp-&gt;response;</span><br><span class="line">				highest = temp;</span><br><span class="line">			&#125;</span><br><span class="line">			temp = temp-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if (highest != NULL) &#123;</span><br><span class="line">			highest-&gt;JobTime = current_time;</span><br><span class="line">			highest-&gt;JobWait = time_diff(current_time, highest-&gt;arrive);</span><br><span class="line">			highest-&gt;ProcessTime = current_time;</span><br><span class="line">			highest-&gt;ProcessWait = 0;</span><br><span class="line">			</span><br><span class="line">			// 计算完成时间</span><br><span class="line">			highest-&gt;finish.hour = current_time.hour + (current_time.min + highest-&gt;zx) / 60;</span><br><span class="line">			highest-&gt;finish.min = (current_time.min + highest-&gt;zx) % 60;</span><br><span class="line">			</span><br><span class="line">			// 更新当前时间</span><br><span class="line">			current_time = highest-&gt;finish;</span><br><span class="line">			</span><br><span class="line">			// 计算周转时间</span><br><span class="line">			highest-&gt;zz = time_diff(highest-&gt;finish, highest-&gt;arrive);</span><br><span class="line">			</span><br><span class="line">			// 计算带权周转时间</span><br><span class="line">			highest-&gt;zzxs = (float)highest-&gt;zz / highest-&gt;zx;</span><br><span class="line">			</span><br><span class="line">			highest-&gt;finished = 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			// 检查是否还有作业需要处理</span><br><span class="line">			temp = head;</span><br><span class="line">			int all_finished = 1;</span><br><span class="line">			while (temp != NULL) &#123;</span><br><span class="line">				if (!temp-&gt;finished) &#123;</span><br><span class="line">					all_finished = 0;</span><br><span class="line">					// 将当前时间移动到剩余作业中最早的到达时间</span><br><span class="line">					if (time_diff(current_time, temp-&gt;arrive) &lt; 0) &#123;</span><br><span class="line">						if (current_time.hour * 60 + current_time.min &gt; temp-&gt;arrive.hour * 60 + temp-&gt;arrive.min) &#123;</span><br><span class="line">							current_time = temp-&gt;arrive;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				temp = temp-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			if (all_finished) break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 打印结果的函数</span><br><span class="line">void print_results(node* head, char* algorithm) &#123;</span><br><span class="line">	printf(&quot;\n模拟作业%s调度过程输出结果：\n&quot;, algorithm);</span><br><span class="line">	printf(&quot;名字    入井时间    运行时间(分钟)    作业调度时间    作业调度等待时间    进程调度时间    进程调度等待时间    完成时间    周转时间    带权周转系数:\n&quot;);</span><br><span class="line">	</span><br><span class="line">	node* p = head;</span><br><span class="line">	float avg_zz = 0, avg_zzxs = 0;</span><br><span class="line">	int count = 0;</span><br><span class="line">	</span><br><span class="line">	while (p != NULL) &#123;</span><br><span class="line">		printf(&quot;%s\t%02d:%02d\t    %-3d(分钟)         %02d:%02d\t      %-3d(分钟)\t\t  %02d:%02d           %-3d(分钟)           %02d:%02d       %-3d(分钟)   %.4f(系数)\n&quot;,</span><br><span class="line">			p-&gt;name, p-&gt;arrive.hour, p-&gt;arrive.min, p-&gt;zx,</span><br><span class="line">			p-&gt;JobTime.hour, p-&gt;JobTime.min, p-&gt;JobWait,</span><br><span class="line">			p-&gt;ProcessTime.hour, p-&gt;ProcessTime.min, p-&gt;ProcessWait,</span><br><span class="line">			p-&gt;finish.hour, p-&gt;finish.min, p-&gt;zz, p-&gt;zzxs);</span><br><span class="line">		avg_zz += p-&gt;zz;</span><br><span class="line">		avg_zzxs += p-&gt;zzxs;</span><br><span class="line">		count++;</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;系统平均周转时间为: %.2f\n&quot;, avg_zz / count);</span><br><span class="line">	printf(&quot;系统带权平均周转时间为: %.4f\n&quot;, avg_zzxs / count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 重置作业完成标志，用于下一次调度</span><br><span class="line">void reset_jobs(node* head) &#123;</span><br><span class="line">	node* p = head;</span><br><span class="line">	while (p != NULL) &#123;</span><br><span class="line">		p-&gt;finished = 0;</span><br><span class="line">		p-&gt;response = 0.0;</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	int algorithm, num_jobs;</span><br><span class="line">	char name[20];</span><br><span class="line">	int arrive_hour, arrive_min, zx;</span><br><span class="line">    printf(&quot;请输入操作(1:开始调度;0:结束作业): &quot;);</span><br><span class="line">		</span><br><span class="line">	int choice;</span><br><span class="line">	if (scanf(&quot;%d&quot;, &amp;choice) != 1 || choice &lt; 0 || choice &gt; 1) &#123;</span><br><span class="line">		printf(&quot;输入无效!\n&quot;);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	if (choice == 0) &#123;</span><br><span class="line">		printf(&quot;感谢使用，再见！\n&quot;);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	while (1) &#123;</span><br><span class="line">        printf(&quot;请输入要创建的作业数量: &quot;);</span><br><span class="line">		if (scanf(&quot;%d&quot;, &amp;num_jobs) != 1 || num_jobs &lt;= 0) &#123;</span><br><span class="line">			printf(&quot;输入无效，请输入大于0的数字\n&quot;);</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">        printf(&quot;请输入作业信息：\n&quot;);</span><br><span class="line">		printf(&quot;作业名 入井时间 执行时间(分钟)\n&quot;);</span><br><span class="line">		</span><br><span class="line">		// 创建作业链表</span><br><span class="line">		node* head = NULL;</span><br><span class="line">		node* tail = NULL;</span><br><span class="line">		</span><br><span class="line">		for (int i = 0; i &lt; num_jobs; i++) &#123;</span><br><span class="line">			if (scanf(&quot;%s %d:%d %d&quot;, name, &amp;arrive_hour, &amp;arrive_min, &amp;zx) != 4) &#123;</span><br><span class="line">				printf(&quot;输入格式错误，请重新输入\n&quot;);</span><br><span class="line">				i--;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			// 验证输入的时间是否有效</span><br><span class="line">			if (arrive_hour &lt; 0 || arrive_hour &gt; 23 || arrive_min &lt; 0 || arrive_min &gt; 59) &#123;</span><br><span class="line">				printf(&quot;时间格式无效，请重新输入\n&quot;);</span><br><span class="line">				i--;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			// 验证执行时间是否有效</span><br><span class="line">			if (zx &lt;= 0) &#123;</span><br><span class="line">				printf(&quot;执行时间必须大于0，请重新输入\n&quot;);</span><br><span class="line">				i--;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			node* new_node = create_node(name, arrive_hour, arrive_min, zx);</span><br><span class="line">			if (head == NULL) &#123;</span><br><span class="line">				head = new_node;</span><br><span class="line">				tail = new_node;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				tail-&gt;next = new_node;</span><br><span class="line">				tail = new_node;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		printf(&quot;\n***************作业管理***************\n&quot;);</span><br><span class="line">		printf(&quot;        1. 先来先服务 (FCFS)\n&quot;);</span><br><span class="line">		printf(&quot;        2. 短作业优先 (SJF)\n&quot;);</span><br><span class="line">		printf(&quot;        3. 高响应比优先 (HRRF)\n&quot;);</span><br><span class="line">        printf(&quot;        0. 退出\n&quot;);</span><br><span class="line">		printf(&quot;请选择要进行的操作号: &quot;);</span><br><span class="line">		</span><br><span class="line">		scanf(&quot;%d&quot;, &amp;algorithm);</span><br><span class="line">		switch(algorithm)&#123;</span><br><span class="line">            case 1:</span><br><span class="line">                FCFS(head);</span><br><span class="line">                print_results(head, &quot;先来先服务 (FCFS)&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                SJF(head);</span><br><span class="line">                print_results(head, &quot;短作业优先 (SJF)&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                HRRF(head);</span><br><span class="line">			    print_results(head, &quot;高响应比优先 (HRRF)&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                printf(&quot;输入无效!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		// 释放内存</span><br><span class="line">		node* temp;</span><br><span class="line">		while (head != NULL) &#123;</span><br><span class="line">			temp = head;</span><br><span class="line">			head = head-&gt;next;</span><br><span class="line">			free(temp);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">        printf(&quot;========================================================================================================\n&quot;);</span><br><span class="line">		printf(&quot;是否继续进行调度实验，开始实验：1，退出实验：-1:&quot;);</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;choice);</span><br><span class="line">        if(choice!=1) break;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag"><i class="fa fa-tag"></i> 操作系统</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/18925/" rel="prev" title="GHCTF">
      <i class="fa fa-chevron-left"></i> GHCTF
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/31372/" rel="next" title="环境变量">
      环境变量 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E5%91%A8%EF%BC%9A%E6%A8%A1%E6%8B%9F%E9%98%9F%E5%88%97%E7%AE%A1%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">第一周：模拟队列管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E5%91%A8%EF%BC%9AFCFS%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">第三周：FCFS进程调度算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E5%91%A8%EF%BC%9A%E7%9F%AD%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%85%88%E8%B0%83%E5%BA%A6"><span class="nav-number">3.</span> <span class="nav-text">第四周：短进程优先调度</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E5%91%A8%EF%BC%9A-%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="nav-number">4.</span> <span class="nav-text">第五周： 优先级调度算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E5%91%A8%EF%BC%9A%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%BD%AC%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="nav-number">5.</span> <span class="nav-text">第六周：时间片轮转调度算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E5%91%A8%EF%BC%9A-%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95"><span class="nav-number">6.</span> <span class="nav-text">第七周： 银行家算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E5%91%A8%EF%BC%9A%E5%9B%BA%E5%AE%9A%E5%88%86%E5%8C%BA%E7%AE%97%E6%B3%95"><span class="nav-number">7.</span> <span class="nav-text">第八周：固定分区算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B9%9D%E5%91%A8%EF%BC%9A%E5%8F%AF%E5%8F%98%E5%88%86%E5%8C%BA%E7%AE%97%E6%B3%95"><span class="nav-number">8.</span> <span class="nav-text">第九周：可变分区算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E5%91%A8%EF%BC%9A%E5%88%86%E9%A1%B5%E5%88%86%E5%8C%BA%E7%AE%97%E6%B3%95"><span class="nav-number">9.</span> <span class="nav-text">第十周：分页分区算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E5%91%A8%EF%BC%88%E9%80%89%E5%81%9A%EF%BC%89%EF%BC%9A%E6%AE%B5%E9%A1%B5%E5%BC%8F%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="nav-number">10.</span> <span class="nav-text">第十一周（选做）：段页式存储管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E5%91%A8%EF%BC%9A%E5%88%86%E6%AE%B5%E5%BC%8F%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="nav-number">11.</span> <span class="nav-text">第十一周：分段式存储管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E5%91%A8%EF%BC%9A%E9%A1%B5%E9%9D%A2%E7%BD%AE%E6%8D%A2"><span class="nav-number">12.</span> <span class="nav-text">第十二周：页面置换</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E5%91%A8%EF%BC%9A%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E5%9B%9E%E6%94%B6"><span class="nav-number">13.</span> <span class="nav-text">第十三周：设备分配回收</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E5%91%A8%EF%BC%9A%E7%A7%BB%E8%87%82%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="nav-number">14.</span> <span class="nav-text">第十四周：移臂调度算法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E5%91%A8%EF%BC%9A%E8%BE%85%E5%AD%98%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%A1%E7%90%86"><span class="nav-number">15.</span> <span class="nav-text">第十五周：辅存空间的管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E5%91%A8%EF%BC%9A%E5%8D%95%E9%81%93%E6%89%B9%E5%A4%84%E7%90%86%E4%BD%9C%E4%B8%9A%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="nav-number">16.</span> <span class="nav-text">第十六周：单道批处理作业调度算法</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="comhacker"
      src="/images/avatar_2.gif">
  <p class="site-author-name" itemprop="name">comhacker</p>
  <div class="site-description" itemprop="description">位卑未敢忘忧国，事定犹须待阖棺</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">comhacker</span>
</div>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : ,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
